(function(){const t=document.createElement("link").relList;if(t&&t.supports&&t.supports("modulepreload"))return;for(const r of document.querySelectorAll('link[rel="modulepreload"]'))i(r);new MutationObserver(r=>{for(const a of r)if(a.type==="childList")for(const o of a.addedNodes)o.tagName==="LINK"&&o.rel==="modulepreload"&&i(o)}).observe(document,{childList:!0,subtree:!0});function e(r){const a={};return r.integrity&&(a.integrity=r.integrity),r.referrerPolicy&&(a.referrerPolicy=r.referrerPolicy),r.crossOrigin==="use-credentials"?a.credentials="include":r.crossOrigin==="anonymous"?a.credentials="omit":a.credentials="same-origin",a}function i(r){if(r.ep)return;r.ep=!0;const a=e(r);fetch(r.href,a)}})();const Ut=class Ut{constructor(t=0){t<1?(this._ptr=[],this._capacity=0,this._size=0):(this._ptr=new Array(t),this._capacity=t,this._size=0)}at(t){return this._ptr[t]}set(t,e){this._ptr[t]=e}get(t=0){const e=new Array;for(let i=t;i<this._size;i++)e.push(this._ptr[i]);return e}pushBack(t){this._size>=this._capacity&&this.prepareCapacity(this._capacity==0?Ut.s_defaultSize:this._capacity*2),this._ptr[this._size++]=t}clear(){this._ptr.length=0,this._size=0}getSize(){return this._size}assign(t,e){this._size<t&&this.prepareCapacity(t);for(let r=0;r<t;r++)this._ptr[r]=e;this._size=t}resize(t,e=null){this.updateSize(t,e,!0)}updateSize(t,e=null,i=!0){if(this._size<t)if(this.prepareCapacity(t),i)for(let a=this._size;a<t;a++)typeof e=="function"?this._ptr[a]=JSON.parse(JSON.stringify(new e)):this._ptr[a]=e;else for(let a=this._size;a<t;a++)this._ptr[a]=e;else{const a=this._size-t;this._ptr.splice(this._size-a,a)}this._size=t}insert(t,e,i){let r=t._index;const a=e._index,o=i._index,n=o-a;this.prepareCapacity(this._size+n);const l=this._size-r;if(l>0)for(let u=0;u<l;u++)this._ptr.splice(r+u,0,null);for(let u=a;u<o;u++,r++)this._ptr[r]=e._vector._ptr[u];this._size=this._size+n}remove(t){return t<0||this._size<=t?!1:(this._ptr.splice(t,1),--this._size,!0)}erase(t){const e=t._index;return e<0||this._size<=e?t:(this._ptr.splice(e,1),--this._size,new oe(this,e))}prepareCapacity(t){t>this._capacity&&(this._capacity==0?(this._ptr=new Array(t),this._capacity=t):(this._ptr.length=t,this._capacity=t))}begin(){return this._size==0?this.end():new oe(this,0)}end(){return new oe(this,this._size)}getOffset(t){const e=new Ut;return e._ptr=this.get(t),e._size=this.get(t).length,e._capacity=this.get(t).length,e}};Ut.s_defaultSize=10;let C=Ut,oe=class Te{constructor(t,e){this._vector=t??null,this._index=e??0}set(t){return this._index=t._index,this._vector=t._vector,this}preIncrement(){return++this._index,this}preDecrement(){return--this._index,this}increment(){return new Te(this._vector,this._index++)}decrement(){return new Te(this._vector,this._index--)}ptr(){return this._vector._ptr[this._index]}substitution(t){return this._index=t._index,this._vector=t._vector,this}notEqual(t){return this._index!=t._index||this._vector!=t._vector}};var He;(s=>{s.csmVector=C,s.iterator=oe})(He||(He={}));class H{append(t,e){return this.s+=e!==void 0?t.substr(0,e):t,this}expansion(t,e){for(let i=0;i<t;i++)this.append(e);return this}getBytes(){return encodeURIComponent(this.s).replace(/%../g,"x").length}getLength(){return this.s.length}isLess(t){return this.s<t.s}isGreat(t){return this.s>t.s}isEqual(t){return this.s==t}isEmpty(){return this.s.length==0}constructor(t){this.s=t}}var $e;(s=>{s.csmString=H})($e||($e={}));class Yt{getString(){return this._id}constructor(t){if(typeof t=="string"){this._id=new H(t);return}this._id=t}isEqual(t){return typeof t=="string"?this._id.isEqual(t):t instanceof H?this._id.isEqual(t.s):t instanceof Yt?this._id.isEqual(t._id.s):!1}isNotEqual(t){return typeof t=="string"?!this._id.isEqual(t):t instanceof H?!this._id.isEqual(t.s):t instanceof Yt?!this._id.isEqual(t._id.s):!1}}var qe;(s=>{s.CubismId=Yt})(qe||(qe={}));class cs{constructor(){this._ids=new C}release(){for(let t=0;t<this._ids.getSize();++t)this._ids.set(t,void 0);this._ids=null}registerIds(t){for(let e=0;e<t.length;e++)this.registerId(t[e])}registerId(t){let e=null;if(typeof t=="string"){if((e=this.findId(t))!=null)return e;e=new Yt(t),this._ids.pushBack(e)}else return this.registerId(t.s);return e}getId(t){return this.registerId(t)}isExist(t){return typeof t=="string"?this.findId(t)!=null:this.isExist(t.s)}findId(t){for(let e=0;e<this._ids.getSize();++e)if(this._ids.at(e).getString().isEqual(t))return this._ids.at(e);return null}}var We;(s=>{s.CubismIdManager=cs})(We||(We={}));class F{constructor(){this._tr=new Float32Array(16),this.loadIdentity()}static multiply(t,e,i){const r=new Float32Array([0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0]),a=4;for(let o=0;o<a;++o)for(let n=0;n<a;++n)for(let l=0;l<a;++l)r[n+o*4]+=t[l+o*4]*e[n+l*4];for(let o=0;o<16;++o)i[o]=r[o]}loadIdentity(){const t=new Float32Array([1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1]);this.setMatrix(t)}setMatrix(t){for(let e=0;e<16;++e)this._tr[e]=t[e]}getArray(){return this._tr}getScaleX(){return this._tr[0]}getScaleY(){return this._tr[5]}getTranslateX(){return this._tr[12]}getTranslateY(){return this._tr[13]}transformX(t){return this._tr[0]*t+this._tr[12]}transformY(t){return this._tr[5]*t+this._tr[13]}invertTransformX(t){return(t-this._tr[12])/this._tr[0]}invertTransformY(t){return(t-this._tr[13])/this._tr[5]}translateRelative(t,e){const i=new Float32Array([1,0,0,0,0,1,0,0,0,0,1,0,t,e,0,1]);F.multiply(i,this._tr,this._tr)}translate(t,e){this._tr[12]=t,this._tr[13]=e}translateX(t){this._tr[12]=t}translateY(t){this._tr[13]=t}scaleRelative(t,e){const i=new Float32Array([t,0,0,0,0,e,0,0,0,0,1,0,0,0,0,1]);F.multiply(i,this._tr,this._tr)}scale(t,e){this._tr[0]=t,this._tr[5]=e}multiplyByMatrix(t){F.multiply(t.getArray(),this._tr,this._tr)}clone(){const t=new F;for(let e=0;e<this._tr.length;e++)t._tr[e]=this._tr[e];return t}}var Je;(s=>{s.CubismMatrix44=F})(Je||(Je={}));class me{static create(){return null}static delete(t){}initialize(t){this._model=t}drawModel(){this.getModel()!=null&&(this.saveProfile(),this.doDrawModel(),this.restoreProfile())}setMvpMatrix(t){this._mvpMatrix4x4.setMatrix(t.getArray())}getMvpMatrix(){return this._mvpMatrix4x4}setModelColor(t,e,i,r){t<0?t=0:t>1&&(t=1),e<0?e=0:e>1&&(e=1),i<0?i=0:i>1&&(i=1),r<0?r=0:r>1&&(r=1),this._modelColor.R=t,this._modelColor.G=e,this._modelColor.B=i,this._modelColor.A=r}getModelColor(){return JSON.parse(JSON.stringify(this._modelColor))}setIsPremultipliedAlpha(t){this._isPremultipliedAlpha=t}isPremultipliedAlpha(){return this._isPremultipliedAlpha}setIsCulling(t){this._isCulling=t}isCulling(){return this._isCulling}setAnisotropy(t){this._anisotropy=t}getAnisotropy(){return this._anisotropy}getModel(){return this._model}useHighPrecisionMask(t){this._useHighPrecisionMask=t}isUsingHighPrecisionMask(){return this._useHighPrecisionMask}constructor(){this._isCulling=!1,this._isPremultipliedAlpha=!1,this._anisotropy=0,this._model=null,this._modelColor=new z,this._useHighPrecisionMask=!1,this._mvpMatrix4x4=new F,this._mvpMatrix4x4.loadIdentity()}}var et=(s=>(s[s.CubismBlendMode_Normal=0]="CubismBlendMode_Normal",s[s.CubismBlendMode_Additive=1]="CubismBlendMode_Additive",s[s.CubismBlendMode_Multiplicative=2]="CubismBlendMode_Multiplicative",s))(et||{});class z{constructor(t=1,e=1,i=1,r=1){this.R=t,this.G=e,this.B=i,this.A=r}}var Ke;(s=>{s.CubismBlendMode=et,s.CubismRenderer=me,s.CubismTextureColor=z})(Ke||(Ke={}));const Ws=(s,t,e)=>{ds.print(s,"[CSM]"+t,e)},Qt=(s,t,e)=>{Ws(s,t+`
`,e)},Z=s=>{console.assert(s)};let jt,Q,ut,U;jt=(s,...t)=>{Qt(vt.LogLevel_Debug,"[D]"+s,t)},Q=(s,...t)=>{Qt(vt.LogLevel_Info,"[I]"+s,t)},ut=(s,...t)=>{Qt(vt.LogLevel_Warning,"[W]"+s,t)},U=(s,...t)=>{Qt(vt.LogLevel_Error,"[E]"+s,t)};class ds{static print(t,e,i){if(t<I.getLoggingLevel())return;const r=I.coreLogFunction;if(!r)return;const a=e.replace(/\{(\d+)\}/g,(o,n)=>i[n]);r(a)}static dumpBytes(t,e,i){for(let r=0;r<i;r++)r%16==0&&r>0?this.print(t,`
`):r%8==0&&r>0&&this.print(t,"  "),this.print(t,"{0} ",[e[r]&255]);this.print(t,`
`)}constructor(){}}var Ze;(s=>{s.CubismDebug=ds})(Ze||(Ze={}));class _s{constructor(t,e){this.first=t??null,this.second=e??null}}const zt=class zt{constructor(t){t!=null?t<1?(this._keyValues=[],this._dummyValue=null,this._size=0):(this._keyValues=new Array(t),this._size=t):(this._keyValues=[],this._dummyValue=null,this._size=0)}release(){this.clear()}appendKey(t){this.prepareCapacity(this._size+1,!1),this._keyValues[this._size]=new _s(t),this._size+=1}getValue(t){let e=-1;for(let i=0;i<this._size;i++)if(this._keyValues[i].first==t){e=i;break}return e>=0?this._keyValues[e].second:(this.appendKey(t),this._keyValues[this._size-1].second)}setValue(t,e){let i=-1;for(let r=0;r<this._size;r++)if(this._keyValues[r].first==t){i=r;break}i>=0?this._keyValues[i].second=e:(this.appendKey(t),this._keyValues[this._size-1].second=e)}isExist(t){for(let e=0;e<this._size;e++)if(this._keyValues[e].first==t)return!0;return!1}clear(){this._keyValues=void 0,this._keyValues=null,this._keyValues=[],this._size=0}getSize(){return this._size}prepareCapacity(t,e){t>this._keyValues.length&&(this._keyValues.length==0?(!e&&t<zt.DefaultSize&&(t=zt.DefaultSize),this._keyValues.length=t):(!e&&t<this._keyValues.length*2&&(t=this._keyValues.length*2),this._keyValues.length=t))}begin(){return new pt(this,0)}end(){return new pt(this,this._size)}erase(t){const e=t._index;return e<0||this._size<=e?t:(this._keyValues.splice(e,1),--this._size,new pt(this,e))}dumpAsInt(){for(let t=0;t<this._size;t++)jt("{0} ,",this._keyValues[t]),jt(`
`)}};zt.DefaultSize=10;let Y=zt;class pt{constructor(t,e){this._map=t??new Y,this._index=e??0}set(t){return this._index=t._index,this._map=t._map,this}preIncrement(){return++this._index,this}preDecrement(){return--this._index,this}increment(){return new pt(this._map,this._index++)}decrement(){const t=new pt(this._map,this._index);return this._map=t._map,this._index=t._index,this}ptr(){return this._map._keyValues[this._index]}notEqual(t){return this._index!=t._index||this._map!=t._map}}var Qe;(s=>{s.csmMap=Y,s.csmPair=_s,s.iterator=pt})(Qe||(Qe={}));class le{static parseJsonObject(t,e){return Object.keys(t).forEach(i=>{if(typeof t[i]=="boolean"){const r=!!t[i];e.put(i,new K(r))}else if(typeof t[i]=="string"){const r=String(t[i]);e.put(i,new Et(r))}else if(typeof t[i]=="number"){const r=Number(t[i]);e.put(i,new he(r))}else t[i]instanceof Array?e.put(i,le.parseJsonArray(t[i])):t[i]instanceof Object?e.put(i,le.parseJsonObject(t[i],new Rt)):t[i]==null?e.put(i,new Tt):e.put(i,t[i])}),e}static parseJsonArray(t){const e=new ke;return Object.keys(t).forEach(i=>{if(typeof Number(i)=="number")if(typeof t[i]=="boolean"){const a=!!t[i];e.add(new K(a))}else if(typeof t[i]=="string"){const a=String(t[i]);e.add(new Et(a))}else if(typeof t[i]=="number"){const a=Number(t[i]);e.add(new he(a))}else t[i]instanceof Array?e.add(this.parseJsonArray(t[i])):t[i]instanceof Object?e.add(this.parseJsonObject(t[i],new Rt)):t[i]==null?e.add(new Tt):e.add(t[i]);else if(t[i]instanceof Array)e.add(this.parseJsonArray(t[i]));else if(t[i]instanceof Object)e.add(this.parseJsonObject(t[i],new Rt));else if(t[i]==null)e.add(new Tt);else{const a=Array(t[i]);for(let o=0;o<a.length;o++)e.add(a[o])}}),e}}const ue="Error: type mismatch",Js="Error: index out of bounds";let k=class tt{constructor(){}getRawString(t,e){return this.getString(t,e)}toInt(t=0){return t}toFloat(t=0){return t}toBoolean(t=!1){return t}getSize(){return 0}getArray(t=null){return t}getVector(t=new C){return t}getMap(t){return t}getValueByIndex(t){return tt.errorValue.setErrorNotForClientCall(ue)}getValueByString(t){return tt.nullValue.setErrorNotForClientCall(ue)}getKeys(){return tt.s_dummyKeys}isError(){return!1}isNull(){return!1}isBool(){return!1}isFloat(){return!1}isString(){return!1}isArray(){return!1}isMap(){return!1}equals(t){return!1}isStatic(){return!1}setErrorNotForClientCall(t){return Gt.errorValue}static staticInitializeNotForClientCall(){K.trueValue=new K(!0),K.falseValue=new K(!1),tt.errorValue=new Gt("ERROR",!0),tt.nullValue=new Tt,tt.s_dummyKeys=new C}static staticReleaseNotForClientCall(){K.trueValue=null,K.falseValue=null,tt.errorValue=null,tt.nullValue=null,tt.s_dummyKeys=null}};class O{constructor(t,e){this._parseCallback=le.parseJsonObject,this._error=null,this._lineCount=0,this._root=null,t!=null&&this.parseBytes(t,e,this._parseCallback)}static create(t,e){const i=new O;return i.parseBytes(t,e,i._parseCallback)?i:(O.delete(i),null)}static delete(t){}getRoot(){return this._root}static arrayBufferToString(t){const e=new Uint8Array(t);let i="";for(let r=0,a=e.length;r<a;++r)i+="%"+this.pad(e[r].toString(16));return i=decodeURIComponent(i),i}static pad(t){return t.length<2?"0"+t:t}parseBytes(t,e,i){const r=new Array(1),a=O.arrayBufferToString(t);if(i==null?this._root=this.parseValue(a,e,0,r):this._root=i(JSON.parse(a),new Rt),this._error){let o="\0";return o="Json parse error : @line "+(this._lineCount+1)+`
`,this._root=new Et(o),Q("{0}",this._root.getRawString()),!1}else if(this._root==null)return this._root=new Gt(new H(this._error),!1),!1;return!0}getParseError(){return this._error}checkEndOfFile(){return this._root.getArray()[1].equals("EOF")}parseValue(t,e,i,r){if(this._error)return null;let a=null,o=i,n;for(;o<e;o++)switch(t[o]){case"-":case".":case"0":case"1":case"2":case"3":case"4":case"5":case"6":case"7":case"8":case"9":{const u=new Array(1);return n=Ks(t.slice(o),u),r[0]=t.indexOf(u[0]),new he(n)}case'"':return new Et(this.parseString(t,e,o+1,r));case"[":return a=this.parseArray(t,e,o+1,r),a;case"{":return a=this.parseObject(t,e,o+1,r),a;case"n":return o+3<e?(a=new Tt,r[0]=o+4):this._error="parse null",a;case"t":return o+3<e?(a=K.trueValue,r[0]=o+4):this._error="parse true",a;case"f":return o+4<e?(a=K.falseValue,r[0]=o+5):this._error="illegal ',' position",a;case",":return this._error="illegal ',' position",null;case"]":return r[0]=o,null;case`
`:this._lineCount++}return this._error="illegal end of value",null}parseString(t,e,i,r){if(this._error)return null;let a=i,o,n;const l=new H("");let u=i;for(;a<e;a++)switch(o=t[a],o){case'"':return r[0]=a+1,l.append(t.slice(u),a-u),l.s;case"//":if(a++,a-1>u&&l.append(t.slice(u),a-u),u=a+1,a<e)switch(n=t[a],n){case"\\":l.expansion(1,"\\");break;case'"':l.expansion(1,'"');break;case"/":l.expansion(1,"/");break;case"b":l.expansion(1,"\b");break;case"f":l.expansion(1,"\f");break;case"n":l.expansion(1,`
`);break;case"r":l.expansion(1,"\r");break;case"t":l.expansion(1,"	");break;case"u":this._error="parse string/unicord escape not supported";break}else this._error="parse string/escape error"}return this._error="parse string/illegal end",null}parseObject(t,e,i,r){if(this._error)return null;const a=new Rt;let o="",n=i,l="";const u=Array(1);let h=!1;for(;n<e;n++){t:for(;n<e;n++)switch(l=t[n],l){case'"':if(o=this.parseString(t,e,n+1,u),this._error)return null;n=u[0],h=!0;break t;case"}":return r[0]=n+1,a;case":":this._error="illegal ':' position";break;case`
`:this._lineCount++}if(!h)return this._error="key not found",null;h=!1;t:for(;n<e;n++)switch(l=t[n],l){case":":h=!0,n++;break t;case"}":this._error="illegal '}' position";break;case`
`:this._lineCount++}if(!h)return this._error="':' not found",null;const _=this.parseValue(t,e,n,u);if(this._error)return null;n=u[0],a.put(o,_);t:for(;n<e;n++)switch(l=t[n],l){case",":break t;case"}":return r[0]=n+1,a;case`
`:this._lineCount++}}return this._error="illegal end of perseObject",null}parseArray(t,e,i,r){if(this._error)return null;let a=new ke,o=i,n;const l=new Array(1);for(;o<e;o++){const u=this.parseValue(t,e,o,l);if(this._error)return null;o=l[0],u&&a.add(u);t:for(;o<e;o++)switch(n=t[o],n){case",":break t;case"]":return r[0]=o+1,a;case`
`:++this._lineCount}}return a=void 0,this._error="illegal end of parseObject",null}}class he extends k{constructor(t){super(),this._value=t}isFloat(){return!0}getString(t,e){const i="\0";return this._value=parseFloat(i),this._stringBuffer=i,this._stringBuffer}toInt(t=0){return parseInt(this._value.toString())}toFloat(t=0){return this._value}equals(t){return typeof t=="number"?Math.round(t)?!1:t==this._value:!1}}class K extends k{constructor(t){super(),this._boolValue=t}isBool(){return!0}toBoolean(t=!1){return this._boolValue}getString(t,e){return this._stringBuffer=this._boolValue?"true":"false",this._stringBuffer}equals(t){return typeof t=="boolean"?t==this._boolValue:!1}isStatic(){return!0}}class Et extends k{constructor(t){super(),typeof t=="string"&&(this._stringBuffer=t),t instanceof H&&(this._stringBuffer=t.s)}isString(){return!0}getString(t,e){return this._stringBuffer}equals(t){return typeof t=="string"?this._stringBuffer==t:t instanceof H?this._stringBuffer==t.s:!1}}class Gt extends Et{constructor(t,e){var i=(...r)=>{super(...r)};i(t),this._isStatic=e}isStatic(){return this._isStatic}setErrorNotForClientCall(t){return this._stringBuffer=t,this}isError(){return!0}}class Tt extends k{isNull(){return!0}getString(t,e){return this._stringBuffer}isStatic(){return!0}setErrorNotForClientCall(t){return this._stringBuffer=t,Gt.nullValue}constructor(){super(),this._stringBuffer="NullValue"}}class ke extends k{constructor(){super(),this._array=new C}release(){for(let t=this._array.begin();t.notEqual(this._array.end());t.preIncrement()){let e=t.ptr();e&&!e.isStatic()&&(e=void 0,e=null)}}isArray(){return!0}getValueByIndex(t){if(t<0||this._array.getSize()<=t)return k.errorValue.setErrorNotForClientCall(Js);const e=this._array.at(t);return e??k.nullValue}getValueByString(t){return k.errorValue.setErrorNotForClientCall(ue)}getString(t,e){const i=e+`[
`;for(let r=this._array.begin();r.notEqual(this._array.end());r.increment()){const a=r.ptr();this._stringBuffer+=e+""+a.getString(e+" ")+`
`}return this._stringBuffer=i+e+`]
`,this._stringBuffer}add(t){this._array.pushBack(t)}getVector(t=null){return this._array}getSize(){return this._array.getSize()}}class Rt extends k{constructor(){super(),this._map=new Y}release(){const t=this._map.begin();for(;t.notEqual(this._map.end());){let e=t.ptr().second;e&&!e.isStatic()&&(e=void 0,e=null),t.preIncrement()}}isMap(){return!0}getValueByString(t){if(t instanceof H){const e=this._map.getValue(t.s);return e??k.nullValue}for(let e=this._map.begin();e.notEqual(this._map.end());e.preIncrement())if(e.ptr().first==t)return e.ptr().second==null?k.nullValue:e.ptr().second;return k.nullValue}getValueByIndex(t){return k.errorValue.setErrorNotForClientCall(ue)}getString(t,e){this._stringBuffer=e+`{
`;const i=this._map.begin();for(;i.notEqual(this._map.end());){const r=i.ptr().first,a=i.ptr().second;this._stringBuffer+=e+" "+r+" : "+a.getString(e+"   ")+` 
`,i.preIncrement()}return this._stringBuffer+=e+`}
`,this._stringBuffer}getMap(t){return this._map}put(t,e){this._map.setValue(t,e)}getKeys(){if(!this._keys){this._keys=new C;const t=this._map.begin();for(;t.notEqual(this._map.end());){const e=t.ptr().first;this._keys.pushBack(e),t.preIncrement()}}return this._keys}getSize(){return this._keys.getSize()}}var ti;(s=>{s.CubismJson=O,s.JsonArray=ke,s.JsonBoolean=K,s.JsonError=Gt,s.JsonFloat=he,s.JsonMap=Rt,s.JsonNullvalue=Tt,s.JsonString=Et,s.Value=k})(ti||(ti={}));function Ks(s,t){let e=0;for(let r=1;;r++){const a=s.slice(r-1,r);if(a=="e"||a=="-"||a=="E")continue;const o=s.substring(0,r),n=Number(o);if(isNaN(n))break;e=r}let i=parseFloat(s);return isNaN(i)&&(i=NaN),t[0]=s.slice(e),i}let q=!1,Ct=!1,Bt=null,Ot=null;const ht=Object.freeze({vertexOffset:0,vertexStep:2});function Zs(s){s&&(s=void 0)}class I{static startUp(t=null){if(q)return Q("CubismFramework.startUp() is already done."),q;if(Bt=t,Bt!=null&&Live2DCubismCore.Logging.csmSetLogFunction(Bt.logFunction),q=!0,q){const e=Live2DCubismCore.Version.csmGetVersion(),i=(e&4278190080)>>24,r=(e&16711680)>>16,a=e&65535,o=e;Q("Live2D Cubism Core version: {0}.{1}.{2} ({3})",("00"+i).slice(-2),("00"+r).slice(-2),("0000"+a).slice(-4),o)}return Q("CubismFramework.startUp() is complete."),q}static cleanUp(){q=!1,Ct=!1,Bt=null,Ot=null}static initialize(t=0){if(Z(q),!q){ut("CubismFramework is not started.");return}if(Ct){ut("CubismFramework.initialize() skipped, already initialized.");return}k.staticInitializeNotForClientCall(),Ot=new cs,Live2DCubismCore.Memory.initializeAmountOfMemory(t),Ct=!0,Q("CubismFramework.initialize() is complete.")}static dispose(){if(Z(q),!q){ut("CubismFramework is not started.");return}if(!Ct){ut("CubismFramework.dispose() skipped, not initialized.");return}k.staticReleaseNotForClientCall(),Ot.release(),Ot=null,me.staticRelease(),Ct=!1,Q("CubismFramework.dispose() is complete.")}static isStarted(){return q}static isInitialized(){return Ct}static coreLogFunction(t){Live2DCubismCore.Logging.csmGetLogFunction()&&Live2DCubismCore.Logging.csmGetLogFunction()(t)}static getLoggingLevel(){return Bt!=null?Bt.loggingLevel:5}static getIdManager(){return Ot}constructor(){}}class Qs{}var vt=(s=>(s[s.LogLevel_Verbose=0]="LogLevel_Verbose",s[s.LogLevel_Debug=1]="LogLevel_Debug",s[s.LogLevel_Info=2]="LogLevel_Info",s[s.LogLevel_Warning=3]="LogLevel_Warning",s[s.LogLevel_Error=4]="LogLevel_Error",s[s.LogLevel_Off=5]="LogLevel_Off",s))(vt||{}),ei;(s=>{s.Constant=ht,s.csmDelete=Zs,s.CubismFramework=I})(ei||(ei={}));const tr={width:600,height:800},ii=1,er=2,ir=.8,sr=-1,rr=1,ar=-2,nr=2,or=-2,lr=2,ms="/l2d/",ur="",Re=["草神"],hr=Re.length,gr="Idle",cr="TapBody",si="Head",ri="Body",dr=1,_r=2,ai=3,mr=vt.LogLevel_Verbose;var L=typeof globalThis<"u"&&globalThis||typeof self<"u"&&self||typeof global<"u"&&global||{},N={searchParams:"URLSearchParams"in L,iterable:"Symbol"in L&&"iterator"in Symbol,blob:"FileReader"in L&&"Blob"in L&&function(){try{return new Blob,!0}catch{return!1}}(),formData:"FormData"in L,arrayBuffer:"ArrayBuffer"in L};function pr(s){return s&&DataView.prototype.isPrototypeOf(s)}if(N.arrayBuffer)var fr=["[object Int8Array]","[object Uint8Array]","[object Uint8ClampedArray]","[object Int16Array]","[object Uint16Array]","[object Int32Array]","[object Uint32Array]","[object Float32Array]","[object Float64Array]"],yr=ArrayBuffer.isView||function(s){return s&&fr.indexOf(Object.prototype.toString.call(s))>-1};function Dt(s){if(typeof s!="string"&&(s=String(s)),/[^a-z0-9\-#$%&'*+.^_`|~!]/i.test(s)||s==="")throw new TypeError('Invalid character in header field name: "'+s+'"');return s.toLowerCase()}function Ne(s){return typeof s!="string"&&(s=String(s)),s}function Ue(s){var t={next:function(){var e=s.shift();return{done:e===void 0,value:e}}};return N.iterable&&(t[Symbol.iterator]=function(){return t}),t}function D(s){this.map={},s instanceof D?s.forEach(function(t,e){this.append(e,t)},this):Array.isArray(s)?s.forEach(function(t){if(t.length!=2)throw new TypeError("Headers constructor: expected name/value pair to be length 2, found"+t.length);this.append(t[0],t[1])},this):s&&Object.getOwnPropertyNames(s).forEach(function(t){this.append(t,s[t])},this)}D.prototype.append=function(s,t){s=Dt(s),t=Ne(t);var e=this.map[s];this.map[s]=e?e+", "+t:t};D.prototype.delete=function(s){delete this.map[Dt(s)]};D.prototype.get=function(s){return s=Dt(s),this.has(s)?this.map[s]:null};D.prototype.has=function(s){return this.map.hasOwnProperty(Dt(s))};D.prototype.set=function(s,t){this.map[Dt(s)]=Ne(t)};D.prototype.forEach=function(s,t){for(var e in this.map)this.map.hasOwnProperty(e)&&s.call(t,this.map[e],e,this)};D.prototype.keys=function(){var s=[];return this.forEach(function(t,e){s.push(e)}),Ue(s)};D.prototype.values=function(){var s=[];return this.forEach(function(t){s.push(t)}),Ue(s)};D.prototype.entries=function(){var s=[];return this.forEach(function(t,e){s.push([e,t])}),Ue(s)};N.iterable&&(D.prototype[Symbol.iterator]=D.prototype.entries);function Se(s){if(!s._noBody){if(s.bodyUsed)return Promise.reject(new TypeError("Already read"));s.bodyUsed=!0}}function ps(s){return new Promise(function(t,e){s.onload=function(){t(s.result)},s.onerror=function(){e(s.error)}})}function Sr(s){var t=new FileReader,e=ps(t);return t.readAsArrayBuffer(s),e}function xr(s){var t=new FileReader,e=ps(t),i=/charset=([A-Za-z0-9_-]+)/.exec(s.type),r=i?i[1]:"utf-8";return t.readAsText(s,r),e}function Cr(s){for(var t=new Uint8Array(s),e=new Array(t.length),i=0;i<t.length;i++)e[i]=String.fromCharCode(t[i]);return e.join("")}function ni(s){if(s.slice)return s.slice(0);var t=new Uint8Array(s.byteLength);return t.set(new Uint8Array(s)),t.buffer}function fs(){return this.bodyUsed=!1,this._initBody=function(s){this.bodyUsed=this.bodyUsed,this._bodyInit=s,s?typeof s=="string"?this._bodyText=s:N.blob&&Blob.prototype.isPrototypeOf(s)?this._bodyBlob=s:N.formData&&FormData.prototype.isPrototypeOf(s)?this._bodyFormData=s:N.searchParams&&URLSearchParams.prototype.isPrototypeOf(s)?this._bodyText=s.toString():N.arrayBuffer&&N.blob&&pr(s)?(this._bodyArrayBuffer=ni(s.buffer),this._bodyInit=new Blob([this._bodyArrayBuffer])):N.arrayBuffer&&(ArrayBuffer.prototype.isPrototypeOf(s)||yr(s))?this._bodyArrayBuffer=ni(s):this._bodyText=s=Object.prototype.toString.call(s):(this._noBody=!0,this._bodyText=""),this.headers.get("content-type")||(typeof s=="string"?this.headers.set("content-type","text/plain;charset=UTF-8"):this._bodyBlob&&this._bodyBlob.type?this.headers.set("content-type",this._bodyBlob.type):N.searchParams&&URLSearchParams.prototype.isPrototypeOf(s)&&this.headers.set("content-type","application/x-www-form-urlencoded;charset=UTF-8"))},N.blob&&(this.blob=function(){var s=Se(this);if(s)return s;if(this._bodyBlob)return Promise.resolve(this._bodyBlob);if(this._bodyArrayBuffer)return Promise.resolve(new Blob([this._bodyArrayBuffer]));if(this._bodyFormData)throw new Error("could not read FormData body as blob");return Promise.resolve(new Blob([this._bodyText]))}),this.arrayBuffer=function(){if(this._bodyArrayBuffer){var s=Se(this);return s||(ArrayBuffer.isView(this._bodyArrayBuffer)?Promise.resolve(this._bodyArrayBuffer.buffer.slice(this._bodyArrayBuffer.byteOffset,this._bodyArrayBuffer.byteOffset+this._bodyArrayBuffer.byteLength)):Promise.resolve(this._bodyArrayBuffer))}else{if(N.blob)return this.blob().then(Sr);throw new Error("could not read as ArrayBuffer")}},this.text=function(){var s=Se(this);if(s)return s;if(this._bodyBlob)return xr(this._bodyBlob);if(this._bodyArrayBuffer)return Promise.resolve(Cr(this._bodyArrayBuffer));if(this._bodyFormData)throw new Error("could not read FormData body as text");return Promise.resolve(this._bodyText)},N.formData&&(this.formData=function(){return this.text().then(Mr)}),this.json=function(){return this.text().then(JSON.parse)},this}var Br=["CONNECT","DELETE","GET","HEAD","OPTIONS","PATCH","POST","PUT","TRACE"];function Pr(s){var t=s.toUpperCase();return Br.indexOf(t)>-1?t:s}function yt(s,t){if(!(this instanceof yt))throw new TypeError('Please use the "new" operator, this DOM object constructor cannot be called as a function.');t=t||{};var e=t.body;if(s instanceof yt){if(s.bodyUsed)throw new TypeError("Already read");this.url=s.url,this.credentials=s.credentials,t.headers||(this.headers=new D(s.headers)),this.method=s.method,this.mode=s.mode,this.signal=s.signal,!e&&s._bodyInit!=null&&(e=s._bodyInit,s.bodyUsed=!0)}else this.url=String(s);if(this.credentials=t.credentials||this.credentials||"same-origin",(t.headers||!this.headers)&&(this.headers=new D(t.headers)),this.method=Pr(t.method||this.method||"GET"),this.mode=t.mode||this.mode||null,this.signal=t.signal||this.signal||function(){if("AbortController"in L){var a=new AbortController;return a.signal}}(),this.referrer=null,(this.method==="GET"||this.method==="HEAD")&&e)throw new TypeError("Body not allowed for GET or HEAD requests");if(this._initBody(e),(this.method==="GET"||this.method==="HEAD")&&(t.cache==="no-store"||t.cache==="no-cache")){var i=/([?&])_=[^&]*/;if(i.test(this.url))this.url=this.url.replace(i,"$1_="+new Date().getTime());else{var r=/\?/;this.url+=(r.test(this.url)?"&":"?")+"_="+new Date().getTime()}}}yt.prototype.clone=function(){return new yt(this,{body:this._bodyInit})};function Mr(s){var t=new FormData;return s.trim().split("&").forEach(function(e){if(e){var i=e.split("="),r=i.shift().replace(/\+/g," "),a=i.join("=").replace(/\+/g," ");t.append(decodeURIComponent(r),decodeURIComponent(a))}}),t}function br(s){var t=new D,e=s.replace(/\r?\n[\t ]+/g," ");return e.split("\r").map(function(i){return i.indexOf(`
`)===0?i.substr(1,i.length):i}).forEach(function(i){var r=i.split(":"),a=r.shift().trim();if(a){var o=r.join(":").trim();try{t.append(a,o)}catch(n){console.warn("Response "+n.message)}}}),t}fs.call(yt.prototype);function it(s,t){if(!(this instanceof it))throw new TypeError('Please use the "new" operator, this DOM object constructor cannot be called as a function.');if(t||(t={}),this.type="default",this.status=t.status===void 0?200:t.status,this.status<200||this.status>599)throw new RangeError("Failed to construct 'Response': The status provided (0) is outside the range [200, 599].");this.ok=this.status>=200&&this.status<300,this.statusText=t.statusText===void 0?"":""+t.statusText,this.headers=new D(t.headers),this.url=t.url||"",this._initBody(s)}fs.call(it.prototype);it.prototype.clone=function(){return new it(this._bodyInit,{status:this.status,statusText:this.statusText,headers:new D(this.headers),url:this.url})};it.error=function(){var s=new it(null,{status:200,statusText:""});return s.status=0,s.type="error",s};var wr=[301,302,303,307,308];it.redirect=function(s,t){if(wr.indexOf(t)===-1)throw new RangeError("Invalid status code");return new it(null,{status:t,headers:{location:s}})};var mt=L.DOMException;try{new mt}catch{mt=function(t,e){this.message=t,this.name=e;var i=Error(t);this.stack=i.stack},mt.prototype=Object.create(Error.prototype),mt.prototype.constructor=mt}function ys(s,t){return new Promise(function(e,i){var r=new yt(s,t);if(r.signal&&r.signal.aborted)return i(new mt("Aborted","AbortError"));var a=new XMLHttpRequest;function o(){a.abort()}a.onload=function(){var u={status:a.status,statusText:a.statusText,headers:br(a.getAllResponseHeaders()||"")};u.url="responseURL"in a?a.responseURL:u.headers.get("X-Request-URL");var h="response"in a?a.response:a.responseText;setTimeout(function(){e(new it(h,u))},0)},a.onerror=function(){setTimeout(function(){i(new TypeError("Network request failed"))},0)},a.ontimeout=function(){setTimeout(function(){i(new TypeError("Network request failed"))},0)},a.onabort=function(){setTimeout(function(){i(new mt("Aborted","AbortError"))},0)};function n(u){try{return u===""&&L.location.href?L.location.href:u}catch{return u}}if(a.open(r.method,n(r.url),!0),r.credentials==="include"?a.withCredentials=!0:r.credentials==="omit"&&(a.withCredentials=!1),"responseType"in a&&(N.blob?a.responseType="blob":N.arrayBuffer&&(a.responseType="arraybuffer")),t&&typeof t.headers=="object"&&!(t.headers instanceof D||L.Headers&&t.headers instanceof L.Headers)){var l=[];Object.getOwnPropertyNames(t.headers).forEach(function(u){l.push(Dt(u)),a.setRequestHeader(u,Ne(t.headers[u]))}),r.headers.forEach(function(u,h){l.indexOf(h)===-1&&a.setRequestHeader(h,u)})}else r.headers.forEach(function(u,h){a.setRequestHeader(h,u)});r.signal&&(r.signal.addEventListener("abort",o),a.onreadystatechange=function(){a.readyState===4&&r.signal.removeEventListener("abort",o)}),a.send(typeof r._bodyInit>"u"?null:r._bodyInit)})}ys.polyfill=!0;L.fetch||(L.fetch=ys,L.Headers=D,L.Request=yt,L.Response=it);const B=Object.freeze({HitAreaPrefix:"HitArea",HitAreaHead:"Head",HitAreaBody:"Body",PartsIdCore:"Parts01Core",PartsArmPrefix:"Parts01Arm_",PartsArmLPrefix:"Parts01ArmL_",PartsArmRPrefix:"Parts01ArmR_",ParamAngleX:"ParamAngleX",ParamAngleY:"ParamAngleY",ParamAngleZ:"ParamAngleZ",ParamEyeLOpen:"ParamEyeLOpen",ParamEyeLSmile:"ParamEyeLSmile",ParamEyeROpen:"ParamEyeROpen",ParamEyeRSmile:"ParamEyeRSmile",ParamEyeBallX:"ParamEyeBallX",ParamEyeBallY:"ParamEyeBallY",ParamEyeBallForm:"ParamEyeBallForm",ParamBrowLY:"ParamBrowLY",ParamBrowRY:"ParamBrowRY",ParamBrowLX:"ParamBrowLX",ParamBrowRX:"ParamBrowRX",ParamBrowLAngle:"ParamBrowLAngle",ParamBrowRAngle:"ParamBrowRAngle",ParamBrowLForm:"ParamBrowLForm",ParamBrowRForm:"ParamBrowRForm",ParamMouthForm:"ParamMouthForm",ParamMouthOpenY:"ParamMouthOpenY",ParamCheek:"ParamCheek",ParamBodyAngleX:"ParamBodyAngleX",ParamBodyAngleY:"ParamBodyAngleY",ParamBodyAngleZ:"ParamBodyAngleZ",ParamBreath:"ParamBreath",ParamArmLA:"ParamArmLA",ParamArmRA:"ParamArmRA",ParamArmLB:"ParamArmLB",ParamArmRB:"ParamArmRB",ParamHandL:"ParamHandL",ParamHandR:"ParamHandR",ParamHairFront:"ParamHairFront",ParamHairSide:"ParamHairSide",ParamHairBack:"ParamHairBack",ParamHairFluffy:"ParamHairFluffy",ParamShoulderY:"ParamShoulderY",ParamBustX:"ParamBustX",ParamBustY:"ParamBustY",ParamBaseX:"ParamBaseX",ParamBaseY:"ParamBaseY",ParamNONE:"NONE:"});var oi;(s=>{s.HitAreaBody=B.HitAreaBody,s.HitAreaHead=B.HitAreaHead,s.HitAreaPrefix=B.HitAreaPrefix,s.ParamAngleX=B.ParamAngleX,s.ParamAngleY=B.ParamAngleY,s.ParamAngleZ=B.ParamAngleZ,s.ParamArmLA=B.ParamArmLA,s.ParamArmLB=B.ParamArmLB,s.ParamArmRA=B.ParamArmRA,s.ParamArmRB=B.ParamArmRB,s.ParamBaseX=B.ParamBaseX,s.ParamBaseY=B.ParamBaseY,s.ParamBodyAngleX=B.ParamBodyAngleX,s.ParamBodyAngleY=B.ParamBodyAngleY,s.ParamBodyAngleZ=B.ParamBodyAngleZ,s.ParamBreath=B.ParamBreath,s.ParamBrowLAngle=B.ParamBrowLAngle,s.ParamBrowLForm=B.ParamBrowLForm,s.ParamBrowLX=B.ParamBrowLX,s.ParamBrowLY=B.ParamBrowLY,s.ParamBrowRAngle=B.ParamBrowRAngle,s.ParamBrowRForm=B.ParamBrowRForm,s.ParamBrowRX=B.ParamBrowRX,s.ParamBrowRY=B.ParamBrowRY,s.ParamBustX=B.ParamBustX,s.ParamBustY=B.ParamBustY,s.ParamCheek=B.ParamCheek,s.ParamEyeBallForm=B.ParamEyeBallForm,s.ParamEyeBallX=B.ParamEyeBallX,s.ParamEyeBallY=B.ParamEyeBallY,s.ParamEyeLOpen=B.ParamEyeLOpen,s.ParamEyeLSmile=B.ParamEyeLSmile,s.ParamEyeROpen=B.ParamEyeROpen,s.ParamEyeRSmile=B.ParamEyeRSmile,s.ParamHairBack=B.ParamHairBack,s.ParamHairFluffy=B.ParamHairFluffy,s.ParamHairFront=B.ParamHairFront,s.ParamHairSide=B.ParamHairSide,s.ParamHandL=B.ParamHandL,s.ParamHandR=B.ParamHandR,s.ParamMouthForm=B.ParamMouthForm,s.ParamMouthOpenY=B.ParamMouthOpenY,s.ParamNONE=B.ParamNONE,s.ParamShoulderY=B.ParamShoulderY,s.PartsArmLPrefix=B.PartsArmLPrefix,s.PartsArmPrefix=B.PartsArmPrefix,s.PartsArmRPrefix=B.PartsArmRPrefix,s.PartsIdCore=B.PartsIdCore})(oi||(oi={}));class Ss{}var li;(s=>{s.ICubismModelSetting=Ss})(li||(li={}));const at="FileReferences",vr="Groups",Ir="Layout",Vr="HitAreas",Tr="Moc",Rr="Textures",Ar="Physics",Er="Pose",Fr="Expressions",Dr="Motions",ui="UserData",nt="Name",hi="File",Lr="Id",te="Ids",gi="Sound",ci="FadeInTime",di="FadeOutTime",xe="LipSync",Ce="EyeBlink";class xs extends Ss{constructor(t,e){super(),this._json=O.create(t,e),this._json&&(this._jsonValue=new C,this._jsonValue.pushBack(this._json.getRoot().getValueByString(vr)),this._jsonValue.pushBack(this._json.getRoot().getValueByString(at).getValueByString(Tr)),this._jsonValue.pushBack(this._json.getRoot().getValueByString(at).getValueByString(Dr)),this._jsonValue.pushBack(this._json.getRoot().getValueByString(at).getValueByString(Fr)),this._jsonValue.pushBack(this._json.getRoot().getValueByString(at).getValueByString(Rr)),this._jsonValue.pushBack(this._json.getRoot().getValueByString(at).getValueByString(Ar)),this._jsonValue.pushBack(this._json.getRoot().getValueByString(at).getValueByString(Er)),this._jsonValue.pushBack(this._json.getRoot().getValueByString(Vr)))}release(){O.delete(this._json),this._jsonValue=null}GetJson(){return this._json}getModelFileName(){return this.isExistModelFile()?this._jsonValue.at(1).getRawString():""}getTextureCount(){return this.isExistTextureFiles()?this._jsonValue.at(4).getSize():0}getTextureDirectory(){const e=this._jsonValue.at(4).getValueByIndex(0).getRawString().split("/"),i=e.length-1;let r="";for(let a=0;a<i;a++)r+=e[a],a<i-1&&(r+="/");return r}getTextureFileName(t){return this._jsonValue.at(4).getValueByIndex(t).getRawString()}getHitAreasCount(){return this.isExistHitAreas()?this._jsonValue.at(7).getSize():0}getHitAreaId(t){return I.getIdManager().getId(this._jsonValue.at(7).getValueByIndex(t).getValueByString(Lr).getRawString())}getHitAreaName(t){return this._jsonValue.at(7).getValueByIndex(t).getValueByString(nt).getRawString()}getPhysicsFileName(){return this.isExistPhysicsFile()?this._jsonValue.at(5).getRawString():""}getPoseFileName(){return this.isExistPoseFile()?this._jsonValue.at(6).getRawString():""}getExpressionCount(){return this.isExistExpressionFile()?this._jsonValue.at(3).getSize():0}getExpressionName(t){return this._jsonValue.at(3).getValueByIndex(t).getValueByString(nt).getRawString()}getExpressionFileName(t){return this._jsonValue.at(3).getValueByIndex(t).getValueByString(hi).getRawString()}getMotionGroupCount(){return this.isExistMotionGroups()?this._jsonValue.at(2).getKeys().getSize():0}getMotionGroupName(t){return this.isExistMotionGroups()?this._jsonValue.at(2).getKeys().at(t):null}getMotionCount(t){return this.isExistMotionGroupName(t)?this._jsonValue.at(2).getValueByString(t).getSize():0}getMotionFileName(t,e){return this.isExistMotionGroupName(t)?this._jsonValue.at(2).getValueByString(t).getValueByIndex(e).getValueByString(hi).getRawString():""}getMotionSoundFileName(t,e){return this.isExistMotionSoundFile(t,e)?this._jsonValue.at(2).getValueByString(t).getValueByIndex(e).getValueByString(gi).getRawString():""}getMotionFadeInTimeValue(t,e){return this.isExistMotionFadeIn(t,e)?this._jsonValue.at(2).getValueByString(t).getValueByIndex(e).getValueByString(ci).toFloat():-1}getMotionFadeOutTimeValue(t,e){return this.isExistMotionFadeOut(t,e)?this._jsonValue.at(2).getValueByString(t).getValueByIndex(e).getValueByString(di).toFloat():-1}getUserDataFile(){return this.isExistUserDataFile()?this._json.getRoot().getValueByString(at).getValueByString(ui).getRawString():""}getLayoutMap(t){const e=this._json.getRoot().getValueByString(Ir).getMap();if(e==null)return!1;let i=!1;for(const r=e.begin();r.notEqual(e.end());r.preIncrement())t.setValue(r.ptr().first,r.ptr().second.toFloat()),i=!0;return i}getEyeBlinkParameterCount(){if(!this.isExistEyeBlinkParameters())return 0;let t=0;for(let e=0;e<this._jsonValue.at(0).getSize();e++){const i=this._jsonValue.at(0).getValueByIndex(e);if(!(i.isNull()||i.isError())&&i.getValueByString(nt).getRawString()==Ce){t=i.getValueByString(te).getVector().getSize();break}}return t}getEyeBlinkParameterId(t){if(!this.isExistEyeBlinkParameters())return null;for(let e=0;e<this._jsonValue.at(0).getSize();e++){const i=this._jsonValue.at(0).getValueByIndex(e);if(!(i.isNull()||i.isError())&&i.getValueByString(nt).getRawString()==Ce)return I.getIdManager().getId(i.getValueByString(te).getValueByIndex(t).getRawString())}return null}getLipSyncParameterCount(){if(!this.isExistLipSyncParameters())return 0;let t=0;for(let e=0;e<this._jsonValue.at(0).getSize();e++){const i=this._jsonValue.at(0).getValueByIndex(e);if(!(i.isNull()||i.isError())&&i.getValueByString(nt).getRawString()==xe){t=i.getValueByString(te).getVector().getSize();break}}return t}getLipSyncParameterId(t){if(!this.isExistLipSyncParameters())return null;for(let e=0;e<this._jsonValue.at(0).getSize();e++){const i=this._jsonValue.at(0).getValueByIndex(e);if(!(i.isNull()||i.isError())&&i.getValueByString(nt).getRawString()==xe)return I.getIdManager().getId(i.getValueByString(te).getValueByIndex(t).getRawString())}return null}isExistModelFile(){const t=this._jsonValue.at(1);return!t.isNull()&&!t.isError()}isExistTextureFiles(){const t=this._jsonValue.at(4);return!t.isNull()&&!t.isError()}isExistHitAreas(){const t=this._jsonValue.at(7);return!t.isNull()&&!t.isError()}isExistPhysicsFile(){const t=this._jsonValue.at(5);return!t.isNull()&&!t.isError()}isExistPoseFile(){const t=this._jsonValue.at(6);return!t.isNull()&&!t.isError()}isExistExpressionFile(){const t=this._jsonValue.at(3);return!t.isNull()&&!t.isError()}isExistMotionGroups(){const t=this._jsonValue.at(2);return!t.isNull()&&!t.isError()}isExistMotionGroupName(t){const e=this._jsonValue.at(2).getValueByString(t);return!e.isNull()&&!e.isError()}isExistMotionSoundFile(t,e){const i=this._jsonValue.at(2).getValueByString(t).getValueByIndex(e).getValueByString(gi);return!i.isNull()&&!i.isError()}isExistMotionFadeIn(t,e){const i=this._jsonValue.at(2).getValueByString(t).getValueByIndex(e).getValueByString(ci);return!i.isNull()&&!i.isError()}isExistMotionFadeOut(t,e){const i=this._jsonValue.at(2).getValueByString(t).getValueByIndex(e).getValueByString(di);return!i.isNull()&&!i.isError()}isExistUserDataFile(){const t=this._json.getRoot().getValueByString(at).getValueByString(ui);return!t.isNull()&&!t.isError()}isExistEyeBlinkParameters(){if(this._jsonValue.at(0).isNull()||this._jsonValue.at(0).isError())return!1;for(let t=0;t<this._jsonValue.at(0).getSize();++t)if(this._jsonValue.at(0).getValueByIndex(t).getValueByString(nt).getRawString()==Ce)return!0;return!1}isExistLipSyncParameters(){if(this._jsonValue.at(0).isNull()||this._jsonValue.at(0).isError())return!1;for(let t=0;t<this._jsonValue.at(0).getSize();++t)if(this._jsonValue.at(0).getValueByIndex(t).getValueByString(nt).getRawString()==xe)return!0;return!1}}var _i;(s=>{s.CubismModelSettingJson=xs})(_i||(_i={}));class Kt{static create(){return new Kt}static delete(t){}setParameters(t){this._breathParameters=t}getParameters(){return this._breathParameters}updateParameters(t,e){this._currentTime+=e;const i=this._currentTime*2*3.14159;for(let r=0;r<this._breathParameters.getSize();++r){const a=this._breathParameters.at(r);t.addParameterValueById(a.parameterId,a.offset+a.peak*Math.sin(i/a.cycle),a.weight)}}constructor(){this._currentTime=0}}class wt{constructor(t,e,i,r,a){this.parameterId=t??null,this.offset=e??0,this.peak=i??0,this.cycle=r??0,this.weight=a??0}}var mi;(s=>{s.BreathParameterData=wt,s.CubismBreath=Kt})(mi||(mi={}));const Xt=class Xt{static create(t=null){return new Xt(t)}static delete(t){}setBlinkingInterval(t){this._blinkingIntervalSeconds=t}setBlinkingSetting(t,e,i){this._closingSeconds=t,this._closedSeconds=e,this._openingSeconds=i}setParameterIds(t){this._parameterIds=t}getParameterIds(){return this._parameterIds}updateParameters(t,e){this._userTimeSeconds+=e;let i,r=0;switch(this._blinkingState){case 2:r=(this._userTimeSeconds-this._stateStartTimeSeconds)/this._closingSeconds,r>=1&&(r=1,this._blinkingState=3,this._stateStartTimeSeconds=this._userTimeSeconds),i=1-r;break;case 3:r=(this._userTimeSeconds-this._stateStartTimeSeconds)/this._closedSeconds,r>=1&&(this._blinkingState=4,this._stateStartTimeSeconds=this._userTimeSeconds),i=0;break;case 4:r=(this._userTimeSeconds-this._stateStartTimeSeconds)/this._openingSeconds,r>=1&&(r=1,this._blinkingState=1,this._nextBlinkingTime=this.determinNextBlinkingTiming()),i=r;break;case 1:this._nextBlinkingTime<this._userTimeSeconds&&(this._blinkingState=2,this._stateStartTimeSeconds=this._userTimeSeconds),i=1;break;case 0:default:this._blinkingState=1,this._nextBlinkingTime=this.determinNextBlinkingTiming(),i=1;break}Xt.CloseIfZero||(i=-i);for(let a=0;a<this._parameterIds.getSize();++a)t.setParameterValueById(this._parameterIds.at(a),i)}constructor(t){if(this._blinkingState=0,this._nextBlinkingTime=0,this._stateStartTimeSeconds=0,this._blinkingIntervalSeconds=4,this._closingSeconds=.1,this._closedSeconds=.05,this._openingSeconds=.15,this._userTimeSeconds=0,this._parameterIds=new C,t!=null)for(let e=0;e<t.getEyeBlinkParameterCount();++e)this._parameterIds.pushBack(t.getEyeBlinkParameterId(e))}determinNextBlinkingTiming(){const t=Math.random();return this._userTimeSeconds+t*(2*this._blinkingIntervalSeconds-1)}};Xt.CloseIfZero=!0;let Ht=Xt;var Cs=(s=>(s[s.EyeState_First=0]="EyeState_First",s[s.EyeState_Interval=1]="EyeState_Interval",s[s.EyeState_Closing=2]="EyeState_Closing",s[s.EyeState_Closed=3]="EyeState_Closed",s[s.EyeState_Opening=4]="EyeState_Opening",s))(Cs||{}),pi;(s=>{s.CubismEyeBlink=Ht,s.EyeState=Cs})(pi||(pi={}));const Or=.001,Be=.5,fi="FadeInTime",yi="Link",kr="Groups",Nr="Id";class $t{static create(t,e){const i=new $t,r=O.create(t,e),a=r.getRoot();a.getValueByString(fi).isNull()||(i._fadeTimeSeconds=a.getValueByString(fi).toFloat(Be),i._fadeTimeSeconds<=0&&(i._fadeTimeSeconds=Be));const o=a.getValueByString(kr),n=o.getSize();for(let l=0;l<n;++l){const u=o.getValueByIndex(l),h=u.getSize();let _=0;for(let d=0;d<h;++d){const g=u.getValueByIndex(d),c=new qt,y=I.getIdManager().getId(g.getValueByString(Nr).getRawString());if(c.partId=y,!g.getValueByString(yi).isNull()){const p=g.getValueByString(yi),S=p.getSize();for(let f=0;f<S;++f){const w=new qt,M=I.getIdManager().getId(p.getValueByIndex(f).getString());w.partId=M,c.link.pushBack(w)}}i._partGroups.pushBack(c.clone()),++_}i._partGroupCounts.pushBack(_)}return O.delete(r),i}static delete(t){}updateParameters(t,e){t!=this._lastModel&&this.reset(t),this._lastModel=t,e<0&&(e=0);let i=0;for(let r=0;r<this._partGroupCounts.getSize();r++){const a=this._partGroupCounts.at(r);this.doFade(t,e,i,a),i+=a}this.copyPartOpacities(t)}reset(t){let e=0;for(let i=0;i<this._partGroupCounts.getSize();++i){const r=this._partGroupCounts.at(i);for(let a=e;a<e+r;++a){this._partGroups.at(a).initialize(t);const o=this._partGroups.at(a).partIndex,n=this._partGroups.at(a).parameterIndex;if(!(o<0)){t.setPartOpacityByIndex(o,a==e?1:0),t.setParameterValueByIndex(n,a==e?1:0);for(let l=0;l<this._partGroups.at(a).link.getSize();++l)this._partGroups.at(a).link.at(l).initialize(t)}}e+=r}}copyPartOpacities(t){for(let e=0;e<this._partGroups.getSize();++e){const i=this._partGroups.at(e);if(i.link.getSize()==0)continue;const r=this._partGroups.at(e).partIndex,a=t.getPartOpacityByIndex(r);for(let o=0;o<i.link.getSize();++o){const l=i.link.at(o).partIndex;l<0||t.setPartOpacityByIndex(l,a)}}}doFade(t,e,i,r){let a=-1,o=1;const n=.5,l=.15;for(let u=i;u<i+r;++u){const h=this._partGroups.at(u).partIndex,_=this._partGroups.at(u).parameterIndex;if(t.getParameterValueByIndex(_)>Or){if(a>=0)break;a=u,o=t.getPartOpacityByIndex(h),o+=e/this._fadeTimeSeconds,o>1&&(o=1)}}a<0&&(a=0,o=1);for(let u=i;u<i+r;++u){const h=this._partGroups.at(u).partIndex;if(a==u)t.setPartOpacityByIndex(h,o);else{let _=t.getPartOpacityByIndex(h),d;o<n?d=o*(n-1)/n+1:d=(1-o)*n/(1-n),(1-d)*(1-o)>l&&(d=1-l/(1-o)),_>d&&(_=d),t.setPartOpacityByIndex(h,_)}}}constructor(){this._fadeTimeSeconds=Be,this._lastModel=null,this._partGroups=new C,this._partGroupCounts=new C}}class qt{constructor(t){if(this.parameterIndex=0,this.partIndex=0,this.link=new C,t!=null){this.partId=t.partId;for(const e=t.link.begin();e.notEqual(t.link.end());e.preIncrement())this.link.pushBack(e.ptr().clone())}}assignment(t){this.partId=t.partId;for(const e=t.link.begin();e.notEqual(t.link.end());e.preIncrement())this.link.pushBack(e.ptr().clone());return this}initialize(t){this.parameterIndex=t.getParameterIndex(this.partId),this.partIndex=t.getPartIndex(this.partId),t.setParameterValueByIndex(this.parameterIndex,1)}clone(){const t=new qt;t.partId=this.partId,t.parameterIndex=this.parameterIndex,t.partIndex=this.partIndex,t.link=new C;for(let e=this.link.begin();e.notEqual(this.link.end());e.increment())t.link.pushBack(e.ptr().clone());return t}}var Si;(s=>{s.CubismPose=$t,s.PartData=qt})(Si||(Si={}));class Bs extends F{constructor(t,e){super(),this._width=t!==void 0?t:0,this._height=e!==void 0?e:0,this.setHeight(2)}setWidth(t){const e=t/this._width,i=e;this.scale(e,i)}setHeight(t){const e=t/this._height,i=e;this.scale(e,i)}setPosition(t,e){this.translate(t,e)}setCenterPosition(t,e){this.centerX(t),this.centerY(e)}top(t){this.setY(t)}bottom(t){const e=this._height*this.getScaleY();this.translateY(t-e)}left(t){this.setX(t)}right(t){const e=this._width*this.getScaleX();this.translateX(t-e)}centerX(t){const e=this._width*this.getScaleX();this.translateX(t-e/2)}setX(t){this.translateX(t)}centerY(t){const e=this._height*this.getScaleY();this.translateY(t-e/2)}setY(t){this.translateY(t)}setupFromLayout(t){const e="width",i="height",r="x",a="y",o="center_x",n="center_y",l="top",u="bottom",h="left",_="right";for(const d=t.begin();d.notEqual(t.end());d.preIncrement()){const g=d.ptr().first,c=d.ptr().second;g==e?this.setWidth(c):g==i&&this.setHeight(c)}for(const d=t.begin();d.notEqual(t.end());d.preIncrement()){const g=d.ptr().first,c=d.ptr().second;g==r?this.setX(c):g==a?this.setY(c):g==o?this.centerX(c):g==n?this.centerY(c):g==l?this.top(c):g==u?this.bottom(c):g==h?this.left(c):g==_&&this.right(c)}}}var xi;(s=>{s.CubismModelMatrix=Bs})(xi||(xi={}));class P{constructor(t,e){this.x=t,this.y=e,this.x=t??0,this.y=e??0}add(t){const e=new P(0,0);return e.x=this.x+t.x,e.y=this.y+t.y,e}substract(t){const e=new P(0,0);return e.x=this.x-t.x,e.y=this.y-t.y,e}multiply(t){const e=new P(0,0);return e.x=this.x*t.x,e.y=this.y*t.y,e}multiplyByScaler(t){return this.multiply(new P(t,t))}division(t){const e=new P(0,0);return e.x=this.x/t.x,e.y=this.y/t.y,e}divisionByScalar(t){return this.division(new P(t,t))}getLength(){return Math.sqrt(this.x*this.x+this.y*this.y)}getDistanceWith(t){return Math.sqrt((this.x-t.x)*(this.x-t.x)+(this.y-t.y)*(this.y-t.y))}dot(t){return this.x*t.x+this.y*t.y}normalize(){const t=Math.pow(this.x*this.x+this.y*this.y,.5);this.x=this.x/t,this.y=this.y/t}isEqual(t){return this.x==t.x&&this.y==t.y}isNotEqual(t){return!this.isEqual(t)}}var Ci;(s=>{s.CubismVector2=P})(Ci||(Ci={}));const It=class It{static range(t,e,i){return t<e?t=e:t>i&&(t=i),t}static sin(t){return Math.sin(t)}static cos(t){return Math.cos(t)}static abs(t){return Math.abs(t)}static sqrt(t){return Math.sqrt(t)}static cbrt(t){if(t===0)return t;let e=t;const i=e<0;i&&(e=-e);let r;return e===1/0?r=1/0:(r=Math.exp(Math.log(e)/3),r=(e/(r*r)+2*r)/3),i?-r:r}static getEasingSine(t){return t<0?0:t>1?1:.5-.5*this.cos(t*Math.PI)}static max(t,e){return t>e?t:e}static min(t,e){return t>e?e:t}static degreesToRadian(t){return t/180*Math.PI}static radianToDegrees(t){return t*180/Math.PI}static directionToRadian(t,e){const i=Math.atan2(e.y,e.x),r=Math.atan2(t.y,t.x);let a=i-r;for(;a<-Math.PI;)a+=Math.PI*2;for(;a>Math.PI;)a-=Math.PI*2;return a}static directionToDegrees(t,e){const i=this.directionToRadian(t,e);let r=this.radianToDegrees(i);return e.x-t.x>0&&(r=-r),r}static radianToDirection(t){const e=new P;return e.x=this.sin(t),e.y=this.cos(t),e}static quadraticEquation(t,e,i){return this.abs(t)<It.Epsilon?this.abs(e)<It.Epsilon?-i:-i/e:-(e+this.sqrt(e*e-4*t*i))/(2*t)}static cardanoAlgorithmForBezier(t,e,i,r){if(this.sqrt(t)<It.Epsilon)return this.range(this.quadraticEquation(e,i,r),0,1);const a=e/t,o=i/t,n=r/t,l=(3*o-a*a)/3,u=l/3,h=(2*a*a*a-9*a*o+27*n)/27,_=h/2,d=_*_+u*u*u,g=.5,c=g+.01;if(d<0){const w=-l/3,M=w*w*w,v=this.sqrt(M),x=-h/(2*v),E=this.range(x,-1,1),j=Math.acos(E),St=2*this.cbrt(v),xt=St*this.cos(j/3)-a/3;if(this.abs(xt-g)<c)return this.range(xt,0,1);const Lt=St*this.cos((j+2*Math.PI)/3)-a/3;if(this.abs(Lt-g)<c)return this.range(Lt,0,1);const qs=St*this.cos((j+4*Math.PI)/3)-a/3;return this.range(qs,0,1)}if(d==0){let w;_<0?w=this.cbrt(-_):w=-this.cbrt(_);const M=2*w-a/3;if(this.abs(M-g)<c)return this.range(M,0,1);const v=-w-a/3;return this.range(v,0,1)}const y=this.sqrt(d),p=this.cbrt(y-_),S=this.cbrt(y+_),f=p-S-a/3;return this.range(f,0,1)}constructor(){}};It.Epsilon=1e-5;let b=It;var Bi;(s=>{s.CubismMath=b})(Bi||(Bi={}));const Pe=30,Pi=.01;class Ps{constructor(){this._faceTargetX=0,this._faceTargetY=0,this._faceX=0,this._faceY=0,this._faceVX=0,this._faceVY=0,this._lastTimeSeconds=0,this._userTimeSeconds=0}update(t){this._userTimeSeconds+=t;const i=40/10*1/Pe;if(this._lastTimeSeconds==0){this._lastTimeSeconds=this._userTimeSeconds;return}const r=(this._userTimeSeconds-this._lastTimeSeconds)*Pe;this._lastTimeSeconds=this._userTimeSeconds;const o=.15*Pe,n=r*i/o,l=this._faceTargetX-this._faceX,u=this._faceTargetY-this._faceY;if(b.abs(l)<=Pi&&b.abs(u)<=Pi)return;const h=b.sqrt(l*l+u*u),_=i*l/h,d=i*u/h;let g=_-this._faceVX,c=d-this._faceVY;const y=b.sqrt(g*g+c*c);(y<-n||y>n)&&(g*=n/y,c*=n/y),this._faceVX+=g,this._faceVY+=c;{const p=.5*(b.sqrt(n*n+16*n*h-8*n*h)-n),S=b.sqrt(this._faceVX*this._faceVX+this._faceVY*this._faceVY);S>p&&(this._faceVX*=p/S,this._faceVY*=p/S)}this._faceX+=this._faceVX,this._faceY+=this._faceVY}getX(){return this._faceX}getY(){return this._faceY}set(t,e){this._faceTargetX=t,this._faceTargetY=e}}var Mi;(s=>{s.CubismTargetPoint=Ps})(Mi||(Mi={}));class Ft{constructor(){this.setFinishedMotionHandler=t=>this._onFinishedMotion=t,this.getFinishedMotionHandler=()=>this._onFinishedMotion,this._fadeInSeconds=-1,this._fadeOutSeconds=-1,this._weight=1,this._offsetSeconds=0,this._firedEventValues=new C}static delete(t){t.release(),t=null}release(){this._weight=0}updateParameters(t,e,i){if(!e.isAvailable()||e.isFinished())return;if(!e.isStarted()){e.setIsStarted(!0),e.setStartTime(i-this._offsetSeconds),e.setFadeInStartTime(i);const n=this.getDuration();e.getEndTime()<0&&e.setEndTime(n<=0?-1:e.getStartTime()+n)}let r=this._weight;const a=this._fadeInSeconds==0?1:b.getEasingSine((i-e.getFadeInStartTime())/this._fadeInSeconds),o=this._fadeOutSeconds==0||e.getEndTime()<0?1:b.getEasingSine((e.getEndTime()-i)/this._fadeOutSeconds);r=r*a*o,e.setState(i,r),Z(0<=r&&r<=1),this.doUpdateParameters(t,i,r,e),e.getEndTime()>0&&e.getEndTime()<i&&e.setIsFinished(!0)}setFadeInTime(t){this._fadeInSeconds=t}setFadeOutTime(t){this._fadeOutSeconds=t}getFadeOutTime(){return this._fadeOutSeconds}getFadeInTime(){return this._fadeInSeconds}setWeight(t){this._weight=t}getWeight(){return this._weight}getDuration(){return-1}getLoopDuration(){return-1}setOffsetTime(t){this._offsetSeconds=t}getFiredEvent(t,e){return this._firedEventValues}isExistModelOpacity(){return!1}getModelOpacityIndex(){return-1}getModelOpacityId(t){return null}getModelOpacityValue(){return 1}}var bi;(s=>{s.ACubismMotion=Ft})(bi||(bi={}));const Ur="FadeInTime",zr="FadeOutTime",wi="Parameters",Xr="Id",Yr="Value",ee="Blend",jr="Add",Gr="Multiply",Hr="Overwrite",vi=1;class pe extends Ft{constructor(){super(),this._parameters=new C}static create(t,e){const i=new pe;return i.parse(t,e),i}doUpdateParameters(t,e,i,r){for(let a=0;a<this._parameters.getSize();++a){const o=this._parameters.at(a);switch(o.blendType){case 0:{t.addParameterValueById(o.parameterId,o.value,i);break}case 1:{t.multiplyParameterValueById(o.parameterId,o.value,i);break}case 2:{t.setParameterValueById(o.parameterId,o.value,i);break}}}}parse(t,e){const i=O.create(t,e),r=i.getRoot();this.setFadeInTime(r.getValueByString(Ur).toFloat(vi)),this.setFadeOutTime(r.getValueByString(zr).toFloat(vi));const a=r.getValueByString(wi).getSize();this._parameters.prepareCapacity(a);for(let o=0;o<a;++o){const n=r.getValueByString(wi).getValueByIndex(o),l=I.getIdManager().getId(n.getValueByString(Xr).getRawString()),u=n.getValueByString(Yr).toFloat();let h;n.getValueByString(ee).isNull()||n.getValueByString(ee).getString()==jr?h=0:n.getValueByString(ee).getString()==Gr?h=1:n.getValueByString(ee).getString()==Hr?h=2:h=0;const _=new bs;_.parameterId=l,_.blendType=h,_.value=u,this._parameters.pushBack(_)}O.delete(i)}}var Ms=(s=>(s[s.ExpressionBlendType_Add=0]="ExpressionBlendType_Add",s[s.ExpressionBlendType_Multiply=1]="ExpressionBlendType_Multiply",s[s.ExpressionBlendType_Overwrite=2]="ExpressionBlendType_Overwrite",s))(Ms||{});class bs{}var Ii;(s=>{s.CubismExpressionMotion=pe,s.ExpressionBlendType=Ms,s.ExpressionParameter=bs})(Ii||(Ii={}));var W=(s=>(s[s.CubismMotionCurveTarget_Model=0]="CubismMotionCurveTarget_Model",s[s.CubismMotionCurveTarget_Parameter=1]="CubismMotionCurveTarget_Parameter",s[s.CubismMotionCurveTarget_PartOpacity=2]="CubismMotionCurveTarget_PartOpacity",s))(W||{}),J=(s=>(s[s.CubismMotionSegmentType_Linear=0]="CubismMotionSegmentType_Linear",s[s.CubismMotionSegmentType_Bezier=1]="CubismMotionSegmentType_Bezier",s[s.CubismMotionSegmentType_Stepped=2]="CubismMotionSegmentType_Stepped",s[s.CubismMotionSegmentType_InverseStepped=3]="CubismMotionSegmentType_InverseStepped",s))(J||{});class ze{constructor(){this.time=0,this.value=0}}class ws{constructor(){this.evaluate=null,this.basePointIndex=0,this.segmentType=0}}class vs{constructor(){this.type=0,this.segmentCount=0,this.baseSegmentIndex=0,this.fadeInTime=0,this.fadeOutTime=0}}class Is{constructor(){this.fireTime=0}}class Vs{constructor(){this.duration=0,this.loop=!1,this.curveCount=0,this.eventCount=0,this.fps=0,this.curves=new C,this.segments=new C,this.points=new C,this.events=new C}}var Vi;(s=>{s.CubismMotionCurve=vs,s.CubismMotionCurveTarget=W,s.CubismMotionData=Vs,s.CubismMotionEvent=Is,s.CubismMotionPoint=ze,s.CubismMotionSegment=ws,s.CubismMotionSegmentType=J})(Vi||(Vi={}));const X="Meta",$r="Duration",qr="Loop",Wr="AreBeziersRestricted",Jr="CurveCount",Kr="Fps",Zr="TotalSegmentCount",Qr="TotalPointCount",ot="Curves",ta="Target",ea="Id",ie="FadeInTime",se="FadeOutTime",Ti="Segments",Ri="UserData",ia="UserDataCount",sa="TotalUserDataSize",ra="Time",aa="Value";class Ts{constructor(t,e){this._json=O.create(t,e)}release(){O.delete(this._json)}getMotionDuration(){return this._json.getRoot().getValueByString(X).getValueByString($r).toFloat()}isMotionLoop(){return this._json.getRoot().getValueByString(X).getValueByString(qr).toBoolean()}getEvaluationOptionFlag(t){return t==0?this._json.getRoot().getValueByString(X).getValueByString(Wr).toBoolean():!1}getMotionCurveCount(){return this._json.getRoot().getValueByString(X).getValueByString(Jr).toInt()}getMotionFps(){return this._json.getRoot().getValueByString(X).getValueByString(Kr).toFloat()}getMotionTotalSegmentCount(){return this._json.getRoot().getValueByString(X).getValueByString(Zr).toInt()}getMotionTotalPointCount(){return this._json.getRoot().getValueByString(X).getValueByString(Qr).toInt()}isExistMotionFadeInTime(){return!this._json.getRoot().getValueByString(X).getValueByString(ie).isNull()}isExistMotionFadeOutTime(){return!this._json.getRoot().getValueByString(X).getValueByString(se).isNull()}getMotionFadeInTime(){return this._json.getRoot().getValueByString(X).getValueByString(ie).toFloat()}getMotionFadeOutTime(){return this._json.getRoot().getValueByString(X).getValueByString(se).toFloat()}getMotionCurveTarget(t){return this._json.getRoot().getValueByString(ot).getValueByIndex(t).getValueByString(ta).getRawString()}getMotionCurveId(t){return I.getIdManager().getId(this._json.getRoot().getValueByString(ot).getValueByIndex(t).getValueByString(ea).getRawString())}isExistMotionCurveFadeInTime(t){return!this._json.getRoot().getValueByString(ot).getValueByIndex(t).getValueByString(ie).isNull()}isExistMotionCurveFadeOutTime(t){return!this._json.getRoot().getValueByString(ot).getValueByIndex(t).getValueByString(se).isNull()}getMotionCurveFadeInTime(t){return this._json.getRoot().getValueByString(ot).getValueByIndex(t).getValueByString(ie).toFloat()}getMotionCurveFadeOutTime(t){return this._json.getRoot().getValueByString(ot).getValueByIndex(t).getValueByString(se).toFloat()}getMotionCurveSegmentCount(t){return this._json.getRoot().getValueByString(ot).getValueByIndex(t).getValueByString(Ti).getVector().getSize()}getMotionCurveSegment(t,e){return this._json.getRoot().getValueByString(ot).getValueByIndex(t).getValueByString(Ti).getValueByIndex(e).toFloat()}getEventCount(){return this._json.getRoot().getValueByString(X).getValueByString(ia).toInt()}getTotalEventValueSize(){return this._json.getRoot().getValueByString(X).getValueByString(sa).toInt()}getEventTime(t){return this._json.getRoot().getValueByString(Ri).getValueByIndex(t).getValueByString(ra).toFloat()}getEventValue(t){return new H(this._json.getRoot().getValueByString(Ri).getValueByIndex(t).getValueByString(aa).getRawString())}}var Rs=(s=>(s[s.EvaluationOptionFlag_AreBeziersRistricted=0]="EvaluationOptionFlag_AreBeziersRistricted",s))(Rs||{}),Ai;(s=>{s.CubismMotionJson=Ts})(Ai||(Ai={}));const na="EyeBlink",oa="LipSync",la="Model",ua="Parameter",ha="PartOpacity",re="Opacity",ga=!1;function G(s,t,e){const i=new ze;return i.time=s.time+(t.time-s.time)*e,i.value=s.value+(t.value-s.value)*e,i}function ca(s,t){let e=(t-s[0].time)/(s[1].time-s[0].time);return e<0&&(e=0),s[0].value+(s[1].value-s[0].value)*e}function da(s,t){let e=(t-s[0].time)/(s[3].time-s[0].time);e<0&&(e=0);const i=G(s[0],s[1],e),r=G(s[1],s[2],e),a=G(s[2],s[3],e),o=G(i,r,e),n=G(r,a,e);return G(o,n,e).value}function _a(s,t){const e=t,i=s[0].time,r=s[3].time,a=s[1].time,o=s[2].time,n=r-3*o+3*a-i,l=3*o-6*a+3*i,u=3*a-3*i,h=i-e,_=b.cardanoAlgorithmForBezier(n,l,u,h),d=G(s[0],s[1],_),g=G(s[1],s[2],_),c=G(s[2],s[3],_),y=G(d,g,_),p=G(g,c,_);return G(y,p,_).value}function ma(s,t){return s[0].value}function pa(s,t){return s[1].value}function Me(s,t,e){const i=s.curves.at(t);let r=-1;const a=i.baseSegmentIndex+i.segmentCount;let o=0;for(let l=i.baseSegmentIndex;l<a;++l)if(o=s.segments.at(l).basePointIndex+(s.segments.at(l).segmentType==J.CubismMotionSegmentType_Bezier?3:1),s.points.at(o).time>e){r=l;break}if(r==-1)return s.points.at(o).value;const n=s.segments.at(r);return n.evaluate(s.points.get(n.basePointIndex),e)}class fe extends Ft{constructor(){super(),this._sourceFrameRate=30,this._loopDurationSeconds=-1,this._isLoop=!1,this._isLoopFadeIn=!0,this._lastWeight=0,this._motionData=null,this._modelCurveIdEyeBlink=null,this._modelCurveIdLipSync=null,this._modelCurveIdOpacity=null,this._eyeBlinkParameterIds=null,this._lipSyncParameterIds=null,this._modelOpacity=1}static create(t,e,i){const r=new fe;return r.parse(t,e),r._sourceFrameRate=r._motionData.fps,r._loopDurationSeconds=r._motionData.duration,r._onFinishedMotion=i,r}doUpdateParameters(t,e,i,r){this._modelCurveIdEyeBlink==null&&(this._modelCurveIdEyeBlink=I.getIdManager().getId(na)),this._modelCurveIdLipSync==null&&(this._modelCurveIdLipSync=I.getIdManager().getId(oa)),this._modelCurveIdOpacity==null&&(this._modelCurveIdOpacity=I.getIdManager().getId(re));let a=e-r.getStartTime();a<0&&(a=0);let o=Number.MAX_VALUE,n=Number.MAX_VALUE;const l=64;let u=0,h=0;this._eyeBlinkParameterIds.getSize()>l&&jt("too many eye blink targets : {0}",this._eyeBlinkParameterIds.getSize()),this._lipSyncParameterIds.getSize()>l&&jt("too many lip sync targets : {0}",this._lipSyncParameterIds.getSize());const _=this._fadeInSeconds<=0?1:b.getEasingSine((e-r.getFadeInStartTime())/this._fadeInSeconds),d=this._fadeOutSeconds<=0||r.getEndTime()<0?1:b.getEasingSine((r.getEndTime()-e)/this._fadeOutSeconds);let g,c,y,p=a;if(this._isLoop)for(;p>this._motionData.duration;)p-=this._motionData.duration;const S=this._motionData.curves;for(c=0;c<this._motionData.curveCount&&S.at(c).type==W.CubismMotionCurveTarget_Model;++c)g=Me(this._motionData,c,p),S.at(c).id==this._modelCurveIdEyeBlink?n=g:S.at(c).id==this._modelCurveIdLipSync?o=g:S.at(c).id==this._modelCurveIdOpacity&&(this._modelOpacity=g,t.setModelOapcity(this.getModelOpacityValue()));for(;c<this._motionData.curveCount&&S.at(c).type==W.CubismMotionCurveTarget_Parameter;++c){if(y=t.getParameterIndex(S.at(c).id),y==-1)continue;const f=t.getParameterValueByIndex(y);if(g=Me(this._motionData,c,p),n!=Number.MAX_VALUE){for(let M=0;M<this._eyeBlinkParameterIds.getSize()&&M<l;++M)if(this._eyeBlinkParameterIds.at(M)==S.at(c).id){g*=n,h|=1<<M;break}}if(o!=Number.MAX_VALUE){for(let M=0;M<this._lipSyncParameterIds.getSize()&&M<l;++M)if(this._lipSyncParameterIds.at(M)==S.at(c).id){g+=o,u|=1<<M;break}}let w;if(S.at(c).fadeInTime<0&&S.at(c).fadeOutTime<0)w=f+(g-f)*i;else{let M,v;S.at(c).fadeInTime<0?M=_:M=S.at(c).fadeInTime==0?1:b.getEasingSine((e-r.getFadeInStartTime())/S.at(c).fadeInTime),S.at(c).fadeOutTime<0?v=d:v=S.at(c).fadeOutTime==0||r.getEndTime()<0?1:b.getEasingSine((r.getEndTime()-e)/S.at(c).fadeOutTime);const x=this._weight*M*v;w=f+(g-f)*x}t.setParameterValueByIndex(y,w,1)}{if(n!=Number.MAX_VALUE)for(let f=0;f<this._eyeBlinkParameterIds.getSize()&&f<l;++f){const w=t.getParameterValueById(this._eyeBlinkParameterIds.at(f));if(h>>f&1)continue;const M=w+(n-w)*i;t.setParameterValueById(this._eyeBlinkParameterIds.at(f),M)}if(o!=Number.MAX_VALUE)for(let f=0;f<this._lipSyncParameterIds.getSize()&&f<l;++f){const w=t.getParameterValueById(this._lipSyncParameterIds.at(f));if(u>>f&1)continue;const M=w+(o-w)*i;t.setParameterValueById(this._lipSyncParameterIds.at(f),M)}}for(;c<this._motionData.curveCount&&S.at(c).type==W.CubismMotionCurveTarget_PartOpacity;++c)y=t.getParameterIndex(S.at(c).id),y!=-1&&(g=Me(this._motionData,c,p),t.setParameterValueByIndex(y,g));a>=this._motionData.duration&&(this._isLoop?(r.setStartTime(e),this._isLoopFadeIn&&r.setFadeInStartTime(e)):(this._onFinishedMotion&&this._onFinishedMotion(this),r.setIsFinished(!0))),this._lastWeight=i}setIsLoop(t){this._isLoop=t}isLoop(){return this._isLoop}setIsLoopFadeIn(t){this._isLoopFadeIn=t}isLoopFadeIn(){return this._isLoopFadeIn}getDuration(){return this._isLoop?-1:this._loopDurationSeconds}getLoopDuration(){return this._loopDurationSeconds}setParameterFadeInTime(t,e){const i=this._motionData.curves;for(let r=0;r<this._motionData.curveCount;++r)if(t==i.at(r).id){i.at(r).fadeInTime=e;return}}setParameterFadeOutTime(t,e){const i=this._motionData.curves;for(let r=0;r<this._motionData.curveCount;++r)if(t==i.at(r).id){i.at(r).fadeOutTime=e;return}}getParameterFadeInTime(t){const e=this._motionData.curves;for(let i=0;i<this._motionData.curveCount;++i)if(t==e.at(i).id)return e.at(i).fadeInTime;return-1}getParameterFadeOutTime(t){const e=this._motionData.curves;for(let i=0;i<this._motionData.curveCount;++i)if(t==e.at(i).id)return e.at(i).fadeOutTime;return-1}setEffectIds(t,e){this._eyeBlinkParameterIds=t,this._lipSyncParameterIds=e}release(){this._motionData=void 0,this._motionData=null}parse(t,e){this._motionData=new Vs;let i=new Ts(t,e);this._motionData.duration=i.getMotionDuration(),this._motionData.loop=i.isMotionLoop(),this._motionData.curveCount=i.getMotionCurveCount(),this._motionData.fps=i.getMotionFps(),this._motionData.eventCount=i.getEventCount();const r=i.getEvaluationOptionFlag(Rs.EvaluationOptionFlag_AreBeziersRistricted);i.isExistMotionFadeInTime()?this._fadeInSeconds=i.getMotionFadeInTime()<0?1:i.getMotionFadeInTime():this._fadeInSeconds=1,i.isExistMotionFadeOutTime()?this._fadeOutSeconds=i.getMotionFadeOutTime()<0?1:i.getMotionFadeOutTime():this._fadeOutSeconds=1,this._motionData.curves.updateSize(this._motionData.curveCount,vs,!0),this._motionData.segments.updateSize(i.getMotionTotalSegmentCount(),ws,!0),this._motionData.points.updateSize(i.getMotionTotalPointCount(),ze,!0),this._motionData.events.updateSize(this._motionData.eventCount,Is,!0);let a=0,o=0;for(let n=0;n<this._motionData.curveCount;++n){i.getMotionCurveTarget(n)==la?this._motionData.curves.at(n).type=W.CubismMotionCurveTarget_Model:i.getMotionCurveTarget(n)==ua?this._motionData.curves.at(n).type=W.CubismMotionCurveTarget_Parameter:i.getMotionCurveTarget(n)==ha?this._motionData.curves.at(n).type=W.CubismMotionCurveTarget_PartOpacity:ut('Warning : Unable to get segment type from Curve! The number of "CurveCount" may be incorrect!'),this._motionData.curves.at(n).id=i.getMotionCurveId(n),this._motionData.curves.at(n).baseSegmentIndex=o,this._motionData.curves.at(n).fadeInTime=i.isExistMotionCurveFadeInTime(n)?i.getMotionCurveFadeInTime(n):-1,this._motionData.curves.at(n).fadeOutTime=i.isExistMotionCurveFadeOutTime(n)?i.getMotionCurveFadeOutTime(n):-1;for(let l=0;l<i.getMotionCurveSegmentCount(n);){switch(l==0?(this._motionData.segments.at(o).basePointIndex=a,this._motionData.points.at(a).time=i.getMotionCurveSegment(n,l),this._motionData.points.at(a).value=i.getMotionCurveSegment(n,l+1),a+=1,l+=2):this._motionData.segments.at(o).basePointIndex=a-1,i.getMotionCurveSegment(n,l)){case J.CubismMotionSegmentType_Linear:{this._motionData.segments.at(o).segmentType=J.CubismMotionSegmentType_Linear,this._motionData.segments.at(o).evaluate=ca,this._motionData.points.at(a).time=i.getMotionCurveSegment(n,l+1),this._motionData.points.at(a).value=i.getMotionCurveSegment(n,l+2),a+=1,l+=3;break}case J.CubismMotionSegmentType_Bezier:{this._motionData.segments.at(o).segmentType=J.CubismMotionSegmentType_Bezier,r||ga?this._motionData.segments.at(o).evaluate=da:this._motionData.segments.at(o).evaluate=_a,this._motionData.points.at(a).time=i.getMotionCurveSegment(n,l+1),this._motionData.points.at(a).value=i.getMotionCurveSegment(n,l+2),this._motionData.points.at(a+1).time=i.getMotionCurveSegment(n,l+3),this._motionData.points.at(a+1).value=i.getMotionCurveSegment(n,l+4),this._motionData.points.at(a+2).time=i.getMotionCurveSegment(n,l+5),this._motionData.points.at(a+2).value=i.getMotionCurveSegment(n,l+6),a+=3,l+=7;break}case J.CubismMotionSegmentType_Stepped:{this._motionData.segments.at(o).segmentType=J.CubismMotionSegmentType_Stepped,this._motionData.segments.at(o).evaluate=ma,this._motionData.points.at(a).time=i.getMotionCurveSegment(n,l+1),this._motionData.points.at(a).value=i.getMotionCurveSegment(n,l+2),a+=1,l+=3;break}case J.CubismMotionSegmentType_InverseStepped:{this._motionData.segments.at(o).segmentType=J.CubismMotionSegmentType_InverseStepped,this._motionData.segments.at(o).evaluate=pa,this._motionData.points.at(a).time=i.getMotionCurveSegment(n,l+1),this._motionData.points.at(a).value=i.getMotionCurveSegment(n,l+2),a+=1,l+=3;break}default:{Z(0);break}}++this._motionData.curves.at(n).segmentCount,++o}}for(let n=0;n<i.getEventCount();++n)this._motionData.events.at(n).fireTime=i.getEventTime(n),this._motionData.events.at(n).value=i.getEventValue(n);i.release(),i=void 0,i=null}getFiredEvent(t,e){this._firedEventValues.updateSize(0);for(let i=0;i<this._motionData.eventCount;++i)this._motionData.events.at(i).fireTime>t&&this._motionData.events.at(i).fireTime<=e&&this._firedEventValues.pushBack(new H(this._motionData.events.at(i).value.s));return this._firedEventValues}isExistModelOpacity(){for(let t=0;t<this._motionData.curveCount;t++){const e=this._motionData.curves.at(t);if(e.type==W.CubismMotionCurveTarget_Model&&e.id.getString().s.localeCompare(re)==0)return!0}return!1}getModelOpacityIndex(){if(this.isExistModelOpacity())for(let t=0;t<this._motionData.curveCount;t++){const e=this._motionData.curves.at(t);if(e.type==W.CubismMotionCurveTarget_Model&&e.id.getString().s.localeCompare(re)==0)return t}return-1}getModelOpacityId(t){if(t!=-1){const e=this._motionData.curves.at(t);if(e.type==W.CubismMotionCurveTarget_Model&&e.id.getString().s.localeCompare(re)==0)return I.getIdManager().getId(e.id.getString().s)}return null}getModelOpacityValue(){return this._modelOpacity}}var Ei;(s=>{s.CubismMotion=fe})(Ei||(Ei={}));class As{constructor(){this._autoDelete=!1,this._motion=null,this._available=!0,this._finished=!1,this._started=!1,this._startTimeSeconds=-1,this._fadeInStartTimeSeconds=0,this._endTimeSeconds=-1,this._stateTimeSeconds=0,this._stateWeight=0,this._lastEventCheckSeconds=0,this._motionQueueEntryHandle=this,this._fadeOutSeconds=0,this._isTriggeredFadeOut=!1}release(){this._autoDelete&&this._motion&&Ft.delete(this._motion)}setFadeOut(t){this._fadeOutSeconds=t,this._isTriggeredFadeOut=!0}startFadeOut(t,e){const i=e+t;this._isTriggeredFadeOut=!0,(this._endTimeSeconds<0||i<this._endTimeSeconds)&&(this._endTimeSeconds=i)}isFinished(){return this._finished}isStarted(){return this._started}getStartTime(){return this._startTimeSeconds}getFadeInStartTime(){return this._fadeInStartTimeSeconds}getEndTime(){return this._endTimeSeconds}setStartTime(t){this._startTimeSeconds=t}setFadeInStartTime(t){this._fadeInStartTimeSeconds=t}setEndTime(t){this._endTimeSeconds=t}setIsFinished(t){this._finished=t}setIsStarted(t){this._started=t}isAvailable(){return this._available}setIsAvailable(t){this._available=t}setState(t,e){this._stateTimeSeconds=t,this._stateWeight=e}getStateTime(){return this._stateTimeSeconds}getStateWeight(){return this._stateWeight}getLastCheckEventSeconds(){return this._lastEventCheckSeconds}setLastCheckEventSeconds(t){this._lastEventCheckSeconds=t}isTriggeredFadeOut(){return this._isTriggeredFadeOut}getFadeOutSeconds(){return this._fadeOutSeconds}}var Fi;(s=>{s.CubismMotionQueueEntry=As})(Fi||(Fi={}));class Es{constructor(){this._userTimeSeconds=0,this._eventCallBack=null,this._eventCustomData=null,this._motions=new C}release(){for(let t=0;t<this._motions.getSize();++t)this._motions.at(t)&&(this._motions.at(t).release(),this._motions.set(t,null));this._motions=null}startMotion(t,e,i){if(t==null)return ge;let r=null;for(let a=0;a<this._motions.getSize();++a)r=this._motions.at(a),r!=null&&r.setFadeOut(r._motion.getFadeOutTime());return r=new As,r._autoDelete=e,r._motion=t,this._motions.pushBack(r),r._motionQueueEntryHandle}isFinished(){for(let t=this._motions.begin();t.notEqual(this._motions.end());){let e=t.ptr();if(e==null){t=this._motions.erase(t);continue}if(e._motion==null){e.release(),e=null,t=this._motions.erase(t);continue}if(e.isFinished())t.preIncrement();else return!1}return!0}isFinishedByHandle(t){for(let e=this._motions.begin();e.notEqual(this._motions.end());e.increment()){const i=e.ptr();if(i!=null&&i._motionQueueEntryHandle==t&&!i.isFinished())return!1}return!0}stopAllMotions(){for(let t=this._motions.begin();t.notEqual(this._motions.end());){let e=t.ptr();if(e==null){t=this._motions.erase(t);continue}e.release(),e=null,t=this._motions.erase(t)}}getCubismMotionQueueEntry(t){for(let e=this._motions.begin();e.notEqual(this._motions.end());e.preIncrement()){const i=e.ptr();if(i!=null&&i._motionQueueEntryHandle==t)return i}return null}setEventCallback(t,e=null){this._eventCallBack=t,this._eventCustomData=e}doUpdateMotion(t,e){let i=!1;for(let r=this._motions.begin();r.notEqual(this._motions.end());){let a=r.ptr();if(a==null){r=this._motions.erase(r);continue}const o=a._motion;if(o==null){a.release(),a=null,r=this._motions.erase(r);continue}o.updateParameters(t,a,e),i=!0;const n=o.getFiredEvent(a.getLastCheckEventSeconds()-a.getStartTime(),e-a.getStartTime());for(let l=0;l<n.getSize();++l)this._eventCallBack(this,n.at(l),this._eventCustomData);a.setLastCheckEventSeconds(e),a.isFinished()?(a.release(),a=null,r=this._motions.erase(r)):(a.isTriggeredFadeOut()&&a.startFadeOut(a.getFadeOutSeconds(),e),r.preIncrement())}return i}}const ge=-1;var Di;(s=>{s.CubismMotionQueueManager=Es,s.InvalidMotionQueueEntryHandleValue=ge})(Di||(Di={}));class Ae extends Es{constructor(){super(),this._currentPriority=0,this._reservePriority=0}getCurrentPriority(){return this._currentPriority}getReservePriority(){return this._reservePriority}setReservePriority(t){this._reservePriority=t}startMotionPriority(t,e,i){return i==this._reservePriority&&(this._reservePriority=0),this._currentPriority=i,super.startMotion(t,e,this._userTimeSeconds)}updateMotion(t,e){this._userTimeSeconds+=e;const i=super.doUpdateMotion(t,this._userTimeSeconds);return this.isFinished()&&(this._currentPriority=0),i}reserveMotion(t){return t<=this._reservePriority||t<=this._currentPriority?!1:(this._reservePriority=t,!0)}}var Li;(s=>{s.CubismMotionManager=Ae})(Li||(Li={}));var ce=(s=>(s[s.CubismPhysicsTargetType_Parameter=0]="CubismPhysicsTargetType_Parameter",s))(ce||{}),lt=(s=>(s[s.CubismPhysicsSource_X=0]="CubismPhysicsSource_X",s[s.CubismPhysicsSource_Y=1]="CubismPhysicsSource_Y",s[s.CubismPhysicsSource_Angle=2]="CubismPhysicsSource_Angle",s))(lt||{});class fa{constructor(){this.gravity=new P(0,0),this.wind=new P(0,0)}}class Xe{}class Ee{}class Fs{constructor(){this.initialPosition=new P(0,0),this.position=new P(0,0),this.lastPosition=new P(0,0),this.lastGravity=new P(0,0),this.force=new P(0,0),this.velocity=new P(0,0)}}class Ds{constructor(){this.normalizationPosition=new Ee,this.normalizationAngle=new Ee}}class Ls{constructor(){this.source=new Xe}}class Os{constructor(){this.destination=new Xe,this.translationScale=new P(0,0)}}class ks{constructor(){this.settings=new C,this.inputs=new C,this.outputs=new C,this.particles=new C,this.gravity=new P(0,0),this.wind=new P(0,0),this.fps=0}}var Oi;(s=>{s.CubismPhysicsInput=Ls,s.CubismPhysicsNormalization=Ee,s.CubismPhysicsOutput=Os,s.CubismPhysicsParameter=Xe,s.CubismPhysicsParticle=Fs,s.CubismPhysicsRig=ks,s.CubismPhysicsSource=lt,s.CubismPhysicsSubRig=Ds,s.CubismPhysicsTargetType=ce,s.PhysicsJsonEffectiveForces=fa})(Oi||(Oi={}));const kt="Position",be="X",we="Y",ve="Angle",ki="Type",Ni="Id",st="Meta",ae="EffectiveForces",ya="TotalInputCount",Sa="TotalOutputCount",xa="PhysicsSettingCount",Ui="Gravity",zi="Wind",Ca="VertexCount",Ba="Fps",A="PhysicsSettings",Pt="Normalization",Xi="Minimum",Yi="Maximum",ji="Default",Gi="Reflect",Hi="Weight",Nt="Input",Pa="Source",gt="Output",Ma="Scale",ba="VertexIndex",wa="Destination",ct="Vertices",va="Mobility",Ia="Delay",Va="Radius",Ta="Acceleration";class Ns{constructor(t,e){this._json=O.create(t,e)}release(){O.delete(this._json)}getGravity(){const t=new P(0,0);return t.x=this._json.getRoot().getValueByString(st).getValueByString(ae).getValueByString(Ui).getValueByString(be).toFloat(),t.y=this._json.getRoot().getValueByString(st).getValueByString(ae).getValueByString(Ui).getValueByString(we).toFloat(),t}getWind(){const t=new P(0,0);return t.x=this._json.getRoot().getValueByString(st).getValueByString(ae).getValueByString(zi).getValueByString(be).toFloat(),t.y=this._json.getRoot().getValueByString(st).getValueByString(ae).getValueByString(zi).getValueByString(we).toFloat(),t}getFps(){return this._json.getRoot().getValueByString(st).getValueByString(Ba).toFloat(0)}getSubRigCount(){return this._json.getRoot().getValueByString(st).getValueByString(xa).toInt()}getTotalInputCount(){return this._json.getRoot().getValueByString(st).getValueByString(ya).toInt()}getTotalOutputCount(){return this._json.getRoot().getValueByString(st).getValueByString(Sa).toInt()}getVertexCount(){return this._json.getRoot().getValueByString(st).getValueByString(Ca).toInt()}getNormalizationPositionMinimumValue(t){return this._json.getRoot().getValueByString(A).getValueByIndex(t).getValueByString(Pt).getValueByString(kt).getValueByString(Xi).toFloat()}getNormalizationPositionMaximumValue(t){return this._json.getRoot().getValueByString(A).getValueByIndex(t).getValueByString(Pt).getValueByString(kt).getValueByString(Yi).toFloat()}getNormalizationPositionDefaultValue(t){return this._json.getRoot().getValueByString(A).getValueByIndex(t).getValueByString(Pt).getValueByString(kt).getValueByString(ji).toFloat()}getNormalizationAngleMinimumValue(t){return this._json.getRoot().getValueByString(A).getValueByIndex(t).getValueByString(Pt).getValueByString(ve).getValueByString(Xi).toFloat()}getNormalizationAngleMaximumValue(t){return this._json.getRoot().getValueByString(A).getValueByIndex(t).getValueByString(Pt).getValueByString(ve).getValueByString(Yi).toFloat()}getNormalizationAngleDefaultValue(t){return this._json.getRoot().getValueByString(A).getValueByIndex(t).getValueByString(Pt).getValueByString(ve).getValueByString(ji).toFloat()}getInputCount(t){return this._json.getRoot().getValueByString(A).getValueByIndex(t).getValueByString(Nt).getVector().getSize()}getInputWeight(t,e){return this._json.getRoot().getValueByString(A).getValueByIndex(t).getValueByString(Nt).getValueByIndex(e).getValueByString(Hi).toFloat()}getInputReflect(t,e){return this._json.getRoot().getValueByString(A).getValueByIndex(t).getValueByString(Nt).getValueByIndex(e).getValueByString(Gi).toBoolean()}getInputType(t,e){return this._json.getRoot().getValueByString(A).getValueByIndex(t).getValueByString(Nt).getValueByIndex(e).getValueByString(ki).getRawString()}getInputSourceId(t,e){return I.getIdManager().getId(this._json.getRoot().getValueByString(A).getValueByIndex(t).getValueByString(Nt).getValueByIndex(e).getValueByString(Pa).getValueByString(Ni).getRawString())}getOutputCount(t){return this._json.getRoot().getValueByString(A).getValueByIndex(t).getValueByString(gt).getVector().getSize()}getOutputVertexIndex(t,e){return this._json.getRoot().getValueByString(A).getValueByIndex(t).getValueByString(gt).getValueByIndex(e).getValueByString(ba).toInt()}getOutputAngleScale(t,e){return this._json.getRoot().getValueByString(A).getValueByIndex(t).getValueByString(gt).getValueByIndex(e).getValueByString(Ma).toFloat()}getOutputWeight(t,e){return this._json.getRoot().getValueByString(A).getValueByIndex(t).getValueByString(gt).getValueByIndex(e).getValueByString(Hi).toFloat()}getOutputDestinationId(t,e){return I.getIdManager().getId(this._json.getRoot().getValueByString(A).getValueByIndex(t).getValueByString(gt).getValueByIndex(e).getValueByString(wa).getValueByString(Ni).getRawString())}getOutputType(t,e){return this._json.getRoot().getValueByString(A).getValueByIndex(t).getValueByString(gt).getValueByIndex(e).getValueByString(ki).getRawString()}getOutputReflect(t,e){return this._json.getRoot().getValueByString(A).getValueByIndex(t).getValueByString(gt).getValueByIndex(e).getValueByString(Gi).toBoolean()}getParticleCount(t){return this._json.getRoot().getValueByString(A).getValueByIndex(t).getValueByString(ct).getVector().getSize()}getParticleMobility(t,e){return this._json.getRoot().getValueByString(A).getValueByIndex(t).getValueByString(ct).getValueByIndex(e).getValueByString(va).toFloat()}getParticleDelay(t,e){return this._json.getRoot().getValueByString(A).getValueByIndex(t).getValueByString(ct).getValueByIndex(e).getValueByString(Ia).toFloat()}getParticleAcceleration(t,e){return this._json.getRoot().getValueByString(A).getValueByIndex(t).getValueByString(ct).getValueByIndex(e).getValueByString(Ta).toFloat()}getParticleRadius(t,e){return this._json.getRoot().getValueByString(A).getValueByIndex(t).getValueByString(ct).getValueByIndex(e).getValueByString(Va).toFloat()}getParticlePosition(t,e){const i=new P(0,0);return i.x=this._json.getRoot().getValueByString(A).getValueByIndex(t).getValueByString(ct).getValueByIndex(e).getValueByString(kt).getValueByString(be).toFloat(),i.y=this._json.getRoot().getValueByString(A).getValueByIndex(t).getValueByString(ct).getValueByIndex(e).getValueByString(kt).getValueByString(we).toFloat(),i}}var $i;(s=>{s.CubismPhysicsJson=Ns})($i||($i={}));const qi="X",Wi="Y",Ji="Angle",Ra=5,Fe=100,Ki=.001,Aa=5;class Wt{static create(t,e){const i=new Wt;return i.parse(t,e),i._physicsRig.gravity.y=0,i}static delete(t){t!=null&&(t.release(),t=null)}parse(t,e){this._physicsRig=new ks;let i=new Ns(t,e);this._physicsRig.gravity=i.getGravity(),this._physicsRig.wind=i.getWind(),this._physicsRig.subRigCount=i.getSubRigCount(),this._physicsRig.fps=i.getFps(),this._physicsRig.settings.updateSize(this._physicsRig.subRigCount,Ds,!0),this._physicsRig.inputs.updateSize(i.getTotalInputCount(),Ls,!0),this._physicsRig.outputs.updateSize(i.getTotalOutputCount(),Os,!0),this._physicsRig.particles.updateSize(i.getVertexCount(),Fs,!0),this._currentRigOutputs.clear(),this._previousRigOutputs.clear();let r=0,a=0,o=0;for(let n=0;n<this._physicsRig.settings.getSize();++n){this._physicsRig.settings.at(n).normalizationPosition.minimum=i.getNormalizationPositionMinimumValue(n),this._physicsRig.settings.at(n).normalizationPosition.maximum=i.getNormalizationPositionMaximumValue(n),this._physicsRig.settings.at(n).normalizationPosition.defalut=i.getNormalizationPositionDefaultValue(n),this._physicsRig.settings.at(n).normalizationAngle.minimum=i.getNormalizationAngleMinimumValue(n),this._physicsRig.settings.at(n).normalizationAngle.maximum=i.getNormalizationAngleMaximumValue(n),this._physicsRig.settings.at(n).normalizationAngle.defalut=i.getNormalizationAngleDefaultValue(n),this._physicsRig.settings.at(n).inputCount=i.getInputCount(n),this._physicsRig.settings.at(n).baseInputIndex=r;for(let h=0;h<this._physicsRig.settings.at(n).inputCount;++h)this._physicsRig.inputs.at(r+h).sourceParameterIndex=-1,this._physicsRig.inputs.at(r+h).weight=i.getInputWeight(n,h),this._physicsRig.inputs.at(r+h).reflect=i.getInputReflect(n,h),i.getInputType(n,h)==qi?(this._physicsRig.inputs.at(r+h).type=lt.CubismPhysicsSource_X,this._physicsRig.inputs.at(r+h).getNormalizedParameterValue=Fa):i.getInputType(n,h)==Wi?(this._physicsRig.inputs.at(r+h).type=lt.CubismPhysicsSource_Y,this._physicsRig.inputs.at(r+h).getNormalizedParameterValue=Da):i.getInputType(n,h)==Ji&&(this._physicsRig.inputs.at(r+h).type=lt.CubismPhysicsSource_Angle,this._physicsRig.inputs.at(r+h).getNormalizedParameterValue=La),this._physicsRig.inputs.at(r+h).source.targetType=ce.CubismPhysicsTargetType_Parameter,this._physicsRig.inputs.at(r+h).source.id=i.getInputSourceId(n,h);r+=this._physicsRig.settings.at(n).inputCount,this._physicsRig.settings.at(n).outputCount=i.getOutputCount(n),this._physicsRig.settings.at(n).baseOutputIndex=a;const l=new Zi;l.outputs.resize(this._physicsRig.settings.at(n).outputCount);const u=new Zi;u.outputs.resize(this._physicsRig.settings.at(n).outputCount);for(let h=0;h<this._physicsRig.settings.at(n).outputCount;++h)l.outputs.set(h,0),u.outputs.set(h,0),this._physicsRig.outputs.at(a+h).destinationParameterIndex=-1,this._physicsRig.outputs.at(a+h).vertexIndex=i.getOutputVertexIndex(n,h),this._physicsRig.outputs.at(a+h).angleScale=i.getOutputAngleScale(n,h),this._physicsRig.outputs.at(a+h).weight=i.getOutputWeight(n,h),this._physicsRig.outputs.at(a+h).destination.targetType=ce.CubismPhysicsTargetType_Parameter,this._physicsRig.outputs.at(a+h).destination.id=i.getOutputDestinationId(n,h),i.getOutputType(n,h)==qi?(this._physicsRig.outputs.at(a+h).type=lt.CubismPhysicsSource_X,this._physicsRig.outputs.at(a+h).getValue=Oa,this._physicsRig.outputs.at(a+h).getScale=Xa):i.getOutputType(n,h)==Wi?(this._physicsRig.outputs.at(a+h).type=lt.CubismPhysicsSource_Y,this._physicsRig.outputs.at(a+h).getValue=ka,this._physicsRig.outputs.at(a+h).getScale=Ya):i.getOutputType(n,h)==Ji&&(this._physicsRig.outputs.at(a+h).type=lt.CubismPhysicsSource_Angle,this._physicsRig.outputs.at(a+h).getValue=Na,this._physicsRig.outputs.at(a+h).getScale=ja),this._physicsRig.outputs.at(a+h).reflect=i.getOutputReflect(n,h);this._currentRigOutputs.pushBack(l),this._previousRigOutputs.pushBack(u),a+=this._physicsRig.settings.at(n).outputCount,this._physicsRig.settings.at(n).particleCount=i.getParticleCount(n),this._physicsRig.settings.at(n).baseParticleIndex=o;for(let h=0;h<this._physicsRig.settings.at(n).particleCount;++h)this._physicsRig.particles.at(o+h).mobility=i.getParticleMobility(n,h),this._physicsRig.particles.at(o+h).delay=i.getParticleDelay(n,h),this._physicsRig.particles.at(o+h).acceleration=i.getParticleAcceleration(n,h),this._physicsRig.particles.at(o+h).radius=i.getParticleRadius(n,h),this._physicsRig.particles.at(o+h).position=i.getParticlePosition(n,h);o+=this._physicsRig.settings.at(n).particleCount}this.initialize(),i.release(),i=void 0,i=null}stabilization(t){var y,p;let e,i,r,a;const o=new P;let n,l,u,h,_,d,g,c;_=t.getModel().parameters.values,d=t.getModel().parameters.maximumValues,g=t.getModel().parameters.minimumValues,c=t.getModel().parameters.defaultValues,(((y=this._parameterCaches)==null?void 0:y.length)??0)<t.getParameterCount()&&(this._parameterCaches=new Float32Array(t.getParameterCount())),(((p=this._parameterInputCaches)==null?void 0:p.length)??0)<t.getParameterCount()&&(this._parameterInputCaches=new Float32Array(t.getParameterCount()));for(let S=0;S<t.getParameterCount();++S)this._parameterCaches[S]=_[S],this._parameterInputCaches[S]=_[S];for(let S=0;S<this._physicsRig.subRigCount;++S){e={angle:0},o.x=0,o.y=0,n=this._physicsRig.settings.at(S),l=this._physicsRig.inputs.get(n.baseInputIndex),u=this._physicsRig.outputs.get(n.baseOutputIndex),h=this._physicsRig.particles.get(n.baseParticleIndex);for(let f=0;f<n.inputCount;++f)i=l[f].weight/Fe,l[f].sourceParameterIndex==-1&&(l[f].sourceParameterIndex=t.getParameterIndex(l[f].source.id)),l[f].getNormalizedParameterValue(o,e,_[l[f].sourceParameterIndex],g[l[f].sourceParameterIndex],d[l[f].sourceParameterIndex],c[l[f].sourceParameterIndex],n.normalizationPosition,n.normalizationAngle,l[f].reflect,i),this._parameterCaches[l[f].sourceParameterIndex]=_[l[f].sourceParameterIndex];r=b.degreesToRadian(-e.angle),o.x=o.x*b.cos(r)-o.y*b.sin(r),o.y=o.x*b.sin(r)+o.y*b.cos(r),Ha(h,n.particleCount,o,e.angle,this._options.wind,Ki*n.normalizationPosition.maximum);for(let f=0;f<n.outputCount;++f){const w=u[f].vertexIndex;if(u[f].destinationParameterIndex==-1&&(u[f].destinationParameterIndex=t.getParameterIndex(u[f].destination.id)),w<1||w>=n.particleCount)continue;let M=new P;M=h[w].position.substract(h[w-1].position),a=u[f].getValue(M,h,w,u[f].reflect,this._options.gravity),this._currentRigOutputs.at(S).outputs.set(f,a),this._previousRigOutputs.at(S).outputs.set(f,a);const v=u[f].destinationParameterIndex,x=!Float32Array.prototype.slice&&"subarray"in Float32Array.prototype?JSON.parse(JSON.stringify(_.subarray(v))):_.slice(v);Ie(x,g[v],d[v],a,u[f]);for(let E=v,j=0;E<this._parameterCaches.length;E++,j++)_[E]=this._parameterCaches[E]=x[j]}}}evaluate(t,e){var f,w;let i,r,a,o;const n=new P;let l,u,h,_;if(0>=e)return;let d,g,c,y,p;if(this._currentRemainTime+=e,this._currentRemainTime>Aa&&(this._currentRemainTime=0),d=t.getModel().parameters.values,g=t.getModel().parameters.maximumValues,c=t.getModel().parameters.minimumValues,y=t.getModel().parameters.defaultValues,(((f=this._parameterCaches)==null?void 0:f.length)??0)<t.getParameterCount()&&(this._parameterCaches=new Float32Array(t.getParameterCount())),(((w=this._parameterInputCaches)==null?void 0:w.length)??0)<t.getParameterCount()){this._parameterInputCaches=new Float32Array(t.getParameterCount());for(let M=0;M<t.getParameterCount();++M)this._parameterInputCaches[M]=d[M]}for(this._physicsRig.fps>0?p=1/this._physicsRig.fps:p=e;this._currentRemainTime>=p;){for(let v=0;v<this._physicsRig.subRigCount;++v){l=this._physicsRig.settings.at(v),h=this._physicsRig.outputs.get(l.baseOutputIndex);for(let x=0;x<l.outputCount;++x)this._previousRigOutputs.at(v).outputs.set(x,this._currentRigOutputs.at(v).outputs.at(x))}const M=p/this._currentRemainTime;for(let v=0;v<t.getParameterCount();++v)this._parameterCaches[v]=this._parameterInputCaches[v]*(1-M)+d[v]*M,this._parameterInputCaches[v]=this._parameterCaches[v];for(let v=0;v<this._physicsRig.subRigCount;++v){i={angle:0},n.x=0,n.y=0,l=this._physicsRig.settings.at(v),u=this._physicsRig.inputs.get(l.baseInputIndex),h=this._physicsRig.outputs.get(l.baseOutputIndex),_=this._physicsRig.particles.get(l.baseParticleIndex);for(let x=0;x<l.inputCount;++x)r=u[x].weight/Fe,u[x].sourceParameterIndex==-1&&(u[x].sourceParameterIndex=t.getParameterIndex(u[x].source.id)),u[x].getNormalizedParameterValue(n,i,this._parameterCaches[u[x].sourceParameterIndex],c[u[x].sourceParameterIndex],g[u[x].sourceParameterIndex],y[u[x].sourceParameterIndex],l.normalizationPosition,l.normalizationAngle,u[x].reflect,r);a=b.degreesToRadian(-i.angle),n.x=n.x*b.cos(a)-n.y*b.sin(a),n.y=n.x*b.sin(a)+n.y*b.cos(a),Ga(_,l.particleCount,n,i.angle,this._options.wind,Ki*l.normalizationPosition.maximum,p,Ra);for(let x=0;x<l.outputCount;++x){const E=h[x].vertexIndex;if(h[x].destinationParameterIndex==-1&&(h[x].destinationParameterIndex=t.getParameterIndex(h[x].destination.id)),E<1||E>=l.particleCount)continue;const j=new P;j.x=_[E].position.x-_[E-1].position.x,j.y=_[E].position.y-_[E-1].position.y,o=h[x].getValue(j,_,E,h[x].reflect,this._options.gravity),this._currentRigOutputs.at(v).outputs.set(x,o);const $=h[x].destinationParameterIndex,St=!Float32Array.prototype.slice&&"subarray"in Float32Array.prototype?JSON.parse(JSON.stringify(this._parameterCaches.subarray($))):this._parameterCaches.slice($);Ie(St,c[$],g[$],o,h[x]);for(let xt=$,Lt=0;xt<this._parameterCaches.length;xt++,Lt++)this._parameterCaches[xt]=St[Lt]}}this._currentRemainTime-=p}const S=this._currentRemainTime/p;this.interpolate(t,S)}interpolate(t,e){let i,r,a,o,n;a=t.getModel().parameters.values,o=t.getModel().parameters.maximumValues,n=t.getModel().parameters.minimumValues;for(let l=0;l<this._physicsRig.subRigCount;++l){r=this._physicsRig.settings.at(l),i=this._physicsRig.outputs.get(r.baseOutputIndex);for(let u=0;u<r.outputCount;++u){if(i[u].destinationParameterIndex==-1)continue;const h=i[u].destinationParameterIndex,_=!Float32Array.prototype.slice&&"subarray"in Float32Array.prototype?JSON.parse(JSON.stringify(a.subarray(h))):a.slice(h);Ie(_,n[h],o[h],this._previousRigOutputs.at(l).outputs.at(u)*(1-e)+this._currentRigOutputs.at(l).outputs.at(u)*e,i[u]);for(let d=h,g=0;d<a.length;d++,g++)a[d]=_[g]}}}setOptions(t){this._options=t}getOption(){return this._options}constructor(){this._physicsRig=null,this._options=new Us,this._options.gravity.y=-1,this._options.gravity.x=0,this._options.wind.x=0,this._options.wind.y=0,this._currentRigOutputs=new C,this._previousRigOutputs=new C,this._currentRemainTime=0,this._parameterCaches=null,this._parameterInputCaches=null}release(){this._physicsRig=void 0,this._physicsRig=null}initialize(){let t,e,i;for(let r=0;r<this._physicsRig.subRigCount;++r){e=this._physicsRig.settings.at(r),t=this._physicsRig.particles.get(e.baseParticleIndex),t[0].initialPosition=new P(0,0),t[0].lastPosition=new P(t[0].initialPosition.x,t[0].initialPosition.y),t[0].lastGravity=new P(0,-1),t[0].lastGravity.y*=-1,t[0].velocity=new P(0,0),t[0].force=new P(0,0);for(let a=1;a<e.particleCount;++a)i=new P(0,0),i.y=t[a].radius,t[a].initialPosition=new P(t[a-1].initialPosition.x+i.x,t[a-1].initialPosition.y+i.y),t[a].position=new P(t[a].initialPosition.x,t[a].initialPosition.y),t[a].lastPosition=new P(t[a].initialPosition.x,t[a].initialPosition.y),t[a].lastGravity=new P(0,-1),t[a].lastGravity.y*=-1,t[a].velocity=new P(0,0),t[a].force=new P(0,0)}}}class Us{constructor(){this.gravity=new P(0,0),this.wind=new P(0,0)}}class Zi{constructor(){this.outputs=new C(0)}}function Ea(s){let t=0;return s>0?t=1:s<0&&(t=-1),t}function Fa(s,t,e,i,r,a,o,n,l,u){s.x+=Ye(e,i,r,a,o.minimum,o.maximum,o.defalut,l)*u}function Da(s,t,e,i,r,a,o,n,l,u){s.y+=Ye(e,i,r,a,o.minimum,o.maximum,o.defalut,l)*u}function La(s,t,e,i,r,a,o,n,l,u){t.angle+=Ye(e,i,r,a,n.minimum,n.maximum,n.defalut,l)*u}function Oa(s,t,e,i,r){let a=s.x;return i&&(a*=-1),a}function ka(s,t,e,i,r){let a=s.y;return i&&(a*=-1),a}function Na(s,t,e,i,r){let a;return e>=2?r=t[e-1].position.substract(t[e-2].position):r=r.multiplyByScaler(-1),a=b.directionToRadian(r,s),i&&(a*=-1),a}function Ua(s,t){const e=b.max(s,t),i=b.min(s,t);return b.abs(e-i)}function za(s,t){return b.min(s,t)+Ua(s,t)/2}function Xa(s,t){return JSON.parse(JSON.stringify(s.x))}function Ya(s,t){return JSON.parse(JSON.stringify(s.y))}function ja(s,t){return JSON.parse(JSON.stringify(t))}function Ga(s,t,e,i,r,a,o,n){let l,u,h,_,d=new P(0,0),g=new P(0,0),c=new P(0,0),y=new P(0,0);s[0].position=new P(e.x,e.y),l=b.degreesToRadian(i),_=b.radianToDirection(l),_.normalize();for(let p=1;p<t;++p)s[p].force=_.multiplyByScaler(s[p].acceleration).add(r),s[p].lastPosition=new P(s[p].position.x,s[p].position.y),u=s[p].delay*o*30,d=s[p].position.substract(s[p-1].position),h=b.directionToRadian(s[p].lastGravity,_)/n,d.x=b.cos(h)*d.x-d.y*b.sin(h),d.y=b.sin(h)*d.x+d.y*b.cos(h),s[p].position=s[p-1].position.add(d),g=s[p].velocity.multiplyByScaler(u),c=s[p].force.multiplyByScaler(u).multiplyByScaler(u),s[p].position=s[p].position.add(g).add(c),y=s[p].position.substract(s[p-1].position),y.normalize(),s[p].position=s[p-1].position.add(y.multiplyByScaler(s[p].radius)),b.abs(s[p].position.x)<a&&(s[p].position.x=0),u!=0&&(s[p].velocity=s[p].position.substract(s[p].lastPosition),s[p].velocity=s[p].velocity.divisionByScalar(u),s[p].velocity=s[p].velocity.multiplyByScaler(s[p].mobility)),s[p].force=new P(0,0),s[p].lastGravity=new P(_.x,_.y)}function Ha(s,t,e,i,r,a){let o,n,l=new P(0,0);s[0].position=new P(e.x,e.y),o=b.degreesToRadian(i),n=b.radianToDirection(o),n.normalize();for(let u=1;u<t;++u)s[u].force=n.multiplyByScaler(s[u].acceleration).add(r),s[u].lastPosition=new P(s[u].position.x,s[u].position.y),s[u].velocity=new P(0,0),l=s[u].force,l.normalize(),l=l.multiplyByScaler(s[u].radius),s[u].position=s[u-1].position.add(l),b.abs(s[u].position.x)<a&&(s[u].position.x=0),s[u].force=new P(0,0),s[u].lastGravity=new P(n.x,n.y)}function Ie(s,t,e,i,r){let a,o,n;a=r.getScale(r.translationScale,r.angleScale),o=i*a,o<t?(o<r.valueBelowMinimum&&(r.valueBelowMinimum=o),o=t):o>e&&(o>r.valueExceededMaximum&&(r.valueExceededMaximum=o),o=e),n=r.weight/Fe,n>=1||(o=s[0]*(1-n)+o*n),s[0]=o}function Ye(s,t,e,i,r,a,o,n){let l=0;const u=b.max(e,t);u<s&&(s=u);const h=b.min(e,t);h>s&&(s=h);const _=b.min(r,a),d=b.max(r,a),g=o,c=za(h,u),y=s-c;switch(Ea(y)){case 1:{const p=d-g,S=u-c;S!=0&&(l=y*(p/S),l+=g);break}case-1:{const p=_-g,S=h-c;S!=0&&(l=y*(p/S),l+=g);break}case 0:{l=g;break}}return n?l:l*-1}var Qi;(s=>{s.CubismPhysics=Wt,s.Options=Us})(Qi||(Qi={}));class de{constructor(t,e,i,r){this.x=t,this.y=e,this.width=i,this.height=r}getCenterX(){return this.x+.5*this.width}getCenterY(){return this.y+.5*this.height}getRight(){return this.x+this.width}getBottom(){return this.y+this.height}setRect(t){this.x=t.x,this.y=t.y,this.width=t.width,this.height=t.height}expand(t,e){this.x-=t,this.y-=e,this.width+=t*2,this.height+=e*2}}var ts;(s=>{s.csmRect=de})(ts||(ts={}));const ne=4,$a=36,qa=32,Wa=10;let dt,rt,_e;class De{getChannelFlagAsColor(t){return this._channelColors.at(t)}getMaskRenderTexture(){if(this._maskTexture&&this._maskTexture.textures!=null)this._maskTexture.frameNo=this._currentFrameNo;else{this._maskRenderTextures!=null&&this._maskRenderTextures.clear(),this._maskRenderTextures=new C,this._maskColorBuffers!=null&&this._maskColorBuffers.clear(),this._maskColorBuffers=new C;const t=this._clippingMaskBufferSize;for(let e=0;e<this._renderTextureCount;e++)this._maskColorBuffers.pushBack(this.gl.createTexture()),this.gl.bindTexture(this.gl.TEXTURE_2D,this._maskColorBuffers.at(e)),this.gl.texImage2D(this.gl.TEXTURE_2D,0,this.gl.RGBA,t,t,0,this.gl.RGBA,this.gl.UNSIGNED_BYTE,null),this.gl.texParameteri(this.gl.TEXTURE_2D,this.gl.TEXTURE_WRAP_S,this.gl.CLAMP_TO_EDGE),this.gl.texParameteri(this.gl.TEXTURE_2D,this.gl.TEXTURE_WRAP_T,this.gl.CLAMP_TO_EDGE),this.gl.texParameteri(this.gl.TEXTURE_2D,this.gl.TEXTURE_MIN_FILTER,this.gl.LINEAR),this.gl.texParameteri(this.gl.TEXTURE_2D,this.gl.TEXTURE_MAG_FILTER,this.gl.LINEAR),this.gl.bindTexture(this.gl.TEXTURE_2D,null),this._maskRenderTextures.pushBack(this.gl.createFramebuffer()),this.gl.bindFramebuffer(this.gl.FRAMEBUFFER,this._maskRenderTextures.at(e)),this.gl.framebufferTexture2D(this.gl.FRAMEBUFFER,this.gl.COLOR_ATTACHMENT0,this.gl.TEXTURE_2D,this._maskColorBuffers.at(e),0);this.gl.bindFramebuffer(this.gl.FRAMEBUFFER,_e),this._maskTexture=new zs(this._currentFrameNo,this._maskRenderTextures)}return this._maskTexture.textures}setGL(t){this.gl=t}calcClippedDrawTotalBounds(t,e){let i=Number.MAX_VALUE,r=Number.MAX_VALUE,a=Number.MIN_VALUE,o=Number.MIN_VALUE;const n=e._clippedDrawableIndexList.length;for(let l=0;l<n;l++){const u=e._clippedDrawableIndexList[l],h=t.getDrawableVertexCount(u),_=t.getDrawableVertices(u);let d=Number.MAX_VALUE,g=Number.MAX_VALUE,c=-Number.MAX_VALUE,y=-Number.MAX_VALUE;const p=h*ht.vertexStep;for(let S=ht.vertexOffset;S<p;S+=ht.vertexStep){const f=_[S],w=_[S+1];f<d&&(d=f),f>c&&(c=f),w<g&&(g=w),w>y&&(y=w)}if(d!=Number.MAX_VALUE)if(d<i&&(i=d),g<r&&(r=g),c>a&&(a=c),y>o&&(o=y),i==Number.MAX_VALUE)e._allClippedDrawRect.x=0,e._allClippedDrawRect.y=0,e._allClippedDrawRect.width=0,e._allClippedDrawRect.height=0,e._isUsing=!1;else{e._isUsing=!0;const S=a-i,f=o-r;e._allClippedDrawRect.x=i,e._allClippedDrawRect.y=r,e._allClippedDrawRect.width=S,e._allClippedDrawRect.height=f}}}constructor(){this._currentMaskRenderTexture=null,this._maskColorBuffers=null,this._currentFrameNo=0,this._renderTextureCount=0,this._clippingMaskBufferSize=256,this._clippingContextListForMask=new C,this._clippingContextListForDraw=new C,this._channelColors=new C,this._tmpBoundsOnModel=new de,this._tmpMatrix=new F,this._tmpMatrixForMask=new F,this._tmpMatrixForDraw=new F,this._maskTexture=null;let t=new z;t.R=1,t.G=0,t.B=0,t.A=0,this._channelColors.pushBack(t),t=new z,t.R=0,t.G=1,t.B=0,t.A=0,this._channelColors.pushBack(t),t=new z,t.R=0,t.G=0,t.B=1,t.A=0,this._channelColors.pushBack(t),t=new z,t.R=0,t.G=0,t.B=0,t.A=1,this._channelColors.pushBack(t)}release(){for(let t=0;t<this._clippingContextListForMask.getSize();t++)this._clippingContextListForMask.at(t)&&(this._clippingContextListForMask.at(t).release(),this._clippingContextListForMask.set(t,void 0)),this._clippingContextListForMask.set(t,null);this._clippingContextListForMask=null;for(let t=0;t<this._clippingContextListForDraw.getSize();t++)this._clippingContextListForDraw.set(t,null);if(this._clippingContextListForDraw=null,this._maskTexture){for(let t=0;t<this._maskTexture.textures.getSize();t++)this.gl.deleteFramebuffer(this._maskTexture.textures.at(t));this._maskTexture.textures.clear(),this._maskTexture.textures=null,this._maskTexture=null}for(let t=0;t<this._channelColors.getSize();t++)this._channelColors.set(t,null);if(this._channelColors=null,this._maskColorBuffers!=null){for(let t=0;t<this._maskColorBuffers.getSize();t++)this.gl.deleteTexture(this._maskColorBuffers.at(t));this._maskColorBuffers.clear()}this._maskColorBuffers=null,this._maskRenderTextures!=null&&this._maskRenderTextures.clear(),this._maskRenderTextures=null,this._clearedFrameBufferflags!=null&&this._clearedFrameBufferflags.clear(),this._clearedFrameBufferflags=null}initialize(t,e,i,r,a){a%1!=0&&(ut("The number of render textures must be specified as an integer. The decimal point is rounded down and corrected to an integer."),a=~~a),a<1&&ut("The number of render textures must be an integer greater than or equal to 1. Set the number of render textures to 1."),this._renderTextureCount=a<1?1:a,this._clearedFrameBufferflags=new C(this._renderTextureCount);for(let o=0;o<e;o++){if(r[o]<=0){this._clippingContextListForDraw.pushBack(null);continue}let n=this.findSameClip(i[o],r[o]);n==null&&(n=new Xs(this,i[o],r[o]),this._clippingContextListForMask.pushBack(n)),n.addClippedDrawable(o),this._clippingContextListForDraw.pushBack(n)}}setupClippingContext(t,e){this._currentFrameNo++;let i=0;for(let r=0;r<this._clippingContextListForMask.getSize();r++){const a=this._clippingContextListForMask.at(r);this.calcClippedDrawTotalBounds(t,a),a._isUsing&&i++}if(i>0){this.setupLayoutBounds(e.isUsingHighPrecisionMask()?0:i),e.isUsingHighPrecisionMask()||(this.gl.viewport(0,0,this._clippingMaskBufferSize,this._clippingMaskBufferSize),this._currentMaskRenderTexture=this.getMaskRenderTexture().at(0),e.preDraw(),this.gl.bindFramebuffer(this.gl.FRAMEBUFFER,this._currentMaskRenderTexture)),this._clearedFrameBufferflags.getSize()!=this._renderTextureCount&&(this._clearedFrameBufferflags.clear(),this._clearedFrameBufferflags=new C(this._renderTextureCount));for(let r=0;r<this._clearedFrameBufferflags.getSize();r++)this._clearedFrameBufferflags.set(r,!1);for(let r=0;r<this._clippingContextListForMask.getSize();r++){const a=this._clippingContextListForMask.at(r),o=a._allClippedDrawRect,n=a._layoutBounds,l=.05;let u=0,h=0;const _=this.getMaskRenderTexture().at(a._bufferIndex);if(this._currentMaskRenderTexture!=_&&!e.isUsingHighPrecisionMask()&&(this._currentMaskRenderTexture=_,e.preDraw(),this.gl.bindFramebuffer(this.gl.FRAMEBUFFER,this._currentMaskRenderTexture)),e.isUsingHighPrecisionMask()){const d=t.getPixelsPerUnit(),g=a.getClippingManager()._clippingMaskBufferSize,c=n.width*g,y=n.height*g;this._tmpBoundsOnModel.setRect(o),this._tmpBoundsOnModel.width*d>c?(this._tmpBoundsOnModel.expand(o.width*l,0),u=n.width/this._tmpBoundsOnModel.width):u=d/c,this._tmpBoundsOnModel.height*d>y?(this._tmpBoundsOnModel.expand(0,o.height*l),h=n.height/this._tmpBoundsOnModel.height):h=d/y}else this._tmpBoundsOnModel.setRect(o),this._tmpBoundsOnModel.expand(o.width*l,o.height*l),u=n.width/this._tmpBoundsOnModel.width,h=n.height/this._tmpBoundsOnModel.height;if(this._tmpMatrix.loadIdentity(),this._tmpMatrix.translateRelative(-1,-1),this._tmpMatrix.scaleRelative(2,2),this._tmpMatrix.translateRelative(n.x,n.y),this._tmpMatrix.scaleRelative(u,h),this._tmpMatrix.translateRelative(-this._tmpBoundsOnModel.x,-this._tmpBoundsOnModel.y),this._tmpMatrixForMask.setMatrix(this._tmpMatrix.getArray()),this._tmpMatrix.loadIdentity(),this._tmpMatrix.translateRelative(n.x,n.y),this._tmpMatrix.scaleRelative(u,h),this._tmpMatrix.translateRelative(-this._tmpBoundsOnModel.x,-this._tmpBoundsOnModel.y),this._tmpMatrixForDraw.setMatrix(this._tmpMatrix.getArray()),a._matrixForMask.setMatrix(this._tmpMatrixForMask.getArray()),a._matrixForDraw.setMatrix(this._tmpMatrixForDraw.getArray()),!e.isUsingHighPrecisionMask()){const d=a._clippingIdCount;for(let g=0;g<d;g++){const c=a._clippingIdList[g];t.getDrawableDynamicFlagVertexPositionsDidChange(c)&&(e.setIsCulling(t.getDrawableCulling(c)!=!1),this._clearedFrameBufferflags.at(a._bufferIndex)||(this.gl.clearColor(1,1,1,1),this.gl.clear(this.gl.COLOR_BUFFER_BIT),this._clearedFrameBufferflags.set(a._bufferIndex,!0)),e.setClippingContextBufferForMask(a),e.drawMesh(t.getDrawableTextureIndex(c),t.getDrawableVertexIndexCount(c),t.getDrawableVertexCount(c),t.getDrawableVertexIndices(c),t.getDrawableVertices(c),t.getDrawableVertexUvs(c),t.getMultiplyColor(c),t.getScreenColor(c),t.getDrawableOpacity(c),et.CubismBlendMode_Normal,!1))}}}e.isUsingHighPrecisionMask()||(this.gl.bindFramebuffer(this.gl.FRAMEBUFFER,_e),e.setClippingContextBufferForMask(null),this.gl.viewport(rt[0],rt[1],rt[2],rt[3]))}}findSameClip(t,e){for(let i=0;i<this._clippingContextListForMask.getSize();i++){const r=this._clippingContextListForMask.at(i),a=r._clippingIdCount;if(a!=e)continue;let o=0;for(let n=0;n<a;n++){const l=r._clippingIdList[n];for(let u=0;u<a;u++)if(t[u]==l){o++;break}}if(o==a)return r}return null}setupLayoutBounds(t){const e=this._renderTextureCount<=1?$a:qa*this._renderTextureCount;if(t<=0||t>e){t>e&&U(`not supported mask count : {0}
[Details] render texture count : {1}, mask count : {2}`,t-e,this._renderTextureCount,t);for(let u=0;u<this._clippingContextListForMask.getSize();u++){const h=this._clippingContextListForMask.at(u);h._layoutChannelNo=0,h._layoutBounds.x=0,h._layoutBounds.y=0,h._layoutBounds.width=1,h._layoutBounds.height=1,h._bufferIndex=0}return}const i=this._renderTextureCount<=1?9:8;let r=t/this._renderTextureCount,a=t%this._renderTextureCount;r=~~r,a=~~a;let o=r/ne,n=r%ne;o=~~o,n=~~n;let l=0;for(let u=0;u<this._renderTextureCount;u++)for(let h=0;h<ne;h++){let _=o+(h<n?1:0);const d=n+1>=ne?0:n+1;if(_<i&&h==d&&(_+=u<a?1:0),_!=0)if(_==1){const g=this._clippingContextListForMask.at(l++);g._layoutChannelNo=h,g._layoutBounds.x=0,g._layoutBounds.y=0,g._layoutBounds.width=1,g._layoutBounds.height=1,g._bufferIndex=u}else if(_==2)for(let g=0;g<_;g++){let c=g%2;c=~~c;const y=this._clippingContextListForMask.at(l++);y._layoutChannelNo=h,y._layoutBounds.x=c*.5,y._layoutBounds.y=0,y._layoutBounds.width=.5,y._layoutBounds.height=1,y._bufferIndex=u}else if(_<=4)for(let g=0;g<_;g++){let c=g%2,y=g/2;c=~~c,y=~~y;const p=this._clippingContextListForMask.at(l++);p._layoutChannelNo=h,p._layoutBounds.x=c*.5,p._layoutBounds.y=y*.5,p._layoutBounds.width=.5,p._layoutBounds.height=.5,p._bufferIndex=u}else if(_<=i)for(let g=0;g<_;g++){let c=g%3,y=g/3;c=~~c,y=~~y;const p=this._clippingContextListForMask.at(l++);p._layoutChannelNo=h,p._layoutBounds.x=c/3,p._layoutBounds.y=y/3,p._layoutBounds.width=1/3,p._layoutBounds.height=1/3,p._bufferIndex=u}else{U(`not supported mask count : {0}
[Details] render texture count : {1}, mask count : {2}`,t-e,this._renderTextureCount,t);for(let g=0;g<_;g++){const c=this._clippingContextListForMask.at(l++);c._layoutChannelNo=0,c._layoutBounds.x=0,c._layoutBounds.y=0,c._layoutBounds.width=1,c._layoutBounds.height=1,c._bufferIndex=0}}}}getColorBuffer(){return this._maskColorBuffers}getClippingContextListForDraw(){return this._clippingContextListForDraw}getClippingMaskCount(){return this._clippingContextListForMask.getSize()}setClippingMaskBufferSize(t){this._clippingMaskBufferSize=t}getClippingMaskBufferSize(){return this._clippingMaskBufferSize}getRenderTextureCount(){return this._renderTextureCount}}class zs{constructor(t,e){this.frameNo=t,this.textures=e}}class Xs{constructor(t,e,i){this._owner=t,this._clippingIdList=e,this._clippingIdCount=i,this._allClippedDrawRect=new de,this._layoutBounds=new de,this._clippedDrawableIndexList=[],this._matrixForMask=new F,this._matrixForDraw=new F,this._bufferIndex=0}release(){this._layoutBounds!=null&&(this._layoutBounds=null),this._allClippedDrawRect!=null&&(this._allClippedDrawRect=null),this._clippedDrawableIndexList!=null&&(this._clippedDrawableIndexList=null)}addClippedDrawable(t){this._clippedDrawableIndexList.push(t)}getClippingManager(){return this._owner}setGl(t){this._owner.setGL(t)}}class Ja{setGlEnable(t,e){e?this.gl.enable(t):this.gl.disable(t)}setGlEnableVertexAttribArray(t,e){e?this.gl.enableVertexAttribArray(t):this.gl.disableVertexAttribArray(t)}save(){if(this.gl==null){U(`'gl' is null. WebGLRenderingContext is required.
Please call 'CubimRenderer_WebGL.startUp' function.`);return}this._lastArrayBufferBinding=this.gl.getParameter(this.gl.ARRAY_BUFFER_BINDING),this._lastArrayBufferBinding=this.gl.getParameter(this.gl.ELEMENT_ARRAY_BUFFER_BINDING),this._lastProgram=this.gl.getParameter(this.gl.CURRENT_PROGRAM),this._lastActiveTexture=this.gl.getParameter(this.gl.ACTIVE_TEXTURE),this.gl.activeTexture(this.gl.TEXTURE1),this._lastTexture1Binding2D=this.gl.getParameter(this.gl.TEXTURE_BINDING_2D),this.gl.activeTexture(this.gl.TEXTURE0),this._lastTexture0Binding2D=this.gl.getParameter(this.gl.TEXTURE_BINDING_2D),this._lastVertexAttribArrayEnabled[0]=this.gl.getVertexAttrib(0,this.gl.VERTEX_ATTRIB_ARRAY_ENABLED),this._lastVertexAttribArrayEnabled[1]=this.gl.getVertexAttrib(1,this.gl.VERTEX_ATTRIB_ARRAY_ENABLED),this._lastVertexAttribArrayEnabled[2]=this.gl.getVertexAttrib(2,this.gl.VERTEX_ATTRIB_ARRAY_ENABLED),this._lastVertexAttribArrayEnabled[3]=this.gl.getVertexAttrib(3,this.gl.VERTEX_ATTRIB_ARRAY_ENABLED),this._lastScissorTest=this.gl.isEnabled(this.gl.SCISSOR_TEST),this._lastStencilTest=this.gl.isEnabled(this.gl.STENCIL_TEST),this._lastDepthTest=this.gl.isEnabled(this.gl.DEPTH_TEST),this._lastCullFace=this.gl.isEnabled(this.gl.CULL_FACE),this._lastBlend=this.gl.isEnabled(this.gl.BLEND),this._lastFrontFace=this.gl.getParameter(this.gl.FRONT_FACE),this._lastColorMask=this.gl.getParameter(this.gl.COLOR_WRITEMASK),this._lastBlending[0]=this.gl.getParameter(this.gl.BLEND_SRC_RGB),this._lastBlending[1]=this.gl.getParameter(this.gl.BLEND_DST_RGB),this._lastBlending[2]=this.gl.getParameter(this.gl.BLEND_SRC_ALPHA),this._lastBlending[3]=this.gl.getParameter(this.gl.BLEND_DST_ALPHA),this._lastFBO=this.gl.getParameter(this.gl.FRAMEBUFFER_BINDING),this._lastViewport=this.gl.getParameter(this.gl.VIEWPORT)}restore(){if(this.gl==null){U(`'gl' is null. WebGLRenderingContext is required.
Please call 'CubimRenderer_WebGL.startUp' function.`);return}this.gl.useProgram(this._lastProgram),this.setGlEnableVertexAttribArray(0,this._lastVertexAttribArrayEnabled[0]),this.setGlEnableVertexAttribArray(1,this._lastVertexAttribArrayEnabled[1]),this.setGlEnableVertexAttribArray(2,this._lastVertexAttribArrayEnabled[2]),this.setGlEnableVertexAttribArray(3,this._lastVertexAttribArrayEnabled[3]),this.setGlEnable(this.gl.SCISSOR_TEST,this._lastScissorTest),this.setGlEnable(this.gl.STENCIL_TEST,this._lastStencilTest),this.setGlEnable(this.gl.DEPTH_TEST,this._lastDepthTest),this.setGlEnable(this.gl.CULL_FACE,this._lastCullFace),this.setGlEnable(this.gl.BLEND,this._lastBlend),this.gl.frontFace(this._lastFrontFace),this.gl.colorMask(this._lastColorMask[0],this._lastColorMask[1],this._lastColorMask[2],this._lastColorMask[3]),this.gl.bindBuffer(this.gl.ARRAY_BUFFER,this._lastArrayBufferBinding),this.gl.bindBuffer(this.gl.ELEMENT_ARRAY_BUFFER,this._lastElementArrayBufferBinding),this.gl.activeTexture(this.gl.TEXTURE1),this.gl.bindTexture(this.gl.TEXTURE_2D,this._lastTexture1Binding2D),this.gl.activeTexture(this.gl.TEXTURE0),this.gl.bindTexture(this.gl.TEXTURE_2D,this._lastTexture0Binding2D),this.gl.activeTexture(this._lastActiveTexture),this.gl.blendFuncSeparate(this._lastBlending[0],this._lastBlending[1],this._lastBlending[2],this._lastBlending[3])}setGl(t){this.gl=t}constructor(){this._lastVertexAttribArrayEnabled=new Array(4),this._lastColorMask=new Array(4),this._lastBlending=new Array(4),this._lastViewport=new Array(4)}}class At{static getInstance(){return dt==null&&(dt=new At),dt}static deleteInstance(){dt&&(dt.release(),dt=null)}constructor(){this._shaderSets=new C}release(){this.releaseShaderProgram()}setupShaderProgram(t,e,i,r,a,o,n,l,u,h,_,d,g,c,y){g||U("NoPremultipliedAlpha is not allowed"),this._shaderSets.getSize()==0&&this.generateShaders();let p,S,f,w;if(t.getClippingContextBufferForMask()!=null){const M=this._shaderSets.at(0);this.gl.useProgram(M.shaderProgram),this.gl.activeTexture(this.gl.TEXTURE0),this.gl.bindTexture(this.gl.TEXTURE_2D,e),this.gl.uniform1i(M.samplerTexture0Location,0),n.vertex==null&&(n.vertex=this.gl.createBuffer()),this.gl.bindBuffer(this.gl.ARRAY_BUFFER,n.vertex),this.gl.bufferData(this.gl.ARRAY_BUFFER,r,this.gl.DYNAMIC_DRAW),this.gl.enableVertexAttribArray(M.attributePositionLocation),this.gl.vertexAttribPointer(M.attributePositionLocation,2,this.gl.FLOAT,!1,0,0),n.uv==null&&(n.uv=this.gl.createBuffer()),this.gl.bindBuffer(this.gl.ARRAY_BUFFER,n.uv),this.gl.bufferData(this.gl.ARRAY_BUFFER,o,this.gl.DYNAMIC_DRAW),this.gl.enableVertexAttribArray(M.attributeTexCoordLocation),this.gl.vertexAttribPointer(M.attributeTexCoordLocation,2,this.gl.FLOAT,!1,0,0);const v=t.getClippingContextBufferForMask()._layoutChannelNo,x=t.getClippingContextBufferForMask().getClippingManager().getChannelFlagAsColor(v);this.gl.uniform4f(M.uniformChannelFlagLocation,x.R,x.G,x.B,x.A),this.gl.uniformMatrix4fv(M.uniformClipMatrixLocation,!1,t.getClippingContextBufferForMask()._matrixForMask.getArray());const E=t.getClippingContextBufferForMask()._layoutBounds;this.gl.uniform4f(M.uniformBaseColorLocation,E.x*2-1,E.y*2-1,E.getRight()*2-1,E.getBottom()*2-1),this.gl.uniform4f(M.uniformMultiplyColorLocation,_.R,_.G,_.B,_.A),this.gl.uniform4f(M.uniformScreenColorLocation,d.R,d.G,d.B,d.A),p=this.gl.ZERO,S=this.gl.ONE_MINUS_SRC_COLOR,f=this.gl.ZERO,w=this.gl.ONE_MINUS_SRC_ALPHA}else{const M=t.getClippingContextBufferForDraw()!=null,v=M?y?2:1:0;let x=new Le;switch(u){case et.CubismBlendMode_Normal:default:x=this._shaderSets.at(1+v),p=this.gl.ONE,S=this.gl.ONE_MINUS_SRC_ALPHA,f=this.gl.ONE,w=this.gl.ONE_MINUS_SRC_ALPHA;break;case et.CubismBlendMode_Additive:x=this._shaderSets.at(4+v),p=this.gl.ONE,S=this.gl.ONE,f=this.gl.ZERO,w=this.gl.ONE;break;case et.CubismBlendMode_Multiplicative:x=this._shaderSets.at(7+v),p=this.gl.DST_COLOR,S=this.gl.ONE_MINUS_SRC_ALPHA,f=this.gl.ZERO,w=this.gl.ONE;break}if(this.gl.useProgram(x.shaderProgram),n.vertex==null&&(n.vertex=this.gl.createBuffer()),this.gl.bindBuffer(this.gl.ARRAY_BUFFER,n.vertex),this.gl.bufferData(this.gl.ARRAY_BUFFER,r,this.gl.DYNAMIC_DRAW),this.gl.enableVertexAttribArray(x.attributePositionLocation),this.gl.vertexAttribPointer(x.attributePositionLocation,2,this.gl.FLOAT,!1,0,0),n.uv==null&&(n.uv=this.gl.createBuffer()),this.gl.bindBuffer(this.gl.ARRAY_BUFFER,n.uv),this.gl.bufferData(this.gl.ARRAY_BUFFER,o,this.gl.DYNAMIC_DRAW),this.gl.enableVertexAttribArray(x.attributeTexCoordLocation),this.gl.vertexAttribPointer(x.attributeTexCoordLocation,2,this.gl.FLOAT,!1,0,0),M){this.gl.activeTexture(this.gl.TEXTURE1);const E=t.getClippingContextBufferForDraw().getClippingManager().getColorBuffer().at(t.getClippingContextBufferForDraw()._bufferIndex);this.gl.bindTexture(this.gl.TEXTURE_2D,E),this.gl.uniform1i(x.samplerTexture1Location,1),this.gl.uniformMatrix4fv(x.uniformClipMatrixLocation,!1,t.getClippingContextBufferForDraw()._matrixForDraw.getArray());const j=t.getClippingContextBufferForDraw()._layoutChannelNo,$=t.getClippingContextBufferForDraw().getClippingManager().getChannelFlagAsColor(j);this.gl.uniform4f(x.uniformChannelFlagLocation,$.R,$.G,$.B,$.A)}this.gl.activeTexture(this.gl.TEXTURE0),this.gl.bindTexture(this.gl.TEXTURE_2D,e),this.gl.uniform1i(x.samplerTexture0Location,0),this.gl.uniformMatrix4fv(x.uniformMatrixLocation,!1,c.getArray()),this.gl.uniform4f(x.uniformBaseColorLocation,h.R,h.G,h.B,h.A),this.gl.uniform4f(x.uniformMultiplyColorLocation,_.R,_.G,_.B,_.A),this.gl.uniform4f(x.uniformScreenColorLocation,d.R,d.G,d.B,d.A)}n.index==null&&(n.index=this.gl.createBuffer()),this.gl.bindBuffer(this.gl.ELEMENT_ARRAY_BUFFER,n.index),this.gl.bufferData(this.gl.ELEMENT_ARRAY_BUFFER,a,this.gl.DYNAMIC_DRAW),this.gl.blendFuncSeparate(p,S,f,w)}releaseShaderProgram(){for(let t=0;t<this._shaderSets.getSize();t++)this.gl.deleteProgram(this._shaderSets.at(t).shaderProgram),this._shaderSets.at(t).shaderProgram=0,this._shaderSets.set(t,void 0),this._shaderSets.set(t,null)}generateShaders(){for(let t=0;t<Wa;t++)this._shaderSets.pushBack(new Le);this._shaderSets.at(0).shaderProgram=this.loadShaderProgram(Ka,Za),this._shaderSets.at(1).shaderProgram=this.loadShaderProgram(Qa,tn),this._shaderSets.at(2).shaderProgram=this.loadShaderProgram(es,en),this._shaderSets.at(3).shaderProgram=this.loadShaderProgram(es,sn),this._shaderSets.at(4).shaderProgram=this._shaderSets.at(1).shaderProgram,this._shaderSets.at(5).shaderProgram=this._shaderSets.at(2).shaderProgram,this._shaderSets.at(6).shaderProgram=this._shaderSets.at(3).shaderProgram,this._shaderSets.at(7).shaderProgram=this._shaderSets.at(1).shaderProgram,this._shaderSets.at(8).shaderProgram=this._shaderSets.at(2).shaderProgram,this._shaderSets.at(9).shaderProgram=this._shaderSets.at(3).shaderProgram,this._shaderSets.at(0).attributePositionLocation=this.gl.getAttribLocation(this._shaderSets.at(0).shaderProgram,"a_position"),this._shaderSets.at(0).attributeTexCoordLocation=this.gl.getAttribLocation(this._shaderSets.at(0).shaderProgram,"a_texCoord"),this._shaderSets.at(0).samplerTexture0Location=this.gl.getUniformLocation(this._shaderSets.at(0).shaderProgram,"s_texture0"),this._shaderSets.at(0).uniformClipMatrixLocation=this.gl.getUniformLocation(this._shaderSets.at(0).shaderProgram,"u_clipMatrix"),this._shaderSets.at(0).uniformChannelFlagLocation=this.gl.getUniformLocation(this._shaderSets.at(0).shaderProgram,"u_channelFlag"),this._shaderSets.at(0).uniformBaseColorLocation=this.gl.getUniformLocation(this._shaderSets.at(0).shaderProgram,"u_baseColor"),this._shaderSets.at(0).uniformMultiplyColorLocation=this.gl.getUniformLocation(this._shaderSets.at(0).shaderProgram,"u_multiplyColor"),this._shaderSets.at(0).uniformScreenColorLocation=this.gl.getUniformLocation(this._shaderSets.at(0).shaderProgram,"u_screenColor"),this._shaderSets.at(1).attributePositionLocation=this.gl.getAttribLocation(this._shaderSets.at(1).shaderProgram,"a_position"),this._shaderSets.at(1).attributeTexCoordLocation=this.gl.getAttribLocation(this._shaderSets.at(1).shaderProgram,"a_texCoord"),this._shaderSets.at(1).samplerTexture0Location=this.gl.getUniformLocation(this._shaderSets.at(1).shaderProgram,"s_texture0"),this._shaderSets.at(1).uniformMatrixLocation=this.gl.getUniformLocation(this._shaderSets.at(1).shaderProgram,"u_matrix"),this._shaderSets.at(1).uniformBaseColorLocation=this.gl.getUniformLocation(this._shaderSets.at(1).shaderProgram,"u_baseColor"),this._shaderSets.at(1).uniformMultiplyColorLocation=this.gl.getUniformLocation(this._shaderSets.at(1).shaderProgram,"u_multiplyColor"),this._shaderSets.at(1).uniformScreenColorLocation=this.gl.getUniformLocation(this._shaderSets.at(1).shaderProgram,"u_screenColor"),this._shaderSets.at(2).attributePositionLocation=this.gl.getAttribLocation(this._shaderSets.at(2).shaderProgram,"a_position"),this._shaderSets.at(2).attributeTexCoordLocation=this.gl.getAttribLocation(this._shaderSets.at(2).shaderProgram,"a_texCoord"),this._shaderSets.at(2).samplerTexture0Location=this.gl.getUniformLocation(this._shaderSets.at(2).shaderProgram,"s_texture0"),this._shaderSets.at(2).samplerTexture1Location=this.gl.getUniformLocation(this._shaderSets.at(2).shaderProgram,"s_texture1"),this._shaderSets.at(2).uniformMatrixLocation=this.gl.getUniformLocation(this._shaderSets.at(2).shaderProgram,"u_matrix"),this._shaderSets.at(2).uniformClipMatrixLocation=this.gl.getUniformLocation(this._shaderSets.at(2).shaderProgram,"u_clipMatrix"),this._shaderSets.at(2).uniformChannelFlagLocation=this.gl.getUniformLocation(this._shaderSets.at(2).shaderProgram,"u_channelFlag"),this._shaderSets.at(2).uniformBaseColorLocation=this.gl.getUniformLocation(this._shaderSets.at(2).shaderProgram,"u_baseColor"),this._shaderSets.at(2).uniformMultiplyColorLocation=this.gl.getUniformLocation(this._shaderSets.at(2).shaderProgram,"u_multiplyColor"),this._shaderSets.at(2).uniformScreenColorLocation=this.gl.getUniformLocation(this._shaderSets.at(2).shaderProgram,"u_screenColor"),this._shaderSets.at(3).attributePositionLocation=this.gl.getAttribLocation(this._shaderSets.at(3).shaderProgram,"a_position"),this._shaderSets.at(3).attributeTexCoordLocation=this.gl.getAttribLocation(this._shaderSets.at(3).shaderProgram,"a_texCoord"),this._shaderSets.at(3).samplerTexture0Location=this.gl.getUniformLocation(this._shaderSets.at(3).shaderProgram,"s_texture0"),this._shaderSets.at(3).samplerTexture1Location=this.gl.getUniformLocation(this._shaderSets.at(3).shaderProgram,"s_texture1"),this._shaderSets.at(3).uniformMatrixLocation=this.gl.getUniformLocation(this._shaderSets.at(3).shaderProgram,"u_matrix"),this._shaderSets.at(3).uniformClipMatrixLocation=this.gl.getUniformLocation(this._shaderSets.at(3).shaderProgram,"u_clipMatrix"),this._shaderSets.at(3).uniformChannelFlagLocation=this.gl.getUniformLocation(this._shaderSets.at(3).shaderProgram,"u_channelFlag"),this._shaderSets.at(3).uniformBaseColorLocation=this.gl.getUniformLocation(this._shaderSets.at(3).shaderProgram,"u_baseColor"),this._shaderSets.at(3).uniformMultiplyColorLocation=this.gl.getUniformLocation(this._shaderSets.at(3).shaderProgram,"u_multiplyColor"),this._shaderSets.at(3).uniformScreenColorLocation=this.gl.getUniformLocation(this._shaderSets.at(3).shaderProgram,"u_screenColor"),this._shaderSets.at(4).attributePositionLocation=this.gl.getAttribLocation(this._shaderSets.at(4).shaderProgram,"a_position"),this._shaderSets.at(4).attributeTexCoordLocation=this.gl.getAttribLocation(this._shaderSets.at(4).shaderProgram,"a_texCoord"),this._shaderSets.at(4).samplerTexture0Location=this.gl.getUniformLocation(this._shaderSets.at(4).shaderProgram,"s_texture0"),this._shaderSets.at(4).uniformMatrixLocation=this.gl.getUniformLocation(this._shaderSets.at(4).shaderProgram,"u_matrix"),this._shaderSets.at(4).uniformBaseColorLocation=this.gl.getUniformLocation(this._shaderSets.at(4).shaderProgram,"u_baseColor"),this._shaderSets.at(4).uniformMultiplyColorLocation=this.gl.getUniformLocation(this._shaderSets.at(4).shaderProgram,"u_multiplyColor"),this._shaderSets.at(4).uniformScreenColorLocation=this.gl.getUniformLocation(this._shaderSets.at(4).shaderProgram,"u_screenColor"),this._shaderSets.at(5).attributePositionLocation=this.gl.getAttribLocation(this._shaderSets.at(5).shaderProgram,"a_position"),this._shaderSets.at(5).attributeTexCoordLocation=this.gl.getAttribLocation(this._shaderSets.at(5).shaderProgram,"a_texCoord"),this._shaderSets.at(5).samplerTexture0Location=this.gl.getUniformLocation(this._shaderSets.at(5).shaderProgram,"s_texture0"),this._shaderSets.at(5).samplerTexture1Location=this.gl.getUniformLocation(this._shaderSets.at(5).shaderProgram,"s_texture1"),this._shaderSets.at(5).uniformMatrixLocation=this.gl.getUniformLocation(this._shaderSets.at(5).shaderProgram,"u_matrix"),this._shaderSets.at(5).uniformClipMatrixLocation=this.gl.getUniformLocation(this._shaderSets.at(5).shaderProgram,"u_clipMatrix"),this._shaderSets.at(5).uniformChannelFlagLocation=this.gl.getUniformLocation(this._shaderSets.at(5).shaderProgram,"u_channelFlag"),this._shaderSets.at(5).uniformBaseColorLocation=this.gl.getUniformLocation(this._shaderSets.at(5).shaderProgram,"u_baseColor"),this._shaderSets.at(5).uniformMultiplyColorLocation=this.gl.getUniformLocation(this._shaderSets.at(5).shaderProgram,"u_multiplyColor"),this._shaderSets.at(5).uniformScreenColorLocation=this.gl.getUniformLocation(this._shaderSets.at(5).shaderProgram,"u_screenColor"),this._shaderSets.at(6).attributePositionLocation=this.gl.getAttribLocation(this._shaderSets.at(6).shaderProgram,"a_position"),this._shaderSets.at(6).attributeTexCoordLocation=this.gl.getAttribLocation(this._shaderSets.at(6).shaderProgram,"a_texCoord"),this._shaderSets.at(6).samplerTexture0Location=this.gl.getUniformLocation(this._shaderSets.at(6).shaderProgram,"s_texture0"),this._shaderSets.at(6).samplerTexture1Location=this.gl.getUniformLocation(this._shaderSets.at(6).shaderProgram,"s_texture1"),this._shaderSets.at(6).uniformMatrixLocation=this.gl.getUniformLocation(this._shaderSets.at(6).shaderProgram,"u_matrix"),this._shaderSets.at(6).uniformClipMatrixLocation=this.gl.getUniformLocation(this._shaderSets.at(6).shaderProgram,"u_clipMatrix"),this._shaderSets.at(6).uniformChannelFlagLocation=this.gl.getUniformLocation(this._shaderSets.at(6).shaderProgram,"u_channelFlag"),this._shaderSets.at(6).uniformBaseColorLocation=this.gl.getUniformLocation(this._shaderSets.at(6).shaderProgram,"u_baseColor"),this._shaderSets.at(6).uniformMultiplyColorLocation=this.gl.getUniformLocation(this._shaderSets.at(6).shaderProgram,"u_multiplyColor"),this._shaderSets.at(6).uniformScreenColorLocation=this.gl.getUniformLocation(this._shaderSets.at(6).shaderProgram,"u_screenColor"),this._shaderSets.at(7).attributePositionLocation=this.gl.getAttribLocation(this._shaderSets.at(7).shaderProgram,"a_position"),this._shaderSets.at(7).attributeTexCoordLocation=this.gl.getAttribLocation(this._shaderSets.at(7).shaderProgram,"a_texCoord"),this._shaderSets.at(7).samplerTexture0Location=this.gl.getUniformLocation(this._shaderSets.at(7).shaderProgram,"s_texture0"),this._shaderSets.at(7).uniformMatrixLocation=this.gl.getUniformLocation(this._shaderSets.at(7).shaderProgram,"u_matrix"),this._shaderSets.at(7).uniformBaseColorLocation=this.gl.getUniformLocation(this._shaderSets.at(7).shaderProgram,"u_baseColor"),this._shaderSets.at(7).uniformMultiplyColorLocation=this.gl.getUniformLocation(this._shaderSets.at(7).shaderProgram,"u_multiplyColor"),this._shaderSets.at(7).uniformScreenColorLocation=this.gl.getUniformLocation(this._shaderSets.at(7).shaderProgram,"u_screenColor"),this._shaderSets.at(8).attributePositionLocation=this.gl.getAttribLocation(this._shaderSets.at(8).shaderProgram,"a_position"),this._shaderSets.at(8).attributeTexCoordLocation=this.gl.getAttribLocation(this._shaderSets.at(8).shaderProgram,"a_texCoord"),this._shaderSets.at(8).samplerTexture0Location=this.gl.getUniformLocation(this._shaderSets.at(8).shaderProgram,"s_texture0"),this._shaderSets.at(8).samplerTexture1Location=this.gl.getUniformLocation(this._shaderSets.at(8).shaderProgram,"s_texture1"),this._shaderSets.at(8).uniformMatrixLocation=this.gl.getUniformLocation(this._shaderSets.at(8).shaderProgram,"u_matrix"),this._shaderSets.at(8).uniformClipMatrixLocation=this.gl.getUniformLocation(this._shaderSets.at(8).shaderProgram,"u_clipMatrix"),this._shaderSets.at(8).uniformChannelFlagLocation=this.gl.getUniformLocation(this._shaderSets.at(8).shaderProgram,"u_channelFlag"),this._shaderSets.at(8).uniformBaseColorLocation=this.gl.getUniformLocation(this._shaderSets.at(8).shaderProgram,"u_baseColor"),this._shaderSets.at(8).uniformMultiplyColorLocation=this.gl.getUniformLocation(this._shaderSets.at(8).shaderProgram,"u_multiplyColor"),this._shaderSets.at(8).uniformScreenColorLocation=this.gl.getUniformLocation(this._shaderSets.at(8).shaderProgram,"u_screenColor"),this._shaderSets.at(9).attributePositionLocation=this.gl.getAttribLocation(this._shaderSets.at(9).shaderProgram,"a_position"),this._shaderSets.at(9).attributeTexCoordLocation=this.gl.getAttribLocation(this._shaderSets.at(9).shaderProgram,"a_texCoord"),this._shaderSets.at(9).samplerTexture0Location=this.gl.getUniformLocation(this._shaderSets.at(9).shaderProgram,"s_texture0"),this._shaderSets.at(9).samplerTexture1Location=this.gl.getUniformLocation(this._shaderSets.at(9).shaderProgram,"s_texture1"),this._shaderSets.at(9).uniformMatrixLocation=this.gl.getUniformLocation(this._shaderSets.at(9).shaderProgram,"u_matrix"),this._shaderSets.at(9).uniformClipMatrixLocation=this.gl.getUniformLocation(this._shaderSets.at(9).shaderProgram,"u_clipMatrix"),this._shaderSets.at(9).uniformChannelFlagLocation=this.gl.getUniformLocation(this._shaderSets.at(9).shaderProgram,"u_channelFlag"),this._shaderSets.at(9).uniformBaseColorLocation=this.gl.getUniformLocation(this._shaderSets.at(9).shaderProgram,"u_baseColor"),this._shaderSets.at(9).uniformMultiplyColorLocation=this.gl.getUniformLocation(this._shaderSets.at(9).shaderProgram,"u_multiplyColor"),this._shaderSets.at(9).uniformScreenColorLocation=this.gl.getUniformLocation(this._shaderSets.at(9).shaderProgram,"u_screenColor")}loadShaderProgram(t,e){let i=this.gl.createProgram(),r=this.compileShaderSource(this.gl.VERTEX_SHADER,t);if(!r)return U("Vertex shader compile error!"),0;let a=this.compileShaderSource(this.gl.FRAGMENT_SHADER,e);return a?(this.gl.attachShader(i,r),this.gl.attachShader(i,a),this.gl.linkProgram(i),this.gl.getProgramParameter(i,this.gl.LINK_STATUS)?(this.gl.deleteShader(r),this.gl.deleteShader(a),i):(U("Failed to link program: {0}",i),this.gl.deleteShader(r),r=0,this.gl.deleteShader(a),a=0,i&&(this.gl.deleteProgram(i),i=0),0)):(U("Vertex shader compile error!"),0)}compileShaderSource(t,e){const i=e,r=this.gl.createShader(t);if(this.gl.shaderSource(r,i),this.gl.compileShader(r),!r){const o=this.gl.getShaderInfoLog(r);U("Shader compile log: {0} ",o)}return this.gl.getShaderParameter(r,this.gl.COMPILE_STATUS)?r:(this.gl.deleteShader(r),null)}setGl(t){this.gl=t}}class Le{}var Ys=(s=>(s[s.ShaderNames_SetupMask=0]="ShaderNames_SetupMask",s[s.ShaderNames_NormalPremultipliedAlpha=1]="ShaderNames_NormalPremultipliedAlpha",s[s.ShaderNames_NormalMaskedPremultipliedAlpha=2]="ShaderNames_NormalMaskedPremultipliedAlpha",s[s.ShaderNames_NomralMaskedInvertedPremultipliedAlpha=3]="ShaderNames_NomralMaskedInvertedPremultipliedAlpha",s[s.ShaderNames_AddPremultipliedAlpha=4]="ShaderNames_AddPremultipliedAlpha",s[s.ShaderNames_AddMaskedPremultipliedAlpha=5]="ShaderNames_AddMaskedPremultipliedAlpha",s[s.ShaderNames_AddMaskedPremultipliedAlphaInverted=6]="ShaderNames_AddMaskedPremultipliedAlphaInverted",s[s.ShaderNames_MultPremultipliedAlpha=7]="ShaderNames_MultPremultipliedAlpha",s[s.ShaderNames_MultMaskedPremultipliedAlpha=8]="ShaderNames_MultMaskedPremultipliedAlpha",s[s.ShaderNames_MultMaskedPremultipliedAlphaInverted=9]="ShaderNames_MultMaskedPremultipliedAlphaInverted",s))(Ys||{});const Ka="attribute vec4     a_position;attribute vec2     a_texCoord;varying vec2       v_texCoord;varying vec4       v_myPos;uniform mat4       u_clipMatrix;void main(){   gl_Position = u_clipMatrix * a_position;   v_myPos = u_clipMatrix * a_position;   v_texCoord = a_texCoord;   v_texCoord.y = 1.0 - v_texCoord.y;}",Za="precision mediump float;varying vec2       v_texCoord;varying vec4       v_myPos;uniform vec4       u_baseColor;uniform vec4       u_channelFlag;uniform sampler2D  s_texture0;void main(){   float isInside =        step(u_baseColor.x, v_myPos.x/v_myPos.w)       * step(u_baseColor.y, v_myPos.y/v_myPos.w)       * step(v_myPos.x/v_myPos.w, u_baseColor.z)       * step(v_myPos.y/v_myPos.w, u_baseColor.w);   gl_FragColor = u_channelFlag * texture2D(s_texture0, v_texCoord).a * isInside;}",Qa="attribute vec4     a_position;attribute vec2     a_texCoord;varying vec2       v_texCoord;uniform mat4       u_matrix;void main(){   gl_Position = u_matrix * a_position;   v_texCoord = a_texCoord;   v_texCoord.y = 1.0 - v_texCoord.y;}",es="attribute vec4     a_position;attribute vec2     a_texCoord;varying vec2       v_texCoord;varying vec4       v_clipPos;uniform mat4       u_matrix;uniform mat4       u_clipMatrix;void main(){   gl_Position = u_matrix * a_position;   v_clipPos = u_clipMatrix * a_position;   v_texCoord = a_texCoord;   v_texCoord.y = 1.0 - v_texCoord.y;}",tn="precision mediump float;varying vec2       v_texCoord;uniform vec4       u_baseColor;uniform sampler2D  s_texture0;uniform vec4       u_multiplyColor;uniform vec4       u_screenColor;void main(){   vec4 texColor = texture2D(s_texture0, v_texCoord);   texColor.rgb = texColor.rgb * u_multiplyColor.rgb;   texColor.rgb = (texColor.rgb + u_screenColor.rgb * texColor.a) - (texColor.rgb * u_screenColor.rgb);   vec4 color = texColor * u_baseColor;   gl_FragColor = vec4(color.rgb, color.a);}",en="precision mediump float;varying vec2       v_texCoord;varying vec4       v_clipPos;uniform vec4       u_baseColor;uniform vec4       u_channelFlag;uniform sampler2D  s_texture0;uniform sampler2D  s_texture1;uniform vec4       u_multiplyColor;uniform vec4       u_screenColor;void main(){   vec4 texColor = texture2D(s_texture0, v_texCoord);   texColor.rgb = texColor.rgb * u_multiplyColor.rgb;   texColor.rgb = (texColor.rgb + u_screenColor.rgb * texColor.a) - (texColor.rgb * u_screenColor.rgb);   vec4 col_formask = texColor * u_baseColor;   vec4 clipMask = (1.0 - texture2D(s_texture1, v_clipPos.xy / v_clipPos.w)) * u_channelFlag;   float maskVal = clipMask.r + clipMask.g + clipMask.b + clipMask.a;   col_formask = col_formask * maskVal;   gl_FragColor = col_formask;}",sn="precision mediump float;varying vec2      v_texCoord;varying vec4      v_clipPos;uniform sampler2D s_texture0;uniform sampler2D s_texture1;uniform vec4      u_channelFlag;uniform vec4      u_baseColor;uniform vec4      u_multiplyColor;uniform vec4      u_screenColor;void main(){   vec4 texColor = texture2D(s_texture0, v_texCoord);   texColor.rgb = texColor.rgb * u_multiplyColor.rgb;   texColor.rgb = (texColor.rgb + u_screenColor.rgb * texColor.a) - (texColor.rgb * u_screenColor.rgb);   vec4 col_formask = texColor * u_baseColor;   vec4 clipMask = (1.0 - texture2D(s_texture1, v_clipPos.xy / v_clipPos.w)) * u_channelFlag;   float maskVal = clipMask.r + clipMask.g + clipMask.b + clipMask.a;   col_formask = col_formask * (1.0 - maskVal);   gl_FragColor = col_formask;}";class je extends me{constructor(){super(),this._clippingContextBufferForMask=null,this._clippingContextBufferForDraw=null,this._rendererProfile=new Ja,this.firstDraw=!0,this._textures=new Y,this._sortedDrawableIndexList=new C,this._bufferData={vertex:WebGLBuffer=null,uv:WebGLBuffer=null,index:WebGLBuffer=null},this._textures.prepareCapacity(32,!0)}initialize(t,e=1){t.isUsingMasking()&&(this._clippingManager=new De,this._clippingManager.initialize(t,t.getDrawableCount(),t.getDrawableMasks(),t.getDrawableMaskCounts(),e)),this._sortedDrawableIndexList.resize(t.getDrawableCount(),0),super.initialize(t)}bindTexture(t,e){this._textures.setValue(t,e)}getBindedTextures(){return this._textures}setClippingMaskBufferSize(t){if(!this._model.isUsingMasking())return;const e=this._clippingManager.getRenderTextureCount();this._clippingManager.release(),this._clippingManager=void 0,this._clippingManager=null,this._clippingManager=new De,this._clippingManager.setClippingMaskBufferSize(t),this._clippingManager.initialize(this.getModel(),this.getModel().getDrawableCount(),this.getModel().getDrawableMasks(),this.getModel().getDrawableMaskCounts(),e)}getClippingMaskBufferSize(){return this._model.isUsingMasking()?this._clippingManager.getClippingMaskBufferSize():-1}getRenderTextureCount(){return this._model.isUsingMasking()?this._clippingManager.getRenderTextureCount():-1}release(){this._clippingManager&&(this._clippingManager.release(),this._clippingManager=void 0,this._clippingManager=null),this.gl!=null&&(this.gl.deleteBuffer(this._bufferData.vertex),this._bufferData.vertex=null,this.gl.deleteBuffer(this._bufferData.uv),this._bufferData.uv=null,this.gl.deleteBuffer(this._bufferData.index),this._bufferData.index=null,this._bufferData=null,this._textures=null)}doDrawModel(){if(this.gl==null){U(`'gl' is null. WebGLRenderingContext is required.
Please call 'CubimRenderer_WebGL.startUp' function.`);return}this._clippingManager!=null&&(this.preDraw(),this._clippingManager.setupClippingContext(this.getModel(),this)),this.preDraw();const t=this.getModel().getDrawableCount(),e=this.getModel().getDrawableRenderOrders();for(let i=0;i<t;++i){const r=e[i];this._sortedDrawableIndexList.set(r,i)}for(let i=0;i<t;++i){const r=this._sortedDrawableIndexList.at(i);if(!this.getModel().getDrawableDynamicFlagIsVisible(r))continue;const a=this._clippingManager!=null?this._clippingManager.getClippingContextListForDraw().at(r):null;if(a!=null&&this.isUsingHighPrecisionMask()){a._isUsing&&(this.gl.viewport(0,0,this._clippingManager.getClippingMaskBufferSize(),this._clippingManager.getClippingMaskBufferSize()),this.preDraw(),this.gl.bindFramebuffer(this.gl.FRAMEBUFFER,a.getClippingManager().getMaskRenderTexture().at(a._bufferIndex)),this.gl.clearColor(1,1,1,1),this.gl.clear(this.gl.COLOR_BUFFER_BIT));{const o=a._clippingIdCount;for(let n=0;n<o;n++){const l=a._clippingIdList[n];this._model.getDrawableDynamicFlagVertexPositionsDidChange(l)&&(this.setIsCulling(this._model.getDrawableCulling(l)!=!1),this.setClippingContextBufferForMask(a),this.drawMesh(this.getModel().getDrawableTextureIndex(l),this.getModel().getDrawableVertexIndexCount(l),this.getModel().getDrawableVertexCount(l),this.getModel().getDrawableVertexIndices(l),this.getModel().getDrawableVertices(l),this.getModel().getDrawableVertexUvs(l),this.getModel().getMultiplyColor(l),this.getModel().getScreenColor(l),this.getModel().getDrawableOpacity(l),et.CubismBlendMode_Normal,!1))}}this.gl.bindFramebuffer(this.gl.FRAMEBUFFER,_e),this.setClippingContextBufferForMask(null),this.gl.viewport(rt[0],rt[1],rt[2],rt[3]),this.preDraw()}this.setClippingContextBufferForDraw(a),this.setIsCulling(this.getModel().getDrawableCulling(r)),this.drawMesh(this.getModel().getDrawableTextureIndex(r),this.getModel().getDrawableVertexIndexCount(r),this.getModel().getDrawableVertexCount(r),this.getModel().getDrawableVertexIndices(r),this.getModel().getDrawableVertices(r),this.getModel().getDrawableVertexUvs(r),this.getModel().getMultiplyColor(r),this.getModel().getScreenColor(r),this.getModel().getDrawableOpacity(r),this.getModel().getDrawableBlendMode(r),this.getModel().getDrawableInvertedMaskBit(r))}}drawMesh(t,e,i,r,a,o,n,l,u,h,_){this.isCulling()?this.gl.enable(this.gl.CULL_FACE):this.gl.disable(this.gl.CULL_FACE),this.gl.frontFace(this.gl.CCW);const d=this.getModelColor();this.getClippingContextBufferForMask()==null&&(d.A*=u,this.isPremultipliedAlpha()&&(d.R*=d.A,d.G*=d.A,d.B*=d.A));let g;this._textures.getValue(t)!=null?g=this._textures.getValue(t):g=null,At.getInstance().setupShaderProgram(this,g,i,a,r,o,this._bufferData,u,h,d,n,l,this.isPremultipliedAlpha(),this.getMvpMatrix(),_),this.gl.drawElements(this.gl.TRIANGLES,e,this.gl.UNSIGNED_SHORT,0),this.gl.useProgram(null),this.setClippingContextBufferForDraw(null),this.setClippingContextBufferForMask(null)}saveProfile(){this._rendererProfile.save()}restoreProfile(){this._rendererProfile.restore()}static doStaticRelease(){At.deleteInstance()}setRenderState(t,e){_e=t,rt=e}preDraw(){if(this.firstDraw&&(this.firstDraw=!1),this.gl.disable(this.gl.SCISSOR_TEST),this.gl.disable(this.gl.STENCIL_TEST),this.gl.disable(this.gl.DEPTH_TEST),this.gl.frontFace(this.gl.CW),this.gl.enable(this.gl.BLEND),this.gl.colorMask(!0,!0,!0,!0),this.gl.bindBuffer(this.gl.ARRAY_BUFFER,null),this.gl.bindBuffer(this.gl.ELEMENT_ARRAY_BUFFER,null),this.getAnisotropy()>0&&this._extension)for(let t=0;t<this._textures.getSize();++t)this.gl.bindTexture(this.gl.TEXTURE_2D,this._textures.getValue(t)),this.gl.texParameterf(this.gl.TEXTURE_2D,this._extension.TEXTURE_MAX_ANISOTROPY_EXT,this.getAnisotropy())}setClippingContextBufferForMask(t){this._clippingContextBufferForMask=t}getClippingContextBufferForMask(){return this._clippingContextBufferForMask}setClippingContextBufferForDraw(t){this._clippingContextBufferForDraw=t}getClippingContextBufferForDraw(){return this._clippingContextBufferForDraw}startUp(t){this.gl=t,this._clippingManager&&this._clippingManager.setGL(t),At.getInstance().setGl(t),this._rendererProfile.setGl(t),this._extension=this.gl.getExtension("EXT_texture_filter_anisotropic")||this.gl.getExtension("WEBKIT_EXT_texture_filter_anisotropic")||this.gl.getExtension("MOZ_EXT_texture_filter_anisotropic")}}me.staticRelease=()=>{je.doStaticRelease()};var is;(s=>{s.CubismClippingContext=Xs,s.CubismClippingManager_WebGL=De,s.CubismRenderTextureResource=zs,s.CubismRenderer_WebGL=je,s.CubismShaderSet=Le,s.CubismShader_WebGL=At,s.ShaderNames=Ys})(is||(is={}));class ss{constructor(t=!1,e=new z){this.isOverwritten=t,this.Color=e}}class rs{constructor(t=!1,e=new z){this.isOverwritten=t,this.Color=e}}class rn{constructor(t=!1,e=!1){this.isOverwritten=t,this.isCulling=e}}class js{update(){this._model.update(),this._model.drawables.resetDynamicFlags()}getPixelsPerUnit(){return this._model==null?0:this._model.canvasinfo.PixelsPerUnit}getCanvasWidth(){return this._model==null?0:this._model.canvasinfo.CanvasWidth/this._model.canvasinfo.PixelsPerUnit}getCanvasHeight(){return this._model==null?0:this._model.canvasinfo.CanvasHeight/this._model.canvasinfo.PixelsPerUnit}saveParameters(){const t=this._model.parameters.count,e=this._savedParameters.getSize();for(let i=0;i<t;++i)i<e?this._savedParameters.set(i,this._parameterValues[i]):this._savedParameters.pushBack(this._parameterValues[i])}getMultiplyColor(t){return this.getOverwriteFlagForModelMultiplyColors()||this.getOverwriteFlagForDrawableMultiplyColors(t)?this._userMultiplyColors.at(t).Color:this.getDrawableMultiplyColor(t)}getScreenColor(t){return this.getOverwriteFlagForModelScreenColors()||this.getOverwriteFlagForDrawableScreenColors(t)?this._userScreenColors.at(t).Color:this.getDrawableScreenColor(t)}setMultiplyColorByTextureColor(t,e){this.setMultiplyColorByRGBA(t,e.R,e.G,e.B,e.A)}setMultiplyColorByRGBA(t,e,i,r,a=1){this._userMultiplyColors.at(t).Color.R=e,this._userMultiplyColors.at(t).Color.G=i,this._userMultiplyColors.at(t).Color.B=r,this._userMultiplyColors.at(t).Color.A=a}setScreenColorByTextureColor(t,e){this.setScreenColorByRGBA(t,e.R,e.G,e.B,e.A)}setScreenColorByRGBA(t,e,i,r,a=1){this._userScreenColors.at(t).Color.R=e,this._userScreenColors.at(t).Color.G=i,this._userScreenColors.at(t).Color.B=r,this._userScreenColors.at(t).Color.A=a}getPartMultiplyColor(t){return this._userPartMultiplyColors.at(t).Color}getPartScreenColor(t){return this._userPartScreenColors.at(t).Color}setPartColor(t,e,i,r,a,o,n){if(o.at(t).Color.R=e,o.at(t).Color.G=i,o.at(t).Color.B=r,o.at(t).Color.A=a,o.at(t).isOverwritten)for(let l=0;l<this._partChildDrawables.at(t).getSize();++l){const u=this._partChildDrawables.at(t).at(l);n.at(u).Color.R=e,n.at(u).Color.G=i,n.at(u).Color.B=r,n.at(u).Color.A=a}}setPartMultiplyColorByTextureColor(t,e){this.setPartMultiplyColorByRGBA(t,e.R,e.G,e.B,e.A)}setPartMultiplyColorByRGBA(t,e,i,r,a){this.setPartColor(t,e,i,r,a,this._userPartMultiplyColors,this._userMultiplyColors)}setPartScreenColorByTextureColor(t,e){this.setPartScreenColorByRGBA(t,e.R,e.G,e.B,e.A)}setPartScreenColorByRGBA(t,e,i,r,a){this.setPartColor(t,e,i,r,a,this._userPartScreenColors,this._userScreenColors)}getOverwriteFlagForModelMultiplyColors(){return this._isOverwrittenModelMultiplyColors}getOverwriteFlagForModelScreenColors(){return this._isOverwrittenModelScreenColors}setOverwriteFlagForModelMultiplyColors(t){this._isOverwrittenModelMultiplyColors=t}setOverwriteFlagForModelScreenColors(t){this._isOverwrittenModelScreenColors=t}getOverwriteFlagForDrawableMultiplyColors(t){return this._userMultiplyColors.at(t).isOverwritten}getOverwriteFlagForDrawableScreenColors(t){return this._userScreenColors.at(t).isOverwritten}setOverwriteFlagForDrawableMultiplyColors(t,e){this._userMultiplyColors.at(t).isOverwritten=e}setOverwriteFlagForDrawableScreenColors(t,e){this._userScreenColors.at(t).isOverwritten=e}getOverwriteColorForPartMultiplyColors(t){return this._userPartMultiplyColors.at(t).isOverwritten}getOverwriteColorForPartScreenColors(t){return this._userPartScreenColors.at(t).isOverwritten}setOverwriteColorForPartColors(t,e,i,r){i.at(t).isOverwritten=e;for(let a=0;a<this._partChildDrawables.at(t).getSize();++a){const o=this._partChildDrawables.at(t).at(a);r.at(o).isOverwritten=e,e&&(r.at(o).Color.R=i.at(t).Color.R,r.at(o).Color.G=i.at(t).Color.G,r.at(o).Color.B=i.at(t).Color.B,r.at(o).Color.A=i.at(t).Color.A)}}setOverwriteColorForPartMultiplyColors(t,e){this._userPartMultiplyColors.at(t).isOverwritten=e,this.setOverwriteColorForPartColors(t,e,this._userPartMultiplyColors,this._userMultiplyColors)}setOverwriteColorForPartScreenColors(t,e){this._userPartScreenColors.at(t).isOverwritten=e,this.setOverwriteColorForPartColors(t,e,this._userPartScreenColors,this._userScreenColors)}getDrawableCulling(t){if(this.getOverwriteFlagForModelCullings()||this.getOverwriteFlagForDrawableCullings(t))return this._userCullings.at(t).isCulling;const e=this._model.drawables.constantFlags;return!Live2DCubismCore.Utils.hasIsDoubleSidedBit(e[t])}setDrawableCulling(t,e){this._userCullings.at(t).isCulling=e}getOverwriteFlagForModelCullings(){return this._isOverwrittenCullings}setOverwriteFlagForModelCullings(t){this._isOverwrittenCullings=t}getOverwriteFlagForDrawableCullings(t){return this._userCullings.at(t).isOverwritten}setOverwriteFlagForDrawableCullings(t,e){this._userCullings.at(t).isOverwritten=e}getModelOapcity(){return this._modelOpacity}setModelOapcity(t){this._modelOpacity=t}getModel(){return this._model}getPartIndex(t){let e;const i=this._model.parts.count;for(e=0;e<i;++e)if(t==this._partIds.at(e))return e;return this._notExistPartId.isExist(t)?this._notExistPartId.getValue(t):(e=i+this._notExistPartId.getSize(),this._notExistPartId.setValue(t,e),this._notExistPartOpacities.appendKey(e),e)}getPartId(t){const e=this._model.parts.ids[t];return I.getIdManager().getId(e)}getPartCount(){return this._model.parts.count}setPartOpacityByIndex(t,e){if(this._notExistPartOpacities.isExist(t)){this._notExistPartOpacities.setValue(t,e);return}Z(0<=t&&t<this.getPartCount()),this._partOpacities[t]=e}setPartOpacityById(t,e){const i=this.getPartIndex(t);i<0||this.setPartOpacityByIndex(i,e)}getPartOpacityByIndex(t){return this._notExistPartOpacities.isExist(t)?this._notExistPartOpacities.getValue(t):(Z(0<=t&&t<this.getPartCount()),this._partOpacities[t])}getPartOpacityById(t){const e=this.getPartIndex(t);return e<0?0:this.getPartOpacityByIndex(e)}getParameterIndex(t){let e;const i=this._model.parameters.count;for(e=0;e<i;++e)if(t==this._parameterIds.at(e))return e;return this._notExistParameterId.isExist(t)?this._notExistParameterId.getValue(t):(e=this._model.parameters.count+this._notExistParameterId.getSize(),this._notExistParameterId.setValue(t,e),this._notExistParameterValues.appendKey(e),e)}getParameterCount(){return this._model.parameters.count}getParameterType(t){return this._model.parameters.types[t]}getParameterMaximumValue(t){return this._model.parameters.maximumValues[t]}getParameterMinimumValue(t){return this._model.parameters.minimumValues[t]}getParameterDefaultValue(t){return this._model.parameters.defaultValues[t]}getParameterValueByIndex(t){return this._notExistParameterValues.isExist(t)?this._notExistParameterValues.getValue(t):(Z(0<=t&&t<this.getParameterCount()),this._parameterValues[t])}getParameterValueById(t){const e=this.getParameterIndex(t);return this.getParameterValueByIndex(e)}setParameterValueByIndex(t,e,i=1){if(this._notExistParameterValues.isExist(t)){this._notExistParameterValues.setValue(t,i==1?e:this._notExistParameterValues.getValue(t)*(1-i)+e*i);return}Z(0<=t&&t<this.getParameterCount()),this._model.parameters.maximumValues[t]<e&&(e=this._model.parameters.maximumValues[t]),this._model.parameters.minimumValues[t]>e&&(e=this._model.parameters.minimumValues[t]),this._parameterValues[t]=i==1?e:this._parameterValues[t]=this._parameterValues[t]*(1-i)+e*i}setParameterValueById(t,e,i=1){const r=this.getParameterIndex(t);this.setParameterValueByIndex(r,e,i)}addParameterValueByIndex(t,e,i=1){this.setParameterValueByIndex(t,this.getParameterValueByIndex(t)+e*i)}addParameterValueById(t,e,i=1){const r=this.getParameterIndex(t);this.addParameterValueByIndex(r,e,i)}multiplyParameterValueById(t,e,i=1){const r=this.getParameterIndex(t);this.multiplyParameterValueByIndex(r,e,i)}multiplyParameterValueByIndex(t,e,i=1){this.setParameterValueByIndex(t,this.getParameterValueByIndex(t)*(1+(e-1)*i))}getDrawableIndex(t){const e=this._model.drawables.count;for(let i=0;i<e;++i)if(this._drawableIds.at(i)==t)return i;return-1}getDrawableCount(){return this._model.drawables.count}getDrawableId(t){const e=this._model.drawables.ids;return I.getIdManager().getId(e[t])}getDrawableRenderOrders(){return this._model.drawables.renderOrders}getDrawableTextureIndices(t){return this.getDrawableTextureIndex(t)}getDrawableTextureIndex(t){return this._model.drawables.textureIndices[t]}getDrawableDynamicFlagVertexPositionsDidChange(t){const e=this._model.drawables.dynamicFlags;return Live2DCubismCore.Utils.hasVertexPositionsDidChangeBit(e[t])}getDrawableVertexIndexCount(t){return this._model.drawables.indexCounts[t]}getDrawableVertexCount(t){return this._model.drawables.vertexCounts[t]}getDrawableVertices(t){return this.getDrawableVertexPositions(t)}getDrawableVertexIndices(t){return this._model.drawables.indices[t]}getDrawableVertexPositions(t){return this._model.drawables.vertexPositions[t]}getDrawableVertexUvs(t){return this._model.drawables.vertexUvs[t]}getDrawableOpacity(t){return this._model.drawables.opacities[t]}getDrawableMultiplyColor(t){const e=this._model.drawables.multiplyColors,i=t*4,r=new z;return r.R=e[i],r.G=e[i+1],r.B=e[i+2],r.A=e[i+3],r}getDrawableScreenColor(t){const e=this._model.drawables.screenColors,i=t*4,r=new z;return r.R=e[i],r.G=e[i+1],r.B=e[i+2],r.A=e[i+3],r}getDrawableParentPartIndex(t){return this._model.drawables.parentPartIndices[t]}getDrawableBlendMode(t){const e=this._model.drawables.constantFlags;return Live2DCubismCore.Utils.hasBlendAdditiveBit(e[t])?et.CubismBlendMode_Additive:Live2DCubismCore.Utils.hasBlendMultiplicativeBit(e[t])?et.CubismBlendMode_Multiplicative:et.CubismBlendMode_Normal}getDrawableInvertedMaskBit(t){const e=this._model.drawables.constantFlags;return Live2DCubismCore.Utils.hasIsInvertedMaskBit(e[t])}getDrawableMasks(){return this._model.drawables.masks}getDrawableMaskCounts(){return this._model.drawables.maskCounts}isUsingMasking(){for(let t=0;t<this._model.drawables.count;++t)if(!(this._model.drawables.maskCounts[t]<=0))return!0;return!1}getDrawableDynamicFlagIsVisible(t){const e=this._model.drawables.dynamicFlags;return Live2DCubismCore.Utils.hasIsVisibleBit(e[t])}getDrawableDynamicFlagVisibilityDidChange(t){const e=this._model.drawables.dynamicFlags;return Live2DCubismCore.Utils.hasVisibilityDidChangeBit(e[t])}getDrawableDynamicFlagOpacityDidChange(t){const e=this._model.drawables.dynamicFlags;return Live2DCubismCore.Utils.hasOpacityDidChangeBit(e[t])}getDrawableDynamicFlagRenderOrderDidChange(t){const e=this._model.drawables.dynamicFlags;return Live2DCubismCore.Utils.hasRenderOrderDidChangeBit(e[t])}getDrawableDynamicFlagBlendColorDidChange(t){const e=this._model.drawables.dynamicFlags;return Live2DCubismCore.Utils.hasBlendColorDidChangeBit(e[t])}loadParameters(){let t=this._model.parameters.count;const e=this._savedParameters.getSize();t>e&&(t=e);for(let i=0;i<t;++i)this._parameterValues[i]=this._savedParameters.at(i)}initialize(){Z(this._model),this._parameterValues=this._model.parameters.values,this._partOpacities=this._model.parts.opacities,this._parameterMaximumValues=this._model.parameters.maximumValues,this._parameterMinimumValues=this._model.parameters.minimumValues;{const e=this._model.parameters.ids,i=this._model.parameters.count;this._parameterIds.prepareCapacity(i);for(let r=0;r<i;++r)this._parameterIds.pushBack(I.getIdManager().getId(e[r]))}const t=this._model.parts.count;{const e=this._model.parts.ids;this._partIds.prepareCapacity(t);for(let i=0;i<t;++i)this._partIds.pushBack(I.getIdManager().getId(e[i]));this._userPartMultiplyColors.prepareCapacity(t),this._userPartScreenColors.prepareCapacity(t),this._partChildDrawables.prepareCapacity(t)}{const e=this._model.drawables.ids,i=this._model.drawables.count;this._userMultiplyColors.prepareCapacity(i),this._userScreenColors.prepareCapacity(i),this._userCullings.prepareCapacity(i);const r=new rn(!1,!1);for(let a=0;a<t;++a){const o=new z(1,1,1,1),n=new z(0,0,0,1),l=new rs(!1,o),u=new rs(!1,n);this._userPartMultiplyColors.pushBack(l),this._userPartScreenColors.pushBack(u),this._partChildDrawables.pushBack(new C),this._partChildDrawables.at(a).prepareCapacity(i)}for(let a=0;a<i;++a){const o=new z(1,1,1,1),n=new z(0,0,0,1),l=new ss(!1,o),u=new ss(!1,n);this._drawableIds.pushBack(I.getIdManager().getId(e[a])),this._userMultiplyColors.pushBack(l),this._userScreenColors.pushBack(u),this._userCullings.pushBack(r);const h=this.getDrawableParentPartIndex(a);h>=0&&this._partChildDrawables.at(h).pushBack(a)}}}constructor(t){this._model=t,this._parameterValues=null,this._parameterMaximumValues=null,this._parameterMinimumValues=null,this._partOpacities=null,this._savedParameters=new C,this._parameterIds=new C,this._drawableIds=new C,this._partIds=new C,this._isOverwrittenModelMultiplyColors=!1,this._isOverwrittenModelScreenColors=!1,this._isOverwrittenCullings=!1,this._modelOpacity=1,this._userMultiplyColors=new C,this._userScreenColors=new C,this._userCullings=new C,this._userPartMultiplyColors=new C,this._userPartScreenColors=new C,this._partChildDrawables=new C,this._notExistPartId=new Y,this._notExistParameterId=new Y,this._notExistParameterValues=new Y,this._notExistPartOpacities=new Y}release(){this._model.release(),this._model=null}}var as;(s=>{s.CubismModel=js})(as||(as={}));class Zt{static create(t,e){let i=null;if(e&&!this.hasMocConsistency(t))return U("Inconsistent MOC3."),i;const r=Live2DCubismCore.Moc.fromArrayBuffer(t);return r&&(i=new Zt(r),i._mocVersion=Live2DCubismCore.Version.csmGetMocVersion(r,t)),i}static delete(t){t._moc._release(),t._moc=null,t=null}createModel(){let t=null;const e=Live2DCubismCore.Model.fromMoc(this._moc);return e&&(t=new js(e),t.initialize(),++this._modelCount),t}deleteModel(t){t!=null&&(t.release(),t=null,--this._modelCount)}constructor(t){this._moc=t,this._modelCount=0,this._mocVersion=0}release(){Z(this._modelCount==0),this._moc._release(),this._moc=null}getLatestMocVersion(){return Live2DCubismCore.Version.csmGetLatestMocVersion()}getMocVersion(){return this._mocVersion}static hasMocConsistency(t){return Live2DCubismCore.Moc.prototype.hasMocConsistency(t)===1}}var ns;(s=>{s.CubismMoc=Zt})(ns||(ns={}));const os="Meta",an="UserDataCount",nn="TotalUserDataSize",Ve="UserData",on="Target",ln="Id",un="Value";class Gs{constructor(t,e){this._json=O.create(t,e)}release(){O.delete(this._json)}getUserDataCount(){return this._json.getRoot().getValueByString(os).getValueByString(an).toInt()}getTotalUserDataSize(){return this._json.getRoot().getValueByString(os).getValueByString(nn).toInt()}getUserDataTargetType(t){return this._json.getRoot().getValueByString(Ve).getValueByIndex(t).getValueByString(on).getRawString()}getUserDataId(t){return I.getIdManager().getId(this._json.getRoot().getValueByString(Ve).getValueByIndex(t).getValueByString(ln).getRawString())}getUserDataValue(t){return this._json.getRoot().getValueByString(Ve).getValueByIndex(t).getValueByString(un).getRawString()}}var ls;(s=>{s.CubismModelUserDataJson=Gs})(ls||(ls={}));const hn="ArtMesh";class Hs{}class Jt{static create(t,e){const i=new Jt;return i.parseUserData(t,e),i}static delete(t){t!=null&&(t.release(),t=null)}getArtMeshUserDatas(){return this._artMeshUserDataNode}parseUserData(t,e){let i=new Gs(t,e);const r=I.getIdManager().getId(hn),a=i.getUserDataCount();for(let o=0;o<a;o++){const n=new Hs;n.targetId=i.getUserDataId(o),n.targetType=I.getIdManager().getId(i.getUserDataTargetType(o)),n.value=new H(i.getUserDataValue(o)),this._userDataNodes.pushBack(n),n.targetType==r&&this._artMeshUserDataNode.pushBack(n)}i.release(),i=void 0}constructor(){this._userDataNodes=new C,this._artMeshUserDataNode=new C}release(){for(let t=0;t<this._userDataNodes.getSize();++t)this._userDataNodes.set(t,null);this._userDataNodes=null}}var us;(s=>{s.CubismModelUserData=Jt,s.CubismModelUserDataNode=Hs})(us||(us={}));class ye{constructor(){this.loadMotion=(t,e,i,r)=>fe.create(t,e,r),this._moc=null,this._model=null,this._motionManager=null,this._expressionManager=null,this._eyeBlink=null,this._breath=null,this._modelMatrix=null,this._pose=null,this._dragManager=null,this._physics=null,this._modelUserData=null,this._initialized=!1,this._updating=!1,this._opacity=1,this._lipsync=!0,this._lastLipSyncValue=0,this._dragX=0,this._dragY=0,this._accelerationX=0,this._accelerationY=0,this._accelerationZ=0,this._mocConsistency=!1,this._debugMode=!1,this._renderer=null,this._motionManager=new Ae,this._motionManager.setEventCallback(ye.cubismDefaultMotionEventCallback,this),this._expressionManager=new Ae,this._dragManager=new Ps}isInitialized(){return this._initialized}setInitialized(t){this._initialized=t}isUpdating(){return this._updating}setUpdating(t){this._updating=t}setDragging(t,e){this._dragManager.set(t,e)}setAcceleration(t,e,i){this._accelerationX=t,this._accelerationY=e,this._accelerationZ=i}getModelMatrix(){return this._modelMatrix}setOpacity(t){this._opacity=t}getOpacity(){return this._opacity}loadModel(t,e=!1){if(this._moc=Zt.create(t,e),this._moc==null){U("Failed to CubismMoc.create().");return}if(this._model=this._moc.createModel(),this._model==null){U("Failed to CreateModel().");return}this._model.saveParameters(),this._modelMatrix=new Bs(this._model.getCanvasWidth(),this._model.getCanvasHeight())}loadExpression(t,e,i){return pe.create(t,e)}loadPose(t,e){this._pose=$t.create(t,e)}loadUserData(t,e){this._modelUserData=Jt.create(t,e)}loadPhysics(t,e){this._physics=Wt.create(t,e)}isHit(t,e,i){const r=this._model.getDrawableIndex(t);if(r<0)return!1;const a=this._model.getDrawableVertexCount(r),o=this._model.getDrawableVertices(r);let n=o[0],l=o[0],u=o[1],h=o[1];for(let g=1;g<a;++g){const c=o[ht.vertexOffset+g*ht.vertexStep],y=o[ht.vertexOffset+g*ht.vertexStep+1];c<n&&(n=c),c>l&&(l=c),y<u&&(u=y),y>h&&(h=y)}const _=this._modelMatrix.invertTransformX(e),d=this._modelMatrix.invertTransformY(i);return n<=_&&_<=l&&u<=d&&d<=h}getModel(){return this._model}getRenderer(){return this._renderer}createRenderer(t=1){this._renderer&&this.deleteRenderer(),this._renderer=new je,this._renderer.initialize(this._model,t)}deleteRenderer(){this._renderer!=null&&(this._renderer.release(),this._renderer=null)}motionEventFired(t){Q("{0}",t.s)}static cubismDefaultMotionEventCallback(t,e,i){const r=i;r!=null&&r.motionEventFired(e)}release(){this._motionManager!=null&&(this._motionManager.release(),this._motionManager=null),this._expressionManager!=null&&(this._expressionManager.release(),this._expressionManager=null),this._moc!=null&&(this._moc.deleteModel(this._model),this._moc.release(),this._moc=null),this._modelMatrix=null,$t.delete(this._pose),Ht.delete(this._eyeBlink),Kt.delete(this._breath),this._dragManager=null,Wt.delete(this._physics),Jt.delete(this._modelUserData),this.deleteRenderer()}}var hs;(s=>{s.CubismUserModel=ye})(hs||(hs={}));const Vt=class Vt{static loadFileAsBytes(t,e){fetch(t).then(i=>i.arrayBuffer()).then(i=>e(i,i.byteLength))}static getDeltaTime(){return this.s_deltaTime}static updateTime(){this.s_currentFrame=Date.now(),this.s_deltaTime=(this.s_currentFrame-this.s_lastFrame)/1e3,this.s_lastFrame=this.s_currentFrame}static printMessage(t){console.log(t)}};Vt.lastUpdate=Date.now(),Vt.s_currentFrame=0,Vt.s_lastFrame=0,Vt.s_deltaTime=0;let R=Vt,Mt=null;class Ge{constructor(){this._loadFiletoBytes=(t,e)=>{this._byteReader._fileByte=t,this._byteReader._fileDataView=new DataView(this._byteReader._fileByte),this._byteReader._fileSize=e},this._pcmData=null,this._userTimeSeconds=0,this._lastRms=0,this._sampleOffset=0,this._wavFileInfo=new gn,this._byteReader=new cn}static getInstance(){return Mt==null&&(Mt=new Ge),Mt}static releaseInstance(){Mt!=null&&(Mt=void 0),Mt=null}update(t){let e,i;if(this._pcmData==null||this._sampleOffset>=this._wavFileInfo._samplesPerChannel)return this._lastRms=0,!1;this._userTimeSeconds+=t,e=Math.floor(this._userTimeSeconds*this._wavFileInfo._samplingRate),e>this._wavFileInfo._samplesPerChannel&&(e=this._wavFileInfo._samplesPerChannel),i=0;for(let r=0;r<this._wavFileInfo._numberOfChannels;r++)for(let a=this._sampleOffset;a<e;a++){const o=this._pcmData[r][a];i+=o*o}return i=Math.sqrt(i/(this._wavFileInfo._numberOfChannels*(e-this._sampleOffset))),this._lastRms=i,this._sampleOffset=e,!0}start(t){this._sampleOffset=0,this._userTimeSeconds=0,this._lastRms=0,this.loadWavFile(t)}getRms(){return this._lastRms}loadWavFile(t){let e=!1;this._pcmData!=null&&this.releasePcmData();const i=async()=>fetch(t).then(r=>r.arrayBuffer());return(async()=>{if(this._byteReader._fileByte=await i(),this._byteReader._fileDataView=new DataView(this._byteReader._fileByte),this._byteReader._fileSize=this._byteReader._fileByte.byteLength,this._byteReader._readOffset=0,this._byteReader._fileByte==null||this._byteReader._fileSize<4)return!1;this._wavFileInfo._fileName=t;try{if(!this._byteReader.getCheckSignature("RIFF"))throw e=!1,new Error('Cannot find Signeture "RIFF".');if(this._byteReader.get32LittleEndian(),!this._byteReader.getCheckSignature("WAVE"))throw e=!1,new Error('Cannot find Signeture "WAVE".');if(!this._byteReader.getCheckSignature("fmt "))throw e=!1,new Error('Cannot find Signeture "fmt".');const r=this._byteReader.get32LittleEndian();if(this._byteReader.get16LittleEndian()!=1)throw e=!1,new Error("File is not linear PCM.");for(this._wavFileInfo._numberOfChannels=this._byteReader.get16LittleEndian(),this._wavFileInfo._samplingRate=this._byteReader.get32LittleEndian(),this._byteReader.get32LittleEndian(),this._byteReader.get16LittleEndian(),this._wavFileInfo._bitsPerSample=this._byteReader.get16LittleEndian(),r>16&&(this._byteReader._readOffset+=r-16);!this._byteReader.getCheckSignature("data")&&this._byteReader._readOffset<this._byteReader._fileSize;)this._byteReader._readOffset+=this._byteReader.get32LittleEndian()+4;if(this._byteReader._readOffset>=this._byteReader._fileSize)throw e=!1,new Error('Cannot find "data" Chunk.');{const a=this._byteReader.get32LittleEndian();this._wavFileInfo._samplesPerChannel=a*8/(this._wavFileInfo._bitsPerSample*this._wavFileInfo._numberOfChannels)}this._pcmData=new Array(this._wavFileInfo._numberOfChannels);for(let a=0;a<this._wavFileInfo._numberOfChannels;a++)this._pcmData[a]=new Float32Array(this._wavFileInfo._samplesPerChannel);for(let a=0;a<this._wavFileInfo._samplesPerChannel;a++)for(let o=0;o<this._wavFileInfo._numberOfChannels;o++)this._pcmData[o][a]=this.getPcmSample();e=!0}catch(r){console.log(r)}})(),e}getPcmSample(){let t;switch(this._wavFileInfo._bitsPerSample){case 8:t=this._byteReader.get8()-128,t<<=24;break;case 16:t=this._byteReader.get16LittleEndian()<<16;break;case 24:t=this._byteReader.get24LittleEndian()<<8;break;default:t=0;break}return t/2147483647}releasePcmData(){for(let t=0;t<this._wavFileInfo._numberOfChannels;t++)delete this._pcmData[t];delete this._pcmData,this._pcmData=null}}class gn{constructor(){this._fileName="",this._numberOfChannels=0,this._bitsPerSample=0,this._samplingRate=0,this._samplesPerChannel=0}}class cn{constructor(){this._fileByte=null,this._fileDataView=null,this._fileSize=0,this._readOffset=0}get8(){const t=this._fileDataView.getUint8(this._readOffset);return this._readOffset++,t}get16LittleEndian(){const t=this._fileDataView.getUint8(this._readOffset+1)<<8|this._fileDataView.getUint8(this._readOffset);return this._readOffset+=2,t}get24LittleEndian(){const t=this._fileDataView.getUint8(this._readOffset+2)<<16|this._fileDataView.getUint8(this._readOffset+1)<<8|this._fileDataView.getUint8(this._readOffset);return this._readOffset+=3,t}get32LittleEndian(){const t=this._fileDataView.getUint8(this._readOffset+3)<<24|this._fileDataView.getUint8(this._readOffset+2)<<16|this._fileDataView.getUint8(this._readOffset+1)<<8|this._fileDataView.getUint8(this._readOffset);return this._readOffset+=4,t}getCheckSignature(t){const e=new Uint8Array(4),i=new TextEncoder().encode(t);if(t.length!=4)return!1;for(let r=0;r<4;r++)e[r]=this.get8();return e[0]==i[0]&&e[1]==i[1]&&e[2]==i[2]&&e[3]==i[3]}}class dn extends ye{constructor(){super(),this._modelSetting=null,this._modelHomeDir=null,this._userTimeSeconds=0,this._eyeBlinkIds=new C,this._lipSyncIds=new C,this._motions=new Y,this._expressions=new Y,this._hitArea=new C,this._userArea=new C,this._idParamAngleX=I.getIdManager().getId(B.ParamAngleX),this._idParamAngleY=I.getIdManager().getId(B.ParamAngleY),this._idParamAngleZ=I.getIdManager().getId(B.ParamAngleZ),this._idParamEyeBallX=I.getIdManager().getId(B.ParamEyeBallX),this._idParamEyeBallY=I.getIdManager().getId(B.ParamEyeBallY),this._idParamBodyAngleX=I.getIdManager().getId(B.ParamBodyAngleX),this._mocConsistency=!0,this._state=0,this._expressionCount=0,this._textureCount=0,this._motionCount=0,this._allMotionCount=0,this._wavFileHandler=new Ge,this._consistency=!1}loadAssets(t,e){this._modelHomeDir=t,fetch(`${this._modelHomeDir}${e}`).then(i=>i.arrayBuffer()).then(i=>{const r=new xs(i,i.byteLength);this._state=1,this.setupModel(r)})}setupModel(t){if(this._updating=!0,this._initialized=!1,this._modelSetting=t,this._modelSetting.getModelFileName()!=""){const d=this._modelSetting.getModelFileName();fetch(`${this._modelHomeDir}${d}`).then(g=>g.arrayBuffer()).then(g=>{this.loadModel(g,this._mocConsistency),this._state=3,e()}),this._state=2}else R.printMessage("Model data does not exist.");const e=()=>{if(this._modelSetting.getExpressionCount()>0){const d=this._modelSetting.getExpressionCount();for(let g=0;g<d;g++){const c=this._modelSetting.getExpressionName(g),y=this._modelSetting.getExpressionFileName(g);fetch(`${this._modelHomeDir}${y}`).then(p=>p.arrayBuffer()).then(p=>{const S=this.loadExpression(p,p.byteLength,c);this._expressions.getValue(c)!=null&&(Ft.delete(this._expressions.getValue(c)),this._expressions.setValue(c,null)),this._expressions.setValue(c,S),this._expressionCount++,this._expressionCount>=d&&(this._state=5,i())})}this._state=4}else this._state=5,i()},i=()=>{if(this._modelSetting.getPhysicsFileName()!=""){const d=this._modelSetting.getPhysicsFileName();fetch(`${this._modelHomeDir}${d}`).then(g=>g.arrayBuffer()).then(g=>{this.loadPhysics(g,g.byteLength),this._state=7,r()}),this._state=6}else this._state=7,r()},r=()=>{if(this._modelSetting.getPoseFileName()!=""){const d=this._modelSetting.getPoseFileName();fetch(`${this._modelHomeDir}${d}`).then(g=>g.arrayBuffer()).then(g=>{this.loadPose(g,g.byteLength),this._state=9,a()}),this._state=8}else this._state=9,a()},a=()=>{this._modelSetting.getEyeBlinkParameterCount()>0&&(this._eyeBlink=Ht.create(this._modelSetting),this._state=10),o()},o=()=>{this._breath=Kt.create();const d=new C;d.pushBack(new wt(this._idParamAngleX,0,15,6.5345,.5)),d.pushBack(new wt(this._idParamAngleY,0,8,3.5345,.5)),d.pushBack(new wt(this._idParamAngleZ,0,10,5.5345,.5)),d.pushBack(new wt(this._idParamBodyAngleX,0,4,15.5345,.5)),d.pushBack(new wt(I.getIdManager().getId(B.ParamBreath),.5,.5,3.2345,1)),this._breath.setParameters(d),this._state=11,n()},n=()=>{if(this._modelSetting.getUserDataFile()!=""){const d=this._modelSetting.getUserDataFile();fetch(`${this._modelHomeDir}${d}`).then(g=>g.arrayBuffer()).then(g=>{this.loadUserData(g,g.byteLength),this._state=13,l()}),this._state=12}else this._state=13,l()},l=()=>{const d=this._modelSetting.getEyeBlinkParameterCount();for(let g=0;g<d;++g)this._eyeBlinkIds.pushBack(this._modelSetting.getEyeBlinkParameterId(g));this._state=14,u()},u=()=>{const d=this._modelSetting.getLipSyncParameterCount();for(let g=0;g<d;++g)this._lipSyncIds.pushBack(this._modelSetting.getLipSyncParameterId(g));this._state=15,h()},h=()=>{const d=new Y;if(this._modelSetting==null||this._modelMatrix==null){U("Failed to setupLayout().");return}this._modelSetting.getLayoutMap(d),this._modelMatrix.setupFromLayout(d),this._state=16,_()},_=()=>{this._state=17,this._model.saveParameters(),this._allMotionCount=0,this._motionCount=0;const d=[],g=this._modelSetting.getMotionGroupCount();for(let c=0;c<g;c++)d[c]=this._modelSetting.getMotionGroupName(c),this._allMotionCount+=this._modelSetting.getMotionCount(d[c]);for(let c=0;c<g;c++)this.preLoadMotionGroup(d[c]);g==0&&(this._state=20,this._motionManager.stopAllMotions(),this._updating=!1,this._initialized=!0,this.createRenderer(),this.setupTextures(),this.getRenderer().startUp(m))}}setupTextures(){if(this._state==20){const e=this._modelSetting.getTextureCount();for(let i=0;i<e;i++){if(this._modelSetting.getTextureFileName(i)==""){console.log("getTextureFileName null");continue}let r=this._modelSetting.getTextureFileName(i);r=this._modelHomeDir+r;const a=o=>{this.getRenderer().bindTexture(i,o.id),this._textureCount++,this._textureCount>=e&&(this._state=22)};T.getInstance().getTextureManager().createTextureFromPngFile(r,!0,a),this.getRenderer().setIsPremultipliedAlpha(!0)}this._state=21}}reloadRenderer(){this.deleteRenderer(),this.createRenderer(),this.setupTextures()}update(){if(this._state!=22)return;const t=R.getDeltaTime();this._userTimeSeconds+=t,this._dragManager.update(t),this._dragX=this._dragManager.getX(),this._dragY=this._dragManager.getY();let e=!1;if(this._model.loadParameters(),this._motionManager.isFinished()?this.startRandomMotion(gr,dr):e=this._motionManager.updateMotion(this._model,t),this._model.saveParameters(),e||this._eyeBlink!=null&&this._eyeBlink.updateParameters(this._model,t),this._expressionManager!=null&&this._expressionManager.updateMotion(this._model,t),this._model.addParameterValueById(this._idParamAngleX,this._dragX*30),this._model.addParameterValueById(this._idParamAngleY,this._dragY*30),this._model.addParameterValueById(this._idParamAngleZ,this._dragX*this._dragY*-30),this._model.addParameterValueById(this._idParamBodyAngleX,this._dragX*10),this._model.addParameterValueById(this._idParamEyeBallX,this._dragX),this._model.addParameterValueById(this._idParamEyeBallY,this._dragY),this._breath!=null&&this._breath.updateParameters(this._model,t),this._physics!=null&&this._physics.evaluate(this._model,t),this._lipsync){let i=0;this._wavFileHandler.update(t),i=this._wavFileHandler.getRms();for(let r=0;r<this._lipSyncIds.getSize();++r)this._model.addParameterValueById(this._lipSyncIds.at(r),i,.8)}this._pose!=null&&this._pose.updateParameters(this._model,t),this._model.update()}startMotion(t,e,i,r){if(i==ai)this._motionManager.setReservePriority(i);else if(!this._motionManager.reserveMotion(i))return this._debugMode&&R.printMessage("[APP]can't start motion."),ge;const a=this._modelSetting.getMotionFileName(t,e),o=`${t}_${e}`;let n=this._motions.getValue(o),l=!1;n==null?fetch(`${this._modelHomeDir}${a}`).then(h=>h.arrayBuffer()).then(h=>{n=this.loadMotion(h,h.byteLength,null,r);let _=this._modelSetting.getMotionFadeInTimeValue(t,e);_>=0&&n.setFadeInTime(_),_=this._modelSetting.getMotionFadeOutTimeValue(t,e),_>=0&&n.setFadeOutTime(_),n.setEffectIds(this._eyeBlinkIds,this._lipSyncIds),l=!0}):n.setFinishedMotionHandler(r);const u=this._modelSetting.getMotionSoundFileName(t,e);if(u.localeCompare("")!=0){let h=u;h=this._modelHomeDir+h,this._wavFileHandler.start(h)}return this._debugMode&&R.printMessage(`[APP]start motion: [${t}_${e}`),this._motionManager.startMotionPriority(n,l,i)}startRandomMotion(t,e,i){if(this._modelSetting.getMotionCount(t)==0)return ge;const r=Math.floor(Math.random()*this._modelSetting.getMotionCount(t));return this.startMotion(t,r,e,i)}setExpression(t){const e=this._expressions.getValue(t);this._debugMode&&R.printMessage(`[APP]expression: [${t}]`),e!=null?this._expressionManager.startMotionPriority(e,!1,ai):this._debugMode&&R.printMessage(`[APP]expression[${t}] is null`)}setRandomExpression(){if(this._expressions.getSize()==0)return;const t=Math.floor(Math.random()*this._expressions.getSize());for(let e=0;e<this._expressions.getSize();e++)if(e==t){const i=this._expressions._keyValues[e].first;this.setExpression(i);return}}motionEventFired(t){Q("{0} is fired on LAppModel!!",t.s)}hitTest(t,e,i){if(this._opacity<1)return!1;const r=this._modelSetting.getHitAreasCount();for(let a=0;a<r;a++)if(this._modelSetting.getHitAreaName(a)==t){const o=this._modelSetting.getHitAreaId(a);return this.isHit(o,e,i)}return!1}preLoadMotionGroup(t){for(let e=0;e<this._modelSetting.getMotionCount(t);e++){const i=this._modelSetting.getMotionFileName(t,e),r=`${t}_${e}`;this._debugMode&&R.printMessage(`[APP]load motion: ${i} => [${r}]`),fetch(`${this._modelHomeDir}${i}`).then(a=>a.arrayBuffer()).then(a=>{const o=this.loadMotion(a,a.byteLength,r);let n=this._modelSetting.getMotionFadeInTimeValue(t,e);n>=0&&o.setFadeInTime(n),n=this._modelSetting.getMotionFadeOutTimeValue(t,e),n>=0&&o.setFadeOutTime(n),o.setEffectIds(this._eyeBlinkIds,this._lipSyncIds),this._motions.getValue(r)!=null&&Ft.delete(this._motions.getValue(r)),this._motions.setValue(r,o),this._motionCount++,this._motionCount>=this._allMotionCount&&(this._state=20,this._motionManager.stopAllMotions(),this._updating=!1,this._initialized=!0,this.createRenderer(),this.setupTextures(),this.getRenderer().startUp(m))})}}releaseMotions(){this._motions.clear()}releaseExpressions(){this._expressions.clear()}doDraw(){if(this._model==null)return;const t=[0,0,V.width,V.height];this.getRenderer().setRenderState(Oe,t),this.getRenderer().drawModel()}draw(t){this._model!=null&&this._state==22&&(t.multiplyByMatrix(this._modelMatrix),this.getRenderer().setMvpMatrix(t),this.doDraw())}async hasMocConsistencyFromFile(){if(Z(this._modelSetting.getModelFileName().localeCompare("")),this._modelSetting.getModelFileName()!=""){const t=this._modelSetting.getModelFileName(),i=await(await fetch(`${this._modelHomeDir}${t}`)).arrayBuffer();return this._consistency=Zt.hasMocConsistency(i),this._consistency?Q("Consistent MOC3."):Q("Inconsistent MOC3."),this._consistency}else R.printMessage("Model data does not exist.")}}let bt=null;class ft{constructor(){this._finishedMotion=t=>{R.printMessage("Motion Finished:"),console.log(t)},this._viewMatrix=new F,this._models=new C,this._sceneIndex=0,this.changeScene(this._sceneIndex)}static getInstance(){return bt==null&&(bt=new ft),bt}static releaseInstance(){bt!=null&&(bt=void 0),bt=null}getModel(t){return t<this._models.getSize()?this._models.at(t):null}releaseAllModel(){for(let t=0;t<this._models.getSize();t++)this._models.at(t).release(),this._models.set(t,null);this._models.clear()}onDrag(t,e){for(let i=0;i<this._models.getSize();i++){const r=this.getModel(i);r&&r.setDragging(t,e)}}onTap(t,e){R.printMessage(`[APP]tap point: {x: ${t.toFixed(2)} y: ${e.toFixed(2)}}`);for(let i=0;i<this._models.getSize();i++)this._models.at(i).hitTest(si,t,e)?(R.printMessage(`[APP]hit area: [${si}]`),this._models.at(i).setRandomExpression()):this._models.at(i).hitTest(ri,t,e)&&(R.printMessage(`[APP]hit area: [${ri}]`),this._models.at(i).startRandomMotion(cr,_r,this._finishedMotion))}onUpdate(){const{width:t,height:e}=V,i=this._models.getSize();for(let r=0;r<i;++r){const a=new F,o=this.getModel(r);o.getModel()&&(o.getModel().getCanvasWidth()>1&&t<e?(o.getModelMatrix().setWidth(2),a.scale(1,t/e)):a.scale(e/t,1),this._viewMatrix!=null&&a.multiplyByMatrix(this._viewMatrix)),o.update(),o.draw(a)}}nextScene(){const t=(this._sceneIndex+1)%hr;this.changeScene(t)}changeScene(t){this._sceneIndex=t,R.printMessage(`[APP]model index: ${this._sceneIndex}`);const e=Re[t],i=ms+e+"/";let r=Re[t];r+=".model3.json",this.releaseAllModel(),this._models.pushBack(new dn),this._models.at(0).loadAssets(i,r)}setViewMatrix(t){for(let e=0;e<16;e++)this._viewMatrix.getArray()[e]=t.getArray()[e]}}class _n{constructor(){this._textures=new C}release(){for(let t=this._textures.begin();t.notEqual(this._textures.end());t.preIncrement())m.deleteTexture(t.ptr().id);this._textures=null}createTextureFromPngFile(t,e,i){for(let a=this._textures.begin();a.notEqual(this._textures.end());a.preIncrement())if(a.ptr().fileName==t&&a.ptr().usePremultply==e){a.ptr().img=new Image,a.ptr().img.onload=()=>i(a.ptr()),a.ptr().img.src=t;return}const r=new Image;r.onload=()=>{const a=m.createTexture();m.bindTexture(m.TEXTURE_2D,a),m.texParameteri(m.TEXTURE_2D,m.TEXTURE_MIN_FILTER,m.LINEAR_MIPMAP_LINEAR),m.texParameteri(m.TEXTURE_2D,m.TEXTURE_MAG_FILTER,m.LINEAR),e&&m.pixelStorei(m.UNPACK_PREMULTIPLY_ALPHA_WEBGL,1),m.texImage2D(m.TEXTURE_2D,0,m.RGBA,m.RGBA,m.UNSIGNED_BYTE,r),m.generateMipmap(m.TEXTURE_2D),m.bindTexture(m.TEXTURE_2D,null);const o=new mn;o!=null&&(o.fileName=t,o.width=r.width,o.height=r.height,o.id=a,o.img=r,o.usePremultply=e,this._textures.pushBack(o)),i(o)},r.src=t}releaseTextures(){for(let t=0;t<this._textures.getSize();t++)this._textures.set(t,null);this._textures.clear()}releaseTextureByTexture(t){for(let e=0;e<this._textures.getSize();e++)if(this._textures.at(e).id==t){this._textures.set(e,null),this._textures.remove(e);break}}releaseTextureByFilePath(t){for(let e=0;e<this._textures.getSize();e++)if(this._textures.at(e).fileName==t){this._textures.set(e,null),this._textures.remove(e);break}}}class mn{constructor(){this.id=null,this.width=0,this.height=0}}class $s extends F{constructor(){super(),this._screenLeft=0,this._screenRight=0,this._screenTop=0,this._screenBottom=0,this._maxLeft=0,this._maxRight=0,this._maxTop=0,this._maxBottom=0,this._maxScale=0,this._minScale=0}adjustTranslate(t,e){this._tr[0]*this._maxLeft+(this._tr[12]+t)>this._screenLeft&&(t=this._screenLeft-this._tr[0]*this._maxLeft-this._tr[12]),this._tr[0]*this._maxRight+(this._tr[12]+t)<this._screenRight&&(t=this._screenRight-this._tr[0]*this._maxRight-this._tr[12]),this._tr[5]*this._maxTop+(this._tr[13]+e)<this._screenTop&&(e=this._screenTop-this._tr[5]*this._maxTop-this._tr[13]),this._tr[5]*this._maxBottom+(this._tr[13]+e)>this._screenBottom&&(e=this._screenBottom-this._tr[5]*this._maxBottom-this._tr[13]);const i=new Float32Array([1,0,0,0,0,1,0,0,0,0,1,0,t,e,0,1]);F.multiply(i,this._tr,this._tr)}adjustScale(t,e,i){const r=this.getMaxScale(),a=this.getMinScale(),o=i*this._tr[0];o<a?this._tr[0]>0&&(i=a/this._tr[0]):o>r&&this._tr[0]>0&&(i=r/this._tr[0]);const n=new Float32Array([1,0,0,0,0,1,0,0,0,0,1,0,t,e,0,1]),l=new Float32Array([i,0,0,0,0,i,0,0,0,0,1,0,0,0,0,1]),u=new Float32Array([1,0,0,0,0,1,0,0,0,0,1,0,-t,-e,0,1]);F.multiply(u,this._tr,this._tr),F.multiply(l,this._tr,this._tr),F.multiply(n,this._tr,this._tr)}setScreenRect(t,e,i,r){this._screenLeft=t,this._screenRight=e,this._screenBottom=i,this._screenTop=r}setMaxScreenRect(t,e,i,r){this._maxLeft=t,this._maxRight=e,this._maxTop=r,this._maxBottom=i}setMaxScale(t){this._maxScale=t}setMinScale(t){this._minScale=t}getMaxScale(){return this._maxScale}getMinScale(){return this._minScale}isMaxScale(){return this.getScaleX()>=this._maxScale}isMinScale(){return this.getScaleX()<=this._minScale}getScreenLeft(){return this._screenLeft}getScreenRight(){return this._screenRight}getScreenBottom(){return this._screenBottom}getScreenTop(){return this._screenTop}getMaxLeft(){return this._maxLeft}getMaxRight(){return this._maxRight}getMaxBottom(){return this._maxBottom}getMaxTop(){return this._maxTop}}var gs;(s=>{s.CubismViewMatrix=$s})(gs||(gs={}));class pn{constructor(t,e,i,r,a){this._rect=new fn,this._rect.left=t-i*.5,this._rect.right=t+i*.5,this._rect.up=e+r*.5,this._rect.down=e-r*.5,this._texture=a,this._vertexBuffer=null,this._uvBuffer=null,this._indexBuffer=null,this._positionLocation=null,this._uvLocation=null,this._textureLocation=null,this._positionArray=null,this._uvArray=null,this._indexArray=null,this._firstDraw=!0}release(){this._rect=null,m.deleteTexture(this._texture),this._texture=null,m.deleteBuffer(this._uvBuffer),this._uvBuffer=null,m.deleteBuffer(this._vertexBuffer),this._vertexBuffer=null,m.deleteBuffer(this._indexBuffer),this._indexBuffer=null}getTexture(){return this._texture}render(t){if(this._texture!=null){if(this._firstDraw){this._positionLocation=m.getAttribLocation(t,"position"),m.enableVertexAttribArray(this._positionLocation),this._uvLocation=m.getAttribLocation(t,"uv"),m.enableVertexAttribArray(this._uvLocation),this._textureLocation=m.getUniformLocation(t,"texture"),m.uniform1i(this._textureLocation,0),this._uvArray=new Float32Array([1,0,0,0,0,1,1,1]),this._uvBuffer=m.createBuffer();{const e=V.width,i=V.height;this._positionArray=new Float32Array([(this._rect.right-e*.5)/(e*.5),(this._rect.up-i*.5)/(i*.5),(this._rect.left-e*.5)/(e*.5),(this._rect.up-i*.5)/(i*.5),(this._rect.left-e*.5)/(e*.5),(this._rect.down-i*.5)/(i*.5),(this._rect.right-e*.5)/(e*.5),(this._rect.down-i*.5)/(i*.5)]),this._vertexBuffer=m.createBuffer()}this._indexArray=new Uint16Array([0,1,2,3,2,0]),this._indexBuffer=m.createBuffer(),this._firstDraw=!1}m.bindBuffer(m.ARRAY_BUFFER,this._uvBuffer),m.bufferData(m.ARRAY_BUFFER,this._uvArray,m.STATIC_DRAW),m.vertexAttribPointer(this._uvLocation,2,m.FLOAT,!1,0,0),m.bindBuffer(m.ARRAY_BUFFER,this._vertexBuffer),m.bufferData(m.ARRAY_BUFFER,this._positionArray,m.STATIC_DRAW),m.vertexAttribPointer(this._positionLocation,2,m.FLOAT,!1,0,0),m.bindBuffer(m.ELEMENT_ARRAY_BUFFER,this._indexBuffer),m.bufferData(m.ELEMENT_ARRAY_BUFFER,this._indexArray,m.DYNAMIC_DRAW),m.bindTexture(m.TEXTURE_2D,this._texture),m.drawElements(m.TRIANGLES,this._indexArray.length,m.UNSIGNED_SHORT,0)}}isHit(t,e){const{height:i}=V,r=i-e;return t>=this._rect.left&&t<=this._rect.right&&r<=this._rect.up&&r>=this._rect.down}}class fn{}class yn{constructor(){this._startX=0,this._startY=0,this._lastX=0,this._lastY=0,this._lastX1=0,this._lastY1=0,this._lastX2=0,this._lastY2=0,this._lastTouchDistance=0,this._deltaX=0,this._deltaY=0,this._scale=1,this._touchSingle=!1,this._flipAvailable=!1}getCenterX(){return this._lastX}getCenterY(){return this._lastY}getDeltaX(){return this._deltaX}getDeltaY(){return this._deltaY}getStartX(){return this._startX}getStartY(){return this._startY}getScale(){return this._scale}getX(){return this._lastX}getY(){return this._lastY}getX1(){return this._lastX1}getY1(){return this._lastY1}getX2(){return this._lastX2}getY2(){return this._lastY2}isSingleTouch(){return this._touchSingle}isFlickAvailable(){return this._flipAvailable}disableFlick(){this._flipAvailable=!1}touchesBegan(t,e){this._lastX=t,this._lastY=e,this._startX=t,this._startY=e,this._lastTouchDistance=-1,this._flipAvailable=!0,this._touchSingle=!0}touchesMoved(t,e){this._lastX=t,this._lastY=e,this._lastTouchDistance=-1,this._touchSingle=!0}getFlickDistance(){return this.calculateDistance(this._startX,this._startY,this._lastX,this._lastY)}calculateDistance(t,e,i,r){return Math.sqrt((t-i)*(t-i)+(e-r)*(e-r))}calculateMovingAmount(t,e){if(t>0!=e>0)return 0;const i=t>0?1:-1,r=Math.abs(t),a=Math.abs(e);return i*(r<a?r:a)}}class Sn{constructor(){this._programId=null,this._back=null,this._gear=null,this._touchManager=new yn,this._deviceToScreen=new F,this._viewMatrix=new $s}initialize(){const{width:t,height:e}=V,i=t/e,r=-i,a=i,o=sr,n=rr;if(this._viewMatrix.setScreenRect(r,a,o,n),this._viewMatrix.scale(ii,ii),this._deviceToScreen.loadIdentity(),t>e){const l=Math.abs(a-r);this._deviceToScreen.scaleRelative(l/t,-l/t)}else{const l=Math.abs(n-o);this._deviceToScreen.scaleRelative(l/e,-l/e)}this._deviceToScreen.translateRelative(-t*.5,-e*.5),this._viewMatrix.setMaxScale(er),this._viewMatrix.setMinScale(ir),this._viewMatrix.setMaxScreenRect(ar,nr,or,lr)}release(){this._viewMatrix=null,this._touchManager=null,this._deviceToScreen=null,this._gear.release(),this._gear=null,this._back.release(),this._back=null,m.deleteProgram(this._programId),this._programId=null}render(){m.useProgram(this._programId),this._back&&this._back.render(this._programId),this._gear&&this._gear.render(this._programId),m.flush();const t=ft.getInstance();t.setViewMatrix(this._viewMatrix),t.onUpdate()}initializeSprite(){const t=V.width,e=V.height,i=T.getInstance().getTextureManager(),r=ms;let a="";if(a=ur,a!=""&&a!=null){const o=n=>{const l=t*.5,u=e*.5,h=n.width*2,_=e*.95;this._back=new pn(l,u,h,_,n.id)};i.createTextureFromPngFile(r+a,!1,o)}this._programId==null&&(this._programId=T.getInstance().createShader())}onTouchesBegan(t,e){this._touchManager.touchesBegan(t,e)}onTouchesMoved(t,e){const i=this.transformViewX(this._touchManager.getX()),r=this.transformViewY(this._touchManager.getY());this._touchManager.touchesMoved(t,e),ft.getInstance().onDrag(i,r)}onTouchesEnded(t,e){const i=ft.getInstance();i.onDrag(0,0);{const r=this._deviceToScreen.transformX(this._touchManager.getX()),a=this._deviceToScreen.transformY(this._touchManager.getY());i.onTap(r,a),this._gear.isHit(t,e)&&i.nextScene()}}transformViewX(t){const e=this._deviceToScreen.transformX(t);return this._viewMatrix.invertTransformX(e)}transformViewY(t){const e=this._deviceToScreen.transformY(t);return this._viewMatrix.invertTransformY(e)}transformScreenX(t){return this._deviceToScreen.transformX(t)}transformScreenY(t){return this._deviceToScreen.transformY(t)}}let V=null,_t=null,m=null,Oe=null;class T{static getInstance(){return _t==null&&(_t=new T),_t}static releaseInstance(){_t!=null&&_t.release(),_t=null}initialize(){return V=document.getElementById("live2d"),V.width=V.width,V.height=V.height,m=V.getContext("webgl")||V.getContext("experimental-webgl"),m?(Oe||(Oe=m.getParameter(m.FRAMEBUFFER_BINDING)),m.enable(m.BLEND),m.blendFunc(m.SRC_ALPHA,m.ONE_MINUS_SRC_ALPHA),"ontouchend"in V?(V.ontouchstart=Pn,V.ontouchmove=Mn,V.ontouchend=bn,V.ontouchcancel=wn):(V.onmousedown=xn,window.onmousemove=Cn,V.onmouseup=Bn),this._view.initialize(),this.initializeCubism(),!0):(alert("Cannot initialize WebGL. This browser does not support."),m=null,document.body.innerHTML="This browser does not support the <code>&lt;canvas&gt;</code> element.",!1)}onResize(){this._resizeCanvas(),this._view.initialize(),this._view.initializeSprite();const t=[0,0,V.width,V.height];m.viewport(t[0],t[1],t[2],t[3])}release(){this._textureManager.release(),this._textureManager=null,this._view.release(),this._view=null,ft.releaseInstance(),I.dispose()}run(){const t=()=>{_t!=null&&(R.updateTime(),m.clearColor(0,0,0,1),m.enable(m.DEPTH_TEST),m.depthFunc(m.LEQUAL),m.clearDepth(1),m.enable(m.BLEND),m.blendFunc(m.SRC_ALPHA,m.ONE_MINUS_SRC_ALPHA),this._view.render(),requestAnimationFrame(t))};t()}createShader(){const t=m.createShader(m.VERTEX_SHADER);if(t==null)return R.printMessage("failed to create vertexShader"),null;const e="precision mediump float;attribute vec3 position;attribute vec2 uv;varying vec2 vuv;void main(void){   gl_Position = vec4(position, 1.0);   vuv = uv;}";m.shaderSource(t,e),m.compileShader(t);const i=m.createShader(m.FRAGMENT_SHADER);if(i==null)return R.printMessage("failed to create fragmentShader"),null;const r="precision mediump float;varying vec2 vuv;uniform sampler2D texture;void main(void){   gl_FragColor = texture2D(texture, vuv);}";m.shaderSource(i,r),m.compileShader(i);const a=m.createProgram();return m.attachShader(a,t),m.attachShader(a,i),m.deleteShader(t),m.deleteShader(i),m.linkProgram(a),m.useProgram(a),a}getView(){return this._view}getTextureManager(){return this._textureManager}constructor(){this._captured=!1,this._mouseX=0,this._mouseY=0,this._isEnd=!1,this._cubismOption=new Qs,this._view=new Sn,this._textureManager=new _n}initializeCubism(){this._cubismOption.logFunction=R.printMessage,this._cubismOption.loggingLevel=mr,I.startUp(this._cubismOption),I.initialize(),ft.getInstance(),R.updateTime(),this._view.initializeSprite()}_resizeCanvas(){V.width=window.innerWidth,V.height=window.innerHeight}}function xn(s){if(!T.getInstance()._view){R.printMessage("view notfound");return}T.getInstance()._captured=!0;const t=s.pageX,e=s.pageY;T.getInstance()._view.onTouchesBegan(t,e)}function Cn(s){if(!T.getInstance()._view){R.printMessage("view notfound");return}s.target.getBoundingClientRect();let t=s.clientX,e=s.clientY-window.innerHeight+V.height;t=t>V.width?V.width:t,e=e<0?0:e,T.getInstance()._view.onTouchesMoved(t,e)}function Bn(s){if(T.getInstance()._captured=!1,!T.getInstance()._view){R.printMessage("view notfound");return}const t=s.target.getBoundingClientRect(),e=s.clientX-t.left,i=s.clientY-t.top;T.getInstance()._view.onTouchesEnded(e,i)}function Pn(s){if(!T.getInstance()._view){R.printMessage("view notfound");return}T.getInstance()._captured=!0;const t=s.changedTouches[0].pageX,e=s.changedTouches[0].pageY;T.getInstance()._view.onTouchesBegan(t,e)}function Mn(s){if(!T.getInstance()._captured)return;if(!T.getInstance()._view){R.printMessage("view notfound");return}const t=s.target.getBoundingClientRect(),e=s.changedTouches[0].clientX-t.left,i=s.changedTouches[0].clientY-t.top;T.getInstance()._view.onTouchesMoved(e,i)}function bn(s){if(T.getInstance()._captured=!1,!T.getInstance()._view){R.printMessage("view notfound");return}const t=s.target.getBoundingClientRect(),e=s.changedTouches[0].clientX-t.left,i=s.changedTouches[0].clientY-t.top;T.getInstance()._view.onTouchesEnded(e,i)}function wn(s){if(T.getInstance()._captured=!1,!T.getInstance()._view){R.printMessage("view notfound");return}const t=s.target.getBoundingClientRect(),e=s.changedTouches[0].clientX-t.left,i=s.changedTouches[0].clientY-t.top;T.getInstance()._view.onTouchesEnded(e,i)}window.onload=()=>{T.getInstance().initialize()!=!1&&T.getInstance().run()};window.onbeforeunload=()=>T.releaseInstance();window.onresize=()=>{tr==="auto"&&T.getInstance().onResize()};(function(){document.querySelectorAll("a").forEach(t=>{let e=t.getAttribute("href");e!=null&&e.startsWith("/")&&(e="/otato/"+e.slice(1),t.setAttribute("href",e))})})();
