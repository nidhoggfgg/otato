(function(){const t=document.createElement("link").relList;if(t&&t.supports&&t.supports("modulepreload"))return;for(const s of document.querySelectorAll('link[rel="modulepreload"]'))i(s);new MutationObserver(s=>{for(const a of s)if(a.type==="childList")for(const l of a.addedNodes)l.tagName==="LINK"&&l.rel==="modulepreload"&&i(l)}).observe(document,{childList:!0,subtree:!0});function e(s){const a={};return s.integrity&&(a.integrity=s.integrity),s.referrerPolicy&&(a.referrerPolicy=s.referrerPolicy),s.crossOrigin==="use-credentials"?a.credentials="include":s.crossOrigin==="anonymous"?a.credentials="omit":a.credentials="same-origin",a}function i(s){if(s.ep)return;s.ep=!0;const a=e(s);fetch(s.href,a)}})();const de=class de{constructor(t=0){t<1?(this._ptr=[],this._capacity=0,this._size=0):(this._ptr=new Array(t),this._capacity=t,this._size=0)}at(t){return this._ptr[t]}set(t,e){this._ptr[t]=e}get(t=0){const e=new Array;for(let i=t;i<this._size;i++)e.push(this._ptr[i]);return e}pushBack(t){this._size>=this._capacity&&this.prepareCapacity(this._capacity==0?de.s_defaultSize:this._capacity*2),this._ptr[this._size++]=t}clear(){this._ptr.length=0,this._size=0}getSize(){return this._size}assign(t,e){this._size<t&&this.prepareCapacity(t);for(let s=0;s<t;s++)this._ptr[s]=e;this._size=t}resize(t,e=null){this.updateSize(t,e,!0)}updateSize(t,e=null,i=!0){if(this._size<t)if(this.prepareCapacity(t),i)for(let a=this._size;a<t;a++)typeof e=="function"?this._ptr[a]=JSON.parse(JSON.stringify(new e)):this._ptr[a]=e;else for(let a=this._size;a<t;a++)this._ptr[a]=e;else{const a=this._size-t;this._ptr.splice(this._size-a,a)}this._size=t}insert(t,e,i){let s=t._index;const a=e._index,l=i._index,n=l-a;this.prepareCapacity(this._size+n);const h=this._size-s;if(h>0)for(let c=0;c<h;c++)this._ptr.splice(s+c,0,null);for(let c=a;c<l;c++,s++)this._ptr[s]=e._vector._ptr[c];this._size=this._size+n}remove(t){return t<0||this._size<=t?!1:(this._ptr.splice(t,1),--this._size,!0)}erase(t){const e=t._index;return e<0||this._size<=e?t:(this._ptr.splice(e,1),--this._size,new Ne(this,e))}prepareCapacity(t){t>this._capacity&&(this._capacity==0?(this._ptr=new Array(t),this._capacity=t):(this._ptr.length=t,this._capacity=t))}begin(){return this._size==0?this.end():new Ne(this,0)}end(){return new Ne(this,this._size)}getOffset(t){const e=new de;return e._ptr=this.get(t),e._size=this.get(t).length,e._capacity=this.get(t).length,e}};de.s_defaultSize=10;let L=de,Ne=class yi{constructor(t,e){this._vector=t??null,this._index=e??0}set(t){return this._index=t._index,this._vector=t._vector,this}preIncrement(){return++this._index,this}preDecrement(){return--this._index,this}increment(){return new yi(this._vector,this._index++)}decrement(){return new yi(this._vector,this._index--)}ptr(){return this._vector._ptr[this._index]}substitution(t){return this._index=t._index,this._vector=t._vector,this}notEqual(t){return this._index!=t._index||this._vector!=t._vector}};var er;(r=>{r.csmVector=L,r.iterator=Ne})(er||(er={}));class _t{append(t,e){return this.s+=e!==void 0?t.substr(0,e):t,this}expansion(t,e){for(let i=0;i<t;i++)this.append(e);return this}getBytes(){return encodeURIComponent(this.s).replace(/%../g,"x").length}getLength(){return this.s.length}isLess(t){return this.s<t.s}isGreat(t){return this.s>t.s}isEqual(t){return this.s==t}isEmpty(){return this.s.length==0}constructor(t){this.s=t}}var ir;(r=>{r.csmString=_t})(ir||(ir={}));class me{getString(){return this._id}constructor(t){if(typeof t=="string"){this._id=new _t(t);return}this._id=t}isEqual(t){return typeof t=="string"?this._id.isEqual(t):t instanceof _t?this._id.isEqual(t.s):t instanceof me?this._id.isEqual(t._id.s):!1}isNotEqual(t){return typeof t=="string"?!this._id.isEqual(t):t instanceof _t?!this._id.isEqual(t.s):t instanceof me?!this._id.isEqual(t._id.s):!1}}var rr;(r=>{r.CubismId=me})(rr||(rr={}));class Cs{constructor(){this._ids=new L}release(){for(let t=0;t<this._ids.getSize();++t)this._ids.set(t,void 0);this._ids=null}registerIds(t){for(let e=0;e<t.length;e++)this.registerId(t[e])}registerId(t){let e=null;if(typeof t=="string"){if((e=this.findId(t))!=null)return e;e=new me(t),this._ids.pushBack(e)}else return this.registerId(t.s);return e}getId(t){return this.registerId(t)}isExist(t){return typeof t=="string"?this.findId(t)!=null:this.isExist(t.s)}findId(t){for(let e=0;e<this._ids.getSize();++e)if(this._ids.at(e).getString().isEqual(t))return this._ids.at(e);return null}}var sr;(r=>{r.CubismIdManager=Cs})(sr||(sr={}));class Z{constructor(){this._tr=new Float32Array(16),this.loadIdentity()}static multiply(t,e,i){const s=new Float32Array([0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0]),a=4;for(let l=0;l<a;++l)for(let n=0;n<a;++n)for(let h=0;h<a;++h)s[n+l*4]+=t[h+l*4]*e[n+h*4];for(let l=0;l<16;++l)i[l]=s[l]}loadIdentity(){const t=new Float32Array([1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1]);this.setMatrix(t)}setMatrix(t){for(let e=0;e<16;++e)this._tr[e]=t[e]}getArray(){return this._tr}getScaleX(){return this._tr[0]}getScaleY(){return this._tr[5]}getTranslateX(){return this._tr[12]}getTranslateY(){return this._tr[13]}transformX(t){return this._tr[0]*t+this._tr[12]}transformY(t){return this._tr[5]*t+this._tr[13]}invertTransformX(t){return(t-this._tr[12])/this._tr[0]}invertTransformY(t){return(t-this._tr[13])/this._tr[5]}translateRelative(t,e){const i=new Float32Array([1,0,0,0,0,1,0,0,0,0,1,0,t,e,0,1]);Z.multiply(i,this._tr,this._tr)}translate(t,e){this._tr[12]=t,this._tr[13]=e}translateX(t){this._tr[12]=t}translateY(t){this._tr[13]=t}scaleRelative(t,e){const i=new Float32Array([t,0,0,0,0,e,0,0,0,0,1,0,0,0,0,1]);Z.multiply(i,this._tr,this._tr)}scale(t,e){this._tr[0]=t,this._tr[5]=e}multiplyByMatrix(t){Z.multiply(t.getArray(),this._tr,this._tr)}clone(){const t=new Z;for(let e=0;e<this._tr.length;e++)t._tr[e]=this._tr[e];return t}}var ar;(r=>{r.CubismMatrix44=Z})(ar||(ar={}));class $e{static create(){return null}static delete(t){}initialize(t){this._model=t}drawModel(){this.getModel()!=null&&(this.saveProfile(),this.doDrawModel(),this.restoreProfile())}setMvpMatrix(t){this._mvpMatrix4x4.setMatrix(t.getArray())}getMvpMatrix(){return this._mvpMatrix4x4}setModelColor(t,e,i,s){t<0?t=0:t>1&&(t=1),e<0?e=0:e>1&&(e=1),i<0?i=0:i>1&&(i=1),s<0?s=0:s>1&&(s=1),this._modelColor.R=t,this._modelColor.G=e,this._modelColor.B=i,this._modelColor.A=s}getModelColor(){return JSON.parse(JSON.stringify(this._modelColor))}setIsPremultipliedAlpha(t){this._isPremultipliedAlpha=t}isPremultipliedAlpha(){return this._isPremultipliedAlpha}setIsCulling(t){this._isCulling=t}isCulling(){return this._isCulling}setAnisotropy(t){this._anisotropy=t}getAnisotropy(){return this._anisotropy}getModel(){return this._model}useHighPrecisionMask(t){this._useHighPrecisionMask=t}isUsingHighPrecisionMask(){return this._useHighPrecisionMask}constructor(){this._isCulling=!1,this._isPremultipliedAlpha=!1,this._anisotropy=0,this._model=null,this._modelColor=new ut,this._useHighPrecisionMask=!1,this._mvpMatrix4x4=new Z,this._mvpMatrix4x4.loadIdentity()}}var Bt=(r=>(r[r.CubismBlendMode_Normal=0]="CubismBlendMode_Normal",r[r.CubismBlendMode_Additive=1]="CubismBlendMode_Additive",r[r.CubismBlendMode_Multiplicative=2]="CubismBlendMode_Multiplicative",r))(Bt||{});class ut{constructor(t=1,e=1,i=1,s=1){this.R=t,this.G=e,this.B=i,this.A=s}}var nr;(r=>{r.CubismBlendMode=Bt,r.CubismRenderer=$e,r.CubismTextureColor=ut})(nr||(nr={}));const an=(r,t,e)=>{Bs.print(r,"[CSM]"+t,e)},Re=(r,t,e)=>{an(r,t+`
`,e)},xt=r=>{console.assert(r)};let pe,vt,Ft,lt;pe=(r,...t)=>{Re(Zt.LogLevel_Debug,"[D]"+r,t)},vt=(r,...t)=>{Re(Zt.LogLevel_Info,"[I]"+r,t)},Ft=(r,...t)=>{Re(Zt.LogLevel_Warning,"[W]"+r,t)},lt=(r,...t)=>{Re(Zt.LogLevel_Error,"[E]"+r,t)};class Bs{static print(t,e,i){if(t<Y.getLoggingLevel())return;const s=Y.coreLogFunction;if(!s)return;const a=e.replace(/\{(\d+)\}/g,(l,n)=>i[n]);s(a)}static dumpBytes(t,e,i){for(let s=0;s<i;s++)s%16==0&&s>0?this.print(t,`
`):s%8==0&&s>0&&this.print(t,"  "),this.print(t,"{0} ",[e[s]&255]);this.print(t,`
`)}constructor(){}}var or;(r=>{r.CubismDebug=Bs})(or||(or={}));class bs{constructor(t,e){this.first=t??null,this.second=e??null}}const _e=class _e{constructor(t){t!=null?t<1?(this._keyValues=[],this._dummyValue=null,this._size=0):(this._keyValues=new Array(t),this._size=t):(this._keyValues=[],this._dummyValue=null,this._size=0)}release(){this.clear()}appendKey(t){this.prepareCapacity(this._size+1,!1),this._keyValues[this._size]=new bs(t),this._size+=1}getValue(t){let e=-1;for(let i=0;i<this._size;i++)if(this._keyValues[i].first==t){e=i;break}return e>=0?this._keyValues[e].second:(this.appendKey(t),this._keyValues[this._size-1].second)}setValue(t,e){let i=-1;for(let s=0;s<this._size;s++)if(this._keyValues[s].first==t){i=s;break}i>=0?this._keyValues[i].second=e:(this.appendKey(t),this._keyValues[this._size-1].second=e)}isExist(t){for(let e=0;e<this._size;e++)if(this._keyValues[e].first==t)return!0;return!1}clear(){this._keyValues=void 0,this._keyValues=null,this._keyValues=[],this._size=0}getSize(){return this._size}prepareCapacity(t,e){t>this._keyValues.length&&(this._keyValues.length==0?(!e&&t<_e.DefaultSize&&(t=_e.DefaultSize),this._keyValues.length=t):(!e&&t<this._keyValues.length*2&&(t=this._keyValues.length*2),this._keyValues.length=t))}begin(){return new zt(this,0)}end(){return new zt(this,this._size)}erase(t){const e=t._index;return e<0||this._size<=e?t:(this._keyValues.splice(e,1),--this._size,new zt(this,e))}dumpAsInt(){for(let t=0;t<this._size;t++)pe("{0} ,",this._keyValues[t]),pe(`
`)}};_e.DefaultSize=10;let ct=_e;class zt{constructor(t,e){this._map=t??new ct,this._index=e??0}set(t){return this._index=t._index,this._map=t._map,this}preIncrement(){return++this._index,this}preDecrement(){return--this._index,this}increment(){return new zt(this._map,this._index++)}decrement(){const t=new zt(this._map,this._index);return this._map=t._map,this._index=t._index,this}ptr(){return this._map._keyValues[this._index]}notEqual(t){return this._index!=t._index||this._map!=t._map}}var lr;(r=>{r.csmMap=ct,r.csmPair=bs,r.iterator=zt})(lr||(lr={}));class Ue{static parseJsonObject(t,e){return Object.keys(t).forEach(i=>{if(typeof t[i]=="boolean"){const s=!!t[i];e.put(i,new St(s))}else if(typeof t[i]=="string"){const s=String(t[i]);e.put(i,new se(s))}else if(typeof t[i]=="number"){const s=Number(t[i]);e.put(i,new Xe(s))}else t[i]instanceof Array?e.put(i,Ue.parseJsonArray(t[i])):t[i]instanceof Object?e.put(i,Ue.parseJsonObject(t[i],new ie)):t[i]==null?e.put(i,new ee):e.put(i,t[i])}),e}static parseJsonArray(t){const e=new Mi;return Object.keys(t).forEach(i=>{if(typeof Number(i)=="number")if(typeof t[i]=="boolean"){const a=!!t[i];e.add(new St(a))}else if(typeof t[i]=="string"){const a=String(t[i]);e.add(new se(a))}else if(typeof t[i]=="number"){const a=Number(t[i]);e.add(new Xe(a))}else t[i]instanceof Array?e.add(this.parseJsonArray(t[i])):t[i]instanceof Object?e.add(this.parseJsonObject(t[i],new ie)):t[i]==null?e.add(new ee):e.add(t[i]);else if(t[i]instanceof Array)e.add(this.parseJsonArray(t[i]));else if(t[i]instanceof Object)e.add(this.parseJsonObject(t[i],new ie));else if(t[i]==null)e.add(new ee);else{const a=Array(t[i]);for(let l=0;l<a.length;l++)e.add(a[l])}}),e}}const ze="Error: type mismatch",nn="Error: index out of bounds";let nt=class Ct{constructor(){}getRawString(t,e){return this.getString(t,e)}toInt(t=0){return t}toFloat(t=0){return t}toBoolean(t=!1){return t}getSize(){return 0}getArray(t=null){return t}getVector(t=new L){return t}getMap(t){return t}getValueByIndex(t){return Ct.errorValue.setErrorNotForClientCall(ze)}getValueByString(t){return Ct.nullValue.setErrorNotForClientCall(ze)}getKeys(){return Ct.s_dummyKeys}isError(){return!1}isNull(){return!1}isBool(){return!1}isFloat(){return!1}isString(){return!1}isArray(){return!1}isMap(){return!1}equals(t){return!1}isStatic(){return!1}setErrorNotForClientCall(t){return ye.errorValue}static staticInitializeNotForClientCall(){St.trueValue=new St(!0),St.falseValue=new St(!1),Ct.errorValue=new ye("ERROR",!0),Ct.nullValue=new ee,Ct.s_dummyKeys=new L}static staticReleaseNotForClientCall(){St.trueValue=null,St.falseValue=null,Ct.errorValue=null,Ct.nullValue=null,Ct.s_dummyKeys=null}};class at{constructor(t,e){this._parseCallback=Ue.parseJsonObject,this._error=null,this._lineCount=0,this._root=null,t!=null&&this.parseBytes(t,e,this._parseCallback)}static create(t,e){const i=new at;return i.parseBytes(t,e,i._parseCallback)?i:(at.delete(i),null)}static delete(t){}getRoot(){return this._root}static arrayBufferToString(t){const e=new Uint8Array(t);let i="";for(let s=0,a=e.length;s<a;++s)i+="%"+this.pad(e[s].toString(16));return i=decodeURIComponent(i),i}static pad(t){return t.length<2?"0"+t:t}parseBytes(t,e,i){const s=new Array(1),a=at.arrayBufferToString(t);if(i==null?this._root=this.parseValue(a,e,0,s):this._root=i(JSON.parse(a),new ie),this._error){let l="\0";return l="Json parse error : @line "+(this._lineCount+1)+`
`,this._root=new se(l),vt("{0}",this._root.getRawString()),!1}else if(this._root==null)return this._root=new ye(new _t(this._error),!1),!1;return!0}getParseError(){return this._error}checkEndOfFile(){return this._root.getArray()[1].equals("EOF")}parseValue(t,e,i,s){if(this._error)return null;let a=null,l=i,n;for(;l<e;l++)switch(t[l]){case"-":case".":case"0":case"1":case"2":case"3":case"4":case"5":case"6":case"7":case"8":case"9":{const c=new Array(1);return n=on(t.slice(l),c),s[0]=t.indexOf(c[0]),new Xe(n)}case'"':return new se(this.parseString(t,e,l+1,s));case"[":return a=this.parseArray(t,e,l+1,s),a;case"{":return a=this.parseObject(t,e,l+1,s),a;case"n":return l+3<e?(a=new ee,s[0]=l+4):this._error="parse null",a;case"t":return l+3<e?(a=St.trueValue,s[0]=l+4):this._error="parse true",a;case"f":return l+4<e?(a=St.falseValue,s[0]=l+5):this._error="illegal ',' position",a;case",":return this._error="illegal ',' position",null;case"]":return s[0]=l,null;case`
`:this._lineCount++}return this._error="illegal end of value",null}parseString(t,e,i,s){if(this._error)return null;let a=i,l,n;const h=new _t("");let c=i;for(;a<e;a++)switch(l=t[a],l){case'"':return s[0]=a+1,h.append(t.slice(c),a-c),h.s;case"//":if(a++,a-1>c&&h.append(t.slice(c),a-c),c=a+1,a<e)switch(n=t[a],n){case"\\":h.expansion(1,"\\");break;case'"':h.expansion(1,'"');break;case"/":h.expansion(1,"/");break;case"b":h.expansion(1,"\b");break;case"f":h.expansion(1,"\f");break;case"n":h.expansion(1,`
`);break;case"r":h.expansion(1,"\r");break;case"t":h.expansion(1,"	");break;case"u":this._error="parse string/unicord escape not supported";break}else this._error="parse string/escape error"}return this._error="parse string/illegal end",null}parseObject(t,e,i,s){if(this._error)return null;const a=new ie;let l="",n=i,h="";const c=Array(1);let d=!1;for(;n<e;n++){t:for(;n<e;n++)switch(h=t[n],h){case'"':if(l=this.parseString(t,e,n+1,c),this._error)return null;n=c[0],d=!0;break t;case"}":return s[0]=n+1,a;case":":this._error="illegal ':' position";break;case`
`:this._lineCount++}if(!d)return this._error="key not found",null;d=!1;t:for(;n<e;n++)switch(h=t[n],h){case":":d=!0,n++;break t;case"}":this._error="illegal '}' position";break;case`
`:this._lineCount++}if(!d)return this._error="':' not found",null;const m=this.parseValue(t,e,n,c);if(this._error)return null;n=c[0],a.put(l,m);t:for(;n<e;n++)switch(h=t[n],h){case",":break t;case"}":return s[0]=n+1,a;case`
`:this._lineCount++}}return this._error="illegal end of perseObject",null}parseArray(t,e,i,s){if(this._error)return null;let a=new Mi,l=i,n;const h=new Array(1);for(;l<e;l++){const c=this.parseValue(t,e,l,h);if(this._error)return null;l=h[0],c&&a.add(c);t:for(;l<e;l++)switch(n=t[l],n){case",":break t;case"]":return s[0]=l+1,a;case`
`:++this._lineCount}}return a=void 0,this._error="illegal end of parseObject",null}}class Xe extends nt{constructor(t){super(),this._value=t}isFloat(){return!0}getString(t,e){const i="\0";return this._value=parseFloat(i),this._stringBuffer=i,this._stringBuffer}toInt(t=0){return parseInt(this._value.toString())}toFloat(t=0){return this._value}equals(t){return typeof t=="number"?Math.round(t)?!1:t==this._value:!1}}class St extends nt{constructor(t){super(),this._boolValue=t}isBool(){return!0}toBoolean(t=!1){return this._boolValue}getString(t,e){return this._stringBuffer=this._boolValue?"true":"false",this._stringBuffer}equals(t){return typeof t=="boolean"?t==this._boolValue:!1}isStatic(){return!0}}class se extends nt{constructor(t){super(),typeof t=="string"&&(this._stringBuffer=t),t instanceof _t&&(this._stringBuffer=t.s)}isString(){return!0}getString(t,e){return this._stringBuffer}equals(t){return typeof t=="string"?this._stringBuffer==t:t instanceof _t?this._stringBuffer==t.s:!1}}class ye extends se{constructor(t,e){var i=(...s)=>{super(...s)};i(t),this._isStatic=e}isStatic(){return this._isStatic}setErrorNotForClientCall(t){return this._stringBuffer=t,this}isError(){return!0}}class ee extends nt{isNull(){return!0}getString(t,e){return this._stringBuffer}isStatic(){return!0}setErrorNotForClientCall(t){return this._stringBuffer=t,ye.nullValue}constructor(){super(),this._stringBuffer="NullValue"}}class Mi extends nt{constructor(){super(),this._array=new L}release(){for(let t=this._array.begin();t.notEqual(this._array.end());t.preIncrement()){let e=t.ptr();e&&!e.isStatic()&&(e=void 0,e=null)}}isArray(){return!0}getValueByIndex(t){if(t<0||this._array.getSize()<=t)return nt.errorValue.setErrorNotForClientCall(nn);const e=this._array.at(t);return e??nt.nullValue}getValueByString(t){return nt.errorValue.setErrorNotForClientCall(ze)}getString(t,e){const i=e+`[
`;for(let s=this._array.begin();s.notEqual(this._array.end());s.increment()){const a=s.ptr();this._stringBuffer+=e+""+a.getString(e+" ")+`
`}return this._stringBuffer=i+e+`]
`,this._stringBuffer}add(t){this._array.pushBack(t)}getVector(t=null){return this._array}getSize(){return this._array.getSize()}}class ie extends nt{constructor(){super(),this._map=new ct}release(){const t=this._map.begin();for(;t.notEqual(this._map.end());){let e=t.ptr().second;e&&!e.isStatic()&&(e=void 0,e=null),t.preIncrement()}}isMap(){return!0}getValueByString(t){if(t instanceof _t){const e=this._map.getValue(t.s);return e??nt.nullValue}for(let e=this._map.begin();e.notEqual(this._map.end());e.preIncrement())if(e.ptr().first==t)return e.ptr().second==null?nt.nullValue:e.ptr().second;return nt.nullValue}getValueByIndex(t){return nt.errorValue.setErrorNotForClientCall(ze)}getString(t,e){this._stringBuffer=e+`{
`;const i=this._map.begin();for(;i.notEqual(this._map.end());){const s=i.ptr().first,a=i.ptr().second;this._stringBuffer+=e+" "+s+" : "+a.getString(e+"   ")+` 
`,i.preIncrement()}return this._stringBuffer+=e+`}
`,this._stringBuffer}getMap(t){return this._map}put(t,e){this._map.setValue(t,e)}getKeys(){if(!this._keys){this._keys=new L;const t=this._map.begin();for(;t.notEqual(this._map.end());){const e=t.ptr().first;this._keys.pushBack(e),t.preIncrement()}}return this._keys}getSize(){return this._keys.getSize()}}var ur;(r=>{r.CubismJson=at,r.JsonArray=Mi,r.JsonBoolean=St,r.JsonError=ye,r.JsonFloat=Xe,r.JsonMap=ie,r.JsonNullvalue=ee,r.JsonString=se,r.Value=nt})(ur||(ur={}));function on(r,t){let e=0;for(let s=1;;s++){const a=r.slice(s-1,s);if(a=="e"||a=="-"||a=="E")continue;const l=r.substring(0,s),n=Number(l);if(isNaN(n))break;e=s}let i=parseFloat(r);return isNaN(i)&&(i=NaN),t[0]=r.slice(e),i}let mt=!1,Ht=!1,$t=null,he=null;const Dt=Object.freeze({vertexOffset:0,vertexStep:2});function ln(r){r&&(r=void 0)}class Y{static startUp(t=null){if(mt)return vt("CubismFramework.startUp() is already done."),mt;if($t=t,$t!=null&&Live2DCubismCore.Logging.csmSetLogFunction($t.logFunction),mt=!0,mt){const e=Live2DCubismCore.Version.csmGetVersion(),i=(e&4278190080)>>24,s=(e&16711680)>>16,a=e&65535,l=e;vt("Live2D Cubism Core version: {0}.{1}.{2} ({3})",("00"+i).slice(-2),("00"+s).slice(-2),("0000"+a).slice(-4),l)}return vt("CubismFramework.startUp() is complete."),mt}static cleanUp(){mt=!1,Ht=!1,$t=null,he=null}static initialize(t=0){if(xt(mt),!mt){Ft("CubismFramework is not started.");return}if(Ht){Ft("CubismFramework.initialize() skipped, already initialized.");return}nt.staticInitializeNotForClientCall(),he=new Cs,Live2DCubismCore.Memory.initializeAmountOfMemory(t),Ht=!0,vt("CubismFramework.initialize() is complete.")}static dispose(){if(xt(mt),!mt){Ft("CubismFramework is not started.");return}if(!Ht){Ft("CubismFramework.dispose() skipped, not initialized.");return}nt.staticReleaseNotForClientCall(),he.release(),he=null,$e.staticRelease(),Ht=!1,vt("CubismFramework.dispose() is complete.")}static isStarted(){return mt}static isInitialized(){return Ht}static coreLogFunction(t){Live2DCubismCore.Logging.csmGetLogFunction()&&Live2DCubismCore.Logging.csmGetLogFunction()(t)}static getLoggingLevel(){return $t!=null?$t.loggingLevel:5}static getIdManager(){return he}constructor(){}}class un{}var Zt=(r=>(r[r.LogLevel_Verbose=0]="LogLevel_Verbose",r[r.LogLevel_Debug=1]="LogLevel_Debug",r[r.LogLevel_Info=2]="LogLevel_Info",r[r.LogLevel_Warning=3]="LogLevel_Warning",r[r.LogLevel_Error=4]="LogLevel_Error",r[r.LogLevel_Off=5]="LogLevel_Off",r))(Zt||{}),hr;(r=>{r.Constant=Dt,r.csmDelete=ln,r.CubismFramework=Y})(hr||(hr={}));const hn={width:600,height:800},cr=1,cn=2,gn=.8,dn=-1,_n=1,fn=-2,mn=2,pn=-2,yn=2,Ps="/l2d/",Sn="",Si=["Cao"],xn=Si.length,vn="Idle",Cn="TapBody",gr="Head",dr="Body",Bn=1,bn=2,_r=3,Pn=Zt.LogLevel_Verbose;var st=typeof globalThis<"u"&&globalThis||typeof self<"u"&&self||typeof global<"u"&&global||{},ot={searchParams:"URLSearchParams"in st,iterable:"Symbol"in st&&"iterator"in Symbol,blob:"FileReader"in st&&"Blob"in st&&function(){try{return new Blob,!0}catch{return!1}}(),formData:"FormData"in st,arrayBuffer:"ArrayBuffer"in st};function Mn(r){return r&&DataView.prototype.isPrototypeOf(r)}if(ot.arrayBuffer)var wn=["[object Int8Array]","[object Uint8Array]","[object Uint8ClampedArray]","[object Int16Array]","[object Uint16Array]","[object Int32Array]","[object Uint32Array]","[object Float32Array]","[object Float64Array]"],In=ArrayBuffer.isView||function(r){return r&&wn.indexOf(Object.prototype.toString.call(r))>-1};function ne(r){if(typeof r!="string"&&(r=String(r)),/[^a-z0-9\-#$%&'*+.^_`|~!]/i.test(r)||r==="")throw new TypeError('Invalid character in header field name: "'+r+'"');return r.toLowerCase()}function wi(r){return typeof r!="string"&&(r=String(r)),r}function Ii(r){var t={next:function(){var e=r.shift();return{done:e===void 0,value:e}}};return ot.iterable&&(t[Symbol.iterator]=function(){return t}),t}function it(r){this.map={},r instanceof it?r.forEach(function(t,e){this.append(e,t)},this):Array.isArray(r)?r.forEach(function(t){if(t.length!=2)throw new TypeError("Headers constructor: expected name/value pair to be length 2, found"+t.length);this.append(t[0],t[1])},this):r&&Object.getOwnPropertyNames(r).forEach(function(t){this.append(t,r[t])},this)}it.prototype.append=function(r,t){r=ne(r),t=wi(t);var e=this.map[r];this.map[r]=e?e+", "+t:t};it.prototype.delete=function(r){delete this.map[ne(r)]};it.prototype.get=function(r){return r=ne(r),this.has(r)?this.map[r]:null};it.prototype.has=function(r){return this.map.hasOwnProperty(ne(r))};it.prototype.set=function(r,t){this.map[ne(r)]=wi(t)};it.prototype.forEach=function(r,t){for(var e in this.map)this.map.hasOwnProperty(e)&&r.call(t,this.map[e],e,this)};it.prototype.keys=function(){var r=[];return this.forEach(function(t,e){r.push(e)}),Ii(r)};it.prototype.values=function(){var r=[];return this.forEach(function(t){r.push(t)}),Ii(r)};it.prototype.entries=function(){var r=[];return this.forEach(function(t,e){r.push([e,t])}),Ii(r)};ot.iterable&&(it.prototype[Symbol.iterator]=it.prototype.entries);function oi(r){if(!r._noBody){if(r.bodyUsed)return Promise.reject(new TypeError("Already read"));r.bodyUsed=!0}}function Ms(r){return new Promise(function(t,e){r.onload=function(){t(r.result)},r.onerror=function(){e(r.error)}})}function Rn(r){var t=new FileReader,e=Ms(t);return t.readAsArrayBuffer(r),e}function Tn(r){var t=new FileReader,e=Ms(t),i=/charset=([A-Za-z0-9_-]+)/.exec(r.type),s=i?i[1]:"utf-8";return t.readAsText(r,s),e}function Vn(r){for(var t=new Uint8Array(r),e=new Array(t.length),i=0;i<t.length;i++)e[i]=String.fromCharCode(t[i]);return e.join("")}function fr(r){if(r.slice)return r.slice(0);var t=new Uint8Array(r.byteLength);return t.set(new Uint8Array(r)),t.buffer}function ws(){return this.bodyUsed=!1,this._initBody=function(r){this.bodyUsed=this.bodyUsed,this._bodyInit=r,r?typeof r=="string"?this._bodyText=r:ot.blob&&Blob.prototype.isPrototypeOf(r)?this._bodyBlob=r:ot.formData&&FormData.prototype.isPrototypeOf(r)?this._bodyFormData=r:ot.searchParams&&URLSearchParams.prototype.isPrototypeOf(r)?this._bodyText=r.toString():ot.arrayBuffer&&ot.blob&&Mn(r)?(this._bodyArrayBuffer=fr(r.buffer),this._bodyInit=new Blob([this._bodyArrayBuffer])):ot.arrayBuffer&&(ArrayBuffer.prototype.isPrototypeOf(r)||In(r))?this._bodyArrayBuffer=fr(r):this._bodyText=r=Object.prototype.toString.call(r):(this._noBody=!0,this._bodyText=""),this.headers.get("content-type")||(typeof r=="string"?this.headers.set("content-type","text/plain;charset=UTF-8"):this._bodyBlob&&this._bodyBlob.type?this.headers.set("content-type",this._bodyBlob.type):ot.searchParams&&URLSearchParams.prototype.isPrototypeOf(r)&&this.headers.set("content-type","application/x-www-form-urlencoded;charset=UTF-8"))},ot.blob&&(this.blob=function(){var r=oi(this);if(r)return r;if(this._bodyBlob)return Promise.resolve(this._bodyBlob);if(this._bodyArrayBuffer)return Promise.resolve(new Blob([this._bodyArrayBuffer]));if(this._bodyFormData)throw new Error("could not read FormData body as blob");return Promise.resolve(new Blob([this._bodyText]))}),this.arrayBuffer=function(){if(this._bodyArrayBuffer){var r=oi(this);return r||(ArrayBuffer.isView(this._bodyArrayBuffer)?Promise.resolve(this._bodyArrayBuffer.buffer.slice(this._bodyArrayBuffer.byteOffset,this._bodyArrayBuffer.byteOffset+this._bodyArrayBuffer.byteLength)):Promise.resolve(this._bodyArrayBuffer))}else{if(ot.blob)return this.blob().then(Rn);throw new Error("could not read as ArrayBuffer")}},this.text=function(){var r=oi(this);if(r)return r;if(this._bodyBlob)return Tn(this._bodyBlob);if(this._bodyArrayBuffer)return Promise.resolve(Vn(this._bodyArrayBuffer));if(this._bodyFormData)throw new Error("could not read FormData body as text");return Promise.resolve(this._bodyText)},ot.formData&&(this.formData=function(){return this.text().then(Fn)}),this.json=function(){return this.text().then(JSON.parse)},this}var En=["CONNECT","DELETE","GET","HEAD","OPTIONS","PATCH","POST","PUT","TRACE"];function An(r){var t=r.toUpperCase();return En.indexOf(t)>-1?t:r}function Yt(r,t){if(!(this instanceof Yt))throw new TypeError('Please use the "new" operator, this DOM object constructor cannot be called as a function.');t=t||{};var e=t.body;if(r instanceof Yt){if(r.bodyUsed)throw new TypeError("Already read");this.url=r.url,this.credentials=r.credentials,t.headers||(this.headers=new it(r.headers)),this.method=r.method,this.mode=r.mode,this.signal=r.signal,!e&&r._bodyInit!=null&&(e=r._bodyInit,r.bodyUsed=!0)}else this.url=String(r);if(this.credentials=t.credentials||this.credentials||"same-origin",(t.headers||!this.headers)&&(this.headers=new it(t.headers)),this.method=An(t.method||this.method||"GET"),this.mode=t.mode||this.mode||null,this.signal=t.signal||this.signal||function(){if("AbortController"in st){var a=new AbortController;return a.signal}}(),this.referrer=null,(this.method==="GET"||this.method==="HEAD")&&e)throw new TypeError("Body not allowed for GET or HEAD requests");if(this._initBody(e),(this.method==="GET"||this.method==="HEAD")&&(t.cache==="no-store"||t.cache==="no-cache")){var i=/([?&])_=[^&]*/;if(i.test(this.url))this.url=this.url.replace(i,"$1_="+new Date().getTime());else{var s=/\?/;this.url+=(s.test(this.url)?"&":"?")+"_="+new Date().getTime()}}}Yt.prototype.clone=function(){return new Yt(this,{body:this._bodyInit})};function Fn(r){var t=new FormData;return r.trim().split("&").forEach(function(e){if(e){var i=e.split("="),s=i.shift().replace(/\+/g," "),a=i.join("=").replace(/\+/g," ");t.append(decodeURIComponent(s),decodeURIComponent(a))}}),t}function Dn(r){var t=new it,e=r.replace(/\r?\n[\t ]+/g," ");return e.split("\r").map(function(i){return i.indexOf(`
`)===0?i.substr(1,i.length):i}).forEach(function(i){var s=i.split(":"),a=s.shift().trim();if(a){var l=s.join(":").trim();try{t.append(a,l)}catch(n){console.warn("Response "+n.message)}}}),t}ws.call(Yt.prototype);function bt(r,t){if(!(this instanceof bt))throw new TypeError('Please use the "new" operator, this DOM object constructor cannot be called as a function.');if(t||(t={}),this.type="default",this.status=t.status===void 0?200:t.status,this.status<200||this.status>599)throw new RangeError("Failed to construct 'Response': The status provided (0) is outside the range [200, 599].");this.ok=this.status>=200&&this.status<300,this.statusText=t.statusText===void 0?"":""+t.statusText,this.headers=new it(t.headers),this.url=t.url||"",this._initBody(r)}ws.call(bt.prototype);bt.prototype.clone=function(){return new bt(this._bodyInit,{status:this.status,statusText:this.statusText,headers:new it(this.headers),url:this.url})};bt.error=function(){var r=new bt(null,{status:200,statusText:""});return r.status=0,r.type="error",r};var Ln=[301,302,303,307,308];bt.redirect=function(r,t){if(Ln.indexOf(t)===-1)throw new RangeError("Invalid status code");return new bt(null,{status:t,headers:{location:r}})};var Ut=st.DOMException;try{new Ut}catch{Ut=function(t,e){this.message=t,this.name=e;var i=Error(t);this.stack=i.stack},Ut.prototype=Object.create(Error.prototype),Ut.prototype.constructor=Ut}function Is(r,t){return new Promise(function(e,i){var s=new Yt(r,t);if(s.signal&&s.signal.aborted)return i(new Ut("Aborted","AbortError"));var a=new XMLHttpRequest;function l(){a.abort()}a.onload=function(){var c={status:a.status,statusText:a.statusText,headers:Dn(a.getAllResponseHeaders()||"")};c.url="responseURL"in a?a.responseURL:c.headers.get("X-Request-URL");var d="response"in a?a.response:a.responseText;setTimeout(function(){e(new bt(d,c))},0)},a.onerror=function(){setTimeout(function(){i(new TypeError("Network request failed"))},0)},a.ontimeout=function(){setTimeout(function(){i(new TypeError("Network request failed"))},0)},a.onabort=function(){setTimeout(function(){i(new Ut("Aborted","AbortError"))},0)};function n(c){try{return c===""&&st.location.href?st.location.href:c}catch{return c}}if(a.open(s.method,n(s.url),!0),s.credentials==="include"?a.withCredentials=!0:s.credentials==="omit"&&(a.withCredentials=!1),"responseType"in a&&(ot.blob?a.responseType="blob":ot.arrayBuffer&&(a.responseType="arraybuffer")),t&&typeof t.headers=="object"&&!(t.headers instanceof it||st.Headers&&t.headers instanceof st.Headers)){var h=[];Object.getOwnPropertyNames(t.headers).forEach(function(c){h.push(ne(c)),a.setRequestHeader(c,wi(t.headers[c]))}),s.headers.forEach(function(c,d){h.indexOf(d)===-1&&a.setRequestHeader(d,c)})}else s.headers.forEach(function(c,d){a.setRequestHeader(d,c)});s.signal&&(s.signal.addEventListener("abort",l),a.onreadystatechange=function(){a.readyState===4&&s.signal.removeEventListener("abort",l)}),a.send(typeof s._bodyInit>"u"?null:s._bodyInit)})}Is.polyfill=!0;st.fetch||(st.fetch=Is,st.Headers=it,st.Request=Yt,st.Response=bt);const O=Object.freeze({HitAreaPrefix:"HitArea",HitAreaHead:"Head",HitAreaBody:"Body",PartsIdCore:"Parts01Core",PartsArmPrefix:"Parts01Arm_",PartsArmLPrefix:"Parts01ArmL_",PartsArmRPrefix:"Parts01ArmR_",ParamAngleX:"ParamAngleX",ParamAngleY:"ParamAngleY",ParamAngleZ:"ParamAngleZ",ParamEyeLOpen:"ParamEyeLOpen",ParamEyeLSmile:"ParamEyeLSmile",ParamEyeROpen:"ParamEyeROpen",ParamEyeRSmile:"ParamEyeRSmile",ParamEyeBallX:"ParamEyeBallX",ParamEyeBallY:"ParamEyeBallY",ParamEyeBallForm:"ParamEyeBallForm",ParamBrowLY:"ParamBrowLY",ParamBrowRY:"ParamBrowRY",ParamBrowLX:"ParamBrowLX",ParamBrowRX:"ParamBrowRX",ParamBrowLAngle:"ParamBrowLAngle",ParamBrowRAngle:"ParamBrowRAngle",ParamBrowLForm:"ParamBrowLForm",ParamBrowRForm:"ParamBrowRForm",ParamMouthForm:"ParamMouthForm",ParamMouthOpenY:"ParamMouthOpenY",ParamCheek:"ParamCheek",ParamBodyAngleX:"ParamBodyAngleX",ParamBodyAngleY:"ParamBodyAngleY",ParamBodyAngleZ:"ParamBodyAngleZ",ParamBreath:"ParamBreath",ParamArmLA:"ParamArmLA",ParamArmRA:"ParamArmRA",ParamArmLB:"ParamArmLB",ParamArmRB:"ParamArmRB",ParamHandL:"ParamHandL",ParamHandR:"ParamHandR",ParamHairFront:"ParamHairFront",ParamHairSide:"ParamHairSide",ParamHairBack:"ParamHairBack",ParamHairFluffy:"ParamHairFluffy",ParamShoulderY:"ParamShoulderY",ParamBustX:"ParamBustX",ParamBustY:"ParamBustY",ParamBaseX:"ParamBaseX",ParamBaseY:"ParamBaseY",ParamNONE:"NONE:"});var mr;(r=>{r.HitAreaBody=O.HitAreaBody,r.HitAreaHead=O.HitAreaHead,r.HitAreaPrefix=O.HitAreaPrefix,r.ParamAngleX=O.ParamAngleX,r.ParamAngleY=O.ParamAngleY,r.ParamAngleZ=O.ParamAngleZ,r.ParamArmLA=O.ParamArmLA,r.ParamArmLB=O.ParamArmLB,r.ParamArmRA=O.ParamArmRA,r.ParamArmRB=O.ParamArmRB,r.ParamBaseX=O.ParamBaseX,r.ParamBaseY=O.ParamBaseY,r.ParamBodyAngleX=O.ParamBodyAngleX,r.ParamBodyAngleY=O.ParamBodyAngleY,r.ParamBodyAngleZ=O.ParamBodyAngleZ,r.ParamBreath=O.ParamBreath,r.ParamBrowLAngle=O.ParamBrowLAngle,r.ParamBrowLForm=O.ParamBrowLForm,r.ParamBrowLX=O.ParamBrowLX,r.ParamBrowLY=O.ParamBrowLY,r.ParamBrowRAngle=O.ParamBrowRAngle,r.ParamBrowRForm=O.ParamBrowRForm,r.ParamBrowRX=O.ParamBrowRX,r.ParamBrowRY=O.ParamBrowRY,r.ParamBustX=O.ParamBustX,r.ParamBustY=O.ParamBustY,r.ParamCheek=O.ParamCheek,r.ParamEyeBallForm=O.ParamEyeBallForm,r.ParamEyeBallX=O.ParamEyeBallX,r.ParamEyeBallY=O.ParamEyeBallY,r.ParamEyeLOpen=O.ParamEyeLOpen,r.ParamEyeLSmile=O.ParamEyeLSmile,r.ParamEyeROpen=O.ParamEyeROpen,r.ParamEyeRSmile=O.ParamEyeRSmile,r.ParamHairBack=O.ParamHairBack,r.ParamHairFluffy=O.ParamHairFluffy,r.ParamHairFront=O.ParamHairFront,r.ParamHairSide=O.ParamHairSide,r.ParamHandL=O.ParamHandL,r.ParamHandR=O.ParamHandR,r.ParamMouthForm=O.ParamMouthForm,r.ParamMouthOpenY=O.ParamMouthOpenY,r.ParamNONE=O.ParamNONE,r.ParamShoulderY=O.ParamShoulderY,r.PartsArmLPrefix=O.PartsArmLPrefix,r.PartsArmPrefix=O.PartsArmPrefix,r.PartsArmRPrefix=O.PartsArmRPrefix,r.PartsIdCore=O.PartsIdCore})(mr||(mr={}));class Rs{}var pr;(r=>{r.ICubismModelSetting=Rs})(pr||(pr={}));const Tt="FileReferences",On="Groups",kn="Layout",Nn="HitAreas",Un="Moc",zn="Textures",Xn="Physics",Yn="Pose",jn="Expressions",Gn="Motions",yr="UserData",Vt="Name",Sr="File",Hn="Id",Te="Ids",xr="Sound",vr="FadeInTime",Cr="FadeOutTime",li="LipSync",ui="EyeBlink";class Ts extends Rs{constructor(t,e){super(),this._json=at.create(t,e),this._json&&(this._jsonValue=new L,this._jsonValue.pushBack(this._json.getRoot().getValueByString(On)),this._jsonValue.pushBack(this._json.getRoot().getValueByString(Tt).getValueByString(Un)),this._jsonValue.pushBack(this._json.getRoot().getValueByString(Tt).getValueByString(Gn)),this._jsonValue.pushBack(this._json.getRoot().getValueByString(Tt).getValueByString(jn)),this._jsonValue.pushBack(this._json.getRoot().getValueByString(Tt).getValueByString(zn)),this._jsonValue.pushBack(this._json.getRoot().getValueByString(Tt).getValueByString(Xn)),this._jsonValue.pushBack(this._json.getRoot().getValueByString(Tt).getValueByString(Yn)),this._jsonValue.pushBack(this._json.getRoot().getValueByString(Nn)))}release(){at.delete(this._json),this._jsonValue=null}GetJson(){return this._json}getModelFileName(){return this.isExistModelFile()?this._jsonValue.at(1).getRawString():""}getTextureCount(){return this.isExistTextureFiles()?this._jsonValue.at(4).getSize():0}getTextureDirectory(){const e=this._jsonValue.at(4).getValueByIndex(0).getRawString().split("/"),i=e.length-1;let s="";for(let a=0;a<i;a++)s+=e[a],a<i-1&&(s+="/");return s}getTextureFileName(t){return this._jsonValue.at(4).getValueByIndex(t).getRawString()}getHitAreasCount(){return this.isExistHitAreas()?this._jsonValue.at(7).getSize():0}getHitAreaId(t){return Y.getIdManager().getId(this._jsonValue.at(7).getValueByIndex(t).getValueByString(Hn).getRawString())}getHitAreaName(t){return this._jsonValue.at(7).getValueByIndex(t).getValueByString(Vt).getRawString()}getPhysicsFileName(){return this.isExistPhysicsFile()?this._jsonValue.at(5).getRawString():""}getPoseFileName(){return this.isExistPoseFile()?this._jsonValue.at(6).getRawString():""}getExpressionCount(){return this.isExistExpressionFile()?this._jsonValue.at(3).getSize():0}getExpressionName(t){return this._jsonValue.at(3).getValueByIndex(t).getValueByString(Vt).getRawString()}getExpressionFileName(t){return this._jsonValue.at(3).getValueByIndex(t).getValueByString(Sr).getRawString()}getMotionGroupCount(){return this.isExistMotionGroups()?this._jsonValue.at(2).getKeys().getSize():0}getMotionGroupName(t){return this.isExistMotionGroups()?this._jsonValue.at(2).getKeys().at(t):null}getMotionCount(t){return this.isExistMotionGroupName(t)?this._jsonValue.at(2).getValueByString(t).getSize():0}getMotionFileName(t,e){return this.isExistMotionGroupName(t)?this._jsonValue.at(2).getValueByString(t).getValueByIndex(e).getValueByString(Sr).getRawString():""}getMotionSoundFileName(t,e){return this.isExistMotionSoundFile(t,e)?this._jsonValue.at(2).getValueByString(t).getValueByIndex(e).getValueByString(xr).getRawString():""}getMotionFadeInTimeValue(t,e){return this.isExistMotionFadeIn(t,e)?this._jsonValue.at(2).getValueByString(t).getValueByIndex(e).getValueByString(vr).toFloat():-1}getMotionFadeOutTimeValue(t,e){return this.isExistMotionFadeOut(t,e)?this._jsonValue.at(2).getValueByString(t).getValueByIndex(e).getValueByString(Cr).toFloat():-1}getUserDataFile(){return this.isExistUserDataFile()?this._json.getRoot().getValueByString(Tt).getValueByString(yr).getRawString():""}getLayoutMap(t){const e=this._json.getRoot().getValueByString(kn).getMap();if(e==null)return!1;let i=!1;for(const s=e.begin();s.notEqual(e.end());s.preIncrement())t.setValue(s.ptr().first,s.ptr().second.toFloat()),i=!0;return i}getEyeBlinkParameterCount(){if(!this.isExistEyeBlinkParameters())return 0;let t=0;for(let e=0;e<this._jsonValue.at(0).getSize();e++){const i=this._jsonValue.at(0).getValueByIndex(e);if(!(i.isNull()||i.isError())&&i.getValueByString(Vt).getRawString()==ui){t=i.getValueByString(Te).getVector().getSize();break}}return t}getEyeBlinkParameterId(t){if(!this.isExistEyeBlinkParameters())return null;for(let e=0;e<this._jsonValue.at(0).getSize();e++){const i=this._jsonValue.at(0).getValueByIndex(e);if(!(i.isNull()||i.isError())&&i.getValueByString(Vt).getRawString()==ui)return Y.getIdManager().getId(i.getValueByString(Te).getValueByIndex(t).getRawString())}return null}getLipSyncParameterCount(){if(!this.isExistLipSyncParameters())return 0;let t=0;for(let e=0;e<this._jsonValue.at(0).getSize();e++){const i=this._jsonValue.at(0).getValueByIndex(e);if(!(i.isNull()||i.isError())&&i.getValueByString(Vt).getRawString()==li){t=i.getValueByString(Te).getVector().getSize();break}}return t}getLipSyncParameterId(t){if(!this.isExistLipSyncParameters())return null;for(let e=0;e<this._jsonValue.at(0).getSize();e++){const i=this._jsonValue.at(0).getValueByIndex(e);if(!(i.isNull()||i.isError())&&i.getValueByString(Vt).getRawString()==li)return Y.getIdManager().getId(i.getValueByString(Te).getValueByIndex(t).getRawString())}return null}isExistModelFile(){const t=this._jsonValue.at(1);return!t.isNull()&&!t.isError()}isExistTextureFiles(){const t=this._jsonValue.at(4);return!t.isNull()&&!t.isError()}isExistHitAreas(){const t=this._jsonValue.at(7);return!t.isNull()&&!t.isError()}isExistPhysicsFile(){const t=this._jsonValue.at(5);return!t.isNull()&&!t.isError()}isExistPoseFile(){const t=this._jsonValue.at(6);return!t.isNull()&&!t.isError()}isExistExpressionFile(){const t=this._jsonValue.at(3);return!t.isNull()&&!t.isError()}isExistMotionGroups(){const t=this._jsonValue.at(2);return!t.isNull()&&!t.isError()}isExistMotionGroupName(t){const e=this._jsonValue.at(2).getValueByString(t);return!e.isNull()&&!e.isError()}isExistMotionSoundFile(t,e){const i=this._jsonValue.at(2).getValueByString(t).getValueByIndex(e).getValueByString(xr);return!i.isNull()&&!i.isError()}isExistMotionFadeIn(t,e){const i=this._jsonValue.at(2).getValueByString(t).getValueByIndex(e).getValueByString(vr);return!i.isNull()&&!i.isError()}isExistMotionFadeOut(t,e){const i=this._jsonValue.at(2).getValueByString(t).getValueByIndex(e).getValueByString(Cr);return!i.isNull()&&!i.isError()}isExistUserDataFile(){const t=this._json.getRoot().getValueByString(Tt).getValueByString(yr);return!t.isNull()&&!t.isError()}isExistEyeBlinkParameters(){if(this._jsonValue.at(0).isNull()||this._jsonValue.at(0).isError())return!1;for(let t=0;t<this._jsonValue.at(0).getSize();++t)if(this._jsonValue.at(0).getValueByIndex(t).getValueByString(Vt).getRawString()==ui)return!0;return!1}isExistLipSyncParameters(){if(this._jsonValue.at(0).isNull()||this._jsonValue.at(0).isError())return!1;for(let t=0;t<this._jsonValue.at(0).getSize();++t)if(this._jsonValue.at(0).getValueByIndex(t).getValueByString(Vt).getRawString()==li)return!0;return!1}}var Br;(r=>{r.CubismModelSettingJson=Ts})(Br||(Br={}));class be{static create(){return new be}static delete(t){}setParameters(t){this._breathParameters=t}getParameters(){return this._breathParameters}updateParameters(t,e){this._currentTime+=e;const i=this._currentTime*2*3.14159;for(let s=0;s<this._breathParameters.getSize();++s){const a=this._breathParameters.at(s);t.addParameterValueById(a.parameterId,a.offset+a.peak*Math.sin(i/a.cycle),a.weight)}}constructor(){this._currentTime=0}}class Kt{constructor(t,e,i,s,a){this.parameterId=t??null,this.offset=e??0,this.peak=i??0,this.cycle=s??0,this.weight=a??0}}var br;(r=>{r.BreathParameterData=Kt,r.CubismBreath=be})(br||(br={}));const fe=class fe{static create(t=null){return new fe(t)}static delete(t){}setBlinkingInterval(t){this._blinkingIntervalSeconds=t}setBlinkingSetting(t,e,i){this._closingSeconds=t,this._closedSeconds=e,this._openingSeconds=i}setParameterIds(t){this._parameterIds=t}getParameterIds(){return this._parameterIds}updateParameters(t,e){this._userTimeSeconds+=e;let i,s=0;switch(this._blinkingState){case 2:s=(this._userTimeSeconds-this._stateStartTimeSeconds)/this._closingSeconds,s>=1&&(s=1,this._blinkingState=3,this._stateStartTimeSeconds=this._userTimeSeconds),i=1-s;break;case 3:s=(this._userTimeSeconds-this._stateStartTimeSeconds)/this._closedSeconds,s>=1&&(this._blinkingState=4,this._stateStartTimeSeconds=this._userTimeSeconds),i=0;break;case 4:s=(this._userTimeSeconds-this._stateStartTimeSeconds)/this._openingSeconds,s>=1&&(s=1,this._blinkingState=1,this._nextBlinkingTime=this.determinNextBlinkingTiming()),i=s;break;case 1:this._nextBlinkingTime<this._userTimeSeconds&&(this._blinkingState=2,this._stateStartTimeSeconds=this._userTimeSeconds),i=1;break;case 0:default:this._blinkingState=1,this._nextBlinkingTime=this.determinNextBlinkingTiming(),i=1;break}fe.CloseIfZero||(i=-i);for(let a=0;a<this._parameterIds.getSize();++a)t.setParameterValueById(this._parameterIds.at(a),i)}constructor(t){if(this._blinkingState=0,this._nextBlinkingTime=0,this._stateStartTimeSeconds=0,this._blinkingIntervalSeconds=4,this._closingSeconds=.1,this._closedSeconds=.05,this._openingSeconds=.15,this._userTimeSeconds=0,this._parameterIds=new L,t!=null)for(let e=0;e<t.getEyeBlinkParameterCount();++e)this._parameterIds.pushBack(t.getEyeBlinkParameterId(e))}determinNextBlinkingTiming(){const t=Math.random();return this._userTimeSeconds+t*(2*this._blinkingIntervalSeconds-1)}};fe.CloseIfZero=!0;let Se=fe;var Vs=(r=>(r[r.EyeState_First=0]="EyeState_First",r[r.EyeState_Interval=1]="EyeState_Interval",r[r.EyeState_Closing=2]="EyeState_Closing",r[r.EyeState_Closed=3]="EyeState_Closed",r[r.EyeState_Opening=4]="EyeState_Opening",r))(Vs||{}),Pr;(r=>{r.CubismEyeBlink=Se,r.EyeState=Vs})(Pr||(Pr={}));const $n=.001,hi=.5,Mr="FadeInTime",wr="Link",Wn="Groups",qn="Id";class xe{static create(t,e){const i=new xe,s=at.create(t,e),a=s.getRoot();a.getValueByString(Mr).isNull()||(i._fadeTimeSeconds=a.getValueByString(Mr).toFloat(hi),i._fadeTimeSeconds<=0&&(i._fadeTimeSeconds=hi));const l=a.getValueByString(Wn),n=l.getSize();for(let h=0;h<n;++h){const c=l.getValueByIndex(h),d=c.getSize();let m=0;for(let x=0;x<d;++x){const S=c.getValueByIndex(x),p=new ve,M=Y.getIdManager().getId(S.getValueByString(qn).getRawString());if(p.partId=M,!S.getValueByString(wr).isNull()){const C=S.getValueByString(wr),E=C.getSize();for(let I=0;I<E;++I){const U=new ve,A=Y.getIdManager().getId(C.getValueByIndex(I).getString());U.partId=A,p.link.pushBack(U)}}i._partGroups.pushBack(p.clone()),++m}i._partGroupCounts.pushBack(m)}return at.delete(s),i}static delete(t){}updateParameters(t,e){t!=this._lastModel&&this.reset(t),this._lastModel=t,e<0&&(e=0);let i=0;for(let s=0;s<this._partGroupCounts.getSize();s++){const a=this._partGroupCounts.at(s);this.doFade(t,e,i,a),i+=a}this.copyPartOpacities(t)}reset(t){let e=0;for(let i=0;i<this._partGroupCounts.getSize();++i){const s=this._partGroupCounts.at(i);for(let a=e;a<e+s;++a){this._partGroups.at(a).initialize(t);const l=this._partGroups.at(a).partIndex,n=this._partGroups.at(a).parameterIndex;if(!(l<0)){t.setPartOpacityByIndex(l,a==e?1:0),t.setParameterValueByIndex(n,a==e?1:0);for(let h=0;h<this._partGroups.at(a).link.getSize();++h)this._partGroups.at(a).link.at(h).initialize(t)}}e+=s}}copyPartOpacities(t){for(let e=0;e<this._partGroups.getSize();++e){const i=this._partGroups.at(e);if(i.link.getSize()==0)continue;const s=this._partGroups.at(e).partIndex,a=t.getPartOpacityByIndex(s);for(let l=0;l<i.link.getSize();++l){const h=i.link.at(l).partIndex;h<0||t.setPartOpacityByIndex(h,a)}}}doFade(t,e,i,s){let a=-1,l=1;const n=.5,h=.15;for(let c=i;c<i+s;++c){const d=this._partGroups.at(c).partIndex,m=this._partGroups.at(c).parameterIndex;if(t.getParameterValueByIndex(m)>$n){if(a>=0)break;a=c,l=t.getPartOpacityByIndex(d),l+=e/this._fadeTimeSeconds,l>1&&(l=1)}}a<0&&(a=0,l=1);for(let c=i;c<i+s;++c){const d=this._partGroups.at(c).partIndex;if(a==c)t.setPartOpacityByIndex(d,l);else{let m=t.getPartOpacityByIndex(d),x;l<n?x=l*(n-1)/n+1:x=(1-l)*n/(1-n),(1-x)*(1-l)>h&&(x=1-h/(1-l)),m>x&&(m=x),t.setPartOpacityByIndex(d,m)}}}constructor(){this._fadeTimeSeconds=hi,this._lastModel=null,this._partGroups=new L,this._partGroupCounts=new L}}class ve{constructor(t){if(this.parameterIndex=0,this.partIndex=0,this.link=new L,t!=null){this.partId=t.partId;for(const e=t.link.begin();e.notEqual(t.link.end());e.preIncrement())this.link.pushBack(e.ptr().clone())}}assignment(t){this.partId=t.partId;for(const e=t.link.begin();e.notEqual(t.link.end());e.preIncrement())this.link.pushBack(e.ptr().clone());return this}initialize(t){this.parameterIndex=t.getParameterIndex(this.partId),this.partIndex=t.getPartIndex(this.partId),t.setParameterValueByIndex(this.parameterIndex,1)}clone(){const t=new ve;t.partId=this.partId,t.parameterIndex=this.parameterIndex,t.partIndex=this.partIndex,t.link=new L;for(let e=this.link.begin();e.notEqual(this.link.end());e.increment())t.link.pushBack(e.ptr().clone());return t}}var Ir;(r=>{r.CubismPose=xe,r.PartData=ve})(Ir||(Ir={}));class Es extends Z{constructor(t,e){super(),this._width=t!==void 0?t:0,this._height=e!==void 0?e:0,this.setHeight(2)}setWidth(t){const e=t/this._width,i=e;this.scale(e,i)}setHeight(t){const e=t/this._height,i=e;this.scale(e,i)}setPosition(t,e){this.translate(t,e)}setCenterPosition(t,e){this.centerX(t),this.centerY(e)}top(t){this.setY(t)}bottom(t){const e=this._height*this.getScaleY();this.translateY(t-e)}left(t){this.setX(t)}right(t){const e=this._width*this.getScaleX();this.translateX(t-e)}centerX(t){const e=this._width*this.getScaleX();this.translateX(t-e/2)}setX(t){this.translateX(t)}centerY(t){const e=this._height*this.getScaleY();this.translateY(t-e/2)}setY(t){this.translateY(t)}setupFromLayout(t){const e="width",i="height",s="x",a="y",l="center_x",n="center_y",h="top",c="bottom",d="left",m="right";for(const x=t.begin();x.notEqual(t.end());x.preIncrement()){const S=x.ptr().first,p=x.ptr().second;S==e?this.setWidth(p):S==i&&this.setHeight(p)}for(const x=t.begin();x.notEqual(t.end());x.preIncrement()){const S=x.ptr().first,p=x.ptr().second;S==s?this.setX(p):S==a?this.setY(p):S==l?this.centerX(p):S==n?this.centerY(p):S==h?this.top(p):S==c?this.bottom(p):S==d?this.left(p):S==m&&this.right(p)}}}var Rr;(r=>{r.CubismModelMatrix=Es})(Rr||(Rr={}));class k{constructor(t,e){this.x=t,this.y=e,this.x=t??0,this.y=e??0}add(t){const e=new k(0,0);return e.x=this.x+t.x,e.y=this.y+t.y,e}substract(t){const e=new k(0,0);return e.x=this.x-t.x,e.y=this.y-t.y,e}multiply(t){const e=new k(0,0);return e.x=this.x*t.x,e.y=this.y*t.y,e}multiplyByScaler(t){return this.multiply(new k(t,t))}division(t){const e=new k(0,0);return e.x=this.x/t.x,e.y=this.y/t.y,e}divisionByScalar(t){return this.division(new k(t,t))}getLength(){return Math.sqrt(this.x*this.x+this.y*this.y)}getDistanceWith(t){return Math.sqrt((this.x-t.x)*(this.x-t.x)+(this.y-t.y)*(this.y-t.y))}dot(t){return this.x*t.x+this.y*t.y}normalize(){const t=Math.pow(this.x*this.x+this.y*this.y,.5);this.x=this.x/t,this.y=this.y/t}isEqual(t){return this.x==t.x&&this.y==t.y}isNotEqual(t){return!this.isEqual(t)}}var Tr;(r=>{r.CubismVector2=k})(Tr||(Tr={}));const Qt=class Qt{static range(t,e,i){return t<e?t=e:t>i&&(t=i),t}static sin(t){return Math.sin(t)}static cos(t){return Math.cos(t)}static abs(t){return Math.abs(t)}static sqrt(t){return Math.sqrt(t)}static cbrt(t){if(t===0)return t;let e=t;const i=e<0;i&&(e=-e);let s;return e===1/0?s=1/0:(s=Math.exp(Math.log(e)/3),s=(e/(s*s)+2*s)/3),i?-s:s}static getEasingSine(t){return t<0?0:t>1?1:.5-.5*this.cos(t*Math.PI)}static max(t,e){return t>e?t:e}static min(t,e){return t>e?e:t}static degreesToRadian(t){return t/180*Math.PI}static radianToDegrees(t){return t*180/Math.PI}static directionToRadian(t,e){const i=Math.atan2(e.y,e.x),s=Math.atan2(t.y,t.x);let a=i-s;for(;a<-Math.PI;)a+=Math.PI*2;for(;a>Math.PI;)a-=Math.PI*2;return a}static directionToDegrees(t,e){const i=this.directionToRadian(t,e);let s=this.radianToDegrees(i);return e.x-t.x>0&&(s=-s),s}static radianToDirection(t){const e=new k;return e.x=this.sin(t),e.y=this.cos(t),e}static quadraticEquation(t,e,i){return this.abs(t)<Qt.Epsilon?this.abs(e)<Qt.Epsilon?-i:-i/e:-(e+this.sqrt(e*e-4*t*i))/(2*t)}static cardanoAlgorithmForBezier(t,e,i,s){if(this.sqrt(t)<Qt.Epsilon)return this.range(this.quadraticEquation(e,i,s),0,1);const a=e/t,l=i/t,n=s/t,h=(3*l-a*a)/3,c=h/3,d=(2*a*a*a-9*a*l+27*n)/27,m=d/2,x=m*m+c*c*c,S=.5,p=S+.01;if(x<0){const U=-h/3,A=U*U*U,B=this.sqrt(A),R=-d/(2*B),D=this.range(R,-1,1),z=Math.acos(D),Q=2*this.cbrt(B),et=Q*this.cos(z/3)-a/3;if(this.abs(et-S)<p)return this.range(et,0,1);const rt=Q*this.cos((z+2*Math.PI)/3)-a/3;if(this.abs(rt-S)<p)return this.range(rt,0,1);const ft=Q*this.cos((z+4*Math.PI)/3)-a/3;return this.range(ft,0,1)}if(x==0){let U;m<0?U=this.cbrt(-m):U=-this.cbrt(m);const A=2*U-a/3;if(this.abs(A-S)<p)return this.range(A,0,1);const B=-U-a/3;return this.range(B,0,1)}const M=this.sqrt(x),C=this.cbrt(M-m),E=this.cbrt(M+m),I=C-E-a/3;return this.range(I,0,1)}constructor(){}};Qt.Epsilon=1e-5;let N=Qt;var Vr;(r=>{r.CubismMath=N})(Vr||(Vr={}));const ci=30,Er=.01;class As{constructor(){this._faceTargetX=0,this._faceTargetY=0,this._faceX=0,this._faceY=0,this._faceVX=0,this._faceVY=0,this._lastTimeSeconds=0,this._userTimeSeconds=0}update(t){this._userTimeSeconds+=t;const i=40/10*1/ci;if(this._lastTimeSeconds==0){this._lastTimeSeconds=this._userTimeSeconds;return}const s=(this._userTimeSeconds-this._lastTimeSeconds)*ci;this._lastTimeSeconds=this._userTimeSeconds;const l=.15*ci,n=s*i/l,h=this._faceTargetX-this._faceX,c=this._faceTargetY-this._faceY;if(N.abs(h)<=Er&&N.abs(c)<=Er)return;const d=N.sqrt(h*h+c*c),m=i*h/d,x=i*c/d;let S=m-this._faceVX,p=x-this._faceVY;const M=N.sqrt(S*S+p*p);(M<-n||M>n)&&(S*=n/M,p*=n/M),this._faceVX+=S,this._faceVY+=p;{const C=.5*(N.sqrt(n*n+16*n*d-8*n*d)-n),E=N.sqrt(this._faceVX*this._faceVX+this._faceVY*this._faceVY);E>C&&(this._faceVX*=C/E,this._faceVY*=C/E)}this._faceX+=this._faceVX,this._faceY+=this._faceVY}getX(){return this._faceX}getY(){return this._faceY}set(t,e){this._faceTargetX=t,this._faceTargetY=e}}var Ar;(r=>{r.CubismTargetPoint=As})(Ar||(Ar={}));class ae{constructor(){this.setFinishedMotionHandler=t=>this._onFinishedMotion=t,this.getFinishedMotionHandler=()=>this._onFinishedMotion,this._fadeInSeconds=-1,this._fadeOutSeconds=-1,this._weight=1,this._offsetSeconds=0,this._firedEventValues=new L}static delete(t){t.release(),t=null}release(){this._weight=0}updateParameters(t,e,i){if(!e.isAvailable()||e.isFinished())return;if(!e.isStarted()){e.setIsStarted(!0),e.setStartTime(i-this._offsetSeconds),e.setFadeInStartTime(i);const n=this.getDuration();e.getEndTime()<0&&e.setEndTime(n<=0?-1:e.getStartTime()+n)}let s=this._weight;const a=this._fadeInSeconds==0?1:N.getEasingSine((i-e.getFadeInStartTime())/this._fadeInSeconds),l=this._fadeOutSeconds==0||e.getEndTime()<0?1:N.getEasingSine((e.getEndTime()-i)/this._fadeOutSeconds);s=s*a*l,e.setState(i,s),xt(0<=s&&s<=1),this.doUpdateParameters(t,i,s,e),e.getEndTime()>0&&e.getEndTime()<i&&e.setIsFinished(!0)}setFadeInTime(t){this._fadeInSeconds=t}setFadeOutTime(t){this._fadeOutSeconds=t}getFadeOutTime(){return this._fadeOutSeconds}getFadeInTime(){return this._fadeInSeconds}setWeight(t){this._weight=t}getWeight(){return this._weight}getDuration(){return-1}getLoopDuration(){return-1}setOffsetTime(t){this._offsetSeconds=t}getFiredEvent(t,e){return this._firedEventValues}isExistModelOpacity(){return!1}getModelOpacityIndex(){return-1}getModelOpacityId(t){return null}getModelOpacityValue(){return 1}}var Fr;(r=>{r.ACubismMotion=ae})(Fr||(Fr={}));const Jn="FadeInTime",Kn="FadeOutTime",Dr="Parameters",Zn="Id",Qn="Value",Ve="Blend",to="Add",eo="Multiply",io="Overwrite",Lr=1;class We extends ae{constructor(){super(),this._parameters=new L}static create(t,e){const i=new We;return i.parse(t,e),i}doUpdateParameters(t,e,i,s){for(let a=0;a<this._parameters.getSize();++a){const l=this._parameters.at(a);switch(l.blendType){case 0:{t.addParameterValueById(l.parameterId,l.value,i);break}case 1:{t.multiplyParameterValueById(l.parameterId,l.value,i);break}case 2:{t.setParameterValueById(l.parameterId,l.value,i);break}}}}parse(t,e){const i=at.create(t,e),s=i.getRoot();this.setFadeInTime(s.getValueByString(Jn).toFloat(Lr)),this.setFadeOutTime(s.getValueByString(Kn).toFloat(Lr));const a=s.getValueByString(Dr).getSize();this._parameters.prepareCapacity(a);for(let l=0;l<a;++l){const n=s.getValueByString(Dr).getValueByIndex(l),h=Y.getIdManager().getId(n.getValueByString(Zn).getRawString()),c=n.getValueByString(Qn).toFloat();let d;n.getValueByString(Ve).isNull()||n.getValueByString(Ve).getString()==to?d=0:n.getValueByString(Ve).getString()==eo?d=1:n.getValueByString(Ve).getString()==io?d=2:d=0;const m=new Ds;m.parameterId=h,m.blendType=d,m.value=c,this._parameters.pushBack(m)}at.delete(i)}}var Fs=(r=>(r[r.ExpressionBlendType_Add=0]="ExpressionBlendType_Add",r[r.ExpressionBlendType_Multiply=1]="ExpressionBlendType_Multiply",r[r.ExpressionBlendType_Overwrite=2]="ExpressionBlendType_Overwrite",r))(Fs||{});class Ds{}var Or;(r=>{r.CubismExpressionMotion=We,r.ExpressionBlendType=Fs,r.ExpressionParameter=Ds})(Or||(Or={}));var pt=(r=>(r[r.CubismMotionCurveTarget_Model=0]="CubismMotionCurveTarget_Model",r[r.CubismMotionCurveTarget_Parameter=1]="CubismMotionCurveTarget_Parameter",r[r.CubismMotionCurveTarget_PartOpacity=2]="CubismMotionCurveTarget_PartOpacity",r))(pt||{}),yt=(r=>(r[r.CubismMotionSegmentType_Linear=0]="CubismMotionSegmentType_Linear",r[r.CubismMotionSegmentType_Bezier=1]="CubismMotionSegmentType_Bezier",r[r.CubismMotionSegmentType_Stepped=2]="CubismMotionSegmentType_Stepped",r[r.CubismMotionSegmentType_InverseStepped=3]="CubismMotionSegmentType_InverseStepped",r))(yt||{});class Ri{constructor(){this.time=0,this.value=0}}class Ls{constructor(){this.evaluate=null,this.basePointIndex=0,this.segmentType=0}}class Os{constructor(){this.type=0,this.segmentCount=0,this.baseSegmentIndex=0,this.fadeInTime=0,this.fadeOutTime=0}}class ks{constructor(){this.fireTime=0}}class Ns{constructor(){this.duration=0,this.loop=!1,this.curveCount=0,this.eventCount=0,this.fps=0,this.curves=new L,this.segments=new L,this.points=new L,this.events=new L}}var kr;(r=>{r.CubismMotionCurve=Os,r.CubismMotionCurveTarget=pt,r.CubismMotionData=Ns,r.CubismMotionEvent=ks,r.CubismMotionPoint=Ri,r.CubismMotionSegment=Ls,r.CubismMotionSegmentType=yt})(kr||(kr={}));const ht="Meta",ro="Duration",so="Loop",ao="AreBeziersRestricted",no="CurveCount",oo="Fps",lo="TotalSegmentCount",uo="TotalPointCount",Et="Curves",ho="Target",co="Id",Ee="FadeInTime",Ae="FadeOutTime",Nr="Segments",Ur="UserData",go="UserDataCount",_o="TotalUserDataSize",fo="Time",mo="Value";class Us{constructor(t,e){this._json=at.create(t,e)}release(){at.delete(this._json)}getMotionDuration(){return this._json.getRoot().getValueByString(ht).getValueByString(ro).toFloat()}isMotionLoop(){return this._json.getRoot().getValueByString(ht).getValueByString(so).toBoolean()}getEvaluationOptionFlag(t){return t==0?this._json.getRoot().getValueByString(ht).getValueByString(ao).toBoolean():!1}getMotionCurveCount(){return this._json.getRoot().getValueByString(ht).getValueByString(no).toInt()}getMotionFps(){return this._json.getRoot().getValueByString(ht).getValueByString(oo).toFloat()}getMotionTotalSegmentCount(){return this._json.getRoot().getValueByString(ht).getValueByString(lo).toInt()}getMotionTotalPointCount(){return this._json.getRoot().getValueByString(ht).getValueByString(uo).toInt()}isExistMotionFadeInTime(){return!this._json.getRoot().getValueByString(ht).getValueByString(Ee).isNull()}isExistMotionFadeOutTime(){return!this._json.getRoot().getValueByString(ht).getValueByString(Ae).isNull()}getMotionFadeInTime(){return this._json.getRoot().getValueByString(ht).getValueByString(Ee).toFloat()}getMotionFadeOutTime(){return this._json.getRoot().getValueByString(ht).getValueByString(Ae).toFloat()}getMotionCurveTarget(t){return this._json.getRoot().getValueByString(Et).getValueByIndex(t).getValueByString(ho).getRawString()}getMotionCurveId(t){return Y.getIdManager().getId(this._json.getRoot().getValueByString(Et).getValueByIndex(t).getValueByString(co).getRawString())}isExistMotionCurveFadeInTime(t){return!this._json.getRoot().getValueByString(Et).getValueByIndex(t).getValueByString(Ee).isNull()}isExistMotionCurveFadeOutTime(t){return!this._json.getRoot().getValueByString(Et).getValueByIndex(t).getValueByString(Ae).isNull()}getMotionCurveFadeInTime(t){return this._json.getRoot().getValueByString(Et).getValueByIndex(t).getValueByString(Ee).toFloat()}getMotionCurveFadeOutTime(t){return this._json.getRoot().getValueByString(Et).getValueByIndex(t).getValueByString(Ae).toFloat()}getMotionCurveSegmentCount(t){return this._json.getRoot().getValueByString(Et).getValueByIndex(t).getValueByString(Nr).getVector().getSize()}getMotionCurveSegment(t,e){return this._json.getRoot().getValueByString(Et).getValueByIndex(t).getValueByString(Nr).getValueByIndex(e).toFloat()}getEventCount(){return this._json.getRoot().getValueByString(ht).getValueByString(go).toInt()}getTotalEventValueSize(){return this._json.getRoot().getValueByString(ht).getValueByString(_o).toInt()}getEventTime(t){return this._json.getRoot().getValueByString(Ur).getValueByIndex(t).getValueByString(fo).toFloat()}getEventValue(t){return new _t(this._json.getRoot().getValueByString(Ur).getValueByIndex(t).getValueByString(mo).getRawString())}}var zs=(r=>(r[r.EvaluationOptionFlag_AreBeziersRistricted=0]="EvaluationOptionFlag_AreBeziersRistricted",r))(zs||{}),zr;(r=>{r.CubismMotionJson=Us})(zr||(zr={}));const po="EyeBlink",yo="LipSync",So="Model",xo="Parameter",vo="PartOpacity",Fe="Opacity",Co=!1;function dt(r,t,e){const i=new Ri;return i.time=r.time+(t.time-r.time)*e,i.value=r.value+(t.value-r.value)*e,i}function Bo(r,t){let e=(t-r[0].time)/(r[1].time-r[0].time);return e<0&&(e=0),r[0].value+(r[1].value-r[0].value)*e}function bo(r,t){let e=(t-r[0].time)/(r[3].time-r[0].time);e<0&&(e=0);const i=dt(r[0],r[1],e),s=dt(r[1],r[2],e),a=dt(r[2],r[3],e),l=dt(i,s,e),n=dt(s,a,e);return dt(l,n,e).value}function Po(r,t){const e=t,i=r[0].time,s=r[3].time,a=r[1].time,l=r[2].time,n=s-3*l+3*a-i,h=3*l-6*a+3*i,c=3*a-3*i,d=i-e,m=N.cardanoAlgorithmForBezier(n,h,c,d),x=dt(r[0],r[1],m),S=dt(r[1],r[2],m),p=dt(r[2],r[3],m),M=dt(x,S,m),C=dt(S,p,m);return dt(M,C,m).value}function Mo(r,t){return r[0].value}function wo(r,t){return r[1].value}function gi(r,t,e){const i=r.curves.at(t);let s=-1;const a=i.baseSegmentIndex+i.segmentCount;let l=0;for(let h=i.baseSegmentIndex;h<a;++h)if(l=r.segments.at(h).basePointIndex+(r.segments.at(h).segmentType==yt.CubismMotionSegmentType_Bezier?3:1),r.points.at(l).time>e){s=h;break}if(s==-1)return r.points.at(l).value;const n=r.segments.at(s);return n.evaluate(r.points.get(n.basePointIndex),e)}class qe extends ae{constructor(){super(),this._sourceFrameRate=30,this._loopDurationSeconds=-1,this._isLoop=!1,this._isLoopFadeIn=!0,this._lastWeight=0,this._motionData=null,this._modelCurveIdEyeBlink=null,this._modelCurveIdLipSync=null,this._modelCurveIdOpacity=null,this._eyeBlinkParameterIds=null,this._lipSyncParameterIds=null,this._modelOpacity=1}static create(t,e,i){const s=new qe;return s.parse(t,e),s._sourceFrameRate=s._motionData.fps,s._loopDurationSeconds=s._motionData.duration,s._onFinishedMotion=i,s}doUpdateParameters(t,e,i,s){this._modelCurveIdEyeBlink==null&&(this._modelCurveIdEyeBlink=Y.getIdManager().getId(po)),this._modelCurveIdLipSync==null&&(this._modelCurveIdLipSync=Y.getIdManager().getId(yo)),this._modelCurveIdOpacity==null&&(this._modelCurveIdOpacity=Y.getIdManager().getId(Fe));let a=e-s.getStartTime();a<0&&(a=0);let l=Number.MAX_VALUE,n=Number.MAX_VALUE;const h=64;let c=0,d=0;this._eyeBlinkParameterIds.getSize()>h&&pe("too many eye blink targets : {0}",this._eyeBlinkParameterIds.getSize()),this._lipSyncParameterIds.getSize()>h&&pe("too many lip sync targets : {0}",this._lipSyncParameterIds.getSize());const m=this._fadeInSeconds<=0?1:N.getEasingSine((e-s.getFadeInStartTime())/this._fadeInSeconds),x=this._fadeOutSeconds<=0||s.getEndTime()<0?1:N.getEasingSine((s.getEndTime()-e)/this._fadeOutSeconds);let S,p,M,C=a;if(this._isLoop)for(;C>this._motionData.duration;)C-=this._motionData.duration;const E=this._motionData.curves;for(p=0;p<this._motionData.curveCount&&E.at(p).type==pt.CubismMotionCurveTarget_Model;++p)S=gi(this._motionData,p,C),E.at(p).id==this._modelCurveIdEyeBlink?n=S:E.at(p).id==this._modelCurveIdLipSync?l=S:E.at(p).id==this._modelCurveIdOpacity&&(this._modelOpacity=S,t.setModelOapcity(this.getModelOpacityValue()));for(;p<this._motionData.curveCount&&E.at(p).type==pt.CubismMotionCurveTarget_Parameter;++p){if(M=t.getParameterIndex(E.at(p).id),M==-1)continue;const I=t.getParameterValueByIndex(M);if(S=gi(this._motionData,p,C),n!=Number.MAX_VALUE){for(let A=0;A<this._eyeBlinkParameterIds.getSize()&&A<h;++A)if(this._eyeBlinkParameterIds.at(A)==E.at(p).id){S*=n,d|=1<<A;break}}if(l!=Number.MAX_VALUE){for(let A=0;A<this._lipSyncParameterIds.getSize()&&A<h;++A)if(this._lipSyncParameterIds.at(A)==E.at(p).id){S+=l,c|=1<<A;break}}let U;if(E.at(p).fadeInTime<0&&E.at(p).fadeOutTime<0)U=I+(S-I)*i;else{let A,B;E.at(p).fadeInTime<0?A=m:A=E.at(p).fadeInTime==0?1:N.getEasingSine((e-s.getFadeInStartTime())/E.at(p).fadeInTime),E.at(p).fadeOutTime<0?B=x:B=E.at(p).fadeOutTime==0||s.getEndTime()<0?1:N.getEasingSine((s.getEndTime()-e)/E.at(p).fadeOutTime);const R=this._weight*A*B;U=I+(S-I)*R}t.setParameterValueByIndex(M,U,1)}{if(n!=Number.MAX_VALUE)for(let I=0;I<this._eyeBlinkParameterIds.getSize()&&I<h;++I){const U=t.getParameterValueById(this._eyeBlinkParameterIds.at(I));if(d>>I&1)continue;const A=U+(n-U)*i;t.setParameterValueById(this._eyeBlinkParameterIds.at(I),A)}if(l!=Number.MAX_VALUE)for(let I=0;I<this._lipSyncParameterIds.getSize()&&I<h;++I){const U=t.getParameterValueById(this._lipSyncParameterIds.at(I));if(c>>I&1)continue;const A=U+(l-U)*i;t.setParameterValueById(this._lipSyncParameterIds.at(I),A)}}for(;p<this._motionData.curveCount&&E.at(p).type==pt.CubismMotionCurveTarget_PartOpacity;++p)M=t.getParameterIndex(E.at(p).id),M!=-1&&(S=gi(this._motionData,p,C),t.setParameterValueByIndex(M,S));a>=this._motionData.duration&&(this._isLoop?(s.setStartTime(e),this._isLoopFadeIn&&s.setFadeInStartTime(e)):(this._onFinishedMotion&&this._onFinishedMotion(this),s.setIsFinished(!0))),this._lastWeight=i}setIsLoop(t){this._isLoop=t}isLoop(){return this._isLoop}setIsLoopFadeIn(t){this._isLoopFadeIn=t}isLoopFadeIn(){return this._isLoopFadeIn}getDuration(){return this._isLoop?-1:this._loopDurationSeconds}getLoopDuration(){return this._loopDurationSeconds}setParameterFadeInTime(t,e){const i=this._motionData.curves;for(let s=0;s<this._motionData.curveCount;++s)if(t==i.at(s).id){i.at(s).fadeInTime=e;return}}setParameterFadeOutTime(t,e){const i=this._motionData.curves;for(let s=0;s<this._motionData.curveCount;++s)if(t==i.at(s).id){i.at(s).fadeOutTime=e;return}}getParameterFadeInTime(t){const e=this._motionData.curves;for(let i=0;i<this._motionData.curveCount;++i)if(t==e.at(i).id)return e.at(i).fadeInTime;return-1}getParameterFadeOutTime(t){const e=this._motionData.curves;for(let i=0;i<this._motionData.curveCount;++i)if(t==e.at(i).id)return e.at(i).fadeOutTime;return-1}setEffectIds(t,e){this._eyeBlinkParameterIds=t,this._lipSyncParameterIds=e}release(){this._motionData=void 0,this._motionData=null}parse(t,e){this._motionData=new Ns;let i=new Us(t,e);this._motionData.duration=i.getMotionDuration(),this._motionData.loop=i.isMotionLoop(),this._motionData.curveCount=i.getMotionCurveCount(),this._motionData.fps=i.getMotionFps(),this._motionData.eventCount=i.getEventCount();const s=i.getEvaluationOptionFlag(zs.EvaluationOptionFlag_AreBeziersRistricted);i.isExistMotionFadeInTime()?this._fadeInSeconds=i.getMotionFadeInTime()<0?1:i.getMotionFadeInTime():this._fadeInSeconds=1,i.isExistMotionFadeOutTime()?this._fadeOutSeconds=i.getMotionFadeOutTime()<0?1:i.getMotionFadeOutTime():this._fadeOutSeconds=1,this._motionData.curves.updateSize(this._motionData.curveCount,Os,!0),this._motionData.segments.updateSize(i.getMotionTotalSegmentCount(),Ls,!0),this._motionData.points.updateSize(i.getMotionTotalPointCount(),Ri,!0),this._motionData.events.updateSize(this._motionData.eventCount,ks,!0);let a=0,l=0;for(let n=0;n<this._motionData.curveCount;++n){i.getMotionCurveTarget(n)==So?this._motionData.curves.at(n).type=pt.CubismMotionCurveTarget_Model:i.getMotionCurveTarget(n)==xo?this._motionData.curves.at(n).type=pt.CubismMotionCurveTarget_Parameter:i.getMotionCurveTarget(n)==vo?this._motionData.curves.at(n).type=pt.CubismMotionCurveTarget_PartOpacity:Ft('Warning : Unable to get segment type from Curve! The number of "CurveCount" may be incorrect!'),this._motionData.curves.at(n).id=i.getMotionCurveId(n),this._motionData.curves.at(n).baseSegmentIndex=l,this._motionData.curves.at(n).fadeInTime=i.isExistMotionCurveFadeInTime(n)?i.getMotionCurveFadeInTime(n):-1,this._motionData.curves.at(n).fadeOutTime=i.isExistMotionCurveFadeOutTime(n)?i.getMotionCurveFadeOutTime(n):-1;for(let h=0;h<i.getMotionCurveSegmentCount(n);){switch(h==0?(this._motionData.segments.at(l).basePointIndex=a,this._motionData.points.at(a).time=i.getMotionCurveSegment(n,h),this._motionData.points.at(a).value=i.getMotionCurveSegment(n,h+1),a+=1,h+=2):this._motionData.segments.at(l).basePointIndex=a-1,i.getMotionCurveSegment(n,h)){case yt.CubismMotionSegmentType_Linear:{this._motionData.segments.at(l).segmentType=yt.CubismMotionSegmentType_Linear,this._motionData.segments.at(l).evaluate=Bo,this._motionData.points.at(a).time=i.getMotionCurveSegment(n,h+1),this._motionData.points.at(a).value=i.getMotionCurveSegment(n,h+2),a+=1,h+=3;break}case yt.CubismMotionSegmentType_Bezier:{this._motionData.segments.at(l).segmentType=yt.CubismMotionSegmentType_Bezier,s||Co?this._motionData.segments.at(l).evaluate=bo:this._motionData.segments.at(l).evaluate=Po,this._motionData.points.at(a).time=i.getMotionCurveSegment(n,h+1),this._motionData.points.at(a).value=i.getMotionCurveSegment(n,h+2),this._motionData.points.at(a+1).time=i.getMotionCurveSegment(n,h+3),this._motionData.points.at(a+1).value=i.getMotionCurveSegment(n,h+4),this._motionData.points.at(a+2).time=i.getMotionCurveSegment(n,h+5),this._motionData.points.at(a+2).value=i.getMotionCurveSegment(n,h+6),a+=3,h+=7;break}case yt.CubismMotionSegmentType_Stepped:{this._motionData.segments.at(l).segmentType=yt.CubismMotionSegmentType_Stepped,this._motionData.segments.at(l).evaluate=Mo,this._motionData.points.at(a).time=i.getMotionCurveSegment(n,h+1),this._motionData.points.at(a).value=i.getMotionCurveSegment(n,h+2),a+=1,h+=3;break}case yt.CubismMotionSegmentType_InverseStepped:{this._motionData.segments.at(l).segmentType=yt.CubismMotionSegmentType_InverseStepped,this._motionData.segments.at(l).evaluate=wo,this._motionData.points.at(a).time=i.getMotionCurveSegment(n,h+1),this._motionData.points.at(a).value=i.getMotionCurveSegment(n,h+2),a+=1,h+=3;break}default:{xt(0);break}}++this._motionData.curves.at(n).segmentCount,++l}}for(let n=0;n<i.getEventCount();++n)this._motionData.events.at(n).fireTime=i.getEventTime(n),this._motionData.events.at(n).value=i.getEventValue(n);i.release(),i=void 0,i=null}getFiredEvent(t,e){this._firedEventValues.updateSize(0);for(let i=0;i<this._motionData.eventCount;++i)this._motionData.events.at(i).fireTime>t&&this._motionData.events.at(i).fireTime<=e&&this._firedEventValues.pushBack(new _t(this._motionData.events.at(i).value.s));return this._firedEventValues}isExistModelOpacity(){for(let t=0;t<this._motionData.curveCount;t++){const e=this._motionData.curves.at(t);if(e.type==pt.CubismMotionCurveTarget_Model&&e.id.getString().s.localeCompare(Fe)==0)return!0}return!1}getModelOpacityIndex(){if(this.isExistModelOpacity())for(let t=0;t<this._motionData.curveCount;t++){const e=this._motionData.curves.at(t);if(e.type==pt.CubismMotionCurveTarget_Model&&e.id.getString().s.localeCompare(Fe)==0)return t}return-1}getModelOpacityId(t){if(t!=-1){const e=this._motionData.curves.at(t);if(e.type==pt.CubismMotionCurveTarget_Model&&e.id.getString().s.localeCompare(Fe)==0)return Y.getIdManager().getId(e.id.getString().s)}return null}getModelOpacityValue(){return this._modelOpacity}}var Xr;(r=>{r.CubismMotion=qe})(Xr||(Xr={}));class Xs{constructor(){this._autoDelete=!1,this._motion=null,this._available=!0,this._finished=!1,this._started=!1,this._startTimeSeconds=-1,this._fadeInStartTimeSeconds=0,this._endTimeSeconds=-1,this._stateTimeSeconds=0,this._stateWeight=0,this._lastEventCheckSeconds=0,this._motionQueueEntryHandle=this,this._fadeOutSeconds=0,this._isTriggeredFadeOut=!1}release(){this._autoDelete&&this._motion&&ae.delete(this._motion)}setFadeOut(t){this._fadeOutSeconds=t,this._isTriggeredFadeOut=!0}startFadeOut(t,e){const i=e+t;this._isTriggeredFadeOut=!0,(this._endTimeSeconds<0||i<this._endTimeSeconds)&&(this._endTimeSeconds=i)}isFinished(){return this._finished}isStarted(){return this._started}getStartTime(){return this._startTimeSeconds}getFadeInStartTime(){return this._fadeInStartTimeSeconds}getEndTime(){return this._endTimeSeconds}setStartTime(t){this._startTimeSeconds=t}setFadeInStartTime(t){this._fadeInStartTimeSeconds=t}setEndTime(t){this._endTimeSeconds=t}setIsFinished(t){this._finished=t}setIsStarted(t){this._started=t}isAvailable(){return this._available}setIsAvailable(t){this._available=t}setState(t,e){this._stateTimeSeconds=t,this._stateWeight=e}getStateTime(){return this._stateTimeSeconds}getStateWeight(){return this._stateWeight}getLastCheckEventSeconds(){return this._lastEventCheckSeconds}setLastCheckEventSeconds(t){this._lastEventCheckSeconds=t}isTriggeredFadeOut(){return this._isTriggeredFadeOut}getFadeOutSeconds(){return this._fadeOutSeconds}}var Yr;(r=>{r.CubismMotionQueueEntry=Xs})(Yr||(Yr={}));class Ys{constructor(){this._userTimeSeconds=0,this._eventCallBack=null,this._eventCustomData=null,this._motions=new L}release(){for(let t=0;t<this._motions.getSize();++t)this._motions.at(t)&&(this._motions.at(t).release(),this._motions.set(t,null));this._motions=null}startMotion(t,e,i){if(t==null)return Ye;let s=null;for(let a=0;a<this._motions.getSize();++a)s=this._motions.at(a),s!=null&&s.setFadeOut(s._motion.getFadeOutTime());return s=new Xs,s._autoDelete=e,s._motion=t,this._motions.pushBack(s),s._motionQueueEntryHandle}isFinished(){for(let t=this._motions.begin();t.notEqual(this._motions.end());){let e=t.ptr();if(e==null){t=this._motions.erase(t);continue}if(e._motion==null){e.release(),e=null,t=this._motions.erase(t);continue}if(e.isFinished())t.preIncrement();else return!1}return!0}isFinishedByHandle(t){for(let e=this._motions.begin();e.notEqual(this._motions.end());e.increment()){const i=e.ptr();if(i!=null&&i._motionQueueEntryHandle==t&&!i.isFinished())return!1}return!0}stopAllMotions(){for(let t=this._motions.begin();t.notEqual(this._motions.end());){let e=t.ptr();if(e==null){t=this._motions.erase(t);continue}e.release(),e=null,t=this._motions.erase(t)}}getCubismMotionQueueEntry(t){for(let e=this._motions.begin();e.notEqual(this._motions.end());e.preIncrement()){const i=e.ptr();if(i!=null&&i._motionQueueEntryHandle==t)return i}return null}setEventCallback(t,e=null){this._eventCallBack=t,this._eventCustomData=e}doUpdateMotion(t,e){let i=!1;for(let s=this._motions.begin();s.notEqual(this._motions.end());){let a=s.ptr();if(a==null){s=this._motions.erase(s);continue}const l=a._motion;if(l==null){a.release(),a=null,s=this._motions.erase(s);continue}l.updateParameters(t,a,e),i=!0;const n=l.getFiredEvent(a.getLastCheckEventSeconds()-a.getStartTime(),e-a.getStartTime());for(let h=0;h<n.getSize();++h)this._eventCallBack(this,n.at(h),this._eventCustomData);a.setLastCheckEventSeconds(e),a.isFinished()?(a.release(),a=null,s=this._motions.erase(s)):(a.isTriggeredFadeOut()&&a.startFadeOut(a.getFadeOutSeconds(),e),s.preIncrement())}return i}}const Ye=-1;var jr;(r=>{r.CubismMotionQueueManager=Ys,r.InvalidMotionQueueEntryHandleValue=Ye})(jr||(jr={}));class xi extends Ys{constructor(){super(),this._currentPriority=0,this._reservePriority=0}getCurrentPriority(){return this._currentPriority}getReservePriority(){return this._reservePriority}setReservePriority(t){this._reservePriority=t}startMotionPriority(t,e,i){return i==this._reservePriority&&(this._reservePriority=0),this._currentPriority=i,super.startMotion(t,e,this._userTimeSeconds)}updateMotion(t,e){this._userTimeSeconds+=e;const i=super.doUpdateMotion(t,this._userTimeSeconds);return this.isFinished()&&(this._currentPriority=0),i}reserveMotion(t){return t<=this._reservePriority||t<=this._currentPriority?!1:(this._reservePriority=t,!0)}}var Gr;(r=>{r.CubismMotionManager=xi})(Gr||(Gr={}));var je=(r=>(r[r.CubismPhysicsTargetType_Parameter=0]="CubismPhysicsTargetType_Parameter",r))(je||{}),At=(r=>(r[r.CubismPhysicsSource_X=0]="CubismPhysicsSource_X",r[r.CubismPhysicsSource_Y=1]="CubismPhysicsSource_Y",r[r.CubismPhysicsSource_Angle=2]="CubismPhysicsSource_Angle",r))(At||{});class Io{constructor(){this.gravity=new k(0,0),this.wind=new k(0,0)}}class Ti{}class vi{}class js{constructor(){this.initialPosition=new k(0,0),this.position=new k(0,0),this.lastPosition=new k(0,0),this.lastGravity=new k(0,0),this.force=new k(0,0),this.velocity=new k(0,0)}}class Gs{constructor(){this.normalizationPosition=new vi,this.normalizationAngle=new vi}}class Hs{constructor(){this.source=new Ti}}class $s{constructor(){this.destination=new Ti,this.translationScale=new k(0,0)}}class Ws{constructor(){this.settings=new L,this.inputs=new L,this.outputs=new L,this.particles=new L,this.gravity=new k(0,0),this.wind=new k(0,0),this.fps=0}}var Hr;(r=>{r.CubismPhysicsInput=Hs,r.CubismPhysicsNormalization=vi,r.CubismPhysicsOutput=$s,r.CubismPhysicsParameter=Ti,r.CubismPhysicsParticle=js,r.CubismPhysicsRig=Ws,r.CubismPhysicsSource=At,r.CubismPhysicsSubRig=Gs,r.CubismPhysicsTargetType=je,r.PhysicsJsonEffectiveForces=Io})(Hr||(Hr={}));const ce="Position",di="X",_i="Y",fi="Angle",$r="Type",Wr="Id",Mt="Meta",De="EffectiveForces",Ro="TotalInputCount",To="TotalOutputCount",Vo="PhysicsSettingCount",qr="Gravity",Jr="Wind",Eo="VertexCount",Ao="Fps",J="PhysicsSettings",Wt="Normalization",Kr="Minimum",Zr="Maximum",Qr="Default",ts="Reflect",es="Weight",ge="Input",Fo="Source",Lt="Output",Do="Scale",Lo="VertexIndex",Oo="Destination",Ot="Vertices",ko="Mobility",No="Delay",Uo="Radius",zo="Acceleration";class qs{constructor(t,e){this._json=at.create(t,e)}release(){at.delete(this._json)}getGravity(){const t=new k(0,0);return t.x=this._json.getRoot().getValueByString(Mt).getValueByString(De).getValueByString(qr).getValueByString(di).toFloat(),t.y=this._json.getRoot().getValueByString(Mt).getValueByString(De).getValueByString(qr).getValueByString(_i).toFloat(),t}getWind(){const t=new k(0,0);return t.x=this._json.getRoot().getValueByString(Mt).getValueByString(De).getValueByString(Jr).getValueByString(di).toFloat(),t.y=this._json.getRoot().getValueByString(Mt).getValueByString(De).getValueByString(Jr).getValueByString(_i).toFloat(),t}getFps(){return this._json.getRoot().getValueByString(Mt).getValueByString(Ao).toFloat(0)}getSubRigCount(){return this._json.getRoot().getValueByString(Mt).getValueByString(Vo).toInt()}getTotalInputCount(){return this._json.getRoot().getValueByString(Mt).getValueByString(Ro).toInt()}getTotalOutputCount(){return this._json.getRoot().getValueByString(Mt).getValueByString(To).toInt()}getVertexCount(){return this._json.getRoot().getValueByString(Mt).getValueByString(Eo).toInt()}getNormalizationPositionMinimumValue(t){return this._json.getRoot().getValueByString(J).getValueByIndex(t).getValueByString(Wt).getValueByString(ce).getValueByString(Kr).toFloat()}getNormalizationPositionMaximumValue(t){return this._json.getRoot().getValueByString(J).getValueByIndex(t).getValueByString(Wt).getValueByString(ce).getValueByString(Zr).toFloat()}getNormalizationPositionDefaultValue(t){return this._json.getRoot().getValueByString(J).getValueByIndex(t).getValueByString(Wt).getValueByString(ce).getValueByString(Qr).toFloat()}getNormalizationAngleMinimumValue(t){return this._json.getRoot().getValueByString(J).getValueByIndex(t).getValueByString(Wt).getValueByString(fi).getValueByString(Kr).toFloat()}getNormalizationAngleMaximumValue(t){return this._json.getRoot().getValueByString(J).getValueByIndex(t).getValueByString(Wt).getValueByString(fi).getValueByString(Zr).toFloat()}getNormalizationAngleDefaultValue(t){return this._json.getRoot().getValueByString(J).getValueByIndex(t).getValueByString(Wt).getValueByString(fi).getValueByString(Qr).toFloat()}getInputCount(t){return this._json.getRoot().getValueByString(J).getValueByIndex(t).getValueByString(ge).getVector().getSize()}getInputWeight(t,e){return this._json.getRoot().getValueByString(J).getValueByIndex(t).getValueByString(ge).getValueByIndex(e).getValueByString(es).toFloat()}getInputReflect(t,e){return this._json.getRoot().getValueByString(J).getValueByIndex(t).getValueByString(ge).getValueByIndex(e).getValueByString(ts).toBoolean()}getInputType(t,e){return this._json.getRoot().getValueByString(J).getValueByIndex(t).getValueByString(ge).getValueByIndex(e).getValueByString($r).getRawString()}getInputSourceId(t,e){return Y.getIdManager().getId(this._json.getRoot().getValueByString(J).getValueByIndex(t).getValueByString(ge).getValueByIndex(e).getValueByString(Fo).getValueByString(Wr).getRawString())}getOutputCount(t){return this._json.getRoot().getValueByString(J).getValueByIndex(t).getValueByString(Lt).getVector().getSize()}getOutputVertexIndex(t,e){return this._json.getRoot().getValueByString(J).getValueByIndex(t).getValueByString(Lt).getValueByIndex(e).getValueByString(Lo).toInt()}getOutputAngleScale(t,e){return this._json.getRoot().getValueByString(J).getValueByIndex(t).getValueByString(Lt).getValueByIndex(e).getValueByString(Do).toFloat()}getOutputWeight(t,e){return this._json.getRoot().getValueByString(J).getValueByIndex(t).getValueByString(Lt).getValueByIndex(e).getValueByString(es).toFloat()}getOutputDestinationId(t,e){return Y.getIdManager().getId(this._json.getRoot().getValueByString(J).getValueByIndex(t).getValueByString(Lt).getValueByIndex(e).getValueByString(Oo).getValueByString(Wr).getRawString())}getOutputType(t,e){return this._json.getRoot().getValueByString(J).getValueByIndex(t).getValueByString(Lt).getValueByIndex(e).getValueByString($r).getRawString()}getOutputReflect(t,e){return this._json.getRoot().getValueByString(J).getValueByIndex(t).getValueByString(Lt).getValueByIndex(e).getValueByString(ts).toBoolean()}getParticleCount(t){return this._json.getRoot().getValueByString(J).getValueByIndex(t).getValueByString(Ot).getVector().getSize()}getParticleMobility(t,e){return this._json.getRoot().getValueByString(J).getValueByIndex(t).getValueByString(Ot).getValueByIndex(e).getValueByString(ko).toFloat()}getParticleDelay(t,e){return this._json.getRoot().getValueByString(J).getValueByIndex(t).getValueByString(Ot).getValueByIndex(e).getValueByString(No).toFloat()}getParticleAcceleration(t,e){return this._json.getRoot().getValueByString(J).getValueByIndex(t).getValueByString(Ot).getValueByIndex(e).getValueByString(zo).toFloat()}getParticleRadius(t,e){return this._json.getRoot().getValueByString(J).getValueByIndex(t).getValueByString(Ot).getValueByIndex(e).getValueByString(Uo).toFloat()}getParticlePosition(t,e){const i=new k(0,0);return i.x=this._json.getRoot().getValueByString(J).getValueByIndex(t).getValueByString(Ot).getValueByIndex(e).getValueByString(ce).getValueByString(di).toFloat(),i.y=this._json.getRoot().getValueByString(J).getValueByIndex(t).getValueByString(Ot).getValueByIndex(e).getValueByString(ce).getValueByString(_i).toFloat(),i}}var is;(r=>{r.CubismPhysicsJson=qs})(is||(is={}));const rs="X",ss="Y",as="Angle",Xo=5,Ci=100,ns=.001,Yo=5;class Ce{static create(t,e){const i=new Ce;return i.parse(t,e),i._physicsRig.gravity.y=0,i}static delete(t){t!=null&&(t.release(),t=null)}parse(t,e){this._physicsRig=new Ws;let i=new qs(t,e);this._physicsRig.gravity=i.getGravity(),this._physicsRig.wind=i.getWind(),this._physicsRig.subRigCount=i.getSubRigCount(),this._physicsRig.fps=i.getFps(),this._physicsRig.settings.updateSize(this._physicsRig.subRigCount,Gs,!0),this._physicsRig.inputs.updateSize(i.getTotalInputCount(),Hs,!0),this._physicsRig.outputs.updateSize(i.getTotalOutputCount(),$s,!0),this._physicsRig.particles.updateSize(i.getVertexCount(),js,!0),this._currentRigOutputs.clear(),this._previousRigOutputs.clear();let s=0,a=0,l=0;for(let n=0;n<this._physicsRig.settings.getSize();++n){this._physicsRig.settings.at(n).normalizationPosition.minimum=i.getNormalizationPositionMinimumValue(n),this._physicsRig.settings.at(n).normalizationPosition.maximum=i.getNormalizationPositionMaximumValue(n),this._physicsRig.settings.at(n).normalizationPosition.defalut=i.getNormalizationPositionDefaultValue(n),this._physicsRig.settings.at(n).normalizationAngle.minimum=i.getNormalizationAngleMinimumValue(n),this._physicsRig.settings.at(n).normalizationAngle.maximum=i.getNormalizationAngleMaximumValue(n),this._physicsRig.settings.at(n).normalizationAngle.defalut=i.getNormalizationAngleDefaultValue(n),this._physicsRig.settings.at(n).inputCount=i.getInputCount(n),this._physicsRig.settings.at(n).baseInputIndex=s;for(let d=0;d<this._physicsRig.settings.at(n).inputCount;++d)this._physicsRig.inputs.at(s+d).sourceParameterIndex=-1,this._physicsRig.inputs.at(s+d).weight=i.getInputWeight(n,d),this._physicsRig.inputs.at(s+d).reflect=i.getInputReflect(n,d),i.getInputType(n,d)==rs?(this._physicsRig.inputs.at(s+d).type=At.CubismPhysicsSource_X,this._physicsRig.inputs.at(s+d).getNormalizedParameterValue=Go):i.getInputType(n,d)==ss?(this._physicsRig.inputs.at(s+d).type=At.CubismPhysicsSource_Y,this._physicsRig.inputs.at(s+d).getNormalizedParameterValue=Ho):i.getInputType(n,d)==as&&(this._physicsRig.inputs.at(s+d).type=At.CubismPhysicsSource_Angle,this._physicsRig.inputs.at(s+d).getNormalizedParameterValue=$o),this._physicsRig.inputs.at(s+d).source.targetType=je.CubismPhysicsTargetType_Parameter,this._physicsRig.inputs.at(s+d).source.id=i.getInputSourceId(n,d);s+=this._physicsRig.settings.at(n).inputCount,this._physicsRig.settings.at(n).outputCount=i.getOutputCount(n),this._physicsRig.settings.at(n).baseOutputIndex=a;const h=new os;h.outputs.resize(this._physicsRig.settings.at(n).outputCount);const c=new os;c.outputs.resize(this._physicsRig.settings.at(n).outputCount);for(let d=0;d<this._physicsRig.settings.at(n).outputCount;++d)h.outputs.set(d,0),c.outputs.set(d,0),this._physicsRig.outputs.at(a+d).destinationParameterIndex=-1,this._physicsRig.outputs.at(a+d).vertexIndex=i.getOutputVertexIndex(n,d),this._physicsRig.outputs.at(a+d).angleScale=i.getOutputAngleScale(n,d),this._physicsRig.outputs.at(a+d).weight=i.getOutputWeight(n,d),this._physicsRig.outputs.at(a+d).destination.targetType=je.CubismPhysicsTargetType_Parameter,this._physicsRig.outputs.at(a+d).destination.id=i.getOutputDestinationId(n,d),i.getOutputType(n,d)==rs?(this._physicsRig.outputs.at(a+d).type=At.CubismPhysicsSource_X,this._physicsRig.outputs.at(a+d).getValue=Wo,this._physicsRig.outputs.at(a+d).getScale=Qo):i.getOutputType(n,d)==ss?(this._physicsRig.outputs.at(a+d).type=At.CubismPhysicsSource_Y,this._physicsRig.outputs.at(a+d).getValue=qo,this._physicsRig.outputs.at(a+d).getScale=tl):i.getOutputType(n,d)==as&&(this._physicsRig.outputs.at(a+d).type=At.CubismPhysicsSource_Angle,this._physicsRig.outputs.at(a+d).getValue=Jo,this._physicsRig.outputs.at(a+d).getScale=el),this._physicsRig.outputs.at(a+d).reflect=i.getOutputReflect(n,d);this._currentRigOutputs.pushBack(h),this._previousRigOutputs.pushBack(c),a+=this._physicsRig.settings.at(n).outputCount,this._physicsRig.settings.at(n).particleCount=i.getParticleCount(n),this._physicsRig.settings.at(n).baseParticleIndex=l;for(let d=0;d<this._physicsRig.settings.at(n).particleCount;++d)this._physicsRig.particles.at(l+d).mobility=i.getParticleMobility(n,d),this._physicsRig.particles.at(l+d).delay=i.getParticleDelay(n,d),this._physicsRig.particles.at(l+d).acceleration=i.getParticleAcceleration(n,d),this._physicsRig.particles.at(l+d).radius=i.getParticleRadius(n,d),this._physicsRig.particles.at(l+d).position=i.getParticlePosition(n,d);l+=this._physicsRig.settings.at(n).particleCount}this.initialize(),i.release(),i=void 0,i=null}stabilization(t){var M,C;let e,i,s,a;const l=new k;let n,h,c,d,m,x,S,p;m=t.getModel().parameters.values,x=t.getModel().parameters.maximumValues,S=t.getModel().parameters.minimumValues,p=t.getModel().parameters.defaultValues,(((M=this._parameterCaches)==null?void 0:M.length)??0)<t.getParameterCount()&&(this._parameterCaches=new Float32Array(t.getParameterCount())),(((C=this._parameterInputCaches)==null?void 0:C.length)??0)<t.getParameterCount()&&(this._parameterInputCaches=new Float32Array(t.getParameterCount()));for(let E=0;E<t.getParameterCount();++E)this._parameterCaches[E]=m[E],this._parameterInputCaches[E]=m[E];for(let E=0;E<this._physicsRig.subRigCount;++E){e={angle:0},l.x=0,l.y=0,n=this._physicsRig.settings.at(E),h=this._physicsRig.inputs.get(n.baseInputIndex),c=this._physicsRig.outputs.get(n.baseOutputIndex),d=this._physicsRig.particles.get(n.baseParticleIndex);for(let I=0;I<n.inputCount;++I)i=h[I].weight/Ci,h[I].sourceParameterIndex==-1&&(h[I].sourceParameterIndex=t.getParameterIndex(h[I].source.id)),h[I].getNormalizedParameterValue(l,e,m[h[I].sourceParameterIndex],S[h[I].sourceParameterIndex],x[h[I].sourceParameterIndex],p[h[I].sourceParameterIndex],n.normalizationPosition,n.normalizationAngle,h[I].reflect,i),this._parameterCaches[h[I].sourceParameterIndex]=m[h[I].sourceParameterIndex];s=N.degreesToRadian(-e.angle),l.x=l.x*N.cos(s)-l.y*N.sin(s),l.y=l.x*N.sin(s)+l.y*N.cos(s),rl(d,n.particleCount,l,e.angle,this._options.wind,ns*n.normalizationPosition.maximum);for(let I=0;I<n.outputCount;++I){const U=c[I].vertexIndex;if(c[I].destinationParameterIndex==-1&&(c[I].destinationParameterIndex=t.getParameterIndex(c[I].destination.id)),U<1||U>=n.particleCount)continue;let A=new k;A=d[U].position.substract(d[U-1].position),a=c[I].getValue(A,d,U,c[I].reflect,this._options.gravity),this._currentRigOutputs.at(E).outputs.set(I,a),this._previousRigOutputs.at(E).outputs.set(I,a);const B=c[I].destinationParameterIndex,R=!Float32Array.prototype.slice&&"subarray"in Float32Array.prototype?JSON.parse(JSON.stringify(m.subarray(B))):m.slice(B);mi(R,S[B],x[B],a,c[I]);for(let D=B,z=0;D<this._parameterCaches.length;D++,z++)m[D]=this._parameterCaches[D]=R[z]}}}evaluate(t,e){var I,U;let i,s,a,l;const n=new k;let h,c,d,m;if(0>=e)return;let x,S,p,M,C;if(this._currentRemainTime+=e,this._currentRemainTime>Yo&&(this._currentRemainTime=0),x=t.getModel().parameters.values,S=t.getModel().parameters.maximumValues,p=t.getModel().parameters.minimumValues,M=t.getModel().parameters.defaultValues,(((I=this._parameterCaches)==null?void 0:I.length)??0)<t.getParameterCount()&&(this._parameterCaches=new Float32Array(t.getParameterCount())),(((U=this._parameterInputCaches)==null?void 0:U.length)??0)<t.getParameterCount()){this._parameterInputCaches=new Float32Array(t.getParameterCount());for(let A=0;A<t.getParameterCount();++A)this._parameterInputCaches[A]=x[A]}for(this._physicsRig.fps>0?C=1/this._physicsRig.fps:C=e;this._currentRemainTime>=C;){for(let B=0;B<this._physicsRig.subRigCount;++B){h=this._physicsRig.settings.at(B),d=this._physicsRig.outputs.get(h.baseOutputIndex);for(let R=0;R<h.outputCount;++R)this._previousRigOutputs.at(B).outputs.set(R,this._currentRigOutputs.at(B).outputs.at(R))}const A=C/this._currentRemainTime;for(let B=0;B<t.getParameterCount();++B)this._parameterCaches[B]=this._parameterInputCaches[B]*(1-A)+x[B]*A,this._parameterInputCaches[B]=this._parameterCaches[B];for(let B=0;B<this._physicsRig.subRigCount;++B){i={angle:0},n.x=0,n.y=0,h=this._physicsRig.settings.at(B),c=this._physicsRig.inputs.get(h.baseInputIndex),d=this._physicsRig.outputs.get(h.baseOutputIndex),m=this._physicsRig.particles.get(h.baseParticleIndex);for(let R=0;R<h.inputCount;++R)s=c[R].weight/Ci,c[R].sourceParameterIndex==-1&&(c[R].sourceParameterIndex=t.getParameterIndex(c[R].source.id)),c[R].getNormalizedParameterValue(n,i,this._parameterCaches[c[R].sourceParameterIndex],p[c[R].sourceParameterIndex],S[c[R].sourceParameterIndex],M[c[R].sourceParameterIndex],h.normalizationPosition,h.normalizationAngle,c[R].reflect,s);a=N.degreesToRadian(-i.angle),n.x=n.x*N.cos(a)-n.y*N.sin(a),n.y=n.x*N.sin(a)+n.y*N.cos(a),il(m,h.particleCount,n,i.angle,this._options.wind,ns*h.normalizationPosition.maximum,C,Xo);for(let R=0;R<h.outputCount;++R){const D=d[R].vertexIndex;if(d[R].destinationParameterIndex==-1&&(d[R].destinationParameterIndex=t.getParameterIndex(d[R].destination.id)),D<1||D>=h.particleCount)continue;const z=new k;z.x=m[D].position.x-m[D-1].position.x,z.y=m[D].position.y-m[D-1].position.y,l=d[R].getValue(z,m,D,d[R].reflect,this._options.gravity),this._currentRigOutputs.at(B).outputs.set(R,l);const $=d[R].destinationParameterIndex,Q=!Float32Array.prototype.slice&&"subarray"in Float32Array.prototype?JSON.parse(JSON.stringify(this._parameterCaches.subarray($))):this._parameterCaches.slice($);mi(Q,p[$],S[$],l,d[R]);for(let et=$,rt=0;et<this._parameterCaches.length;et++,rt++)this._parameterCaches[et]=Q[rt]}}this._currentRemainTime-=C}const E=this._currentRemainTime/C;this.interpolate(t,E)}interpolate(t,e){let i,s,a,l,n;a=t.getModel().parameters.values,l=t.getModel().parameters.maximumValues,n=t.getModel().parameters.minimumValues;for(let h=0;h<this._physicsRig.subRigCount;++h){s=this._physicsRig.settings.at(h),i=this._physicsRig.outputs.get(s.baseOutputIndex);for(let c=0;c<s.outputCount;++c){if(i[c].destinationParameterIndex==-1)continue;const d=i[c].destinationParameterIndex,m=!Float32Array.prototype.slice&&"subarray"in Float32Array.prototype?JSON.parse(JSON.stringify(a.subarray(d))):a.slice(d);mi(m,n[d],l[d],this._previousRigOutputs.at(h).outputs.at(c)*(1-e)+this._currentRigOutputs.at(h).outputs.at(c)*e,i[c]);for(let x=d,S=0;x<a.length;x++,S++)a[x]=m[S]}}}setOptions(t){this._options=t}getOption(){return this._options}constructor(){this._physicsRig=null,this._options=new Js,this._options.gravity.y=-1,this._options.gravity.x=0,this._options.wind.x=0,this._options.wind.y=0,this._currentRigOutputs=new L,this._previousRigOutputs=new L,this._currentRemainTime=0,this._parameterCaches=null,this._parameterInputCaches=null}release(){this._physicsRig=void 0,this._physicsRig=null}initialize(){let t,e,i;for(let s=0;s<this._physicsRig.subRigCount;++s){e=this._physicsRig.settings.at(s),t=this._physicsRig.particles.get(e.baseParticleIndex),t[0].initialPosition=new k(0,0),t[0].lastPosition=new k(t[0].initialPosition.x,t[0].initialPosition.y),t[0].lastGravity=new k(0,-1),t[0].lastGravity.y*=-1,t[0].velocity=new k(0,0),t[0].force=new k(0,0);for(let a=1;a<e.particleCount;++a)i=new k(0,0),i.y=t[a].radius,t[a].initialPosition=new k(t[a-1].initialPosition.x+i.x,t[a-1].initialPosition.y+i.y),t[a].position=new k(t[a].initialPosition.x,t[a].initialPosition.y),t[a].lastPosition=new k(t[a].initialPosition.x,t[a].initialPosition.y),t[a].lastGravity=new k(0,-1),t[a].lastGravity.y*=-1,t[a].velocity=new k(0,0),t[a].force=new k(0,0)}}}class Js{constructor(){this.gravity=new k(0,0),this.wind=new k(0,0)}}class os{constructor(){this.outputs=new L(0)}}function jo(r){let t=0;return r>0?t=1:r<0&&(t=-1),t}function Go(r,t,e,i,s,a,l,n,h,c){r.x+=Vi(e,i,s,a,l.minimum,l.maximum,l.defalut,h)*c}function Ho(r,t,e,i,s,a,l,n,h,c){r.y+=Vi(e,i,s,a,l.minimum,l.maximum,l.defalut,h)*c}function $o(r,t,e,i,s,a,l,n,h,c){t.angle+=Vi(e,i,s,a,n.minimum,n.maximum,n.defalut,h)*c}function Wo(r,t,e,i,s){let a=r.x;return i&&(a*=-1),a}function qo(r,t,e,i,s){let a=r.y;return i&&(a*=-1),a}function Jo(r,t,e,i,s){let a;return e>=2?s=t[e-1].position.substract(t[e-2].position):s=s.multiplyByScaler(-1),a=N.directionToRadian(s,r),i&&(a*=-1),a}function Ko(r,t){const e=N.max(r,t),i=N.min(r,t);return N.abs(e-i)}function Zo(r,t){return N.min(r,t)+Ko(r,t)/2}function Qo(r,t){return JSON.parse(JSON.stringify(r.x))}function tl(r,t){return JSON.parse(JSON.stringify(r.y))}function el(r,t){return JSON.parse(JSON.stringify(t))}function il(r,t,e,i,s,a,l,n){let h,c,d,m,x=new k(0,0),S=new k(0,0),p=new k(0,0),M=new k(0,0);r[0].position=new k(e.x,e.y),h=N.degreesToRadian(i),m=N.radianToDirection(h),m.normalize();for(let C=1;C<t;++C)r[C].force=m.multiplyByScaler(r[C].acceleration).add(s),r[C].lastPosition=new k(r[C].position.x,r[C].position.y),c=r[C].delay*l*30,x=r[C].position.substract(r[C-1].position),d=N.directionToRadian(r[C].lastGravity,m)/n,x.x=N.cos(d)*x.x-x.y*N.sin(d),x.y=N.sin(d)*x.x+x.y*N.cos(d),r[C].position=r[C-1].position.add(x),S=r[C].velocity.multiplyByScaler(c),p=r[C].force.multiplyByScaler(c).multiplyByScaler(c),r[C].position=r[C].position.add(S).add(p),M=r[C].position.substract(r[C-1].position),M.normalize(),r[C].position=r[C-1].position.add(M.multiplyByScaler(r[C].radius)),N.abs(r[C].position.x)<a&&(r[C].position.x=0),c!=0&&(r[C].velocity=r[C].position.substract(r[C].lastPosition),r[C].velocity=r[C].velocity.divisionByScalar(c),r[C].velocity=r[C].velocity.multiplyByScaler(r[C].mobility)),r[C].force=new k(0,0),r[C].lastGravity=new k(m.x,m.y)}function rl(r,t,e,i,s,a){let l,n,h=new k(0,0);r[0].position=new k(e.x,e.y),l=N.degreesToRadian(i),n=N.radianToDirection(l),n.normalize();for(let c=1;c<t;++c)r[c].force=n.multiplyByScaler(r[c].acceleration).add(s),r[c].lastPosition=new k(r[c].position.x,r[c].position.y),r[c].velocity=new k(0,0),h=r[c].force,h.normalize(),h=h.multiplyByScaler(r[c].radius),r[c].position=r[c-1].position.add(h),N.abs(r[c].position.x)<a&&(r[c].position.x=0),r[c].force=new k(0,0),r[c].lastGravity=new k(n.x,n.y)}function mi(r,t,e,i,s){let a,l,n;a=s.getScale(s.translationScale,s.angleScale),l=i*a,l<t?(l<s.valueBelowMinimum&&(s.valueBelowMinimum=l),l=t):l>e&&(l>s.valueExceededMaximum&&(s.valueExceededMaximum=l),l=e),n=s.weight/Ci,n>=1||(l=r[0]*(1-n)+l*n),r[0]=l}function Vi(r,t,e,i,s,a,l,n){let h=0;const c=N.max(e,t);c<r&&(r=c);const d=N.min(e,t);d>r&&(r=d);const m=N.min(s,a),x=N.max(s,a),S=l,p=Zo(d,c),M=r-p;switch(jo(M)){case 1:{const C=x-S,E=c-p;E!=0&&(h=M*(C/E),h+=S);break}case-1:{const C=m-S,E=d-p;E!=0&&(h=M*(C/E),h+=S);break}case 0:{h=S;break}}return n?h:h*-1}var ls;(r=>{r.CubismPhysics=Ce,r.Options=Js})(ls||(ls={}));class Ge{constructor(t,e,i,s){this.x=t,this.y=e,this.width=i,this.height=s}getCenterX(){return this.x+.5*this.width}getCenterY(){return this.y+.5*this.height}getRight(){return this.x+this.width}getBottom(){return this.y+this.height}setRect(t){this.x=t.x,this.y=t.y,this.width=t.width,this.height=t.height}expand(t,e){this.x-=t,this.y-=e,this.width+=t*2,this.height+=e*2}}var us;(r=>{r.csmRect=Ge})(us||(us={}));const Le=4,sl=36,al=32,nl=10;let kt,wt,He;class Bi{getChannelFlagAsColor(t){return this._channelColors.at(t)}getMaskRenderTexture(){if(this._maskTexture&&this._maskTexture.textures!=null)this._maskTexture.frameNo=this._currentFrameNo;else{this._maskRenderTextures!=null&&this._maskRenderTextures.clear(),this._maskRenderTextures=new L,this._maskColorBuffers!=null&&this._maskColorBuffers.clear(),this._maskColorBuffers=new L;const t=this._clippingMaskBufferSize;for(let e=0;e<this._renderTextureCount;e++)this._maskColorBuffers.pushBack(this.gl.createTexture()),this.gl.bindTexture(this.gl.TEXTURE_2D,this._maskColorBuffers.at(e)),this.gl.texImage2D(this.gl.TEXTURE_2D,0,this.gl.RGBA,t,t,0,this.gl.RGBA,this.gl.UNSIGNED_BYTE,null),this.gl.texParameteri(this.gl.TEXTURE_2D,this.gl.TEXTURE_WRAP_S,this.gl.CLAMP_TO_EDGE),this.gl.texParameteri(this.gl.TEXTURE_2D,this.gl.TEXTURE_WRAP_T,this.gl.CLAMP_TO_EDGE),this.gl.texParameteri(this.gl.TEXTURE_2D,this.gl.TEXTURE_MIN_FILTER,this.gl.LINEAR),this.gl.texParameteri(this.gl.TEXTURE_2D,this.gl.TEXTURE_MAG_FILTER,this.gl.LINEAR),this.gl.bindTexture(this.gl.TEXTURE_2D,null),this._maskRenderTextures.pushBack(this.gl.createFramebuffer()),this.gl.bindFramebuffer(this.gl.FRAMEBUFFER,this._maskRenderTextures.at(e)),this.gl.framebufferTexture2D(this.gl.FRAMEBUFFER,this.gl.COLOR_ATTACHMENT0,this.gl.TEXTURE_2D,this._maskColorBuffers.at(e),0);this.gl.bindFramebuffer(this.gl.FRAMEBUFFER,He),this._maskTexture=new Ks(this._currentFrameNo,this._maskRenderTextures)}return this._maskTexture.textures}setGL(t){this.gl=t}calcClippedDrawTotalBounds(t,e){let i=Number.MAX_VALUE,s=Number.MAX_VALUE,a=Number.MIN_VALUE,l=Number.MIN_VALUE;const n=e._clippedDrawableIndexList.length;for(let h=0;h<n;h++){const c=e._clippedDrawableIndexList[h],d=t.getDrawableVertexCount(c),m=t.getDrawableVertices(c);let x=Number.MAX_VALUE,S=Number.MAX_VALUE,p=-Number.MAX_VALUE,M=-Number.MAX_VALUE;const C=d*Dt.vertexStep;for(let E=Dt.vertexOffset;E<C;E+=Dt.vertexStep){const I=m[E],U=m[E+1];I<x&&(x=I),I>p&&(p=I),U<S&&(S=U),U>M&&(M=U)}if(x!=Number.MAX_VALUE)if(x<i&&(i=x),S<s&&(s=S),p>a&&(a=p),M>l&&(l=M),i==Number.MAX_VALUE)e._allClippedDrawRect.x=0,e._allClippedDrawRect.y=0,e._allClippedDrawRect.width=0,e._allClippedDrawRect.height=0,e._isUsing=!1;else{e._isUsing=!0;const E=a-i,I=l-s;e._allClippedDrawRect.x=i,e._allClippedDrawRect.y=s,e._allClippedDrawRect.width=E,e._allClippedDrawRect.height=I}}}constructor(){this._currentMaskRenderTexture=null,this._maskColorBuffers=null,this._currentFrameNo=0,this._renderTextureCount=0,this._clippingMaskBufferSize=256,this._clippingContextListForMask=new L,this._clippingContextListForDraw=new L,this._channelColors=new L,this._tmpBoundsOnModel=new Ge,this._tmpMatrix=new Z,this._tmpMatrixForMask=new Z,this._tmpMatrixForDraw=new Z,this._maskTexture=null;let t=new ut;t.R=1,t.G=0,t.B=0,t.A=0,this._channelColors.pushBack(t),t=new ut,t.R=0,t.G=1,t.B=0,t.A=0,this._channelColors.pushBack(t),t=new ut,t.R=0,t.G=0,t.B=1,t.A=0,this._channelColors.pushBack(t),t=new ut,t.R=0,t.G=0,t.B=0,t.A=1,this._channelColors.pushBack(t)}release(){for(let t=0;t<this._clippingContextListForMask.getSize();t++)this._clippingContextListForMask.at(t)&&(this._clippingContextListForMask.at(t).release(),this._clippingContextListForMask.set(t,void 0)),this._clippingContextListForMask.set(t,null);this._clippingContextListForMask=null;for(let t=0;t<this._clippingContextListForDraw.getSize();t++)this._clippingContextListForDraw.set(t,null);if(this._clippingContextListForDraw=null,this._maskTexture){for(let t=0;t<this._maskTexture.textures.getSize();t++)this.gl.deleteFramebuffer(this._maskTexture.textures.at(t));this._maskTexture.textures.clear(),this._maskTexture.textures=null,this._maskTexture=null}for(let t=0;t<this._channelColors.getSize();t++)this._channelColors.set(t,null);if(this._channelColors=null,this._maskColorBuffers!=null){for(let t=0;t<this._maskColorBuffers.getSize();t++)this.gl.deleteTexture(this._maskColorBuffers.at(t));this._maskColorBuffers.clear()}this._maskColorBuffers=null,this._maskRenderTextures!=null&&this._maskRenderTextures.clear(),this._maskRenderTextures=null,this._clearedFrameBufferflags!=null&&this._clearedFrameBufferflags.clear(),this._clearedFrameBufferflags=null}initialize(t,e,i,s,a){a%1!=0&&(Ft("The number of render textures must be specified as an integer. The decimal point is rounded down and corrected to an integer."),a=~~a),a<1&&Ft("The number of render textures must be an integer greater than or equal to 1. Set the number of render textures to 1."),this._renderTextureCount=a<1?1:a,this._clearedFrameBufferflags=new L(this._renderTextureCount);for(let l=0;l<e;l++){if(s[l]<=0){this._clippingContextListForDraw.pushBack(null);continue}let n=this.findSameClip(i[l],s[l]);n==null&&(n=new Zs(this,i[l],s[l]),this._clippingContextListForMask.pushBack(n)),n.addClippedDrawable(l),this._clippingContextListForDraw.pushBack(n)}}setupClippingContext(t,e){this._currentFrameNo++;let i=0;for(let s=0;s<this._clippingContextListForMask.getSize();s++){const a=this._clippingContextListForMask.at(s);this.calcClippedDrawTotalBounds(t,a),a._isUsing&&i++}if(i>0){this.setupLayoutBounds(e.isUsingHighPrecisionMask()?0:i),e.isUsingHighPrecisionMask()||(this.gl.viewport(0,0,this._clippingMaskBufferSize,this._clippingMaskBufferSize),this._currentMaskRenderTexture=this.getMaskRenderTexture().at(0),e.preDraw(),this.gl.bindFramebuffer(this.gl.FRAMEBUFFER,this._currentMaskRenderTexture)),this._clearedFrameBufferflags.getSize()!=this._renderTextureCount&&(this._clearedFrameBufferflags.clear(),this._clearedFrameBufferflags=new L(this._renderTextureCount));for(let s=0;s<this._clearedFrameBufferflags.getSize();s++)this._clearedFrameBufferflags.set(s,!1);for(let s=0;s<this._clippingContextListForMask.getSize();s++){const a=this._clippingContextListForMask.at(s),l=a._allClippedDrawRect,n=a._layoutBounds,h=.05;let c=0,d=0;const m=this.getMaskRenderTexture().at(a._bufferIndex);if(this._currentMaskRenderTexture!=m&&!e.isUsingHighPrecisionMask()&&(this._currentMaskRenderTexture=m,e.preDraw(),this.gl.bindFramebuffer(this.gl.FRAMEBUFFER,this._currentMaskRenderTexture)),e.isUsingHighPrecisionMask()){const x=t.getPixelsPerUnit(),S=a.getClippingManager()._clippingMaskBufferSize,p=n.width*S,M=n.height*S;this._tmpBoundsOnModel.setRect(l),this._tmpBoundsOnModel.width*x>p?(this._tmpBoundsOnModel.expand(l.width*h,0),c=n.width/this._tmpBoundsOnModel.width):c=x/p,this._tmpBoundsOnModel.height*x>M?(this._tmpBoundsOnModel.expand(0,l.height*h),d=n.height/this._tmpBoundsOnModel.height):d=x/M}else this._tmpBoundsOnModel.setRect(l),this._tmpBoundsOnModel.expand(l.width*h,l.height*h),c=n.width/this._tmpBoundsOnModel.width,d=n.height/this._tmpBoundsOnModel.height;if(this._tmpMatrix.loadIdentity(),this._tmpMatrix.translateRelative(-1,-1),this._tmpMatrix.scaleRelative(2,2),this._tmpMatrix.translateRelative(n.x,n.y),this._tmpMatrix.scaleRelative(c,d),this._tmpMatrix.translateRelative(-this._tmpBoundsOnModel.x,-this._tmpBoundsOnModel.y),this._tmpMatrixForMask.setMatrix(this._tmpMatrix.getArray()),this._tmpMatrix.loadIdentity(),this._tmpMatrix.translateRelative(n.x,n.y),this._tmpMatrix.scaleRelative(c,d),this._tmpMatrix.translateRelative(-this._tmpBoundsOnModel.x,-this._tmpBoundsOnModel.y),this._tmpMatrixForDraw.setMatrix(this._tmpMatrix.getArray()),a._matrixForMask.setMatrix(this._tmpMatrixForMask.getArray()),a._matrixForDraw.setMatrix(this._tmpMatrixForDraw.getArray()),!e.isUsingHighPrecisionMask()){const x=a._clippingIdCount;for(let S=0;S<x;S++){const p=a._clippingIdList[S];t.getDrawableDynamicFlagVertexPositionsDidChange(p)&&(e.setIsCulling(t.getDrawableCulling(p)!=!1),this._clearedFrameBufferflags.at(a._bufferIndex)||(this.gl.clearColor(1,1,1,1),this.gl.clear(this.gl.COLOR_BUFFER_BIT),this._clearedFrameBufferflags.set(a._bufferIndex,!0)),e.setClippingContextBufferForMask(a),e.drawMesh(t.getDrawableTextureIndex(p),t.getDrawableVertexIndexCount(p),t.getDrawableVertexCount(p),t.getDrawableVertexIndices(p),t.getDrawableVertices(p),t.getDrawableVertexUvs(p),t.getMultiplyColor(p),t.getScreenColor(p),t.getDrawableOpacity(p),Bt.CubismBlendMode_Normal,!1))}}}e.isUsingHighPrecisionMask()||(this.gl.bindFramebuffer(this.gl.FRAMEBUFFER,He),e.setClippingContextBufferForMask(null),this.gl.viewport(wt[0],wt[1],wt[2],wt[3]))}}findSameClip(t,e){for(let i=0;i<this._clippingContextListForMask.getSize();i++){const s=this._clippingContextListForMask.at(i),a=s._clippingIdCount;if(a!=e)continue;let l=0;for(let n=0;n<a;n++){const h=s._clippingIdList[n];for(let c=0;c<a;c++)if(t[c]==h){l++;break}}if(l==a)return s}return null}setupLayoutBounds(t){const e=this._renderTextureCount<=1?sl:al*this._renderTextureCount;if(t<=0||t>e){t>e&&lt(`not supported mask count : {0}
[Details] render texture count : {1}, mask count : {2}`,t-e,this._renderTextureCount,t);for(let c=0;c<this._clippingContextListForMask.getSize();c++){const d=this._clippingContextListForMask.at(c);d._layoutChannelNo=0,d._layoutBounds.x=0,d._layoutBounds.y=0,d._layoutBounds.width=1,d._layoutBounds.height=1,d._bufferIndex=0}return}const i=this._renderTextureCount<=1?9:8;let s=t/this._renderTextureCount,a=t%this._renderTextureCount;s=~~s,a=~~a;let l=s/Le,n=s%Le;l=~~l,n=~~n;let h=0;for(let c=0;c<this._renderTextureCount;c++)for(let d=0;d<Le;d++){let m=l+(d<n?1:0);const x=n+1>=Le?0:n+1;if(m<i&&d==x&&(m+=c<a?1:0),m!=0)if(m==1){const S=this._clippingContextListForMask.at(h++);S._layoutChannelNo=d,S._layoutBounds.x=0,S._layoutBounds.y=0,S._layoutBounds.width=1,S._layoutBounds.height=1,S._bufferIndex=c}else if(m==2)for(let S=0;S<m;S++){let p=S%2;p=~~p;const M=this._clippingContextListForMask.at(h++);M._layoutChannelNo=d,M._layoutBounds.x=p*.5,M._layoutBounds.y=0,M._layoutBounds.width=.5,M._layoutBounds.height=1,M._bufferIndex=c}else if(m<=4)for(let S=0;S<m;S++){let p=S%2,M=S/2;p=~~p,M=~~M;const C=this._clippingContextListForMask.at(h++);C._layoutChannelNo=d,C._layoutBounds.x=p*.5,C._layoutBounds.y=M*.5,C._layoutBounds.width=.5,C._layoutBounds.height=.5,C._bufferIndex=c}else if(m<=i)for(let S=0;S<m;S++){let p=S%3,M=S/3;p=~~p,M=~~M;const C=this._clippingContextListForMask.at(h++);C._layoutChannelNo=d,C._layoutBounds.x=p/3,C._layoutBounds.y=M/3,C._layoutBounds.width=1/3,C._layoutBounds.height=1/3,C._bufferIndex=c}else{lt(`not supported mask count : {0}
[Details] render texture count : {1}, mask count : {2}`,t-e,this._renderTextureCount,t);for(let S=0;S<m;S++){const p=this._clippingContextListForMask.at(h++);p._layoutChannelNo=0,p._layoutBounds.x=0,p._layoutBounds.y=0,p._layoutBounds.width=1,p._layoutBounds.height=1,p._bufferIndex=0}}}}getColorBuffer(){return this._maskColorBuffers}getClippingContextListForDraw(){return this._clippingContextListForDraw}getClippingMaskCount(){return this._clippingContextListForMask.getSize()}setClippingMaskBufferSize(t){this._clippingMaskBufferSize=t}getClippingMaskBufferSize(){return this._clippingMaskBufferSize}getRenderTextureCount(){return this._renderTextureCount}}class Ks{constructor(t,e){this.frameNo=t,this.textures=e}}class Zs{constructor(t,e,i){this._owner=t,this._clippingIdList=e,this._clippingIdCount=i,this._allClippedDrawRect=new Ge,this._layoutBounds=new Ge,this._clippedDrawableIndexList=[],this._matrixForMask=new Z,this._matrixForDraw=new Z,this._bufferIndex=0}release(){this._layoutBounds!=null&&(this._layoutBounds=null),this._allClippedDrawRect!=null&&(this._allClippedDrawRect=null),this._clippedDrawableIndexList!=null&&(this._clippedDrawableIndexList=null)}addClippedDrawable(t){this._clippedDrawableIndexList.push(t)}getClippingManager(){return this._owner}setGl(t){this._owner.setGL(t)}}class ol{setGlEnable(t,e){e?this.gl.enable(t):this.gl.disable(t)}setGlEnableVertexAttribArray(t,e){e?this.gl.enableVertexAttribArray(t):this.gl.disableVertexAttribArray(t)}save(){if(this.gl==null){lt(`'gl' is null. WebGLRenderingContext is required.
Please call 'CubimRenderer_WebGL.startUp' function.`);return}this._lastArrayBufferBinding=this.gl.getParameter(this.gl.ARRAY_BUFFER_BINDING),this._lastArrayBufferBinding=this.gl.getParameter(this.gl.ELEMENT_ARRAY_BUFFER_BINDING),this._lastProgram=this.gl.getParameter(this.gl.CURRENT_PROGRAM),this._lastActiveTexture=this.gl.getParameter(this.gl.ACTIVE_TEXTURE),this.gl.activeTexture(this.gl.TEXTURE1),this._lastTexture1Binding2D=this.gl.getParameter(this.gl.TEXTURE_BINDING_2D),this.gl.activeTexture(this.gl.TEXTURE0),this._lastTexture0Binding2D=this.gl.getParameter(this.gl.TEXTURE_BINDING_2D),this._lastVertexAttribArrayEnabled[0]=this.gl.getVertexAttrib(0,this.gl.VERTEX_ATTRIB_ARRAY_ENABLED),this._lastVertexAttribArrayEnabled[1]=this.gl.getVertexAttrib(1,this.gl.VERTEX_ATTRIB_ARRAY_ENABLED),this._lastVertexAttribArrayEnabled[2]=this.gl.getVertexAttrib(2,this.gl.VERTEX_ATTRIB_ARRAY_ENABLED),this._lastVertexAttribArrayEnabled[3]=this.gl.getVertexAttrib(3,this.gl.VERTEX_ATTRIB_ARRAY_ENABLED),this._lastScissorTest=this.gl.isEnabled(this.gl.SCISSOR_TEST),this._lastStencilTest=this.gl.isEnabled(this.gl.STENCIL_TEST),this._lastDepthTest=this.gl.isEnabled(this.gl.DEPTH_TEST),this._lastCullFace=this.gl.isEnabled(this.gl.CULL_FACE),this._lastBlend=this.gl.isEnabled(this.gl.BLEND),this._lastFrontFace=this.gl.getParameter(this.gl.FRONT_FACE),this._lastColorMask=this.gl.getParameter(this.gl.COLOR_WRITEMASK),this._lastBlending[0]=this.gl.getParameter(this.gl.BLEND_SRC_RGB),this._lastBlending[1]=this.gl.getParameter(this.gl.BLEND_DST_RGB),this._lastBlending[2]=this.gl.getParameter(this.gl.BLEND_SRC_ALPHA),this._lastBlending[3]=this.gl.getParameter(this.gl.BLEND_DST_ALPHA),this._lastFBO=this.gl.getParameter(this.gl.FRAMEBUFFER_BINDING),this._lastViewport=this.gl.getParameter(this.gl.VIEWPORT)}restore(){if(this.gl==null){lt(`'gl' is null. WebGLRenderingContext is required.
Please call 'CubimRenderer_WebGL.startUp' function.`);return}this.gl.useProgram(this._lastProgram),this.setGlEnableVertexAttribArray(0,this._lastVertexAttribArrayEnabled[0]),this.setGlEnableVertexAttribArray(1,this._lastVertexAttribArrayEnabled[1]),this.setGlEnableVertexAttribArray(2,this._lastVertexAttribArrayEnabled[2]),this.setGlEnableVertexAttribArray(3,this._lastVertexAttribArrayEnabled[3]),this.setGlEnable(this.gl.SCISSOR_TEST,this._lastScissorTest),this.setGlEnable(this.gl.STENCIL_TEST,this._lastStencilTest),this.setGlEnable(this.gl.DEPTH_TEST,this._lastDepthTest),this.setGlEnable(this.gl.CULL_FACE,this._lastCullFace),this.setGlEnable(this.gl.BLEND,this._lastBlend),this.gl.frontFace(this._lastFrontFace),this.gl.colorMask(this._lastColorMask[0],this._lastColorMask[1],this._lastColorMask[2],this._lastColorMask[3]),this.gl.bindBuffer(this.gl.ARRAY_BUFFER,this._lastArrayBufferBinding),this.gl.bindBuffer(this.gl.ELEMENT_ARRAY_BUFFER,this._lastElementArrayBufferBinding),this.gl.activeTexture(this.gl.TEXTURE1),this.gl.bindTexture(this.gl.TEXTURE_2D,this._lastTexture1Binding2D),this.gl.activeTexture(this.gl.TEXTURE0),this.gl.bindTexture(this.gl.TEXTURE_2D,this._lastTexture0Binding2D),this.gl.activeTexture(this._lastActiveTexture),this.gl.blendFuncSeparate(this._lastBlending[0],this._lastBlending[1],this._lastBlending[2],this._lastBlending[3])}setGl(t){this.gl=t}constructor(){this._lastVertexAttribArrayEnabled=new Array(4),this._lastColorMask=new Array(4),this._lastBlending=new Array(4),this._lastViewport=new Array(4)}}class re{static getInstance(){return kt==null&&(kt=new re),kt}static deleteInstance(){kt&&(kt.release(),kt=null)}constructor(){this._shaderSets=new L}release(){this.releaseShaderProgram()}setupShaderProgram(t,e,i,s,a,l,n,h,c,d,m,x,S,p,M){S||lt("NoPremultipliedAlpha is not allowed"),this._shaderSets.getSize()==0&&this.generateShaders();let C,E,I,U;if(t.getClippingContextBufferForMask()!=null){const A=this._shaderSets.at(0);this.gl.useProgram(A.shaderProgram),this.gl.activeTexture(this.gl.TEXTURE0),this.gl.bindTexture(this.gl.TEXTURE_2D,e),this.gl.uniform1i(A.samplerTexture0Location,0),n.vertex==null&&(n.vertex=this.gl.createBuffer()),this.gl.bindBuffer(this.gl.ARRAY_BUFFER,n.vertex),this.gl.bufferData(this.gl.ARRAY_BUFFER,s,this.gl.DYNAMIC_DRAW),this.gl.enableVertexAttribArray(A.attributePositionLocation),this.gl.vertexAttribPointer(A.attributePositionLocation,2,this.gl.FLOAT,!1,0,0),n.uv==null&&(n.uv=this.gl.createBuffer()),this.gl.bindBuffer(this.gl.ARRAY_BUFFER,n.uv),this.gl.bufferData(this.gl.ARRAY_BUFFER,l,this.gl.DYNAMIC_DRAW),this.gl.enableVertexAttribArray(A.attributeTexCoordLocation),this.gl.vertexAttribPointer(A.attributeTexCoordLocation,2,this.gl.FLOAT,!1,0,0);const B=t.getClippingContextBufferForMask()._layoutChannelNo,R=t.getClippingContextBufferForMask().getClippingManager().getChannelFlagAsColor(B);this.gl.uniform4f(A.uniformChannelFlagLocation,R.R,R.G,R.B,R.A),this.gl.uniformMatrix4fv(A.uniformClipMatrixLocation,!1,t.getClippingContextBufferForMask()._matrixForMask.getArray());const D=t.getClippingContextBufferForMask()._layoutBounds;this.gl.uniform4f(A.uniformBaseColorLocation,D.x*2-1,D.y*2-1,D.getRight()*2-1,D.getBottom()*2-1),this.gl.uniform4f(A.uniformMultiplyColorLocation,m.R,m.G,m.B,m.A),this.gl.uniform4f(A.uniformScreenColorLocation,x.R,x.G,x.B,x.A),C=this.gl.ZERO,E=this.gl.ONE_MINUS_SRC_COLOR,I=this.gl.ZERO,U=this.gl.ONE_MINUS_SRC_ALPHA}else{const A=t.getClippingContextBufferForDraw()!=null,B=A?M?2:1:0;let R=new bi;switch(c){case Bt.CubismBlendMode_Normal:default:R=this._shaderSets.at(1+B),C=this.gl.ONE,E=this.gl.ONE_MINUS_SRC_ALPHA,I=this.gl.ONE,U=this.gl.ONE_MINUS_SRC_ALPHA;break;case Bt.CubismBlendMode_Additive:R=this._shaderSets.at(4+B),C=this.gl.ONE,E=this.gl.ONE,I=this.gl.ZERO,U=this.gl.ONE;break;case Bt.CubismBlendMode_Multiplicative:R=this._shaderSets.at(7+B),C=this.gl.DST_COLOR,E=this.gl.ONE_MINUS_SRC_ALPHA,I=this.gl.ZERO,U=this.gl.ONE;break}if(this.gl.useProgram(R.shaderProgram),n.vertex==null&&(n.vertex=this.gl.createBuffer()),this.gl.bindBuffer(this.gl.ARRAY_BUFFER,n.vertex),this.gl.bufferData(this.gl.ARRAY_BUFFER,s,this.gl.DYNAMIC_DRAW),this.gl.enableVertexAttribArray(R.attributePositionLocation),this.gl.vertexAttribPointer(R.attributePositionLocation,2,this.gl.FLOAT,!1,0,0),n.uv==null&&(n.uv=this.gl.createBuffer()),this.gl.bindBuffer(this.gl.ARRAY_BUFFER,n.uv),this.gl.bufferData(this.gl.ARRAY_BUFFER,l,this.gl.DYNAMIC_DRAW),this.gl.enableVertexAttribArray(R.attributeTexCoordLocation),this.gl.vertexAttribPointer(R.attributeTexCoordLocation,2,this.gl.FLOAT,!1,0,0),A){this.gl.activeTexture(this.gl.TEXTURE1);const D=t.getClippingContextBufferForDraw().getClippingManager().getColorBuffer().at(t.getClippingContextBufferForDraw()._bufferIndex);this.gl.bindTexture(this.gl.TEXTURE_2D,D),this.gl.uniform1i(R.samplerTexture1Location,1),this.gl.uniformMatrix4fv(R.uniformClipMatrixLocation,!1,t.getClippingContextBufferForDraw()._matrixForDraw.getArray());const z=t.getClippingContextBufferForDraw()._layoutChannelNo,$=t.getClippingContextBufferForDraw().getClippingManager().getChannelFlagAsColor(z);this.gl.uniform4f(R.uniformChannelFlagLocation,$.R,$.G,$.B,$.A)}this.gl.activeTexture(this.gl.TEXTURE0),this.gl.bindTexture(this.gl.TEXTURE_2D,e),this.gl.uniform1i(R.samplerTexture0Location,0),this.gl.uniformMatrix4fv(R.uniformMatrixLocation,!1,p.getArray()),this.gl.uniform4f(R.uniformBaseColorLocation,d.R,d.G,d.B,d.A),this.gl.uniform4f(R.uniformMultiplyColorLocation,m.R,m.G,m.B,m.A),this.gl.uniform4f(R.uniformScreenColorLocation,x.R,x.G,x.B,x.A)}n.index==null&&(n.index=this.gl.createBuffer()),this.gl.bindBuffer(this.gl.ELEMENT_ARRAY_BUFFER,n.index),this.gl.bufferData(this.gl.ELEMENT_ARRAY_BUFFER,a,this.gl.DYNAMIC_DRAW),this.gl.blendFuncSeparate(C,E,I,U)}releaseShaderProgram(){for(let t=0;t<this._shaderSets.getSize();t++)this.gl.deleteProgram(this._shaderSets.at(t).shaderProgram),this._shaderSets.at(t).shaderProgram=0,this._shaderSets.set(t,void 0),this._shaderSets.set(t,null)}generateShaders(){for(let t=0;t<nl;t++)this._shaderSets.pushBack(new bi);this._shaderSets.at(0).shaderProgram=this.loadShaderProgram(ll,ul),this._shaderSets.at(1).shaderProgram=this.loadShaderProgram(hl,cl),this._shaderSets.at(2).shaderProgram=this.loadShaderProgram(hs,gl),this._shaderSets.at(3).shaderProgram=this.loadShaderProgram(hs,dl),this._shaderSets.at(4).shaderProgram=this._shaderSets.at(1).shaderProgram,this._shaderSets.at(5).shaderProgram=this._shaderSets.at(2).shaderProgram,this._shaderSets.at(6).shaderProgram=this._shaderSets.at(3).shaderProgram,this._shaderSets.at(7).shaderProgram=this._shaderSets.at(1).shaderProgram,this._shaderSets.at(8).shaderProgram=this._shaderSets.at(2).shaderProgram,this._shaderSets.at(9).shaderProgram=this._shaderSets.at(3).shaderProgram,this._shaderSets.at(0).attributePositionLocation=this.gl.getAttribLocation(this._shaderSets.at(0).shaderProgram,"a_position"),this._shaderSets.at(0).attributeTexCoordLocation=this.gl.getAttribLocation(this._shaderSets.at(0).shaderProgram,"a_texCoord"),this._shaderSets.at(0).samplerTexture0Location=this.gl.getUniformLocation(this._shaderSets.at(0).shaderProgram,"s_texture0"),this._shaderSets.at(0).uniformClipMatrixLocation=this.gl.getUniformLocation(this._shaderSets.at(0).shaderProgram,"u_clipMatrix"),this._shaderSets.at(0).uniformChannelFlagLocation=this.gl.getUniformLocation(this._shaderSets.at(0).shaderProgram,"u_channelFlag"),this._shaderSets.at(0).uniformBaseColorLocation=this.gl.getUniformLocation(this._shaderSets.at(0).shaderProgram,"u_baseColor"),this._shaderSets.at(0).uniformMultiplyColorLocation=this.gl.getUniformLocation(this._shaderSets.at(0).shaderProgram,"u_multiplyColor"),this._shaderSets.at(0).uniformScreenColorLocation=this.gl.getUniformLocation(this._shaderSets.at(0).shaderProgram,"u_screenColor"),this._shaderSets.at(1).attributePositionLocation=this.gl.getAttribLocation(this._shaderSets.at(1).shaderProgram,"a_position"),this._shaderSets.at(1).attributeTexCoordLocation=this.gl.getAttribLocation(this._shaderSets.at(1).shaderProgram,"a_texCoord"),this._shaderSets.at(1).samplerTexture0Location=this.gl.getUniformLocation(this._shaderSets.at(1).shaderProgram,"s_texture0"),this._shaderSets.at(1).uniformMatrixLocation=this.gl.getUniformLocation(this._shaderSets.at(1).shaderProgram,"u_matrix"),this._shaderSets.at(1).uniformBaseColorLocation=this.gl.getUniformLocation(this._shaderSets.at(1).shaderProgram,"u_baseColor"),this._shaderSets.at(1).uniformMultiplyColorLocation=this.gl.getUniformLocation(this._shaderSets.at(1).shaderProgram,"u_multiplyColor"),this._shaderSets.at(1).uniformScreenColorLocation=this.gl.getUniformLocation(this._shaderSets.at(1).shaderProgram,"u_screenColor"),this._shaderSets.at(2).attributePositionLocation=this.gl.getAttribLocation(this._shaderSets.at(2).shaderProgram,"a_position"),this._shaderSets.at(2).attributeTexCoordLocation=this.gl.getAttribLocation(this._shaderSets.at(2).shaderProgram,"a_texCoord"),this._shaderSets.at(2).samplerTexture0Location=this.gl.getUniformLocation(this._shaderSets.at(2).shaderProgram,"s_texture0"),this._shaderSets.at(2).samplerTexture1Location=this.gl.getUniformLocation(this._shaderSets.at(2).shaderProgram,"s_texture1"),this._shaderSets.at(2).uniformMatrixLocation=this.gl.getUniformLocation(this._shaderSets.at(2).shaderProgram,"u_matrix"),this._shaderSets.at(2).uniformClipMatrixLocation=this.gl.getUniformLocation(this._shaderSets.at(2).shaderProgram,"u_clipMatrix"),this._shaderSets.at(2).uniformChannelFlagLocation=this.gl.getUniformLocation(this._shaderSets.at(2).shaderProgram,"u_channelFlag"),this._shaderSets.at(2).uniformBaseColorLocation=this.gl.getUniformLocation(this._shaderSets.at(2).shaderProgram,"u_baseColor"),this._shaderSets.at(2).uniformMultiplyColorLocation=this.gl.getUniformLocation(this._shaderSets.at(2).shaderProgram,"u_multiplyColor"),this._shaderSets.at(2).uniformScreenColorLocation=this.gl.getUniformLocation(this._shaderSets.at(2).shaderProgram,"u_screenColor"),this._shaderSets.at(3).attributePositionLocation=this.gl.getAttribLocation(this._shaderSets.at(3).shaderProgram,"a_position"),this._shaderSets.at(3).attributeTexCoordLocation=this.gl.getAttribLocation(this._shaderSets.at(3).shaderProgram,"a_texCoord"),this._shaderSets.at(3).samplerTexture0Location=this.gl.getUniformLocation(this._shaderSets.at(3).shaderProgram,"s_texture0"),this._shaderSets.at(3).samplerTexture1Location=this.gl.getUniformLocation(this._shaderSets.at(3).shaderProgram,"s_texture1"),this._shaderSets.at(3).uniformMatrixLocation=this.gl.getUniformLocation(this._shaderSets.at(3).shaderProgram,"u_matrix"),this._shaderSets.at(3).uniformClipMatrixLocation=this.gl.getUniformLocation(this._shaderSets.at(3).shaderProgram,"u_clipMatrix"),this._shaderSets.at(3).uniformChannelFlagLocation=this.gl.getUniformLocation(this._shaderSets.at(3).shaderProgram,"u_channelFlag"),this._shaderSets.at(3).uniformBaseColorLocation=this.gl.getUniformLocation(this._shaderSets.at(3).shaderProgram,"u_baseColor"),this._shaderSets.at(3).uniformMultiplyColorLocation=this.gl.getUniformLocation(this._shaderSets.at(3).shaderProgram,"u_multiplyColor"),this._shaderSets.at(3).uniformScreenColorLocation=this.gl.getUniformLocation(this._shaderSets.at(3).shaderProgram,"u_screenColor"),this._shaderSets.at(4).attributePositionLocation=this.gl.getAttribLocation(this._shaderSets.at(4).shaderProgram,"a_position"),this._shaderSets.at(4).attributeTexCoordLocation=this.gl.getAttribLocation(this._shaderSets.at(4).shaderProgram,"a_texCoord"),this._shaderSets.at(4).samplerTexture0Location=this.gl.getUniformLocation(this._shaderSets.at(4).shaderProgram,"s_texture0"),this._shaderSets.at(4).uniformMatrixLocation=this.gl.getUniformLocation(this._shaderSets.at(4).shaderProgram,"u_matrix"),this._shaderSets.at(4).uniformBaseColorLocation=this.gl.getUniformLocation(this._shaderSets.at(4).shaderProgram,"u_baseColor"),this._shaderSets.at(4).uniformMultiplyColorLocation=this.gl.getUniformLocation(this._shaderSets.at(4).shaderProgram,"u_multiplyColor"),this._shaderSets.at(4).uniformScreenColorLocation=this.gl.getUniformLocation(this._shaderSets.at(4).shaderProgram,"u_screenColor"),this._shaderSets.at(5).attributePositionLocation=this.gl.getAttribLocation(this._shaderSets.at(5).shaderProgram,"a_position"),this._shaderSets.at(5).attributeTexCoordLocation=this.gl.getAttribLocation(this._shaderSets.at(5).shaderProgram,"a_texCoord"),this._shaderSets.at(5).samplerTexture0Location=this.gl.getUniformLocation(this._shaderSets.at(5).shaderProgram,"s_texture0"),this._shaderSets.at(5).samplerTexture1Location=this.gl.getUniformLocation(this._shaderSets.at(5).shaderProgram,"s_texture1"),this._shaderSets.at(5).uniformMatrixLocation=this.gl.getUniformLocation(this._shaderSets.at(5).shaderProgram,"u_matrix"),this._shaderSets.at(5).uniformClipMatrixLocation=this.gl.getUniformLocation(this._shaderSets.at(5).shaderProgram,"u_clipMatrix"),this._shaderSets.at(5).uniformChannelFlagLocation=this.gl.getUniformLocation(this._shaderSets.at(5).shaderProgram,"u_channelFlag"),this._shaderSets.at(5).uniformBaseColorLocation=this.gl.getUniformLocation(this._shaderSets.at(5).shaderProgram,"u_baseColor"),this._shaderSets.at(5).uniformMultiplyColorLocation=this.gl.getUniformLocation(this._shaderSets.at(5).shaderProgram,"u_multiplyColor"),this._shaderSets.at(5).uniformScreenColorLocation=this.gl.getUniformLocation(this._shaderSets.at(5).shaderProgram,"u_screenColor"),this._shaderSets.at(6).attributePositionLocation=this.gl.getAttribLocation(this._shaderSets.at(6).shaderProgram,"a_position"),this._shaderSets.at(6).attributeTexCoordLocation=this.gl.getAttribLocation(this._shaderSets.at(6).shaderProgram,"a_texCoord"),this._shaderSets.at(6).samplerTexture0Location=this.gl.getUniformLocation(this._shaderSets.at(6).shaderProgram,"s_texture0"),this._shaderSets.at(6).samplerTexture1Location=this.gl.getUniformLocation(this._shaderSets.at(6).shaderProgram,"s_texture1"),this._shaderSets.at(6).uniformMatrixLocation=this.gl.getUniformLocation(this._shaderSets.at(6).shaderProgram,"u_matrix"),this._shaderSets.at(6).uniformClipMatrixLocation=this.gl.getUniformLocation(this._shaderSets.at(6).shaderProgram,"u_clipMatrix"),this._shaderSets.at(6).uniformChannelFlagLocation=this.gl.getUniformLocation(this._shaderSets.at(6).shaderProgram,"u_channelFlag"),this._shaderSets.at(6).uniformBaseColorLocation=this.gl.getUniformLocation(this._shaderSets.at(6).shaderProgram,"u_baseColor"),this._shaderSets.at(6).uniformMultiplyColorLocation=this.gl.getUniformLocation(this._shaderSets.at(6).shaderProgram,"u_multiplyColor"),this._shaderSets.at(6).uniformScreenColorLocation=this.gl.getUniformLocation(this._shaderSets.at(6).shaderProgram,"u_screenColor"),this._shaderSets.at(7).attributePositionLocation=this.gl.getAttribLocation(this._shaderSets.at(7).shaderProgram,"a_position"),this._shaderSets.at(7).attributeTexCoordLocation=this.gl.getAttribLocation(this._shaderSets.at(7).shaderProgram,"a_texCoord"),this._shaderSets.at(7).samplerTexture0Location=this.gl.getUniformLocation(this._shaderSets.at(7).shaderProgram,"s_texture0"),this._shaderSets.at(7).uniformMatrixLocation=this.gl.getUniformLocation(this._shaderSets.at(7).shaderProgram,"u_matrix"),this._shaderSets.at(7).uniformBaseColorLocation=this.gl.getUniformLocation(this._shaderSets.at(7).shaderProgram,"u_baseColor"),this._shaderSets.at(7).uniformMultiplyColorLocation=this.gl.getUniformLocation(this._shaderSets.at(7).shaderProgram,"u_multiplyColor"),this._shaderSets.at(7).uniformScreenColorLocation=this.gl.getUniformLocation(this._shaderSets.at(7).shaderProgram,"u_screenColor"),this._shaderSets.at(8).attributePositionLocation=this.gl.getAttribLocation(this._shaderSets.at(8).shaderProgram,"a_position"),this._shaderSets.at(8).attributeTexCoordLocation=this.gl.getAttribLocation(this._shaderSets.at(8).shaderProgram,"a_texCoord"),this._shaderSets.at(8).samplerTexture0Location=this.gl.getUniformLocation(this._shaderSets.at(8).shaderProgram,"s_texture0"),this._shaderSets.at(8).samplerTexture1Location=this.gl.getUniformLocation(this._shaderSets.at(8).shaderProgram,"s_texture1"),this._shaderSets.at(8).uniformMatrixLocation=this.gl.getUniformLocation(this._shaderSets.at(8).shaderProgram,"u_matrix"),this._shaderSets.at(8).uniformClipMatrixLocation=this.gl.getUniformLocation(this._shaderSets.at(8).shaderProgram,"u_clipMatrix"),this._shaderSets.at(8).uniformChannelFlagLocation=this.gl.getUniformLocation(this._shaderSets.at(8).shaderProgram,"u_channelFlag"),this._shaderSets.at(8).uniformBaseColorLocation=this.gl.getUniformLocation(this._shaderSets.at(8).shaderProgram,"u_baseColor"),this._shaderSets.at(8).uniformMultiplyColorLocation=this.gl.getUniformLocation(this._shaderSets.at(8).shaderProgram,"u_multiplyColor"),this._shaderSets.at(8).uniformScreenColorLocation=this.gl.getUniformLocation(this._shaderSets.at(8).shaderProgram,"u_screenColor"),this._shaderSets.at(9).attributePositionLocation=this.gl.getAttribLocation(this._shaderSets.at(9).shaderProgram,"a_position"),this._shaderSets.at(9).attributeTexCoordLocation=this.gl.getAttribLocation(this._shaderSets.at(9).shaderProgram,"a_texCoord"),this._shaderSets.at(9).samplerTexture0Location=this.gl.getUniformLocation(this._shaderSets.at(9).shaderProgram,"s_texture0"),this._shaderSets.at(9).samplerTexture1Location=this.gl.getUniformLocation(this._shaderSets.at(9).shaderProgram,"s_texture1"),this._shaderSets.at(9).uniformMatrixLocation=this.gl.getUniformLocation(this._shaderSets.at(9).shaderProgram,"u_matrix"),this._shaderSets.at(9).uniformClipMatrixLocation=this.gl.getUniformLocation(this._shaderSets.at(9).shaderProgram,"u_clipMatrix"),this._shaderSets.at(9).uniformChannelFlagLocation=this.gl.getUniformLocation(this._shaderSets.at(9).shaderProgram,"u_channelFlag"),this._shaderSets.at(9).uniformBaseColorLocation=this.gl.getUniformLocation(this._shaderSets.at(9).shaderProgram,"u_baseColor"),this._shaderSets.at(9).uniformMultiplyColorLocation=this.gl.getUniformLocation(this._shaderSets.at(9).shaderProgram,"u_multiplyColor"),this._shaderSets.at(9).uniformScreenColorLocation=this.gl.getUniformLocation(this._shaderSets.at(9).shaderProgram,"u_screenColor")}loadShaderProgram(t,e){let i=this.gl.createProgram(),s=this.compileShaderSource(this.gl.VERTEX_SHADER,t);if(!s)return lt("Vertex shader compile error!"),0;let a=this.compileShaderSource(this.gl.FRAGMENT_SHADER,e);return a?(this.gl.attachShader(i,s),this.gl.attachShader(i,a),this.gl.linkProgram(i),this.gl.getProgramParameter(i,this.gl.LINK_STATUS)?(this.gl.deleteShader(s),this.gl.deleteShader(a),i):(lt("Failed to link program: {0}",i),this.gl.deleteShader(s),s=0,this.gl.deleteShader(a),a=0,i&&(this.gl.deleteProgram(i),i=0),0)):(lt("Vertex shader compile error!"),0)}compileShaderSource(t,e){const i=e,s=this.gl.createShader(t);if(this.gl.shaderSource(s,i),this.gl.compileShader(s),!s){const l=this.gl.getShaderInfoLog(s);lt("Shader compile log: {0} ",l)}return this.gl.getShaderParameter(s,this.gl.COMPILE_STATUS)?s:(this.gl.deleteShader(s),null)}setGl(t){this.gl=t}}class bi{}var Qs=(r=>(r[r.ShaderNames_SetupMask=0]="ShaderNames_SetupMask",r[r.ShaderNames_NormalPremultipliedAlpha=1]="ShaderNames_NormalPremultipliedAlpha",r[r.ShaderNames_NormalMaskedPremultipliedAlpha=2]="ShaderNames_NormalMaskedPremultipliedAlpha",r[r.ShaderNames_NomralMaskedInvertedPremultipliedAlpha=3]="ShaderNames_NomralMaskedInvertedPremultipliedAlpha",r[r.ShaderNames_AddPremultipliedAlpha=4]="ShaderNames_AddPremultipliedAlpha",r[r.ShaderNames_AddMaskedPremultipliedAlpha=5]="ShaderNames_AddMaskedPremultipliedAlpha",r[r.ShaderNames_AddMaskedPremultipliedAlphaInverted=6]="ShaderNames_AddMaskedPremultipliedAlphaInverted",r[r.ShaderNames_MultPremultipliedAlpha=7]="ShaderNames_MultPremultipliedAlpha",r[r.ShaderNames_MultMaskedPremultipliedAlpha=8]="ShaderNames_MultMaskedPremultipliedAlpha",r[r.ShaderNames_MultMaskedPremultipliedAlphaInverted=9]="ShaderNames_MultMaskedPremultipliedAlphaInverted",r))(Qs||{});const ll="attribute vec4     a_position;attribute vec2     a_texCoord;varying vec2       v_texCoord;varying vec4       v_myPos;uniform mat4       u_clipMatrix;void main(){   gl_Position = u_clipMatrix * a_position;   v_myPos = u_clipMatrix * a_position;   v_texCoord = a_texCoord;   v_texCoord.y = 1.0 - v_texCoord.y;}",ul="precision mediump float;varying vec2       v_texCoord;varying vec4       v_myPos;uniform vec4       u_baseColor;uniform vec4       u_channelFlag;uniform sampler2D  s_texture0;void main(){   float isInside =        step(u_baseColor.x, v_myPos.x/v_myPos.w)       * step(u_baseColor.y, v_myPos.y/v_myPos.w)       * step(v_myPos.x/v_myPos.w, u_baseColor.z)       * step(v_myPos.y/v_myPos.w, u_baseColor.w);   gl_FragColor = u_channelFlag * texture2D(s_texture0, v_texCoord).a * isInside;}",hl="attribute vec4     a_position;attribute vec2     a_texCoord;varying vec2       v_texCoord;uniform mat4       u_matrix;void main(){   gl_Position = u_matrix * a_position;   v_texCoord = a_texCoord;   v_texCoord.y = 1.0 - v_texCoord.y;}",hs="attribute vec4     a_position;attribute vec2     a_texCoord;varying vec2       v_texCoord;varying vec4       v_clipPos;uniform mat4       u_matrix;uniform mat4       u_clipMatrix;void main(){   gl_Position = u_matrix * a_position;   v_clipPos = u_clipMatrix * a_position;   v_texCoord = a_texCoord;   v_texCoord.y = 1.0 - v_texCoord.y;}",cl="precision mediump float;varying vec2       v_texCoord;uniform vec4       u_baseColor;uniform sampler2D  s_texture0;uniform vec4       u_multiplyColor;uniform vec4       u_screenColor;void main(){   vec4 texColor = texture2D(s_texture0, v_texCoord);   texColor.rgb = texColor.rgb * u_multiplyColor.rgb;   texColor.rgb = (texColor.rgb + u_screenColor.rgb * texColor.a) - (texColor.rgb * u_screenColor.rgb);   vec4 color = texColor * u_baseColor;   gl_FragColor = vec4(color.rgb, color.a);}",gl="precision mediump float;varying vec2       v_texCoord;varying vec4       v_clipPos;uniform vec4       u_baseColor;uniform vec4       u_channelFlag;uniform sampler2D  s_texture0;uniform sampler2D  s_texture1;uniform vec4       u_multiplyColor;uniform vec4       u_screenColor;void main(){   vec4 texColor = texture2D(s_texture0, v_texCoord);   texColor.rgb = texColor.rgb * u_multiplyColor.rgb;   texColor.rgb = (texColor.rgb + u_screenColor.rgb * texColor.a) - (texColor.rgb * u_screenColor.rgb);   vec4 col_formask = texColor * u_baseColor;   vec4 clipMask = (1.0 - texture2D(s_texture1, v_clipPos.xy / v_clipPos.w)) * u_channelFlag;   float maskVal = clipMask.r + clipMask.g + clipMask.b + clipMask.a;   col_formask = col_formask * maskVal;   gl_FragColor = col_formask;}",dl="precision mediump float;varying vec2      v_texCoord;varying vec4      v_clipPos;uniform sampler2D s_texture0;uniform sampler2D s_texture1;uniform vec4      u_channelFlag;uniform vec4      u_baseColor;uniform vec4      u_multiplyColor;uniform vec4      u_screenColor;void main(){   vec4 texColor = texture2D(s_texture0, v_texCoord);   texColor.rgb = texColor.rgb * u_multiplyColor.rgb;   texColor.rgb = (texColor.rgb + u_screenColor.rgb * texColor.a) - (texColor.rgb * u_screenColor.rgb);   vec4 col_formask = texColor * u_baseColor;   vec4 clipMask = (1.0 - texture2D(s_texture1, v_clipPos.xy / v_clipPos.w)) * u_channelFlag;   float maskVal = clipMask.r + clipMask.g + clipMask.b + clipMask.a;   col_formask = col_formask * (1.0 - maskVal);   gl_FragColor = col_formask;}";class Ei extends $e{constructor(){super(),this._clippingContextBufferForMask=null,this._clippingContextBufferForDraw=null,this._rendererProfile=new ol,this.firstDraw=!0,this._textures=new ct,this._sortedDrawableIndexList=new L,this._bufferData={vertex:WebGLBuffer=null,uv:WebGLBuffer=null,index:WebGLBuffer=null},this._textures.prepareCapacity(32,!0)}initialize(t,e=1){t.isUsingMasking()&&(this._clippingManager=new Bi,this._clippingManager.initialize(t,t.getDrawableCount(),t.getDrawableMasks(),t.getDrawableMaskCounts(),e)),this._sortedDrawableIndexList.resize(t.getDrawableCount(),0),super.initialize(t)}bindTexture(t,e){this._textures.setValue(t,e)}getBindedTextures(){return this._textures}setClippingMaskBufferSize(t){if(!this._model.isUsingMasking())return;const e=this._clippingManager.getRenderTextureCount();this._clippingManager.release(),this._clippingManager=void 0,this._clippingManager=null,this._clippingManager=new Bi,this._clippingManager.setClippingMaskBufferSize(t),this._clippingManager.initialize(this.getModel(),this.getModel().getDrawableCount(),this.getModel().getDrawableMasks(),this.getModel().getDrawableMaskCounts(),e)}getClippingMaskBufferSize(){return this._model.isUsingMasking()?this._clippingManager.getClippingMaskBufferSize():-1}getRenderTextureCount(){return this._model.isUsingMasking()?this._clippingManager.getRenderTextureCount():-1}release(){this._clippingManager&&(this._clippingManager.release(),this._clippingManager=void 0,this._clippingManager=null),this.gl!=null&&(this.gl.deleteBuffer(this._bufferData.vertex),this._bufferData.vertex=null,this.gl.deleteBuffer(this._bufferData.uv),this._bufferData.uv=null,this.gl.deleteBuffer(this._bufferData.index),this._bufferData.index=null,this._bufferData=null,this._textures=null)}doDrawModel(){if(this.gl==null){lt(`'gl' is null. WebGLRenderingContext is required.
Please call 'CubimRenderer_WebGL.startUp' function.`);return}this._clippingManager!=null&&(this.preDraw(),this._clippingManager.setupClippingContext(this.getModel(),this)),this.preDraw();const t=this.getModel().getDrawableCount(),e=this.getModel().getDrawableRenderOrders();for(let i=0;i<t;++i){const s=e[i];this._sortedDrawableIndexList.set(s,i)}for(let i=0;i<t;++i){const s=this._sortedDrawableIndexList.at(i);if(!this.getModel().getDrawableDynamicFlagIsVisible(s))continue;const a=this._clippingManager!=null?this._clippingManager.getClippingContextListForDraw().at(s):null;if(a!=null&&this.isUsingHighPrecisionMask()){a._isUsing&&(this.gl.viewport(0,0,this._clippingManager.getClippingMaskBufferSize(),this._clippingManager.getClippingMaskBufferSize()),this.preDraw(),this.gl.bindFramebuffer(this.gl.FRAMEBUFFER,a.getClippingManager().getMaskRenderTexture().at(a._bufferIndex)),this.gl.clearColor(1,1,1,1),this.gl.clear(this.gl.COLOR_BUFFER_BIT));{const l=a._clippingIdCount;for(let n=0;n<l;n++){const h=a._clippingIdList[n];this._model.getDrawableDynamicFlagVertexPositionsDidChange(h)&&(this.setIsCulling(this._model.getDrawableCulling(h)!=!1),this.setClippingContextBufferForMask(a),this.drawMesh(this.getModel().getDrawableTextureIndex(h),this.getModel().getDrawableVertexIndexCount(h),this.getModel().getDrawableVertexCount(h),this.getModel().getDrawableVertexIndices(h),this.getModel().getDrawableVertices(h),this.getModel().getDrawableVertexUvs(h),this.getModel().getMultiplyColor(h),this.getModel().getScreenColor(h),this.getModel().getDrawableOpacity(h),Bt.CubismBlendMode_Normal,!1))}}this.gl.bindFramebuffer(this.gl.FRAMEBUFFER,He),this.setClippingContextBufferForMask(null),this.gl.viewport(wt[0],wt[1],wt[2],wt[3]),this.preDraw()}this.setClippingContextBufferForDraw(a),this.setIsCulling(this.getModel().getDrawableCulling(s)),this.drawMesh(this.getModel().getDrawableTextureIndex(s),this.getModel().getDrawableVertexIndexCount(s),this.getModel().getDrawableVertexCount(s),this.getModel().getDrawableVertexIndices(s),this.getModel().getDrawableVertices(s),this.getModel().getDrawableVertexUvs(s),this.getModel().getMultiplyColor(s),this.getModel().getScreenColor(s),this.getModel().getDrawableOpacity(s),this.getModel().getDrawableBlendMode(s),this.getModel().getDrawableInvertedMaskBit(s))}}drawMesh(t,e,i,s,a,l,n,h,c,d,m){this.isCulling()?this.gl.enable(this.gl.CULL_FACE):this.gl.disable(this.gl.CULL_FACE),this.gl.frontFace(this.gl.CCW);const x=this.getModelColor();this.getClippingContextBufferForMask()==null&&(x.A*=c,this.isPremultipliedAlpha()&&(x.R*=x.A,x.G*=x.A,x.B*=x.A));let S;this._textures.getValue(t)!=null?S=this._textures.getValue(t):S=null,re.getInstance().setupShaderProgram(this,S,i,a,s,l,this._bufferData,c,d,x,n,h,this.isPremultipliedAlpha(),this.getMvpMatrix(),m),this.gl.drawElements(this.gl.TRIANGLES,e,this.gl.UNSIGNED_SHORT,0),this.gl.useProgram(null),this.setClippingContextBufferForDraw(null),this.setClippingContextBufferForMask(null)}saveProfile(){this._rendererProfile.save()}restoreProfile(){this._rendererProfile.restore()}static doStaticRelease(){re.deleteInstance()}setRenderState(t,e){He=t,wt=e}preDraw(){if(this.firstDraw&&(this.firstDraw=!1),this.gl.disable(this.gl.SCISSOR_TEST),this.gl.disable(this.gl.STENCIL_TEST),this.gl.disable(this.gl.DEPTH_TEST),this.gl.frontFace(this.gl.CW),this.gl.enable(this.gl.BLEND),this.gl.colorMask(!0,!0,!0,!0),this.gl.bindBuffer(this.gl.ARRAY_BUFFER,null),this.gl.bindBuffer(this.gl.ELEMENT_ARRAY_BUFFER,null),this.getAnisotropy()>0&&this._extension)for(let t=0;t<this._textures.getSize();++t)this.gl.bindTexture(this.gl.TEXTURE_2D,this._textures.getValue(t)),this.gl.texParameterf(this.gl.TEXTURE_2D,this._extension.TEXTURE_MAX_ANISOTROPY_EXT,this.getAnisotropy())}setClippingContextBufferForMask(t){this._clippingContextBufferForMask=t}getClippingContextBufferForMask(){return this._clippingContextBufferForMask}setClippingContextBufferForDraw(t){this._clippingContextBufferForDraw=t}getClippingContextBufferForDraw(){return this._clippingContextBufferForDraw}startUp(t){this.gl=t,this._clippingManager&&this._clippingManager.setGL(t),re.getInstance().setGl(t),this._rendererProfile.setGl(t),this._extension=this.gl.getExtension("EXT_texture_filter_anisotropic")||this.gl.getExtension("WEBKIT_EXT_texture_filter_anisotropic")||this.gl.getExtension("MOZ_EXT_texture_filter_anisotropic")}}$e.staticRelease=()=>{Ei.doStaticRelease()};var cs;(r=>{r.CubismClippingContext=Zs,r.CubismClippingManager_WebGL=Bi,r.CubismRenderTextureResource=Ks,r.CubismRenderer_WebGL=Ei,r.CubismShaderSet=bi,r.CubismShader_WebGL=re,r.ShaderNames=Qs})(cs||(cs={}));class gs{constructor(t=!1,e=new ut){this.isOverwritten=t,this.Color=e}}class ds{constructor(t=!1,e=new ut){this.isOverwritten=t,this.Color=e}}class _l{constructor(t=!1,e=!1){this.isOverwritten=t,this.isCulling=e}}class ta{update(){this._model.update(),this._model.drawables.resetDynamicFlags()}getPixelsPerUnit(){return this._model==null?0:this._model.canvasinfo.PixelsPerUnit}getCanvasWidth(){return this._model==null?0:this._model.canvasinfo.CanvasWidth/this._model.canvasinfo.PixelsPerUnit}getCanvasHeight(){return this._model==null?0:this._model.canvasinfo.CanvasHeight/this._model.canvasinfo.PixelsPerUnit}saveParameters(){const t=this._model.parameters.count,e=this._savedParameters.getSize();for(let i=0;i<t;++i)i<e?this._savedParameters.set(i,this._parameterValues[i]):this._savedParameters.pushBack(this._parameterValues[i])}getMultiplyColor(t){return this.getOverwriteFlagForModelMultiplyColors()||this.getOverwriteFlagForDrawableMultiplyColors(t)?this._userMultiplyColors.at(t).Color:this.getDrawableMultiplyColor(t)}getScreenColor(t){return this.getOverwriteFlagForModelScreenColors()||this.getOverwriteFlagForDrawableScreenColors(t)?this._userScreenColors.at(t).Color:this.getDrawableScreenColor(t)}setMultiplyColorByTextureColor(t,e){this.setMultiplyColorByRGBA(t,e.R,e.G,e.B,e.A)}setMultiplyColorByRGBA(t,e,i,s,a=1){this._userMultiplyColors.at(t).Color.R=e,this._userMultiplyColors.at(t).Color.G=i,this._userMultiplyColors.at(t).Color.B=s,this._userMultiplyColors.at(t).Color.A=a}setScreenColorByTextureColor(t,e){this.setScreenColorByRGBA(t,e.R,e.G,e.B,e.A)}setScreenColorByRGBA(t,e,i,s,a=1){this._userScreenColors.at(t).Color.R=e,this._userScreenColors.at(t).Color.G=i,this._userScreenColors.at(t).Color.B=s,this._userScreenColors.at(t).Color.A=a}getPartMultiplyColor(t){return this._userPartMultiplyColors.at(t).Color}getPartScreenColor(t){return this._userPartScreenColors.at(t).Color}setPartColor(t,e,i,s,a,l,n){if(l.at(t).Color.R=e,l.at(t).Color.G=i,l.at(t).Color.B=s,l.at(t).Color.A=a,l.at(t).isOverwritten)for(let h=0;h<this._partChildDrawables.at(t).getSize();++h){const c=this._partChildDrawables.at(t).at(h);n.at(c).Color.R=e,n.at(c).Color.G=i,n.at(c).Color.B=s,n.at(c).Color.A=a}}setPartMultiplyColorByTextureColor(t,e){this.setPartMultiplyColorByRGBA(t,e.R,e.G,e.B,e.A)}setPartMultiplyColorByRGBA(t,e,i,s,a){this.setPartColor(t,e,i,s,a,this._userPartMultiplyColors,this._userMultiplyColors)}setPartScreenColorByTextureColor(t,e){this.setPartScreenColorByRGBA(t,e.R,e.G,e.B,e.A)}setPartScreenColorByRGBA(t,e,i,s,a){this.setPartColor(t,e,i,s,a,this._userPartScreenColors,this._userScreenColors)}getOverwriteFlagForModelMultiplyColors(){return this._isOverwrittenModelMultiplyColors}getOverwriteFlagForModelScreenColors(){return this._isOverwrittenModelScreenColors}setOverwriteFlagForModelMultiplyColors(t){this._isOverwrittenModelMultiplyColors=t}setOverwriteFlagForModelScreenColors(t){this._isOverwrittenModelScreenColors=t}getOverwriteFlagForDrawableMultiplyColors(t){return this._userMultiplyColors.at(t).isOverwritten}getOverwriteFlagForDrawableScreenColors(t){return this._userScreenColors.at(t).isOverwritten}setOverwriteFlagForDrawableMultiplyColors(t,e){this._userMultiplyColors.at(t).isOverwritten=e}setOverwriteFlagForDrawableScreenColors(t,e){this._userScreenColors.at(t).isOverwritten=e}getOverwriteColorForPartMultiplyColors(t){return this._userPartMultiplyColors.at(t).isOverwritten}getOverwriteColorForPartScreenColors(t){return this._userPartScreenColors.at(t).isOverwritten}setOverwriteColorForPartColors(t,e,i,s){i.at(t).isOverwritten=e;for(let a=0;a<this._partChildDrawables.at(t).getSize();++a){const l=this._partChildDrawables.at(t).at(a);s.at(l).isOverwritten=e,e&&(s.at(l).Color.R=i.at(t).Color.R,s.at(l).Color.G=i.at(t).Color.G,s.at(l).Color.B=i.at(t).Color.B,s.at(l).Color.A=i.at(t).Color.A)}}setOverwriteColorForPartMultiplyColors(t,e){this._userPartMultiplyColors.at(t).isOverwritten=e,this.setOverwriteColorForPartColors(t,e,this._userPartMultiplyColors,this._userMultiplyColors)}setOverwriteColorForPartScreenColors(t,e){this._userPartScreenColors.at(t).isOverwritten=e,this.setOverwriteColorForPartColors(t,e,this._userPartScreenColors,this._userScreenColors)}getDrawableCulling(t){if(this.getOverwriteFlagForModelCullings()||this.getOverwriteFlagForDrawableCullings(t))return this._userCullings.at(t).isCulling;const e=this._model.drawables.constantFlags;return!Live2DCubismCore.Utils.hasIsDoubleSidedBit(e[t])}setDrawableCulling(t,e){this._userCullings.at(t).isCulling=e}getOverwriteFlagForModelCullings(){return this._isOverwrittenCullings}setOverwriteFlagForModelCullings(t){this._isOverwrittenCullings=t}getOverwriteFlagForDrawableCullings(t){return this._userCullings.at(t).isOverwritten}setOverwriteFlagForDrawableCullings(t,e){this._userCullings.at(t).isOverwritten=e}getModelOapcity(){return this._modelOpacity}setModelOapcity(t){this._modelOpacity=t}getModel(){return this._model}getPartIndex(t){let e;const i=this._model.parts.count;for(e=0;e<i;++e)if(t==this._partIds.at(e))return e;return this._notExistPartId.isExist(t)?this._notExistPartId.getValue(t):(e=i+this._notExistPartId.getSize(),this._notExistPartId.setValue(t,e),this._notExistPartOpacities.appendKey(e),e)}getPartId(t){const e=this._model.parts.ids[t];return Y.getIdManager().getId(e)}getPartCount(){return this._model.parts.count}setPartOpacityByIndex(t,e){if(this._notExistPartOpacities.isExist(t)){this._notExistPartOpacities.setValue(t,e);return}xt(0<=t&&t<this.getPartCount()),this._partOpacities[t]=e}setPartOpacityById(t,e){const i=this.getPartIndex(t);i<0||this.setPartOpacityByIndex(i,e)}getPartOpacityByIndex(t){return this._notExistPartOpacities.isExist(t)?this._notExistPartOpacities.getValue(t):(xt(0<=t&&t<this.getPartCount()),this._partOpacities[t])}getPartOpacityById(t){const e=this.getPartIndex(t);return e<0?0:this.getPartOpacityByIndex(e)}getParameterIndex(t){let e;const i=this._model.parameters.count;for(e=0;e<i;++e)if(t==this._parameterIds.at(e))return e;return this._notExistParameterId.isExist(t)?this._notExistParameterId.getValue(t):(e=this._model.parameters.count+this._notExistParameterId.getSize(),this._notExistParameterId.setValue(t,e),this._notExistParameterValues.appendKey(e),e)}getParameterCount(){return this._model.parameters.count}getParameterType(t){return this._model.parameters.types[t]}getParameterMaximumValue(t){return this._model.parameters.maximumValues[t]}getParameterMinimumValue(t){return this._model.parameters.minimumValues[t]}getParameterDefaultValue(t){return this._model.parameters.defaultValues[t]}getParameterValueByIndex(t){return this._notExistParameterValues.isExist(t)?this._notExistParameterValues.getValue(t):(xt(0<=t&&t<this.getParameterCount()),this._parameterValues[t])}getParameterValueById(t){const e=this.getParameterIndex(t);return this.getParameterValueByIndex(e)}setParameterValueByIndex(t,e,i=1){if(this._notExistParameterValues.isExist(t)){this._notExistParameterValues.setValue(t,i==1?e:this._notExistParameterValues.getValue(t)*(1-i)+e*i);return}xt(0<=t&&t<this.getParameterCount()),this._model.parameters.maximumValues[t]<e&&(e=this._model.parameters.maximumValues[t]),this._model.parameters.minimumValues[t]>e&&(e=this._model.parameters.minimumValues[t]),this._parameterValues[t]=i==1?e:this._parameterValues[t]=this._parameterValues[t]*(1-i)+e*i}setParameterValueById(t,e,i=1){const s=this.getParameterIndex(t);this.setParameterValueByIndex(s,e,i)}addParameterValueByIndex(t,e,i=1){this.setParameterValueByIndex(t,this.getParameterValueByIndex(t)+e*i)}addParameterValueById(t,e,i=1){const s=this.getParameterIndex(t);this.addParameterValueByIndex(s,e,i)}multiplyParameterValueById(t,e,i=1){const s=this.getParameterIndex(t);this.multiplyParameterValueByIndex(s,e,i)}multiplyParameterValueByIndex(t,e,i=1){this.setParameterValueByIndex(t,this.getParameterValueByIndex(t)*(1+(e-1)*i))}getDrawableIndex(t){const e=this._model.drawables.count;for(let i=0;i<e;++i)if(this._drawableIds.at(i)==t)return i;return-1}getDrawableCount(){return this._model.drawables.count}getDrawableId(t){const e=this._model.drawables.ids;return Y.getIdManager().getId(e[t])}getDrawableRenderOrders(){return this._model.drawables.renderOrders}getDrawableTextureIndices(t){return this.getDrawableTextureIndex(t)}getDrawableTextureIndex(t){return this._model.drawables.textureIndices[t]}getDrawableDynamicFlagVertexPositionsDidChange(t){const e=this._model.drawables.dynamicFlags;return Live2DCubismCore.Utils.hasVertexPositionsDidChangeBit(e[t])}getDrawableVertexIndexCount(t){return this._model.drawables.indexCounts[t]}getDrawableVertexCount(t){return this._model.drawables.vertexCounts[t]}getDrawableVertices(t){return this.getDrawableVertexPositions(t)}getDrawableVertexIndices(t){return this._model.drawables.indices[t]}getDrawableVertexPositions(t){return this._model.drawables.vertexPositions[t]}getDrawableVertexUvs(t){return this._model.drawables.vertexUvs[t]}getDrawableOpacity(t){return this._model.drawables.opacities[t]}getDrawableMultiplyColor(t){const e=this._model.drawables.multiplyColors,i=t*4,s=new ut;return s.R=e[i],s.G=e[i+1],s.B=e[i+2],s.A=e[i+3],s}getDrawableScreenColor(t){const e=this._model.drawables.screenColors,i=t*4,s=new ut;return s.R=e[i],s.G=e[i+1],s.B=e[i+2],s.A=e[i+3],s}getDrawableParentPartIndex(t){return this._model.drawables.parentPartIndices[t]}getDrawableBlendMode(t){const e=this._model.drawables.constantFlags;return Live2DCubismCore.Utils.hasBlendAdditiveBit(e[t])?Bt.CubismBlendMode_Additive:Live2DCubismCore.Utils.hasBlendMultiplicativeBit(e[t])?Bt.CubismBlendMode_Multiplicative:Bt.CubismBlendMode_Normal}getDrawableInvertedMaskBit(t){const e=this._model.drawables.constantFlags;return Live2DCubismCore.Utils.hasIsInvertedMaskBit(e[t])}getDrawableMasks(){return this._model.drawables.masks}getDrawableMaskCounts(){return this._model.drawables.maskCounts}isUsingMasking(){for(let t=0;t<this._model.drawables.count;++t)if(!(this._model.drawables.maskCounts[t]<=0))return!0;return!1}getDrawableDynamicFlagIsVisible(t){const e=this._model.drawables.dynamicFlags;return Live2DCubismCore.Utils.hasIsVisibleBit(e[t])}getDrawableDynamicFlagVisibilityDidChange(t){const e=this._model.drawables.dynamicFlags;return Live2DCubismCore.Utils.hasVisibilityDidChangeBit(e[t])}getDrawableDynamicFlagOpacityDidChange(t){const e=this._model.drawables.dynamicFlags;return Live2DCubismCore.Utils.hasOpacityDidChangeBit(e[t])}getDrawableDynamicFlagRenderOrderDidChange(t){const e=this._model.drawables.dynamicFlags;return Live2DCubismCore.Utils.hasRenderOrderDidChangeBit(e[t])}getDrawableDynamicFlagBlendColorDidChange(t){const e=this._model.drawables.dynamicFlags;return Live2DCubismCore.Utils.hasBlendColorDidChangeBit(e[t])}loadParameters(){let t=this._model.parameters.count;const e=this._savedParameters.getSize();t>e&&(t=e);for(let i=0;i<t;++i)this._parameterValues[i]=this._savedParameters.at(i)}initialize(){xt(this._model),this._parameterValues=this._model.parameters.values,this._partOpacities=this._model.parts.opacities,this._parameterMaximumValues=this._model.parameters.maximumValues,this._parameterMinimumValues=this._model.parameters.minimumValues;{const e=this._model.parameters.ids,i=this._model.parameters.count;this._parameterIds.prepareCapacity(i);for(let s=0;s<i;++s)this._parameterIds.pushBack(Y.getIdManager().getId(e[s]))}const t=this._model.parts.count;{const e=this._model.parts.ids;this._partIds.prepareCapacity(t);for(let i=0;i<t;++i)this._partIds.pushBack(Y.getIdManager().getId(e[i]));this._userPartMultiplyColors.prepareCapacity(t),this._userPartScreenColors.prepareCapacity(t),this._partChildDrawables.prepareCapacity(t)}{const e=this._model.drawables.ids,i=this._model.drawables.count;this._userMultiplyColors.prepareCapacity(i),this._userScreenColors.prepareCapacity(i),this._userCullings.prepareCapacity(i);const s=new _l(!1,!1);for(let a=0;a<t;++a){const l=new ut(1,1,1,1),n=new ut(0,0,0,1),h=new ds(!1,l),c=new ds(!1,n);this._userPartMultiplyColors.pushBack(h),this._userPartScreenColors.pushBack(c),this._partChildDrawables.pushBack(new L),this._partChildDrawables.at(a).prepareCapacity(i)}for(let a=0;a<i;++a){const l=new ut(1,1,1,1),n=new ut(0,0,0,1),h=new gs(!1,l),c=new gs(!1,n);this._drawableIds.pushBack(Y.getIdManager().getId(e[a])),this._userMultiplyColors.pushBack(h),this._userScreenColors.pushBack(c),this._userCullings.pushBack(s);const d=this.getDrawableParentPartIndex(a);d>=0&&this._partChildDrawables.at(d).pushBack(a)}}}constructor(t){this._model=t,this._parameterValues=null,this._parameterMaximumValues=null,this._parameterMinimumValues=null,this._partOpacities=null,this._savedParameters=new L,this._parameterIds=new L,this._drawableIds=new L,this._partIds=new L,this._isOverwrittenModelMultiplyColors=!1,this._isOverwrittenModelScreenColors=!1,this._isOverwrittenCullings=!1,this._modelOpacity=1,this._userMultiplyColors=new L,this._userScreenColors=new L,this._userCullings=new L,this._userPartMultiplyColors=new L,this._userPartScreenColors=new L,this._partChildDrawables=new L,this._notExistPartId=new ct,this._notExistParameterId=new ct,this._notExistParameterValues=new ct,this._notExistPartOpacities=new ct}release(){this._model.release(),this._model=null}}var _s;(r=>{r.CubismModel=ta})(_s||(_s={}));class Pe{static create(t,e){let i=null;if(e&&!this.hasMocConsistency(t))return lt("Inconsistent MOC3."),i;const s=Live2DCubismCore.Moc.fromArrayBuffer(t);return s&&(i=new Pe(s),i._mocVersion=Live2DCubismCore.Version.csmGetMocVersion(s,t)),i}static delete(t){t._moc._release(),t._moc=null,t=null}createModel(){let t=null;const e=Live2DCubismCore.Model.fromMoc(this._moc);return e&&(t=new ta(e),t.initialize(),++this._modelCount),t}deleteModel(t){t!=null&&(t.release(),t=null,--this._modelCount)}constructor(t){this._moc=t,this._modelCount=0,this._mocVersion=0}release(){xt(this._modelCount==0),this._moc._release(),this._moc=null}getLatestMocVersion(){return Live2DCubismCore.Version.csmGetLatestMocVersion()}getMocVersion(){return this._mocVersion}static hasMocConsistency(t){return Live2DCubismCore.Moc.prototype.hasMocConsistency(t)===1}}var fs;(r=>{r.CubismMoc=Pe})(fs||(fs={}));const ms="Meta",fl="UserDataCount",ml="TotalUserDataSize",pi="UserData",pl="Target",yl="Id",Sl="Value";class ea{constructor(t,e){this._json=at.create(t,e)}release(){at.delete(this._json)}getUserDataCount(){return this._json.getRoot().getValueByString(ms).getValueByString(fl).toInt()}getTotalUserDataSize(){return this._json.getRoot().getValueByString(ms).getValueByString(ml).toInt()}getUserDataTargetType(t){return this._json.getRoot().getValueByString(pi).getValueByIndex(t).getValueByString(pl).getRawString()}getUserDataId(t){return Y.getIdManager().getId(this._json.getRoot().getValueByString(pi).getValueByIndex(t).getValueByString(yl).getRawString())}getUserDataValue(t){return this._json.getRoot().getValueByString(pi).getValueByIndex(t).getValueByString(Sl).getRawString()}}var ps;(r=>{r.CubismModelUserDataJson=ea})(ps||(ps={}));const xl="ArtMesh";class ia{}class Be{static create(t,e){const i=new Be;return i.parseUserData(t,e),i}static delete(t){t!=null&&(t.release(),t=null)}getArtMeshUserDatas(){return this._artMeshUserDataNode}parseUserData(t,e){let i=new ea(t,e);const s=Y.getIdManager().getId(xl),a=i.getUserDataCount();for(let l=0;l<a;l++){const n=new ia;n.targetId=i.getUserDataId(l),n.targetType=Y.getIdManager().getId(i.getUserDataTargetType(l)),n.value=new _t(i.getUserDataValue(l)),this._userDataNodes.pushBack(n),n.targetType==s&&this._artMeshUserDataNode.pushBack(n)}i.release(),i=void 0}constructor(){this._userDataNodes=new L,this._artMeshUserDataNode=new L}release(){for(let t=0;t<this._userDataNodes.getSize();++t)this._userDataNodes.set(t,null);this._userDataNodes=null}}var ys;(r=>{r.CubismModelUserData=Be,r.CubismModelUserDataNode=ia})(ys||(ys={}));class Je{constructor(){this.loadMotion=(t,e,i,s)=>qe.create(t,e,s),this._moc=null,this._model=null,this._motionManager=null,this._expressionManager=null,this._eyeBlink=null,this._breath=null,this._modelMatrix=null,this._pose=null,this._dragManager=null,this._physics=null,this._modelUserData=null,this._initialized=!1,this._updating=!1,this._opacity=1,this._lipsync=!0,this._lastLipSyncValue=0,this._dragX=0,this._dragY=0,this._accelerationX=0,this._accelerationY=0,this._accelerationZ=0,this._mocConsistency=!1,this._debugMode=!1,this._renderer=null,this._motionManager=new xi,this._motionManager.setEventCallback(Je.cubismDefaultMotionEventCallback,this),this._expressionManager=new xi,this._dragManager=new As}isInitialized(){return this._initialized}setInitialized(t){this._initialized=t}isUpdating(){return this._updating}setUpdating(t){this._updating=t}setDragging(t,e){this._dragManager.set(t,e)}setAcceleration(t,e,i){this._accelerationX=t,this._accelerationY=e,this._accelerationZ=i}getModelMatrix(){return this._modelMatrix}setOpacity(t){this._opacity=t}getOpacity(){return this._opacity}loadModel(t,e=!1){if(this._moc=Pe.create(t,e),this._moc==null){lt("Failed to CubismMoc.create().");return}if(this._model=this._moc.createModel(),this._model==null){lt("Failed to CreateModel().");return}this._model.saveParameters(),this._modelMatrix=new Es(this._model.getCanvasWidth(),this._model.getCanvasHeight())}loadExpression(t,e,i){return We.create(t,e)}loadPose(t,e){this._pose=xe.create(t,e)}loadUserData(t,e){this._modelUserData=Be.create(t,e)}loadPhysics(t,e){this._physics=Ce.create(t,e)}isHit(t,e,i){const s=this._model.getDrawableIndex(t);if(s<0)return!1;const a=this._model.getDrawableVertexCount(s),l=this._model.getDrawableVertices(s);let n=l[0],h=l[0],c=l[1],d=l[1];for(let S=1;S<a;++S){const p=l[Dt.vertexOffset+S*Dt.vertexStep],M=l[Dt.vertexOffset+S*Dt.vertexStep+1];p<n&&(n=p),p>h&&(h=p),M<c&&(c=M),M>d&&(d=M)}const m=this._modelMatrix.invertTransformX(e),x=this._modelMatrix.invertTransformY(i);return n<=m&&m<=h&&c<=x&&x<=d}getModel(){return this._model}getRenderer(){return this._renderer}createRenderer(t=1){this._renderer&&this.deleteRenderer(),this._renderer=new Ei,this._renderer.initialize(this._model,t)}deleteRenderer(){this._renderer!=null&&(this._renderer.release(),this._renderer=null)}motionEventFired(t){vt("{0}",t.s)}static cubismDefaultMotionEventCallback(t,e,i){const s=i;s!=null&&s.motionEventFired(e)}release(){this._motionManager!=null&&(this._motionManager.release(),this._motionManager=null),this._expressionManager!=null&&(this._expressionManager.release(),this._expressionManager=null),this._moc!=null&&(this._moc.deleteModel(this._model),this._moc.release(),this._moc=null),this._modelMatrix=null,xe.delete(this._pose),Se.delete(this._eyeBlink),be.delete(this._breath),this._dragManager=null,Ce.delete(this._physics),Be.delete(this._modelUserData),this.deleteRenderer()}}var Ss;(r=>{r.CubismUserModel=Je})(Ss||(Ss={}));const te=class te{static loadFileAsBytes(t,e){fetch(t).then(i=>i.arrayBuffer()).then(i=>e(i,i.byteLength))}static getDeltaTime(){return this.s_deltaTime}static updateTime(){this.s_currentFrame=Date.now(),this.s_deltaTime=(this.s_currentFrame-this.s_lastFrame)/1e3,this.s_lastFrame=this.s_currentFrame}static printMessage(t){console.log(t)}};te.lastUpdate=Date.now(),te.s_currentFrame=0,te.s_lastFrame=0,te.s_deltaTime=0;let j=te,qt=null;class Ai{constructor(){this._loadFiletoBytes=(t,e)=>{this._byteReader._fileByte=t,this._byteReader._fileDataView=new DataView(this._byteReader._fileByte),this._byteReader._fileSize=e},this._pcmData=null,this._userTimeSeconds=0,this._lastRms=0,this._sampleOffset=0,this._wavFileInfo=new vl,this._byteReader=new Cl}static getInstance(){return qt==null&&(qt=new Ai),qt}static releaseInstance(){qt!=null&&(qt=void 0),qt=null}update(t){let e,i;if(this._pcmData==null||this._sampleOffset>=this._wavFileInfo._samplesPerChannel)return this._lastRms=0,!1;this._userTimeSeconds+=t,e=Math.floor(this._userTimeSeconds*this._wavFileInfo._samplingRate),e>this._wavFileInfo._samplesPerChannel&&(e=this._wavFileInfo._samplesPerChannel),i=0;for(let s=0;s<this._wavFileInfo._numberOfChannels;s++)for(let a=this._sampleOffset;a<e;a++){const l=this._pcmData[s][a];i+=l*l}return i=Math.sqrt(i/(this._wavFileInfo._numberOfChannels*(e-this._sampleOffset))),this._lastRms=i,this._sampleOffset=e,!0}start(t){this._sampleOffset=0,this._userTimeSeconds=0,this._lastRms=0,this.loadWavFile(t)}getRms(){return this._lastRms}loadWavFile(t){let e=!1;this._pcmData!=null&&this.releasePcmData();const i=async()=>fetch(t).then(s=>s.arrayBuffer());return(async()=>{if(this._byteReader._fileByte=await i(),this._byteReader._fileDataView=new DataView(this._byteReader._fileByte),this._byteReader._fileSize=this._byteReader._fileByte.byteLength,this._byteReader._readOffset=0,this._byteReader._fileByte==null||this._byteReader._fileSize<4)return!1;this._wavFileInfo._fileName=t;try{if(!this._byteReader.getCheckSignature("RIFF"))throw e=!1,new Error('Cannot find Signeture "RIFF".');if(this._byteReader.get32LittleEndian(),!this._byteReader.getCheckSignature("WAVE"))throw e=!1,new Error('Cannot find Signeture "WAVE".');if(!this._byteReader.getCheckSignature("fmt "))throw e=!1,new Error('Cannot find Signeture "fmt".');const s=this._byteReader.get32LittleEndian();if(this._byteReader.get16LittleEndian()!=1)throw e=!1,new Error("File is not linear PCM.");for(this._wavFileInfo._numberOfChannels=this._byteReader.get16LittleEndian(),this._wavFileInfo._samplingRate=this._byteReader.get32LittleEndian(),this._byteReader.get32LittleEndian(),this._byteReader.get16LittleEndian(),this._wavFileInfo._bitsPerSample=this._byteReader.get16LittleEndian(),s>16&&(this._byteReader._readOffset+=s-16);!this._byteReader.getCheckSignature("data")&&this._byteReader._readOffset<this._byteReader._fileSize;)this._byteReader._readOffset+=this._byteReader.get32LittleEndian()+4;if(this._byteReader._readOffset>=this._byteReader._fileSize)throw e=!1,new Error('Cannot find "data" Chunk.');{const a=this._byteReader.get32LittleEndian();this._wavFileInfo._samplesPerChannel=a*8/(this._wavFileInfo._bitsPerSample*this._wavFileInfo._numberOfChannels)}this._pcmData=new Array(this._wavFileInfo._numberOfChannels);for(let a=0;a<this._wavFileInfo._numberOfChannels;a++)this._pcmData[a]=new Float32Array(this._wavFileInfo._samplesPerChannel);for(let a=0;a<this._wavFileInfo._samplesPerChannel;a++)for(let l=0;l<this._wavFileInfo._numberOfChannels;l++)this._pcmData[l][a]=this.getPcmSample();e=!0}catch(s){console.log(s)}})(),e}getPcmSample(){let t;switch(this._wavFileInfo._bitsPerSample){case 8:t=this._byteReader.get8()-128,t<<=24;break;case 16:t=this._byteReader.get16LittleEndian()<<16;break;case 24:t=this._byteReader.get24LittleEndian()<<8;break;default:t=0;break}return t/2147483647}releasePcmData(){for(let t=0;t<this._wavFileInfo._numberOfChannels;t++)delete this._pcmData[t];delete this._pcmData,this._pcmData=null}}class vl{constructor(){this._fileName="",this._numberOfChannels=0,this._bitsPerSample=0,this._samplingRate=0,this._samplesPerChannel=0}}class Cl{constructor(){this._fileByte=null,this._fileDataView=null,this._fileSize=0,this._readOffset=0}get8(){const t=this._fileDataView.getUint8(this._readOffset);return this._readOffset++,t}get16LittleEndian(){const t=this._fileDataView.getUint8(this._readOffset+1)<<8|this._fileDataView.getUint8(this._readOffset);return this._readOffset+=2,t}get24LittleEndian(){const t=this._fileDataView.getUint8(this._readOffset+2)<<16|this._fileDataView.getUint8(this._readOffset+1)<<8|this._fileDataView.getUint8(this._readOffset);return this._readOffset+=3,t}get32LittleEndian(){const t=this._fileDataView.getUint8(this._readOffset+3)<<24|this._fileDataView.getUint8(this._readOffset+2)<<16|this._fileDataView.getUint8(this._readOffset+1)<<8|this._fileDataView.getUint8(this._readOffset);return this._readOffset+=4,t}getCheckSignature(t){const e=new Uint8Array(4),i=new TextEncoder().encode(t);if(t.length!=4)return!1;for(let s=0;s<4;s++)e[s]=this.get8();return e[0]==i[0]&&e[1]==i[1]&&e[2]==i[2]&&e[3]==i[3]}}var Oe=typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:{};function Bl(r){return r&&r.__esModule&&Object.prototype.hasOwnProperty.call(r,"default")?r.default:r}function ke(r){throw new Error('Could not dynamically require "'+r+'". Please configure the dynamicRequireTargets or/and ignoreDynamicRequires option of @rollup/plugin-commonjs appropriately for this require call to work.')}var ra={exports:{}};/*!
    localForage -- Offline Storage, Improved
    Version 1.10.0
    https://localforage.github.io/localForage
    (c) 2013-2017 Mozilla, Apache License 2.0
*/(function(r,t){(function(e){r.exports=e()})(function(){return function e(i,s,a){function l(c,d){if(!s[c]){if(!i[c]){var m=typeof ke=="function"&&ke;if(!d&&m)return m(c,!0);if(n)return n(c,!0);var x=new Error("Cannot find module '"+c+"'");throw x.code="MODULE_NOT_FOUND",x}var S=s[c]={exports:{}};i[c][0].call(S.exports,function(p){var M=i[c][1][p];return l(M||p)},S,S.exports,e,i,s,a)}return s[c].exports}for(var n=typeof ke=="function"&&ke,h=0;h<a.length;h++)l(a[h]);return l}({1:[function(e,i,s){(function(a){var l=a.MutationObserver||a.WebKitMutationObserver,n;if(l){var h=0,c=new l(p),d=a.document.createTextNode("");c.observe(d,{characterData:!0}),n=function(){d.data=h=++h%2}}else if(!a.setImmediate&&typeof a.MessageChannel<"u"){var m=new a.MessageChannel;m.port1.onmessage=p,n=function(){m.port2.postMessage(0)}}else"document"in a&&"onreadystatechange"in a.document.createElement("script")?n=function(){var C=a.document.createElement("script");C.onreadystatechange=function(){p(),C.onreadystatechange=null,C.parentNode.removeChild(C),C=null},a.document.documentElement.appendChild(C)}:n=function(){setTimeout(p,0)};var x,S=[];function p(){x=!0;for(var C,E,I=S.length;I;){for(E=S,S=[],C=-1;++C<I;)E[C]();I=S.length}x=!1}i.exports=M;function M(C){S.push(C)===1&&!x&&n()}}).call(this,typeof Oe<"u"?Oe:typeof self<"u"?self:typeof window<"u"?window:{})},{}],2:[function(e,i,s){var a=e(1);function l(){}var n={},h=["REJECTED"],c=["FULFILLED"],d=["PENDING"];i.exports=m;function m(B){if(typeof B!="function")throw new TypeError("resolver must be a function");this.state=d,this.queue=[],this.outcome=void 0,B!==l&&M(this,B)}m.prototype.catch=function(B){return this.then(null,B)},m.prototype.then=function(B,R){if(typeof B!="function"&&this.state===c||typeof R!="function"&&this.state===h)return this;var D=new this.constructor(l);if(this.state!==d){var z=this.state===c?B:R;S(D,z,this.outcome)}else this.queue.push(new x(D,B,R));return D};function x(B,R,D){this.promise=B,typeof R=="function"&&(this.onFulfilled=R,this.callFulfilled=this.otherCallFulfilled),typeof D=="function"&&(this.onRejected=D,this.callRejected=this.otherCallRejected)}x.prototype.callFulfilled=function(B){n.resolve(this.promise,B)},x.prototype.otherCallFulfilled=function(B){S(this.promise,this.onFulfilled,B)},x.prototype.callRejected=function(B){n.reject(this.promise,B)},x.prototype.otherCallRejected=function(B){S(this.promise,this.onRejected,B)};function S(B,R,D){a(function(){var z;try{z=R(D)}catch($){return n.reject(B,$)}z===B?n.reject(B,new TypeError("Cannot resolve promise with itself")):n.resolve(B,z)})}n.resolve=function(B,R){var D=C(p,R);if(D.status==="error")return n.reject(B,D.value);var z=D.value;if(z)M(B,z);else{B.state=c,B.outcome=R;for(var $=-1,Q=B.queue.length;++$<Q;)B.queue[$].callFulfilled(R)}return B},n.reject=function(B,R){B.state=h,B.outcome=R;for(var D=-1,z=B.queue.length;++D<z;)B.queue[D].callRejected(R);return B};function p(B){var R=B&&B.then;if(B&&(typeof B=="object"||typeof B=="function")&&typeof R=="function")return function(){R.apply(B,arguments)}}function M(B,R){var D=!1;function z(rt){D||(D=!0,n.reject(B,rt))}function $(rt){D||(D=!0,n.resolve(B,rt))}function Q(){R($,z)}var et=C(Q);et.status==="error"&&z(et.value)}function C(B,R){var D={};try{D.value=B(R),D.status="success"}catch(z){D.status="error",D.value=z}return D}m.resolve=E;function E(B){return B instanceof this?B:n.resolve(new this(l),B)}m.reject=I;function I(B){var R=new this(l);return n.reject(R,B)}m.all=U;function U(B){var R=this;if(Object.prototype.toString.call(B)!=="[object Array]")return this.reject(new TypeError("must be an array"));var D=B.length,z=!1;if(!D)return this.resolve([]);for(var $=new Array(D),Q=0,et=-1,rt=new this(l);++et<D;)ft(B[et],et);return rt;function ft(oe,Me){R.resolve(oe).then(Ke,function(jt){z||(z=!0,n.reject(rt,jt))});function Ke(jt){$[Me]=jt,++Q===D&&!z&&(z=!0,n.resolve(rt,$))}}}m.race=A;function A(B){var R=this;if(Object.prototype.toString.call(B)!=="[object Array]")return this.reject(new TypeError("must be an array"));var D=B.length,z=!1;if(!D)return this.resolve([]);for(var $=-1,Q=new this(l);++$<D;)et(B[$]);return Q;function et(rt){R.resolve(rt).then(function(ft){z||(z=!0,n.resolve(Q,ft))},function(ft){z||(z=!0,n.reject(Q,ft))})}}},{1:1}],3:[function(e,i,s){(function(a){typeof a.Promise!="function"&&(a.Promise=e(2))}).call(this,typeof Oe<"u"?Oe:typeof self<"u"?self:typeof window<"u"?window:{})},{2:2}],4:[function(e,i,s){var a=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(o){return typeof o}:function(o){return o&&typeof Symbol=="function"&&o.constructor===Symbol&&o!==Symbol.prototype?"symbol":typeof o};function l(o,g){if(!(o instanceof g))throw new TypeError("Cannot call a class as a function")}function n(){try{if(typeof indexedDB<"u")return indexedDB;if(typeof webkitIndexedDB<"u")return webkitIndexedDB;if(typeof mozIndexedDB<"u")return mozIndexedDB;if(typeof OIndexedDB<"u")return OIndexedDB;if(typeof msIndexedDB<"u")return msIndexedDB}catch{return}}var h=n();function c(){try{if(!h||!h.open)return!1;var o=typeof openDatabase<"u"&&/(Safari|iPhone|iPad|iPod)/.test(navigator.userAgent)&&!/Chrome/.test(navigator.userAgent)&&!/BlackBerry/.test(navigator.platform),g=typeof fetch=="function"&&fetch.toString().indexOf("[native code")!==-1;return(!o||g)&&typeof indexedDB<"u"&&typeof IDBKeyRange<"u"}catch{return!1}}function d(o,g){o=o||[],g=g||{};try{return new Blob(o,g)}catch(_){if(_.name!=="TypeError")throw _;for(var u=typeof BlobBuilder<"u"?BlobBuilder:typeof MSBlobBuilder<"u"?MSBlobBuilder:typeof MozBlobBuilder<"u"?MozBlobBuilder:WebKitBlobBuilder,f=new u,y=0;y<o.length;y+=1)f.append(o[y]);return f.getBlob(g.type)}}typeof Promise>"u"&&e(3);var m=Promise;function x(o,g){g&&o.then(function(u){g(null,u)},function(u){g(u)})}function S(o,g,u){typeof g=="function"&&o.then(g),typeof u=="function"&&o.catch(u)}function p(o){return typeof o!="string"&&(console.warn(o+" used as a key, but it is not a string."),o=String(o)),o}function M(){if(arguments.length&&typeof arguments[arguments.length-1]=="function")return arguments[arguments.length-1]}var C="local-forage-detect-blob-support",E=void 0,I={},U=Object.prototype.toString,A="readonly",B="readwrite";function R(o){for(var g=o.length,u=new ArrayBuffer(g),f=new Uint8Array(u),y=0;y<g;y++)f[y]=o.charCodeAt(y);return u}function D(o){return new m(function(g){var u=o.transaction(C,B),f=d([""]);u.objectStore(C).put(f,"key"),u.onabort=function(y){y.preventDefault(),y.stopPropagation(),g(!1)},u.oncomplete=function(){var y=navigator.userAgent.match(/Chrome\/(\d+)/),_=navigator.userAgent.match(/Edge\//);g(_||!y||parseInt(y[1],10)>=43)}}).catch(function(){return!1})}function z(o){return typeof E=="boolean"?m.resolve(E):D(o).then(function(g){return E=g,E})}function $(o){var g=I[o.name],u={};u.promise=new m(function(f,y){u.resolve=f,u.reject=y}),g.deferredOperations.push(u),g.dbReady?g.dbReady=g.dbReady.then(function(){return u.promise}):g.dbReady=u.promise}function Q(o){var g=I[o.name],u=g.deferredOperations.pop();if(u)return u.resolve(),u.promise}function et(o,g){var u=I[o.name],f=u.deferredOperations.pop();if(f)return f.reject(g),f.promise}function rt(o,g){return new m(function(u,f){if(I[o.name]=I[o.name]||Di(),o.db)if(g)$(o),o.db.close();else return u(o.db);var y=[o.name];g&&y.push(o.version);var _=h.open.apply(h,y);g&&(_.onupgradeneeded=function(v){var P=_.result;try{P.createObjectStore(o.storeName),v.oldVersion<=1&&P.createObjectStore(C)}catch(w){if(w.name==="ConstraintError")console.warn('The database "'+o.name+'" has been upgraded from version '+v.oldVersion+" to version "+v.newVersion+', but the storage "'+o.storeName+'" already exists.');else throw w}}),_.onerror=function(v){v.preventDefault(),f(_.error)},_.onsuccess=function(){var v=_.result;v.onversionchange=function(P){P.target.close()},u(v),Q(o)}})}function ft(o){return rt(o,!1)}function oe(o){return rt(o,!0)}function Me(o,g){if(!o.db)return!0;var u=!o.db.objectStoreNames.contains(o.storeName),f=o.version<o.db.version,y=o.version>o.db.version;if(f&&(o.version!==g&&console.warn('The database "'+o.name+`" can't be downgraded from version `+o.db.version+" to version "+o.version+"."),o.version=o.db.version),y||u){if(u){var _=o.db.version+1;_>o.version&&(o.version=_)}return!0}return!1}function Ke(o){return new m(function(g,u){var f=new FileReader;f.onerror=u,f.onloadend=function(y){var _=btoa(y.target.result||"");g({__local_forage_encoded_blob:!0,data:_,type:o.type})},f.readAsBinaryString(o)})}function jt(o){var g=R(atob(o.data));return d([g],{type:o.type})}function Fi(o){return o&&o.__local_forage_encoded_blob}function aa(o){var g=this,u=g._initReady().then(function(){var f=I[g._dbInfo.name];if(f&&f.dbReady)return f.dbReady});return S(u,o,o),u}function na(o){$(o);for(var g=I[o.name],u=g.forages,f=0;f<u.length;f++){var y=u[f];y._dbInfo.db&&(y._dbInfo.db.close(),y._dbInfo.db=null)}return o.db=null,ft(o).then(function(_){return o.db=_,Me(o)?oe(o):_}).then(function(_){o.db=g.db=_;for(var v=0;v<u.length;v++)u[v]._dbInfo.db=_}).catch(function(_){throw et(o,_),_})}function Pt(o,g,u,f){f===void 0&&(f=1);try{var y=o.db.transaction(o.storeName,g);u(null,y)}catch(_){if(f>0&&(!o.db||_.name==="InvalidStateError"||_.name==="NotFoundError"))return m.resolve().then(function(){if(!o.db||_.name==="NotFoundError"&&!o.db.objectStoreNames.contains(o.storeName)&&o.version<=o.db.version)return o.db&&(o.version=o.db.version+1),oe(o)}).then(function(){return na(o).then(function(){Pt(o,g,u,f-1)})}).catch(u);u(_)}}function Di(){return{forages:[],db:null,dbReady:null,deferredOperations:[]}}function oa(o){var g=this,u={db:null};if(o)for(var f in o)u[f]=o[f];var y=I[u.name];y||(y=Di(),I[u.name]=y),y.forages.push(g),g._initReady||(g._initReady=g.ready,g.ready=aa);var _=[];function v(){return m.resolve()}for(var P=0;P<y.forages.length;P++){var w=y.forages[P];w!==g&&_.push(w._initReady().catch(v))}var T=y.forages.slice(0);return m.all(_).then(function(){return u.db=y.db,ft(u)}).then(function(V){return u.db=V,Me(u,g._defaultConfig.version)?oe(u):V}).then(function(V){u.db=y.db=V,g._dbInfo=u;for(var F=0;F<T.length;F++){var X=T[F];X!==g&&(X._dbInfo.db=u.db,X._dbInfo.version=u.version)}})}function la(o,g){var u=this;o=p(o);var f=new m(function(y,_){u.ready().then(function(){Pt(u._dbInfo,A,function(v,P){if(v)return _(v);try{var w=P.objectStore(u._dbInfo.storeName),T=w.get(o);T.onsuccess=function(){var V=T.result;V===void 0&&(V=null),Fi(V)&&(V=jt(V)),y(V)},T.onerror=function(){_(T.error)}}catch(V){_(V)}})}).catch(_)});return x(f,g),f}function ua(o,g){var u=this,f=new m(function(y,_){u.ready().then(function(){Pt(u._dbInfo,A,function(v,P){if(v)return _(v);try{var w=P.objectStore(u._dbInfo.storeName),T=w.openCursor(),V=1;T.onsuccess=function(){var F=T.result;if(F){var X=F.value;Fi(X)&&(X=jt(X));var G=o(X,F.key,V++);G!==void 0?y(G):F.continue()}else y()},T.onerror=function(){_(T.error)}}catch(F){_(F)}})}).catch(_)});return x(f,g),f}function ha(o,g,u){var f=this;o=p(o);var y=new m(function(_,v){var P;f.ready().then(function(){return P=f._dbInfo,U.call(g)==="[object Blob]"?z(P.db).then(function(w){return w?g:Ke(g)}):g}).then(function(w){Pt(f._dbInfo,B,function(T,V){if(T)return v(T);try{var F=V.objectStore(f._dbInfo.storeName);w===null&&(w=void 0);var X=F.put(w,o);V.oncomplete=function(){w===void 0&&(w=null),_(w)},V.onabort=V.onerror=function(){var G=X.error?X.error:X.transaction.error;v(G)}}catch(G){v(G)}})}).catch(v)});return x(y,u),y}function ca(o,g){var u=this;o=p(o);var f=new m(function(y,_){u.ready().then(function(){Pt(u._dbInfo,B,function(v,P){if(v)return _(v);try{var w=P.objectStore(u._dbInfo.storeName),T=w.delete(o);P.oncomplete=function(){y()},P.onerror=function(){_(T.error)},P.onabort=function(){var V=T.error?T.error:T.transaction.error;_(V)}}catch(V){_(V)}})}).catch(_)});return x(f,g),f}function ga(o){var g=this,u=new m(function(f,y){g.ready().then(function(){Pt(g._dbInfo,B,function(_,v){if(_)return y(_);try{var P=v.objectStore(g._dbInfo.storeName),w=P.clear();v.oncomplete=function(){f()},v.onabort=v.onerror=function(){var T=w.error?w.error:w.transaction.error;y(T)}}catch(T){y(T)}})}).catch(y)});return x(u,o),u}function da(o){var g=this,u=new m(function(f,y){g.ready().then(function(){Pt(g._dbInfo,A,function(_,v){if(_)return y(_);try{var P=v.objectStore(g._dbInfo.storeName),w=P.count();w.onsuccess=function(){f(w.result)},w.onerror=function(){y(w.error)}}catch(T){y(T)}})}).catch(y)});return x(u,o),u}function _a(o,g){var u=this,f=new m(function(y,_){if(o<0){y(null);return}u.ready().then(function(){Pt(u._dbInfo,A,function(v,P){if(v)return _(v);try{var w=P.objectStore(u._dbInfo.storeName),T=!1,V=w.openKeyCursor();V.onsuccess=function(){var F=V.result;if(!F){y(null);return}o===0||T?y(F.key):(T=!0,F.advance(o))},V.onerror=function(){_(V.error)}}catch(F){_(F)}})}).catch(_)});return x(f,g),f}function fa(o){var g=this,u=new m(function(f,y){g.ready().then(function(){Pt(g._dbInfo,A,function(_,v){if(_)return y(_);try{var P=v.objectStore(g._dbInfo.storeName),w=P.openKeyCursor(),T=[];w.onsuccess=function(){var V=w.result;if(!V){f(T);return}T.push(V.key),V.continue()},w.onerror=function(){y(w.error)}}catch(V){y(V)}})}).catch(y)});return x(u,o),u}function ma(o,g){g=M.apply(this,arguments);var u=this.config();o=typeof o!="function"&&o||{},o.name||(o.name=o.name||u.name,o.storeName=o.storeName||u.storeName);var f=this,y;if(!o.name)y=m.reject("Invalid arguments");else{var _=o.name===u.name&&f._dbInfo.db,v=_?m.resolve(f._dbInfo.db):ft(o).then(function(P){var w=I[o.name],T=w.forages;w.db=P;for(var V=0;V<T.length;V++)T[V]._dbInfo.db=P;return P});o.storeName?y=v.then(function(P){if(P.objectStoreNames.contains(o.storeName)){var w=P.version+1;$(o);var T=I[o.name],V=T.forages;P.close();for(var F=0;F<V.length;F++){var X=V[F];X._dbInfo.db=null,X._dbInfo.version=w}var G=new m(function(W,tt){var K=h.open(o.name,w);K.onerror=function(gt){var ue=K.result;ue.close(),tt(gt)},K.onupgradeneeded=function(){var gt=K.result;gt.deleteObjectStore(o.storeName)},K.onsuccess=function(){var gt=K.result;gt.close(),W(gt)}});return G.then(function(W){T.db=W;for(var tt=0;tt<V.length;tt++){var K=V[tt];K._dbInfo.db=W,Q(K._dbInfo)}}).catch(function(W){throw(et(o,W)||m.resolve()).catch(function(){}),W})}}):y=v.then(function(P){$(o);var w=I[o.name],T=w.forages;P.close();for(var V=0;V<T.length;V++){var F=T[V];F._dbInfo.db=null}var X=new m(function(G,W){var tt=h.deleteDatabase(o.name);tt.onerror=function(){var K=tt.result;K&&K.close(),W(tt.error)},tt.onblocked=function(){console.warn('dropInstance blocked for database "'+o.name+'" until all open connections are closed')},tt.onsuccess=function(){var K=tt.result;K&&K.close(),G(K)}});return X.then(function(G){w.db=G;for(var W=0;W<T.length;W++){var tt=T[W];Q(tt._dbInfo)}}).catch(function(G){throw(et(o,G)||m.resolve()).catch(function(){}),G})})}return x(y,g),y}var pa={_driver:"asyncStorage",_initStorage:oa,_support:c(),iterate:ua,getItem:la,setItem:ha,removeItem:ca,clear:ga,length:da,key:_a,keys:fa,dropInstance:ma};function ya(){return typeof openDatabase=="function"}var It="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",Sa="~~local_forage_type~",Li=/^~~local_forage_type~([^~]+)~/,we="__lfsc__:",Ze=we.length,Qe="arbf",ti="blob",Oi="si08",ki="ui08",Ni="uic8",Ui="si16",zi="si32",Xi="ur16",Yi="ui32",ji="fl32",Gi="fl64",Hi=Ze+Qe.length,$i=Object.prototype.toString;function Wi(o){var g=o.length*.75,u=o.length,f,y=0,_,v,P,w;o[o.length-1]==="="&&(g--,o[o.length-2]==="="&&g--);var T=new ArrayBuffer(g),V=new Uint8Array(T);for(f=0;f<u;f+=4)_=It.indexOf(o[f]),v=It.indexOf(o[f+1]),P=It.indexOf(o[f+2]),w=It.indexOf(o[f+3]),V[y++]=_<<2|v>>4,V[y++]=(v&15)<<4|P>>2,V[y++]=(P&3)<<6|w&63;return T}function ei(o){var g=new Uint8Array(o),u="",f;for(f=0;f<g.length;f+=3)u+=It[g[f]>>2],u+=It[(g[f]&3)<<4|g[f+1]>>4],u+=It[(g[f+1]&15)<<2|g[f+2]>>6],u+=It[g[f+2]&63];return g.length%3===2?u=u.substring(0,u.length-1)+"=":g.length%3===1&&(u=u.substring(0,u.length-2)+"=="),u}function xa(o,g){var u="";if(o&&(u=$i.call(o)),o&&(u==="[object ArrayBuffer]"||o.buffer&&$i.call(o.buffer)==="[object ArrayBuffer]")){var f,y=we;o instanceof ArrayBuffer?(f=o,y+=Qe):(f=o.buffer,u==="[object Int8Array]"?y+=Oi:u==="[object Uint8Array]"?y+=ki:u==="[object Uint8ClampedArray]"?y+=Ni:u==="[object Int16Array]"?y+=Ui:u==="[object Uint16Array]"?y+=Xi:u==="[object Int32Array]"?y+=zi:u==="[object Uint32Array]"?y+=Yi:u==="[object Float32Array]"?y+=ji:u==="[object Float64Array]"?y+=Gi:g(new Error("Failed to get type for BinaryArray"))),g(y+ei(f))}else if(u==="[object Blob]"){var _=new FileReader;_.onload=function(){var v=Sa+o.type+"~"+ei(this.result);g(we+ti+v)},_.readAsArrayBuffer(o)}else try{g(JSON.stringify(o))}catch(v){console.error("Couldn't convert value into a JSON string: ",o),g(null,v)}}function va(o){if(o.substring(0,Ze)!==we)return JSON.parse(o);var g=o.substring(Hi),u=o.substring(Ze,Hi),f;if(u===ti&&Li.test(g)){var y=g.match(Li);f=y[1],g=g.substring(y[0].length)}var _=Wi(g);switch(u){case Qe:return _;case ti:return d([_],{type:f});case Oi:return new Int8Array(_);case ki:return new Uint8Array(_);case Ni:return new Uint8ClampedArray(_);case Ui:return new Int16Array(_);case Xi:return new Uint16Array(_);case zi:return new Int32Array(_);case Yi:return new Uint32Array(_);case ji:return new Float32Array(_);case Gi:return new Float64Array(_);default:throw new Error("Unkown type: "+u)}}var ii={serialize:xa,deserialize:va,stringToBuffer:Wi,bufferToString:ei};function qi(o,g,u,f){o.executeSql("CREATE TABLE IF NOT EXISTS "+g.storeName+" (id INTEGER PRIMARY KEY, key unique, value)",[],u,f)}function Ca(o){var g=this,u={db:null};if(o)for(var f in o)u[f]=typeof o[f]!="string"?o[f].toString():o[f];var y=new m(function(_,v){try{u.db=openDatabase(u.name,String(u.version),u.description,u.size)}catch(P){return v(P)}u.db.transaction(function(P){qi(P,u,function(){g._dbInfo=u,_()},function(w,T){v(T)})},v)});return u.serializer=ii,y}function Rt(o,g,u,f,y,_){o.executeSql(u,f,y,function(v,P){P.code===P.SYNTAX_ERR?v.executeSql("SELECT name FROM sqlite_master WHERE type='table' AND name = ?",[g.storeName],function(w,T){T.rows.length?_(w,P):qi(w,g,function(){w.executeSql(u,f,y,_)},_)},_):_(v,P)},_)}function Ba(o,g){var u=this;o=p(o);var f=new m(function(y,_){u.ready().then(function(){var v=u._dbInfo;v.db.transaction(function(P){Rt(P,v,"SELECT * FROM "+v.storeName+" WHERE key = ? LIMIT 1",[o],function(w,T){var V=T.rows.length?T.rows.item(0).value:null;V&&(V=v.serializer.deserialize(V)),y(V)},function(w,T){_(T)})})}).catch(_)});return x(f,g),f}function ba(o,g){var u=this,f=new m(function(y,_){u.ready().then(function(){var v=u._dbInfo;v.db.transaction(function(P){Rt(P,v,"SELECT * FROM "+v.storeName,[],function(w,T){for(var V=T.rows,F=V.length,X=0;X<F;X++){var G=V.item(X),W=G.value;if(W&&(W=v.serializer.deserialize(W)),W=o(W,G.key,X+1),W!==void 0){y(W);return}}y()},function(w,T){_(T)})})}).catch(_)});return x(f,g),f}function Ji(o,g,u,f){var y=this;o=p(o);var _=new m(function(v,P){y.ready().then(function(){g===void 0&&(g=null);var w=g,T=y._dbInfo;T.serializer.serialize(g,function(V,F){F?P(F):T.db.transaction(function(X){Rt(X,T,"INSERT OR REPLACE INTO "+T.storeName+" (key, value) VALUES (?, ?)",[o,V],function(){v(w)},function(G,W){P(W)})},function(X){if(X.code===X.QUOTA_ERR){if(f>0){v(Ji.apply(y,[o,w,u,f-1]));return}P(X)}})})}).catch(P)});return x(_,u),_}function Pa(o,g,u){return Ji.apply(this,[o,g,u,1])}function Ma(o,g){var u=this;o=p(o);var f=new m(function(y,_){u.ready().then(function(){var v=u._dbInfo;v.db.transaction(function(P){Rt(P,v,"DELETE FROM "+v.storeName+" WHERE key = ?",[o],function(){y()},function(w,T){_(T)})})}).catch(_)});return x(f,g),f}function wa(o){var g=this,u=new m(function(f,y){g.ready().then(function(){var _=g._dbInfo;_.db.transaction(function(v){Rt(v,_,"DELETE FROM "+_.storeName,[],function(){f()},function(P,w){y(w)})})}).catch(y)});return x(u,o),u}function Ia(o){var g=this,u=new m(function(f,y){g.ready().then(function(){var _=g._dbInfo;_.db.transaction(function(v){Rt(v,_,"SELECT COUNT(key) as c FROM "+_.storeName,[],function(P,w){var T=w.rows.item(0).c;f(T)},function(P,w){y(w)})})}).catch(y)});return x(u,o),u}function Ra(o,g){var u=this,f=new m(function(y,_){u.ready().then(function(){var v=u._dbInfo;v.db.transaction(function(P){Rt(P,v,"SELECT key FROM "+v.storeName+" WHERE id = ? LIMIT 1",[o+1],function(w,T){var V=T.rows.length?T.rows.item(0).key:null;y(V)},function(w,T){_(T)})})}).catch(_)});return x(f,g),f}function Ta(o){var g=this,u=new m(function(f,y){g.ready().then(function(){var _=g._dbInfo;_.db.transaction(function(v){Rt(v,_,"SELECT key FROM "+_.storeName,[],function(P,w){for(var T=[],V=0;V<w.rows.length;V++)T.push(w.rows.item(V).key);f(T)},function(P,w){y(w)})})}).catch(y)});return x(u,o),u}function Va(o){return new m(function(g,u){o.transaction(function(f){f.executeSql("SELECT name FROM sqlite_master WHERE type='table' AND name <> '__WebKitDatabaseInfoTable__'",[],function(y,_){for(var v=[],P=0;P<_.rows.length;P++)v.push(_.rows.item(P).name);g({db:o,storeNames:v})},function(y,_){u(_)})},function(f){u(f)})})}function Ea(o,g){g=M.apply(this,arguments);var u=this.config();o=typeof o!="function"&&o||{},o.name||(o.name=o.name||u.name,o.storeName=o.storeName||u.storeName);var f=this,y;return o.name?y=new m(function(_){var v;o.name===u.name?v=f._dbInfo.db:v=openDatabase(o.name,"","",0),o.storeName?_({db:v,storeNames:[o.storeName]}):_(Va(v))}).then(function(_){return new m(function(v,P){_.db.transaction(function(w){function T(G){return new m(function(W,tt){w.executeSql("DROP TABLE IF EXISTS "+G,[],function(){W()},function(K,gt){tt(gt)})})}for(var V=[],F=0,X=_.storeNames.length;F<X;F++)V.push(T(_.storeNames[F]));m.all(V).then(function(){v()}).catch(function(G){P(G)})},function(w){P(w)})})}):y=m.reject("Invalid arguments"),x(y,g),y}var Aa={_driver:"webSQLStorage",_initStorage:Ca,_support:ya(),iterate:ba,getItem:Ba,setItem:Pa,removeItem:Ma,clear:wa,length:Ia,key:Ra,keys:Ta,dropInstance:Ea};function Fa(){try{return typeof localStorage<"u"&&"setItem"in localStorage&&!!localStorage.setItem}catch{return!1}}function Ki(o,g){var u=o.name+"/";return o.storeName!==g.storeName&&(u+=o.storeName+"/"),u}function Da(){var o="_localforage_support_test";try{return localStorage.setItem(o,!0),localStorage.removeItem(o),!1}catch{return!0}}function La(){return!Da()||localStorage.length>0}function Oa(o){var g=this,u={};if(o)for(var f in o)u[f]=o[f];return u.keyPrefix=Ki(o,g._defaultConfig),La()?(g._dbInfo=u,u.serializer=ii,m.resolve()):m.reject()}function ka(o){var g=this,u=g.ready().then(function(){for(var f=g._dbInfo.keyPrefix,y=localStorage.length-1;y>=0;y--){var _=localStorage.key(y);_.indexOf(f)===0&&localStorage.removeItem(_)}});return x(u,o),u}function Na(o,g){var u=this;o=p(o);var f=u.ready().then(function(){var y=u._dbInfo,_=localStorage.getItem(y.keyPrefix+o);return _&&(_=y.serializer.deserialize(_)),_});return x(f,g),f}function Ua(o,g){var u=this,f=u.ready().then(function(){for(var y=u._dbInfo,_=y.keyPrefix,v=_.length,P=localStorage.length,w=1,T=0;T<P;T++){var V=localStorage.key(T);if(V.indexOf(_)===0){var F=localStorage.getItem(V);if(F&&(F=y.serializer.deserialize(F)),F=o(F,V.substring(v),w++),F!==void 0)return F}}});return x(f,g),f}function za(o,g){var u=this,f=u.ready().then(function(){var y=u._dbInfo,_;try{_=localStorage.key(o)}catch{_=null}return _&&(_=_.substring(y.keyPrefix.length)),_});return x(f,g),f}function Xa(o){var g=this,u=g.ready().then(function(){for(var f=g._dbInfo,y=localStorage.length,_=[],v=0;v<y;v++){var P=localStorage.key(v);P.indexOf(f.keyPrefix)===0&&_.push(P.substring(f.keyPrefix.length))}return _});return x(u,o),u}function Ya(o){var g=this,u=g.keys().then(function(f){return f.length});return x(u,o),u}function ja(o,g){var u=this;o=p(o);var f=u.ready().then(function(){var y=u._dbInfo;localStorage.removeItem(y.keyPrefix+o)});return x(f,g),f}function Ga(o,g,u){var f=this;o=p(o);var y=f.ready().then(function(){g===void 0&&(g=null);var _=g;return new m(function(v,P){var w=f._dbInfo;w.serializer.serialize(g,function(T,V){if(V)P(V);else try{localStorage.setItem(w.keyPrefix+o,T),v(_)}catch(F){(F.name==="QuotaExceededError"||F.name==="NS_ERROR_DOM_QUOTA_REACHED")&&P(F),P(F)}})})});return x(y,u),y}function Ha(o,g){if(g=M.apply(this,arguments),o=typeof o!="function"&&o||{},!o.name){var u=this.config();o.name=o.name||u.name,o.storeName=o.storeName||u.storeName}var f=this,y;return o.name?y=new m(function(_){o.storeName?_(Ki(o,f._defaultConfig)):_(o.name+"/")}).then(function(_){for(var v=localStorage.length-1;v>=0;v--){var P=localStorage.key(v);P.indexOf(_)===0&&localStorage.removeItem(P)}}):y=m.reject("Invalid arguments"),x(y,g),y}var $a={_driver:"localStorageWrapper",_initStorage:Oa,_support:Fa(),iterate:Ua,getItem:Na,setItem:Ga,removeItem:ja,clear:ka,length:Ya,key:za,keys:Xa,dropInstance:Ha},Wa=function(g,u){return g===u||typeof g=="number"&&typeof u=="number"&&isNaN(g)&&isNaN(u)},qa=function(g,u){for(var f=g.length,y=0;y<f;){if(Wa(g[y],u))return!0;y++}return!1},Zi=Array.isArray||function(o){return Object.prototype.toString.call(o)==="[object Array]"},le={},Qi={},Gt={INDEXEDDB:pa,WEBSQL:Aa,LOCALSTORAGE:$a},Ja=[Gt.INDEXEDDB._driver,Gt.WEBSQL._driver,Gt.LOCALSTORAGE._driver],Ie=["dropInstance"],ri=["clear","getItem","iterate","key","keys","length","removeItem","setItem"].concat(Ie),Ka={description:"",driver:Ja.slice(),name:"localforage",size:4980736,storeName:"keyvaluepairs",version:1};function Za(o,g){o[g]=function(){var u=arguments;return o.ready().then(function(){return o[g].apply(o,u)})}}function si(){for(var o=1;o<arguments.length;o++){var g=arguments[o];if(g)for(var u in g)g.hasOwnProperty(u)&&(Zi(g[u])?arguments[0][u]=g[u].slice():arguments[0][u]=g[u])}return arguments[0]}var Qa=function(){function o(g){l(this,o);for(var u in Gt)if(Gt.hasOwnProperty(u)){var f=Gt[u],y=f._driver;this[u]=y,le[y]||this.defineDriver(f)}this._defaultConfig=si({},Ka),this._config=si({},this._defaultConfig,g),this._driverSet=null,this._initDriver=null,this._ready=!1,this._dbInfo=null,this._wrapLibraryMethodsWithReady(),this.setDriver(this._config.driver).catch(function(){})}return o.prototype.config=function(u){if((typeof u>"u"?"undefined":a(u))==="object"){if(this._ready)return new Error("Can't call config() after localforage has been used.");for(var f in u){if(f==="storeName"&&(u[f]=u[f].replace(/\W/g,"_")),f==="version"&&typeof u[f]!="number")return new Error("Database version must be a number.");this._config[f]=u[f]}return"driver"in u&&u.driver?this.setDriver(this._config.driver):!0}else return typeof u=="string"?this._config[u]:this._config},o.prototype.defineDriver=function(u,f,y){var _=new m(function(v,P){try{var w=u._driver,T=new Error("Custom driver not compliant; see https://mozilla.github.io/localForage/#definedriver");if(!u._driver){P(T);return}for(var V=ri.concat("_initStorage"),F=0,X=V.length;F<X;F++){var G=V[F],W=!qa(Ie,G);if((W||u[G])&&typeof u[G]!="function"){P(T);return}}var tt=function(){for(var ue=function(rn){return function(){var sn=new Error("Method "+rn+" is not implemented by the current driver"),tr=m.reject(sn);return x(tr,arguments[arguments.length-1]),tr}},ai=0,en=Ie.length;ai<en;ai++){var ni=Ie[ai];u[ni]||(u[ni]=ue(ni))}};tt();var K=function(ue){le[w]&&console.info("Redefining LocalForage driver: "+w),le[w]=u,Qi[w]=ue,v()};"_support"in u?u._support&&typeof u._support=="function"?u._support().then(K,P):K(!!u._support):K(!0)}catch(gt){P(gt)}});return S(_,f,y),_},o.prototype.driver=function(){return this._driver||null},o.prototype.getDriver=function(u,f,y){var _=le[u]?m.resolve(le[u]):m.reject(new Error("Driver not found."));return S(_,f,y),_},o.prototype.getSerializer=function(u){var f=m.resolve(ii);return S(f,u),f},o.prototype.ready=function(u){var f=this,y=f._driverSet.then(function(){return f._ready===null&&(f._ready=f._initDriver()),f._ready});return S(y,u,u),y},o.prototype.setDriver=function(u,f,y){var _=this;Zi(u)||(u=[u]);var v=this._getSupportedDrivers(u);function P(){_._config.driver=_.driver()}function w(F){return _._extend(F),P(),_._ready=_._initStorage(_._config),_._ready}function T(F){return function(){var X=0;function G(){for(;X<F.length;){var W=F[X];return X++,_._dbInfo=null,_._ready=null,_.getDriver(W).then(w).catch(G)}P();var tt=new Error("No available storage method found.");return _._driverSet=m.reject(tt),_._driverSet}return G()}}var V=this._driverSet!==null?this._driverSet.catch(function(){return m.resolve()}):m.resolve();return this._driverSet=V.then(function(){var F=v[0];return _._dbInfo=null,_._ready=null,_.getDriver(F).then(function(X){_._driver=X._driver,P(),_._wrapLibraryMethodsWithReady(),_._initDriver=T(v)})}).catch(function(){P();var F=new Error("No available storage method found.");return _._driverSet=m.reject(F),_._driverSet}),S(this._driverSet,f,y),this._driverSet},o.prototype.supports=function(u){return!!Qi[u]},o.prototype._extend=function(u){si(this,u)},o.prototype._getSupportedDrivers=function(u){for(var f=[],y=0,_=u.length;y<_;y++){var v=u[y];this.supports(v)&&f.push(v)}return f},o.prototype._wrapLibraryMethodsWithReady=function(){for(var u=0,f=ri.length;u<f;u++)Za(this,ri[u])},o.prototype.createInstance=function(u){return new o(u)},o}(),tn=new Qa;i.exports=tn},{3:3}]},{},[4])(4)})})(ra);var bl=ra.exports;const xs=Bl(bl);class Pl extends Je{constructor(){super(),this._modelSetting=null,this._modelHomeDir=null,this._userTimeSeconds=0,this._eyeBlinkIds=new L,this._lipSyncIds=new L,this._motions=new ct,this._expressions=new ct,this._hitArea=new L,this._userArea=new L,this._idParamAngleX=Y.getIdManager().getId(O.ParamAngleX),this._idParamAngleY=Y.getIdManager().getId(O.ParamAngleY),this._idParamAngleZ=Y.getIdManager().getId(O.ParamAngleZ),this._idParamEyeBallX=Y.getIdManager().getId(O.ParamEyeBallX),this._idParamEyeBallY=Y.getIdManager().getId(O.ParamEyeBallY),this._idParamBodyAngleX=Y.getIdManager().getId(O.ParamBodyAngleX),this._mocConsistency=!0,this._state=0,this._expressionCount=0,this._textureCount=0,this._motionCount=0,this._allMotionCount=0,this._wavFileHandler=new Ai,this._consistency=!1}loadAssets(t,e){this._modelHomeDir=t,fetch(`${this._modelHomeDir}${e}`).then(i=>i.arrayBuffer()).then(i=>{const s=new Ts(i,i.byteLength);this._state=1,this.setupModel(s)})}setupModel(t){this._updating=!0,this._initialized=!1,this._modelSetting=t;const e=()=>{this._state=17,this._model.saveParameters(),this._allMotionCount=0,this._motionCount=0;const S=[],p=this._modelSetting.getMotionGroupCount();for(let M=0;M<p;M++)S[M]=this._modelSetting.getMotionGroupName(M),this._allMotionCount+=this._modelSetting.getMotionCount(S[M]);for(let M=0;M<p;M++)this.preLoadMotionGroup(S[M]);p==0&&(this._state=20,this._motionManager.stopAllMotions(),this._updating=!1,this._initialized=!0,this.createRenderer(),this.setupTextures(),this.getRenderer().startUp(b))},i=()=>{const S=new ct;if(this._modelSetting==null||this._modelMatrix==null){lt("Failed to setupLayout().");return}this._modelSetting.getLayoutMap(S),this._modelMatrix.setupFromLayout(S),this._state=16,e()},s=()=>{const S=this._modelSetting.getLipSyncParameterCount();for(let p=0;p<S;++p)this._lipSyncIds.pushBack(this._modelSetting.getLipSyncParameterId(p));this._state=15,i()},a=()=>{const S=this._modelSetting.getEyeBlinkParameterCount();for(let p=0;p<S;++p)this._eyeBlinkIds.pushBack(this._modelSetting.getEyeBlinkParameterId(p));this._state=14,s()},l=()=>{if(this._modelSetting.getUserDataFile()!=""){const S=this._modelSetting.getUserDataFile();fetch(`${this._modelHomeDir}${S}`).then(p=>p.arrayBuffer()).then(p=>{this.loadUserData(p,p.byteLength),this._state=13,a()}),this._state=12}else this._state=13,a()},n=()=>{this._breath=be.create();const S=new L;S.pushBack(new Kt(this._idParamAngleX,0,15,6.5345,.5)),S.pushBack(new Kt(this._idParamAngleY,0,8,3.5345,.5)),S.pushBack(new Kt(this._idParamAngleZ,0,10,5.5345,.5)),S.pushBack(new Kt(this._idParamBodyAngleX,0,4,15.5345,.5)),S.pushBack(new Kt(Y.getIdManager().getId(O.ParamBreath),.5,.5,3.2345,1)),this._breath.setParameters(S),this._state=11,l()},h=()=>{this._modelSetting.getEyeBlinkParameterCount()>0&&(this._eyeBlink=Se.create(this._modelSetting),this._state=10),n()},c=()=>{if(this._modelSetting.getPoseFileName()!=""){const S=this._modelSetting.getPoseFileName();fetch(`${this._modelHomeDir}${S}`).then(p=>p.arrayBuffer()).then(p=>{this.loadPose(p,p.byteLength),this._state=9,h()}),this._state=8}else this._state=9,h()},d=()=>{if(this._modelSetting.getPhysicsFileName()!=""){const S=this._modelSetting.getPhysicsFileName();fetch(`${this._modelHomeDir}${S}`).then(p=>p.arrayBuffer()).then(p=>{this.loadPhysics(p,p.byteLength),this._state=7,c()}),this._state=6}else this._state=7,c()},m=()=>{if(this._modelSetting.getExpressionCount()>0){const S=this._modelSetting.getExpressionCount();for(let p=0;p<S;p++){const M=this._modelSetting.getExpressionName(p),C=this._modelSetting.getExpressionFileName(p);fetch(`${this._modelHomeDir}${C}`).then(E=>E.arrayBuffer()).then(E=>{const I=this.loadExpression(E,E.byteLength,M);this._expressions.getValue(M)!=null&&(ae.delete(this._expressions.getValue(M)),this._expressions.setValue(M,null)),this._expressions.setValue(M,I),this._expressionCount++,this._expressionCount>=S&&(this._state=5,d())})}this._state=4}else this._state=5,d()};if(this._modelSetting.getModelFileName()!=""){const S=this._modelSetting.getModelFileName();var x=this;xs.getItem(S).then(function(p){p===null?fetch(`${x._modelHomeDir}${S}`).then(M=>M.arrayBuffer()).then(M=>{xs.setItem(S,M).then(function(C){j.printMessage("success store "+S)}).catch(function(C){j.printMessage(C)}),x.loadModel(M,x._mocConsistency),x._state=3,m()}):(x.loadModel(p,x._mocConsistency),x._state=3,m(),j.printMessage("load model from client storage!")),x._state=2}).catch(function(p){j.printMessage(p)})}else j.printMessage("Model data does not exist.")}setupTextures(){if(this._state==20){const e=this._modelSetting.getTextureCount();for(let i=0;i<e;i++){if(this._modelSetting.getTextureFileName(i)==""){console.log("getTextureFileName null");continue}let s=this._modelSetting.getTextureFileName(i);s=this._modelHomeDir+s;const a=l=>{this.getRenderer().bindTexture(i,l.id),this._textureCount++,this._textureCount>=e&&(this._state=22)};q.getInstance().getTextureManager().createTextureFromPngFile(s,!0,a),this.getRenderer().setIsPremultipliedAlpha(!0)}this._state=21}}reloadRenderer(){this.deleteRenderer(),this.createRenderer(),this.setupTextures()}update(){if(this._state!=22)return;const t=j.getDeltaTime();this._userTimeSeconds+=t,this._dragManager.update(t),this._dragX=this._dragManager.getX(),this._dragY=this._dragManager.getY();let e=!1;if(this._model.loadParameters(),this._motionManager.isFinished()?this.startRandomMotion(vn,Bn):e=this._motionManager.updateMotion(this._model,t),this._model.saveParameters(),e||this._eyeBlink!=null&&this._eyeBlink.updateParameters(this._model,t),this._expressionManager!=null&&this._expressionManager.updateMotion(this._model,t),this._model.addParameterValueById(this._idParamAngleX,this._dragX*30),this._model.addParameterValueById(this._idParamAngleY,this._dragY*30),this._model.addParameterValueById(this._idParamAngleZ,this._dragX*this._dragY*-30),this._model.addParameterValueById(this._idParamBodyAngleX,this._dragX*10),this._model.addParameterValueById(this._idParamEyeBallX,this._dragX),this._model.addParameterValueById(this._idParamEyeBallY,this._dragY),this._breath!=null&&this._breath.updateParameters(this._model,t),this._physics!=null&&this._physics.evaluate(this._model,t),this._lipsync){let i=0;this._wavFileHandler.update(t),i=this._wavFileHandler.getRms();for(let s=0;s<this._lipSyncIds.getSize();++s)this._model.addParameterValueById(this._lipSyncIds.at(s),i,.8)}this._pose!=null&&this._pose.updateParameters(this._model,t),this._model.update()}startMotion(t,e,i,s){if(i==_r)this._motionManager.setReservePriority(i);else if(!this._motionManager.reserveMotion(i))return this._debugMode&&j.printMessage("[APP]can't start motion."),Ye;const a=this._modelSetting.getMotionFileName(t,e),l=`${t}_${e}`;let n=this._motions.getValue(l),h=!1;n==null?fetch(`${this._modelHomeDir}${a}`).then(d=>d.arrayBuffer()).then(d=>{n=this.loadMotion(d,d.byteLength,null,s);let m=this._modelSetting.getMotionFadeInTimeValue(t,e);m>=0&&n.setFadeInTime(m),m=this._modelSetting.getMotionFadeOutTimeValue(t,e),m>=0&&n.setFadeOutTime(m),n.setEffectIds(this._eyeBlinkIds,this._lipSyncIds),h=!0}):n.setFinishedMotionHandler(s);const c=this._modelSetting.getMotionSoundFileName(t,e);if(c.localeCompare("")!=0){let d=c;d=this._modelHomeDir+d,this._wavFileHandler.start(d)}return this._debugMode&&j.printMessage(`[APP]start motion: [${t}_${e}`),this._motionManager.startMotionPriority(n,h,i)}startRandomMotion(t,e,i){if(this._modelSetting.getMotionCount(t)==0)return Ye;const s=Math.floor(Math.random()*this._modelSetting.getMotionCount(t));return this.startMotion(t,s,e,i)}setExpression(t){const e=this._expressions.getValue(t);this._debugMode&&j.printMessage(`[APP]expression: [${t}]`),e!=null?this._expressionManager.startMotionPriority(e,!1,_r):this._debugMode&&j.printMessage(`[APP]expression[${t}] is null`)}setRandomExpression(){if(this._expressions.getSize()==0)return;const t=Math.floor(Math.random()*this._expressions.getSize());for(let e=0;e<this._expressions.getSize();e++)if(e==t){const i=this._expressions._keyValues[e].first;this.setExpression(i);return}}motionEventFired(t){vt("{0} is fired on LAppModel!!",t.s)}hitTest(t,e,i){if(this._opacity<1)return!1;const s=this._modelSetting.getHitAreasCount();for(let a=0;a<s;a++)if(this._modelSetting.getHitAreaName(a)==t){const l=this._modelSetting.getHitAreaId(a);return this.isHit(l,e,i)}return!1}preLoadMotionGroup(t){for(let e=0;e<this._modelSetting.getMotionCount(t);e++){const i=this._modelSetting.getMotionFileName(t,e),s=`${t}_${e}`;this._debugMode&&j.printMessage(`[APP]load motion: ${i} => [${s}]`),fetch(`${this._modelHomeDir}${i}`).then(a=>a.arrayBuffer()).then(a=>{const l=this.loadMotion(a,a.byteLength,s);let n=this._modelSetting.getMotionFadeInTimeValue(t,e);n>=0&&l.setFadeInTime(n),n=this._modelSetting.getMotionFadeOutTimeValue(t,e),n>=0&&l.setFadeOutTime(n),l.setEffectIds(this._eyeBlinkIds,this._lipSyncIds),this._motions.getValue(s)!=null&&ae.delete(this._motions.getValue(s)),this._motions.setValue(s,l),this._motionCount++,this._motionCount>=this._allMotionCount&&(this._state=20,this._motionManager.stopAllMotions(),this._updating=!1,this._initialized=!0,this.createRenderer(),this.setupTextures(),this.getRenderer().startUp(b))})}}releaseMotions(){this._motions.clear()}releaseExpressions(){this._expressions.clear()}doDraw(){if(this._model==null)return;const t=[0,0,H.width,H.height];this.getRenderer().setRenderState(Pi,t),this.getRenderer().drawModel()}draw(t){this._model!=null&&this._state==22&&(t.multiplyByMatrix(this._modelMatrix),this.getRenderer().setMvpMatrix(t),this.doDraw())}async hasMocConsistencyFromFile(){if(xt(this._modelSetting.getModelFileName().localeCompare("")),this._modelSetting.getModelFileName()!=""){const t=this._modelSetting.getModelFileName(),i=await(await fetch(`${this._modelHomeDir}${t}`)).arrayBuffer();return this._consistency=Pe.hasMocConsistency(i),this._consistency?vt("Consistent MOC3."):vt("Inconsistent MOC3."),this._consistency}else j.printMessage("Model data does not exist.")}}let Jt=null;class Xt{constructor(){this._finishedMotion=t=>{j.printMessage("Motion Finished:"),console.log(t)},this._viewMatrix=new Z,this._models=new L,this._sceneIndex=0,this.changeScene(this._sceneIndex)}static getInstance(){return Jt==null&&(Jt=new Xt),Jt}static releaseInstance(){Jt!=null&&(Jt=void 0),Jt=null}getModel(t){return t<this._models.getSize()?this._models.at(t):null}releaseAllModel(){for(let t=0;t<this._models.getSize();t++)this._models.at(t).release(),this._models.set(t,null);this._models.clear()}onDrag(t,e){for(let i=0;i<this._models.getSize();i++){const s=this.getModel(i);s&&s.setDragging(t,e)}}onTap(t,e){j.printMessage(`[APP]tap point: {x: ${t.toFixed(2)} y: ${e.toFixed(2)}}`);for(let i=0;i<this._models.getSize();i++)this._models.at(i).hitTest(gr,t,e)?(j.printMessage(`[APP]hit area: [${gr}]`),this._models.at(i).setRandomExpression()):this._models.at(i).hitTest(dr,t,e)&&(j.printMessage(`[APP]hit area: [${dr}]`),this._models.at(i).startRandomMotion(Cn,bn,this._finishedMotion))}onUpdate(){const{width:t,height:e}=H,i=this._models.getSize();for(let s=0;s<i;++s){const a=new Z,l=this.getModel(s);l.getModel()&&(l.getModel().getCanvasWidth()>1&&t<e?(l.getModelMatrix().setWidth(2),a.scale(1,t/e)):a.scale(e/t,1),this._viewMatrix!=null&&a.multiplyByMatrix(this._viewMatrix)),l.update(),l.draw(a)}}nextScene(){const t=(this._sceneIndex+1)%xn;this.changeScene(t)}changeScene(t){this._sceneIndex=t,j.printMessage(`[APP]model index: ${this._sceneIndex}`);const e=Si[t],i=Ps+e+"/";let s=Si[t];s+=".model3.json",this.releaseAllModel(),this._models.pushBack(new Pl),this._models.at(0).loadAssets(i,s)}setViewMatrix(t){for(let e=0;e<16;e++)this._viewMatrix.getArray()[e]=t.getArray()[e]}}class Ml{constructor(){this._textures=new L}release(){for(let t=this._textures.begin();t.notEqual(this._textures.end());t.preIncrement())b.deleteTexture(t.ptr().id);this._textures=null}createTextureFromPngFile(t,e,i){for(let a=this._textures.begin();a.notEqual(this._textures.end());a.preIncrement())if(a.ptr().fileName==t&&a.ptr().usePremultply==e){a.ptr().img=new Image,a.ptr().img.onload=()=>i(a.ptr()),a.ptr().img.src=t;return}const s=new Image;s.onload=()=>{const a=b.createTexture();b.bindTexture(b.TEXTURE_2D,a),b.texParameteri(b.TEXTURE_2D,b.TEXTURE_MIN_FILTER,b.LINEAR_MIPMAP_LINEAR),b.texParameteri(b.TEXTURE_2D,b.TEXTURE_MAG_FILTER,b.LINEAR),e&&b.pixelStorei(b.UNPACK_PREMULTIPLY_ALPHA_WEBGL,1),b.texImage2D(b.TEXTURE_2D,0,b.RGBA,b.RGBA,b.UNSIGNED_BYTE,s),b.generateMipmap(b.TEXTURE_2D),b.bindTexture(b.TEXTURE_2D,null);const l=new wl;l!=null&&(l.fileName=t,l.width=s.width,l.height=s.height,l.id=a,l.img=s,l.usePremultply=e,this._textures.pushBack(l)),i(l)},s.src=t}releaseTextures(){for(let t=0;t<this._textures.getSize();t++)this._textures.set(t,null);this._textures.clear()}releaseTextureByTexture(t){for(let e=0;e<this._textures.getSize();e++)if(this._textures.at(e).id==t){this._textures.set(e,null),this._textures.remove(e);break}}releaseTextureByFilePath(t){for(let e=0;e<this._textures.getSize();e++)if(this._textures.at(e).fileName==t){this._textures.set(e,null),this._textures.remove(e);break}}}class wl{constructor(){this.id=null,this.width=0,this.height=0}}class sa extends Z{constructor(){super(),this._screenLeft=0,this._screenRight=0,this._screenTop=0,this._screenBottom=0,this._maxLeft=0,this._maxRight=0,this._maxTop=0,this._maxBottom=0,this._maxScale=0,this._minScale=0}adjustTranslate(t,e){this._tr[0]*this._maxLeft+(this._tr[12]+t)>this._screenLeft&&(t=this._screenLeft-this._tr[0]*this._maxLeft-this._tr[12]),this._tr[0]*this._maxRight+(this._tr[12]+t)<this._screenRight&&(t=this._screenRight-this._tr[0]*this._maxRight-this._tr[12]),this._tr[5]*this._maxTop+(this._tr[13]+e)<this._screenTop&&(e=this._screenTop-this._tr[5]*this._maxTop-this._tr[13]),this._tr[5]*this._maxBottom+(this._tr[13]+e)>this._screenBottom&&(e=this._screenBottom-this._tr[5]*this._maxBottom-this._tr[13]);const i=new Float32Array([1,0,0,0,0,1,0,0,0,0,1,0,t,e,0,1]);Z.multiply(i,this._tr,this._tr)}adjustScale(t,e,i){const s=this.getMaxScale(),a=this.getMinScale(),l=i*this._tr[0];l<a?this._tr[0]>0&&(i=a/this._tr[0]):l>s&&this._tr[0]>0&&(i=s/this._tr[0]);const n=new Float32Array([1,0,0,0,0,1,0,0,0,0,1,0,t,e,0,1]),h=new Float32Array([i,0,0,0,0,i,0,0,0,0,1,0,0,0,0,1]),c=new Float32Array([1,0,0,0,0,1,0,0,0,0,1,0,-t,-e,0,1]);Z.multiply(c,this._tr,this._tr),Z.multiply(h,this._tr,this._tr),Z.multiply(n,this._tr,this._tr)}setScreenRect(t,e,i,s){this._screenLeft=t,this._screenRight=e,this._screenBottom=i,this._screenTop=s}setMaxScreenRect(t,e,i,s){this._maxLeft=t,this._maxRight=e,this._maxTop=s,this._maxBottom=i}setMaxScale(t){this._maxScale=t}setMinScale(t){this._minScale=t}getMaxScale(){return this._maxScale}getMinScale(){return this._minScale}isMaxScale(){return this.getScaleX()>=this._maxScale}isMinScale(){return this.getScaleX()<=this._minScale}getScreenLeft(){return this._screenLeft}getScreenRight(){return this._screenRight}getScreenBottom(){return this._screenBottom}getScreenTop(){return this._screenTop}getMaxLeft(){return this._maxLeft}getMaxRight(){return this._maxRight}getMaxBottom(){return this._maxBottom}getMaxTop(){return this._maxTop}}var vs;(r=>{r.CubismViewMatrix=sa})(vs||(vs={}));class Il{constructor(t,e,i,s,a){this._rect=new Rl,this._rect.left=t-i*.5,this._rect.right=t+i*.5,this._rect.up=e+s*.5,this._rect.down=e-s*.5,this._texture=a,this._vertexBuffer=null,this._uvBuffer=null,this._indexBuffer=null,this._positionLocation=null,this._uvLocation=null,this._textureLocation=null,this._positionArray=null,this._uvArray=null,this._indexArray=null,this._firstDraw=!0}release(){this._rect=null,b.deleteTexture(this._texture),this._texture=null,b.deleteBuffer(this._uvBuffer),this._uvBuffer=null,b.deleteBuffer(this._vertexBuffer),this._vertexBuffer=null,b.deleteBuffer(this._indexBuffer),this._indexBuffer=null}getTexture(){return this._texture}render(t){if(this._texture!=null){if(this._firstDraw){this._positionLocation=b.getAttribLocation(t,"position"),b.enableVertexAttribArray(this._positionLocation),this._uvLocation=b.getAttribLocation(t,"uv"),b.enableVertexAttribArray(this._uvLocation),this._textureLocation=b.getUniformLocation(t,"texture"),b.uniform1i(this._textureLocation,0),this._uvArray=new Float32Array([1,0,0,0,0,1,1,1]),this._uvBuffer=b.createBuffer();{const e=H.width,i=H.height;this._positionArray=new Float32Array([(this._rect.right-e*.5)/(e*.5),(this._rect.up-i*.5)/(i*.5),(this._rect.left-e*.5)/(e*.5),(this._rect.up-i*.5)/(i*.5),(this._rect.left-e*.5)/(e*.5),(this._rect.down-i*.5)/(i*.5),(this._rect.right-e*.5)/(e*.5),(this._rect.down-i*.5)/(i*.5)]),this._vertexBuffer=b.createBuffer()}this._indexArray=new Uint16Array([0,1,2,3,2,0]),this._indexBuffer=b.createBuffer(),this._firstDraw=!1}b.bindBuffer(b.ARRAY_BUFFER,this._uvBuffer),b.bufferData(b.ARRAY_BUFFER,this._uvArray,b.STATIC_DRAW),b.vertexAttribPointer(this._uvLocation,2,b.FLOAT,!1,0,0),b.bindBuffer(b.ARRAY_BUFFER,this._vertexBuffer),b.bufferData(b.ARRAY_BUFFER,this._positionArray,b.STATIC_DRAW),b.vertexAttribPointer(this._positionLocation,2,b.FLOAT,!1,0,0),b.bindBuffer(b.ELEMENT_ARRAY_BUFFER,this._indexBuffer),b.bufferData(b.ELEMENT_ARRAY_BUFFER,this._indexArray,b.DYNAMIC_DRAW),b.bindTexture(b.TEXTURE_2D,this._texture),b.drawElements(b.TRIANGLES,this._indexArray.length,b.UNSIGNED_SHORT,0)}}isHit(t,e){const{height:i}=H,s=i-e;return t>=this._rect.left&&t<=this._rect.right&&s<=this._rect.up&&s>=this._rect.down}}class Rl{}class Tl{constructor(){this._startX=0,this._startY=0,this._lastX=0,this._lastY=0,this._lastX1=0,this._lastY1=0,this._lastX2=0,this._lastY2=0,this._lastTouchDistance=0,this._deltaX=0,this._deltaY=0,this._scale=1,this._touchSingle=!1,this._flipAvailable=!1}getCenterX(){return this._lastX}getCenterY(){return this._lastY}getDeltaX(){return this._deltaX}getDeltaY(){return this._deltaY}getStartX(){return this._startX}getStartY(){return this._startY}getScale(){return this._scale}getX(){return this._lastX}getY(){return this._lastY}getX1(){return this._lastX1}getY1(){return this._lastY1}getX2(){return this._lastX2}getY2(){return this._lastY2}isSingleTouch(){return this._touchSingle}isFlickAvailable(){return this._flipAvailable}disableFlick(){this._flipAvailable=!1}touchesBegan(t,e){this._lastX=t,this._lastY=e,this._startX=t,this._startY=e,this._lastTouchDistance=-1,this._flipAvailable=!0,this._touchSingle=!0}touchesMoved(t,e){this._lastX=t,this._lastY=e,this._lastTouchDistance=-1,this._touchSingle=!0}getFlickDistance(){return this.calculateDistance(this._startX,this._startY,this._lastX,this._lastY)}calculateDistance(t,e,i,s){return Math.sqrt((t-i)*(t-i)+(e-s)*(e-s))}calculateMovingAmount(t,e){if(t>0!=e>0)return 0;const i=t>0?1:-1,s=Math.abs(t),a=Math.abs(e);return i*(s<a?s:a)}}class Vl{constructor(){this._programId=null,this._back=null,this._gear=null,this._touchManager=new Tl,this._deviceToScreen=new Z,this._viewMatrix=new sa}initialize(){const{width:t,height:e}=H,i=t/e,s=-i,a=i,l=dn,n=_n;if(this._viewMatrix.setScreenRect(s,a,l,n),this._viewMatrix.scale(cr,cr),this._deviceToScreen.loadIdentity(),t>e){const h=Math.abs(a-s);this._deviceToScreen.scaleRelative(h/t,-h/t)}else{const h=Math.abs(n-l);this._deviceToScreen.scaleRelative(h/e,-h/e)}this._deviceToScreen.translateRelative(-t*.5,-e*.5),this._viewMatrix.setMaxScale(cn),this._viewMatrix.setMinScale(gn),this._viewMatrix.setMaxScreenRect(fn,mn,pn,yn)}release(){this._viewMatrix=null,this._touchManager=null,this._deviceToScreen=null,this._gear.release(),this._gear=null,this._back.release(),this._back=null,b.deleteProgram(this._programId),this._programId=null}render(){b.useProgram(this._programId),this._back&&this._back.render(this._programId),this._gear&&this._gear.render(this._programId),b.flush();const t=Xt.getInstance();t.setViewMatrix(this._viewMatrix),t.onUpdate()}initializeSprite(){const t=H.width,e=H.height,i=q.getInstance().getTextureManager(),s=Ps;let a="";if(a=Sn,a!=""&&a!=null){const l=n=>{const h=t*.5,c=e*.5,d=n.width*2,m=e*.95;this._back=new Il(h,c,d,m,n.id)};i.createTextureFromPngFile(s+a,!1,l)}this._programId==null&&(this._programId=q.getInstance().createShader())}onTouchesBegan(t,e){this._touchManager.touchesBegan(t,e)}onTouchesMoved(t,e){const i=this.transformViewX(this._touchManager.getX()),s=this.transformViewY(this._touchManager.getY());this._touchManager.touchesMoved(t,e),Xt.getInstance().onDrag(i,s)}onTouchesEnded(t,e){const i=Xt.getInstance();i.onDrag(0,0);{const s=this._deviceToScreen.transformX(this._touchManager.getX()),a=this._deviceToScreen.transformY(this._touchManager.getY());i.onTap(s,a),this._gear.isHit(t,e)&&i.nextScene()}}transformViewX(t){const e=this._deviceToScreen.transformX(t);return this._viewMatrix.invertTransformX(e)}transformViewY(t){const e=this._deviceToScreen.transformY(t);return this._viewMatrix.invertTransformY(e)}transformScreenX(t){return this._deviceToScreen.transformX(t)}transformScreenY(t){return this._deviceToScreen.transformY(t)}}let H=null,Nt=null,b=null,Pi=null;class q{static getInstance(){return Nt==null&&(Nt=new q),Nt}static releaseInstance(){Nt!=null&&Nt.release(),Nt=null}initialize(){return H=document.getElementById("live2d"),H.width=H.width,H.height=H.height,b=H.getContext("webgl")||H.getContext("experimental-webgl"),b?(Pi||(Pi=b.getParameter(b.FRAMEBUFFER_BINDING)),b.enable(b.BLEND),b.blendFunc(b.SRC_ALPHA,b.ONE_MINUS_SRC_ALPHA),"ontouchend"in H?(H.ontouchstart=Dl,H.ontouchmove=Ll,H.ontouchend=Ol,H.ontouchcancel=kl):(H.onmousedown=El,window.onmousemove=Al,H.onmouseup=Fl),this._view.initialize(),this.initializeCubism(),!0):(alert("Cannot initialize WebGL. This browser does not support."),b=null,document.body.innerHTML="This browser does not support the <code>&lt;canvas&gt;</code> element.",!1)}onResize(){this._resizeCanvas(),this._view.initialize(),this._view.initializeSprite();const t=[0,0,H.width,H.height];b.viewport(t[0],t[1],t[2],t[3])}release(){this._textureManager.release(),this._textureManager=null,this._view.release(),this._view=null,Xt.releaseInstance(),Y.dispose()}run(){const t=()=>{Nt!=null&&(j.updateTime(),b.clearColor(0,0,0,1),b.enable(b.DEPTH_TEST),b.depthFunc(b.LEQUAL),b.clearDepth(1),b.enable(b.BLEND),b.blendFunc(b.SRC_ALPHA,b.ONE_MINUS_SRC_ALPHA),this._view.render(),requestAnimationFrame(t))};t()}createShader(){const t=b.createShader(b.VERTEX_SHADER);if(t==null)return j.printMessage("failed to create vertexShader"),null;const e="precision mediump float;attribute vec3 position;attribute vec2 uv;varying vec2 vuv;void main(void){   gl_Position = vec4(position, 1.0);   vuv = uv;}";b.shaderSource(t,e),b.compileShader(t);const i=b.createShader(b.FRAGMENT_SHADER);if(i==null)return j.printMessage("failed to create fragmentShader"),null;const s="precision mediump float;varying vec2 vuv;uniform sampler2D texture;void main(void){   gl_FragColor = texture2D(texture, vuv);}";b.shaderSource(i,s),b.compileShader(i);const a=b.createProgram();return b.attachShader(a,t),b.attachShader(a,i),b.deleteShader(t),b.deleteShader(i),b.linkProgram(a),b.useProgram(a),a}getView(){return this._view}getTextureManager(){return this._textureManager}constructor(){this._captured=!1,this._mouseX=0,this._mouseY=0,this._isEnd=!1,this._cubismOption=new un,this._view=new Vl,this._textureManager=new Ml}initializeCubism(){this._cubismOption.logFunction=j.printMessage,this._cubismOption.loggingLevel=Pn,Y.startUp(this._cubismOption),Y.initialize(),Xt.getInstance(),j.updateTime(),this._view.initializeSprite()}_resizeCanvas(){H.width=window.innerWidth,H.height=window.innerHeight}}function El(r){if(!q.getInstance()._view){j.printMessage("view notfound");return}q.getInstance()._captured=!0;const t=r.pageX,e=r.pageY;q.getInstance()._view.onTouchesBegan(t,e)}function Al(r){if(!q.getInstance()._view){j.printMessage("view notfound");return}r.target.getBoundingClientRect();let t=r.clientX,e=r.clientY-window.innerHeight+H.height;t=t>H.width?H.width:t,e=e<0?0:e,q.getInstance()._view.onTouchesMoved(t,e)}function Fl(r){if(q.getInstance()._captured=!1,!q.getInstance()._view){j.printMessage("view notfound");return}const t=r.target.getBoundingClientRect(),e=r.clientX-t.left,i=r.clientY-t.top;q.getInstance()._view.onTouchesEnded(e,i)}function Dl(r){if(!q.getInstance()._view){j.printMessage("view notfound");return}q.getInstance()._captured=!0;const t=r.changedTouches[0].pageX,e=r.changedTouches[0].pageY;q.getInstance()._view.onTouchesBegan(t,e)}function Ll(r){if(!q.getInstance()._captured)return;if(!q.getInstance()._view){j.printMessage("view notfound");return}const t=r.target.getBoundingClientRect(),e=r.changedTouches[0].clientX-t.left,i=r.changedTouches[0].clientY-t.top;q.getInstance()._view.onTouchesMoved(e,i)}function Ol(r){if(q.getInstance()._captured=!1,!q.getInstance()._view){j.printMessage("view notfound");return}const t=r.target.getBoundingClientRect(),e=r.changedTouches[0].clientX-t.left,i=r.changedTouches[0].clientY-t.top;q.getInstance()._view.onTouchesEnded(e,i)}function kl(r){if(q.getInstance()._captured=!1,!q.getInstance()._view){j.printMessage("view notfound");return}const t=r.target.getBoundingClientRect(),e=r.changedTouches[0].clientX-t.left,i=r.changedTouches[0].clientY-t.top;q.getInstance()._view.onTouchesEnded(e,i)}window.onload=()=>{q.getInstance().initialize()!=!1&&q.getInstance().run()};window.onbeforeunload=()=>q.releaseInstance();window.onresize=()=>{hn==="auto"&&q.getInstance().onResize()};
